define("MsPortalImpl.Controls/Fields/CustomHtmlField",["require","exports","MsPortalImpl.Controls/Fields/Base/FormValidation","MsPortalImpl.Controls/Fields/Base/LabelAndBalloonWidget","MsPortalImpl.Controls/Controls/Base/Loadable","FxInternal/Css","_generated/Less/MsPortalImpl/CssLibrary/CustomForm.css","Fx/Controls/CustomHtml"],(function(t,e,s,i,o,l,a,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Widget=e.createVm=void 0,(0,l.injectCss)(a),Object.defineProperty(e,"createVm",{enumerable:!0,get:function(){return n.create}});class r extends o.Widget{constructor(t,e,s){super(t,e,s),this._vms=ko.observableArray(),this.element.addClass("msportalfx-customHtml").addClass("msportalfx-form-formelement"),this._htmlContentDiv=$(FxImpl.createElement("div",{class:"azc-formElementContainer","data-bind":"untrustedHtml: { html: htmlTemplate, data: innerViewModel, isolated: isolated }"}));const o=new i.LabelAndBalloonWidgetHelper(this._diContainer,this.ltm,MsPortalFx.extend({infoBalloonTabbable:!0},e));o.appendWidgetToDom(this.element,this._htmlContentDiv),o.attachSubLabelClass(this.element),o.attachKeyboardEvents(this.element),o.insertLabelBefore(this._htmlContentDiv),o.insertSubLabelAfter(this._htmlContentDiv),this._bindElement(e,this._htmlContentDiv),this._updateTemplate(),this.options.htmlTemplate.subscribe(this.ltm,(()=>{this._updateTemplate()}))}dispose(){this._cleanElement("msportalfx-form-formelement","msportalfx-customHtml"),this._htmlContentDiv&&(this._cleanDescendants(),this._htmlContentDiv.remove(),this._htmlContentDiv=null),super.dispose()}get options(){return this._options}_updateTemplate(){const t=s.gatherFormFields(this._htmlContentDiv,!0).map((t=>t.viewmodel));this._vms(t),this._vmsLifetimeManager&&this._vmsLifetimeManager.dispose(),this._vmsLifetimeManager=this.ltm.createChildLifetime(),ko.reactor(this._vmsLifetimeManager,(()=>{const t=this._vms();this.options.dirty(t.some((t=>t&&t.dirty&&t.dirty())))})),ko.reactor(this._vmsLifetimeManager,(()=>{const t=this._vms();this.options._msPortalFxRequired(t.some((t=>t&&t._msPortalFxRequired&&t._msPortalFxRequired())))})),ko.reactor(this._vmsLifetimeManager,(()=>{const t=s.gatherFormFields(this._htmlContentDiv,!0).map((t=>t.viewmodel));this.options.valid(t.every((t=>!t||!t.valid||t.valid())))})),this.options._msPortalFxClearValidation((()=>{const t=[];return this._vms().forEach((e=>{if("function"==typeof e.clearValidation){const s=e.clearValidation();s&&t.push(s)}})),Promise.all(t)})),this.options._msPortalFxTriggerValidation((()=>{const t=this._vms().map((t=>{if("function"==typeof t.triggerValidation)return t.triggerValidation()})).filter(MsPortalFx.identity);return Promise.all(t).then((t=>t.every(MsPortalFx.identity)))}))}}e.Widget=r}));