define("MsPortalImpl.Controls/Fields/Section.shim",["require","exports","Weave/DirectMode","FxInternal/WeaveControls/Section.Component.Internal","Weave","FxInternal/Weave","MsPortalImpl/Weave/Components","FxInternal/Weave/Components/PcControl","FxInternal"],(function(t,e,a,i,s,n,o,l,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isAmdViewModel=e.isHtmlContent=e.shimFxSectionVMToSectionInnerProps=e.tryWeaveSectionInnerContent=void 0;const d=MsPortalFx.isFeatureEnabled("weavesection");function c(e,i){const d=(0,n.toComputation)(e.dirty);return{name:i?null:(0,n.toComputation)(e.name).compose((e=>e?a(o.HtmlOrKo,{require:t,content:e}):null)),children:(0,n.toComputation)(e.children).composeArray(r.identity).cMap(n.toValueOrComputation).cMap((function(e){return a(s.Fragment,null,function(e){if(h(e))return a("div",{className:"fxt-tabs-inner"},a(o.Ko,{content:e,require:t}));if(e)return a(l.PcControl,{className:15===e.controlType?null:"fxc-section-control",vm:e,container:null})}(e),a(s.Aggregatable,{dirty:d}))})),disabled:(0,n.toComputation)(e.disabled),leftLabelPosition:!(!e.leftLabelPosition||!e.leftLabelPosition()),leftLabelWidth:e.leftLabelWidth&&e.leftLabelWidth(),smartAlignLabel:!!e.smartAlignLabel}}function h(t){return t&&t.htmlTemplate&&23!==t.controlType}function m(t){return!!t.leftLabelWidth||!!t.smartAlignLabel}e.tryWeaveSectionInnerContent=function(t){const e=t.vm;if(d&&m(e)&&1===e.style())return(0,i.SectionInner)(c(e,!1),void 0)},e.shimFxSectionVMToSectionInnerProps=c,e.isHtmlContent=h,e.isAmdViewModel=m})),
define("MsPortalImpl.Controls/Fields/Section",["require","exports","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/TsxStringMode/Tsx","_generated/MsPortalImpl/Svg/Startup/Ellipsis.svg","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Interactions/Interactions.DismissHandler","Viva.Controls/Util/Viva.TemplateEngine","MsPortalImpl.Controls/Controls/Base/Loadable","MsPortalImpl/Base/Base.SvgHelper","MsPortalImpl/Base/JQueryHelper","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Base/Base.Timers","Viva.Controls/Util/Viva.Resize","MsPortalImpl/Widgets/Widgets.Common","MsPortalImpl/Weave/Util","MsPortalImpl.Controls/Fields/Section.shim","FxInternal/Css","FxInternal/_generated/Less/WeaveControls/Section.Component.css","MsPortalImpl.Controls/Fields/Base/LabelAndBalloonWidget","Fx/Controls/Section"],(function(t,e,a,i,s,n,o,l,r,d,c,h,m,u,b,p,f,g,v,_,x,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Section=e.Widget=e.tryWeaveInnerContent=e.createVm=void 0,(0,v.injectCss)(_);var w=MsPortalFx.Base.Diagnostics.Telemetry;const y=window.document.implementation.createHTMLDocument(""),I="fxc-section",S="fxc-section-name",T="fxc-section-wrapper",M="fxc-section-row",F="fxc-section-column",P="fxc-section-dependent",B="fxc-section-tabs",W="fxc-section-control",L="fxc-section-singlecontrol",H="fxc-tabs-menu",O="fxc-tabs-menu-content",k="fxc-tabs-menu-open",A="fxc-tabs-itemslist",D="fxc-tabs-container",E="fxc-section-tab-item",K="fxc-section-tab-item-icon",N="fxc-tab-invalid-icon",q="msportalfx-form",V="msportalfx-form-regular",U="fxc-left-label-fixed",z="fxc-smart-labels",R="msportalfx-tooltip-overflow",j="fxs-portal-border",J=a(i.KoIf,{condition:"$parent.allowClosableTabs"},a("span",{class:K,"data-bind":{image:"MsPortalFx.Base.Images.Discard()"}})),Q=(t=!1)=>a(i.KoIf,{condition:"$data && $data.visible && ko.unwrap($data.visible)"},a("div",{role:"tab",class:E,"data-bind":{attr:{id:`$ctl._tabUsedId($index(), ${t}, false)`,tabindex:`$ctl._focused($index(), ${t})`,"aria-controls":`$ctl._tabUsedId($index(), ${t}, true)`,"aria-selected":'$data.active() ? "true" : "false"',"aria-setsize":"$ctl._tabSetSize","aria-posinset":"$ctl._tabPosInSet($index())","aria-invalid":"!$data.valid()","aria-disabled":"$data.disabled","aria-describedby":"$data.required && $data.required() ? $ctl._requiredDescId : null"},css:{"azc-br-active fxs-portal-text":"$data.active()","fxc-section-tab-dirty":"$data.dirty","fxc-tab-disabled azc-fill-disabled":"$data.disabled","fxc-tab-required-item":"$data.required && $data.required() && !(!$data.valid() && $parent.showValidationStatusOnTabs && $parent.showValidationStatusOnTabs())"}}},a("span",{class:[O,R]},a(i.KoIf,{condition:"!$data.valid() && $parent.showValidationStatusOnTabs"},a("span",{title:x.errorLabel,"aria-label":x.errorLabel,role:"img",class:N,"data-bind":{image:`MsPortalFx.Base.Images.StatusBadge.Critical({customClass: "${x.errorSvgClass}",})`}})),a("span",{"data-bind":{untrustedContent:"$data.name"}}),J),a("span",{"aria-hidden":"true",class:[O,R,"fxc-section-tab-placeholder"]},a(i.KoIf,{condition:"!$data.valid() && $parent.showValidationStatusOnTabs"},a("span",{title:x.errorLabel,"aria-label":x.errorLabel,role:"img",class:N,"data-bind":{image:`MsPortalFx.Base.Images.StatusBadge.Critical({customClass: "${x.errorSvgClass}",})`}})),a("span",{"data-bind":{untrustedContent:"$data.name"}}),J))),G=a(i.Root,null,a(i.KoIf,{condition:"$data.name"},a("div",{class:["fxc-section-legend azc-br-muted",S],"data-bind":{untrustedContent:"$data.name"}})),a(i.KoIf,{condition:"$data.style() === 4"},a("div",{class:[D,j]},a("div",{role:"tablist",class:[A,"fxc-tabs-headers"],"data-bind":{css:{"fxc-tab-required":"$data.showRequiredStatusOnTabs","fxc-tab-invalid":"$data.showValidationStatusOnTabs"}}},a(i.KoForEach,{items:"$data.children"},Q())),a("div",{class:H},a("span",{tabindex:"0",role:"button","aria-expanded":"false",class:"fxs-portal-svg-secondary","data-bind":{attr:{"aria-label":"$ctl._menuBtnAriaLabel",title:"$ctl._menuBtnAriaLabel"}}},(0,c.getSvgReferenceOrFallBackToData)(s).outerHTML),a("div",{class:[A,"azc-bg-default","msportalfx-shadow-level2"]},a(i.KoForEach,{items:"$data.children"},Q(!0)))),a("label",{class:"fxs-hide-accessible-label","data-bind":{attr:{id:"$ctl._requiredDescId"}}},o.required)),a(i.KoForEach,{items:"$data.children"},a(i.KoIf,{condition:"$data"},a("div",{role:"tabpanel","data-bind":{pcControl:"$data.tabSection",visible:"visible() && active()",attr:{id:"$ctl._panelUsedId($index(), false)","aria-labelledby":"$ctl._panelUsedId($index(), true)"}}})))),a(i.KoIfNot,{condition:"$data.style() === 4"},a(i.KoForEach,{items:"$data.children"},a(i.KoIf,{condition:"$ctl._verifyHtmlContent($data)"},a("div",{class:"fxt-tabs-inner","data-bind":{untrustedContent:"$data"}})),a(i.KoIfNot,{condition:"$ctl._verifyHtmlContent($data)"},a(i.KoIf,{condition:"$ctl._verifyDynamicSection($data)"},a("div",{"data-bind":{pcControl:"$data",style:{width:"$ctl._applyWidth($data, $parent, $index())"}}})),a(i.KoIfNot,{condition:"$data && $ctl._verifyDynamicSection($data)"},a("div",{class:W,"data-bind":{pcControl:"$data"}})))))),X=a(i.KoTemplate,{options:"{ name: 'sectionTemplate', data: $data.data }"}),Y=[M,F,B,T,P,j,L].join(" "),Z={};Z[3]=M,Z[0]=F,Z[4]=B,Z[2]=T+" "+P+" "+j,Z[6]=T+" "+L;const tt="MouseClick",et="KeyboardEvent",at="OnLoad",it="Programmatically";Object.defineProperty(e,"createVm",{enumerable:!0,get:function(){return C.create}}),e.tryWeaveInnerContent=g.tryWeaveSectionInnerContent;class st extends d.Widget{constructor(t,e,a){super(t,e,a),this._populateTimer=null,this._activeChangedByWidget=!1,this._hasColumn=ko.observable(!1),this._panelBaseId=MsPortalFx.getUniqueId(),this._tabBaseId=MsPortalFx.getUniqueId(),this._focusedTab=ko.observable(0),this._menuBtnAriaLabel=o.CommandBar.more,this._requiredDescId=MsPortalFx.getUniqueId(),this._setTabOverflowContent=this.weaveContext?null:(0,u.throttleByAnimationFrame)((()=>{const t=this.element.find(`.${H}`).outerWidth()||0,e=$(this.element.find(`.${D} > div.${A}`)[0]),a=e.find(`> .${E}`);let i=e.width()-t;i<=0&&(i=320);let s=0,n=0;if(this._tabHeaders=[],a.each(((t,e)=>{this._tabHeaders.push($(e));const a=this.options.children()[t];a&&a.active()&&(n=t)})),n>0){for(let t=n;t>=0;t--){const e=$(a[t]);s+=e.outerWidth(!0),e.toggleClass("fxc-section-tab-item-hidden",s>i)}n++}for(let t=n;t<a.length;t++){const e=$(a[t]);s+=e.outerWidth(!0),e.toggleClass("fxc-section-tab-item-hidden",s>i)}$(this.element.find(`.${H}`)[0]).toggleClass("fxc-tabs-menu-active",s>i)})),this._appliedWidthSubscription=new Map;const i=this.options,s=i.children,l=this.ltm,d=4===i.style();let c;i.disableStyles||t.addClass(I),(0,g.isAmdViewModel)(i)&&ko.unwrap(i.leftLabelWidth)&&t.addClass(q).addClass(V).addClass(U),this.weaveContext||(4===i.style()&&(this._tabSetSize=ko.computed(l,[i.children],(t=>t.length))),t.html(X),(this.templateEngine=new r.StringTemplateEngine).setTemplate("sectionTemplate",G),this._bindDescendants()),t.find(`.${S}`).each(((t,e)=>{const a=`azc-form-guid-${MsPortalFx.getUniqueId()}`;e.id=a,$(e.parentElement).find(`.${W}`).each(((t,e)=>{$(e).attr("aria-labelledby",a),$(e).attr("role")||$(e).attr("role","group")}))}));const f=(0,u.throttleByAnimationFrame)((e=>{c!==e&&(c=e,c>480?t.addClass(V).addClass(U):t.removeClass(V).removeClass(U))}));if((0,g.isAmdViewModel)(i)&&i.smartAlignLabel&&(t.addClass(q).addClass(z),f(this.element.width()),d||(0,b.track)(l,this.element.first(),(t=>{f(t)}))),d){const e=ko.contextFor(t[0]),a=e&&e.$partName;this._extensionName=e&&e.$extensionName,this._extensionName&&(this._telemetrySource=["Extension",this._extensionName,"Blade",a].join("/"));const o=i.telemetrySource;o&&(this._extensionName=o.extension,this._telemetrySource=o.source);const r=s;let d;if(!this.weaveContext){$(window).setEvents(["resize",()=>{this._toggleMenu(!1)}]);let t=MsPortalFx.find(r(),(t=>t&&ko.unwrap(t.active)));if(!t){const e=r()[0];e&&e.active&&(t=e)}t&&this._tabActivated(t,this.options,at),i._msPortalFxSetFocusOnTab&&i._msPortalFxSetFocusOnTab.subscribeAndRun(l,(t=>{if(!MsPortalFx.isNullOrUndefined(t)){const e=this.element.closest(".fxs-blade");if(e.find(":focus").length||e[0]===document.activeElement){const e=this._tabSetSize();if(e&&t>-1&&t<=e){const a=nt(t,0,e-1);this._focusedTab(a),setTimeout((()=>{this._tabHeaders&&this._tabHeaders[a]&&this._tabHeaders[a].focus()}),50)}}}})),r.map(l,((t,e)=>{e&&15===e.controlType&&e.active.subscribe(t,(t=>{t&&!this._activeChangedByWidget&&(this._activeChangedByWidget=!0,this._tabActivated(e,this.options,it),this._activeChangedByWidget=!1)}))}))}const c=this.weaveContext?null:()=>{r().forEach((t=>{if(t&&15===t.controlType){const e=t.tabHasBeenLoaded;t.populateSection(),e&&!e()&&this._tabSelected(t)}}))};if(!this.weaveContext){d=!1;const t=i.showRequiredStatusOnTabs,e=i.showValidationStatusOnTabs;(t||e)&&ko.reactor(l,[t,e],(()=>{d=t()||e(),d&&c()})),this._populateTimer=setTimeout((()=>{c(),this._setTabOverflowContent()}),3e3)}if((0,b.track)(l,this.element.first(),(t=>{this.weaveContext||this._setTabOverflowContent(),(0,g.isAmdViewModel)(i)&&i.smartAlignLabel&&f(t)})),!this.weaveContext){r.subscribeAndRun(l,(()=>{this._setTabOverflowContent(),d&&c()}));const t=t=>{const e=$(t.currentTarget),a=parseInt(e.attr("aria-posinset")||e.parent().parent().attr("aria-posinset"))-1,s=ko.contextFor(t.currentTarget).$parent,o=s.children();if(ko.unwrap(this.vm.alertOnClose)&&o[a]&&o[a].dirty&&o[a].dirty()&&!window.confirm(n.Desktop.confirmEditScopeDiscard))return;const l=o[a]&&o[a].active&&o[a].active();this._tabHeaders&&this._tabHeaders.length&&this._tabHeaders.splice(a,1),o.splice(a,1),s.children(o);const r=this._tabHeaders&&this._tabHeaders.length;if(r){let t=0;a>r-1&&(t=r-1);const e=i.children()[t];e&&(l&&e.active(!0),this._tabHeaders[t].focus())}},e=(t,e)=>{if($(t.target).parents(".fxc-tabs-menu").length){const t=$(document.activeElement);e?t.prev().focus():t.next().focus()}else{const a=this._tabHeaders,i=nt(this._focusedTab()-(e?1:-1),0,this._tabSetSize()-1);if($(a[i]).is(":visible")){t.stopPropagation();const e=this._tabHeaders;this._focusedTab(i),e[i].focus()}}},a=`.${H} span[role=button]`;this.ltm.registerForDispose(this.element.setEvents(["click",`.${E}`,t=>{const e=ko.contextFor(t.currentTarget);this._tabActivated(e.$data,e.$parent,tt)}],["click",`.${K}`,e=>(t(e),!1)],["keydown",`.${E}`,a=>{switch(a.which){case 13:{a.stopPropagation();const t=ko.contextFor(a.target);this._tabActivated(t.$data,t.$parent,et);break}case 37:case 38:return e(a,!0),!1;case 39:case 40:return e(a),!1;case 46:return ko.unwrap(i.allowClosableTabs)&&t(a),!1}}],["click",a,t=>{this._toggleMenu(),t.stopPropagation()}],["keydown",a,t=>{13!==t.which&&32!==t.which&&40!==t.which||(this._toggleMenu(),t.stopPropagation())}],["keydown",`.${H}`,t=>{27===t.which&&(this._toggleMenu(!1),this.element.find(a).focus(),t.stopPropagation())}]))}}i.valid.subscribe(l,(e=>t.toggleClass("fxc-section-invalid",!e))),i.dirty.subscribe(l,(e=>t.toggleClass("fxc-section-dirty",e))),i.minHeight&&t.css("min-height",`${i.minHeight}px`),this.weaveContext||(this.ltm.registerForDispose(this.element.setEvents(["keydown",t=>{if(13===t.which){const a=e.submit();if(a)return t.stopPropagation(),a().then((t=>{}))}}])),s.subscribeAndRun(l,(e=>{m.isChrome&&(0,p.waitForBindings)(t[0]).finally((()=>{if(t.is((0,h.getUnhideSelector)())){const e=t.find("> .fxc-left-label");e.length>1&&(e.removeClass("fxc-left-label"),setTimeout((()=>{e.addClass("fxc-left-label")})))}})),this._hasColumn(3===i.style()&&e.some((t=>t.style&&0===t.style())))}))),ko.computed(l,[i.style,this._hasColumn],((e,a)=>{if(!i.disableStyles){let i=a||3!==e?Z[e]:T;i=i||T,t.removeClass(Y).addClass(i),i===M&&t.attr("role","presentation")}}))}dispose(){const t=this.options;if(this._cleanElement(I,Y,t.cssClass(),q,V,U,z||""),t.minHeight&&this.element.css("min-height",""),!this.weaveContext){const t=this._populateTimer;null!==t&&clearTimeout(t),this._populateTimer=null}super.dispose()}get options(){return this._options}_applyWidth(t,e,a){let i;if((0===t.style()||t.width&&t.width())&&4!==e.style()){let s=0,n=0;const o=e.children(),l=this._appliedWidthSubscription;o.forEach((function(t){const e=ko.unwrap(t.width);e&&(n++,s+=e)})),i=s>100?1:t.width()?o[a].width():(100-s)/(e.children().length-n),l.get(t)||l.set(t,this.options.width.subscribe(this.ltm,(i=>{this.element.attr("width",this._applyWidth(t,e,a))})))}return i?i+"%":""}_getTelemetryName(t){const e=ko.unwrap(t.telemetryName);if(e)return e;let a=ko.unwrap(t.name);return(0,g.isHtmlContent)(a)?(a=a.htmlTemplate,$($.parseHTML(a,y)).text()):a}_tabActivated(t,e,a){if(this.weaveContext)throw new Error("_tabActivated shouldn't be called in Weave mode");if(t.disabled()&&!this._activeChangedByWidget)return;let i=this._tabActivateChildLifetime;i&&i.dispose(),i=this._tabActivateChildLifetime=this.ltm.createChildLifetime();const s=ko.unwrap(e.children),n=MsPortalFx.findIndex(s,(e=>e===t));if(this._lastTabOpened){const t=new Date,e=t.getTime()-this._lastTabOpened.getTime();this._lastTabOpened=t,w.trace({action:"TabClosed",extension:this._extensionName,source:this._telemetrySource,duration:e,name:this._getTelemetryName(this._currentActiveTab),data:{index:MsPortalFx.findIndex(s,(t=>t&&t.active&&t.active()))}})}else this._lastTabOpened=new Date;t.active()?this.element.scrollTop(0):(this._activeChangedByWidget=!0,t.active(!0),this._activeChangedByWidget=!1),this._currentActiveTab=t,w.trace({action:"TabOpened",extension:this._extensionName,source:this._telemetrySource,name:this._getTelemetryName(t),actionModifier:a,data:{index:n}}),e.children.map(i,((e,a)=>{a!==t&&a&&a.active(!1)})),!t.tabHasBeenLoaded()&&this._tabSelected(t),this._toggleMenu(!1),this.element.find(".azc-br-active").is(":visible")||this._setTabOverflowContent(),this._focusedTab(n)}_tabSelected(t){if(this.weaveContext)throw new Error("_tabSelected shouldn't be called in Weave mode");t.tabHasBeenLoaded(!0);const e=t.populateSection();"function"==typeof e?e().then(t.tabSection):t.tabSection(t)}_toggleMenu(t){if(this.weaveContext)throw new Error("_toggleMenu shouldn't be called in Weave mode");const e=$(this.element.find(`.${H}`)[0]);"boolean"!=typeof t&&(t=!e.hasClass(k)),e.toggleClass(k,t).find("[role=button]").attr("aria-expanded",t);const a=t=>!!$(t).parents(".fxc-tabs-menu-open").length&&0,i={dismissFn:()=>{this._toggleMenu(!1)},shouldDismissOnFocusOutFn:a,shouldDismissOnMouseDownFn:a,shouldDismissOnMouseWheelFn:a,shouldDismissOnScroll:!1,logName:"tab menu"};if(t){if($(e.find(".fxc-section-tab-item")[0]).focus(),!this._dismissHandleLifetime||this._dismissHandleLifetime.isDisposed()){(0,l.dismissByLogName)("tab menu"),(0,l.register)(i);(this._dismissHandleLifetime=this.ltm.createChildLifetime()).registerForDispose((()=>{(0,l.unregister)(i)}))}}else this._dismissHandleLifetime&&(this._dismissHandleLifetime.dispose(),this._dismissHandleLifetime=null)}_panelUsedId(t,e){return(e?this._tabBaseId:this._panelBaseId)+t}_tabUsedId(t,e,a){const i=a?this._panelBaseId:this._tabBaseId,s=this.options.children().length;return e?i+(t+s):t<s?i+t:null}_tabPosInSet(t){return t+1}_verifyDynamicSection(t){return t&&15===t.controlType}_verifyHtmlContent(t){return(0,g.isHtmlContent)(t)}_focused(t,e){return t!==this._focusedTab()||e?"-1":"0"}}function nt(t,e,a){return Math.min(Math.max(t,e),a)}e.Widget=st,st.flightNewRender=!0,e.Section=(0,f.createControlComponentForKO)({widgetCtor:st})}));