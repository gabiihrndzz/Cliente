define("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Helpers",["require","exports","Fx/DependencyInjection","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/Services/Services.AssetTypes","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/UI/Compositions/UI.Composition.PropertyTransformers"],(function(e,t,i,s,o,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BladeRedirector=t.mapMasterModelToBladeModel=t.getBladeOpenerJourneyPathSegment=void 0;var r=MsPortalFx.Base.Constants;const l=a.PropertyTransformers.getModelToPropertyMapper(),d=a.PropertyTransformers.getDynamicSelectionMapper();t.getBladeOpenerJourneyPathSegment=function(e){const t={master:{part:e.masterPartId,property:e.masterInvocationProperty,command:e.masterCommandName}};return MsPortalFx.toSortedString(t)},t.mapMasterModelToBladeModel=function(e,t,i){const s={},o=new n.PropertyTransformerArgs(e,t,null,s,null);return o.propertyChanges.push(n.ObservableChangeArgs.forObject(i.targetProperty,t)),i.opensDynamicBlades&&d(o),i.targetProperty||l(o),o.propertyChanges.forEach((e=>{const t=e.propertyName;t&&(s[t]=e.propertyValue)})),s};let c=class{constructor(e,t){this._finder=e,this._assetTypeService=t}applyRedirects(e,t,i){const o=this._finder;let n=e;const a=e.getExtensionLocator(),l=s.Locator.forBladeRedirect(a.name,e.name),d={};if(o.tryLocate(l,d)){const e=d.value;3===e.type?n=s.Locator.forExtension("HubsExtension").withBlade(r.BladeNames.Hubs.ResourceMenuBlade):2===e.type&&(n=s.Locator.forExtension(e.toExtension||a.name).withBlade(e.toBlade))}else n=this._assetTypeService.getMappedBladeLocator(e);return n&&i&&function(e,t,i){if(!e.equals(i.locator)||!i.bladeDefinition)return!1;const o=ko.toJS(i.model);if(e.equals(s.resourceMenu))return(t.id||"").toLowerCase()===(o.id||"").toLowerCase();if(!i.bladeDefinition.inputs)return!1;return i.bladeDefinition.inputs.every((e=>t[e]===o[e]))}(n,t,i)&&(n=e),n}};t.BladeRedirector=c,t.BladeRedirector=c=__decorate([__metadata("fx:diagnostics",[e,"BladeRedirector"]),i.Class(),__metadata("design:paramtypes",[s.DefinitionFinder,o.AssetTypeService])],c)})),
define("_generated/Less/MsPortalImpl/Widgets/Widgets.BreadCrumb.css",["module"],(function(e){"use strict";return{css:".fxs-breadcrumb-wrapper{display:flex;align-items:center;height:100%;max-width:100%}.fxs-breadcrumb-wrapper>.fxs-breadcrumb-crumb{cursor:text}.fxs-breadcrumb-wrapper>.fxs-breadcrumb-crumb-active{cursor:pointer}.fxs-breadcrumb-wrapper>.fxs-breadcrumb-crumb-active:hover{text-decoration:underline}.fxs-breadcrumb-crumb{font-size:14px;flex:0 1 auto;height:100%;align-items:center;padding:0 3px;box-sizing:border-box;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.fxs-breadcrumb-divider{flex:0 0 auto;display:flex;align-items:center;justify-content:center;height:100%;text-align:center;padding:0 3px}.fxs-breadcrumb-divider svg{transform:rotate(90deg);height:10px;width:10px;margin-top:1px}.fxs-breadcrumb-overflow-btn{flex:0 0 auto;display:flex;align-items:center;justify-content:center;font-weight:200;font-size:24px;box-sizing:border-box;height:20px;width:32px;padding-bottom:14px}.fxs-breadcrumb-dropmenu{flex:0 0 auto}.fxs-breadcrumb-dropmenu .fxs-dropmenu-content{width:220px}.fxs-breadcrumb-overflow .fxs-breadcrumb-crumb{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:32px;padding:0 10px!important}.fxs-breadcrumb-container{display:flex;padding:0 17px;height:20px}.fxs-breadcrumb-crumb:not(.fxs-breadcrumb-crumb-active){display:none}",moduleId:e.id}})),
define("MsPortalImpl/Widgets/Widgets.BreadCrumb",["require","exports","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/Base.Timers","MsPortalImpl/Widgets/Widgets.WidgetBase","Viva.Controls/Util/Viva.Resize","MsPortalImpl/Interactions/Interactions.KeyboardNavigation","MsPortalImpl/Base/Base.DeepLink","WeaveDOM/DirectRender/DataAttribute","Weave/Core/Computation","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.BreadCrumb.css","MsPortalImpl/Base/Base.KeyboardHelper","Weave"],(function(e,t,i,s,o,n,a,r,l,d,c,p,u,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEV=t.Widget=t.ViewModel=void 0,(0,c.injectCss)(p);var b=MsPortalFx.Base;const h={deferred:!0},g="rootpagelink";class f extends o.ViewModel{constructor(e){super(),this.getRootPageType=e,this.breadCrumbs=ko.observableArray(),this.breadCrumbsVisibleUI=ko.observableArray([]),this.breadCrumbsOverflowUI=ko.observableArray([]),this.hasOverflow=(0,m.makeWritableComputation)(!1),this.lastVisibleIdx=(0,m.makeWritableComputation)(0)}}function v(e,t,i,s){let o;ko.computed(e,t,(t=>{const n=s?t.slice().reverse():t,a=n.length;o&&o.dispose(),o=e.createChildLifetime();const r=i(),l=a-r.length;if(l>0){const e=[];for(let t=0,i=Math.max(l,5);t<i;t++)e.push({bladeId:null,bladeTitle:ko.observable(),visible:ko.observable(!0),href:ko.observable(),isDefaultItemSelected:ko.observable(!1)});i.push.apply(i,e)}for(let e=0;e<r.length;e++){const t=r[e];if(e<a){const i=n[e];t.bladeId=i.bladeId,i.bladeTitle.subscribeAndRun(o,(e=>{t.bladeTitle(e)})),i.href.subscribeAndRun(o,(e=>{t.href(e)})),t.visible(!0),i.isDefaultItemSelected.subscribeAndRun(o,(e=>{t.isDefaultItemSelected(e)}))}else t.visible(!1)}}))}t.ViewModel=f;class y extends o.Widget{constructor(e,t){super(e,t);const o=this.element,c=this.options,p=this.ltm,m=[{bladeId:g,bladeTitle:ko.observable(""),deepLink:ko.observable("#")}],f=ko.observableArray([]);ko.computed(p,(()=>{const e=c.breadCrumbs(),s=!e.length||!e[e.length-1].bladeTitleResolved||e[e.length-1].bladeTitleResolved();ko.ignoreDependencies((()=>{const n=f().slice(),a=m.concat(e);e.length&&e[0].isCustomHome&&a.splice(1,1),a.forEach(((e,s)=>{const o=n[s]={bladeId:e.bladeId,bladeTitle:e.bladeTitle,visible:n[s]&&n[s].visible||ko.observable(!0),href:e.deepLink,isDefaultItemSelected:e.isDefaultItemSelected||ko.observable(!1)};if(e.bladeId===g){let e,s;switch(t.getRootPageType()){case"Home":e=i.AzureHome.home,s=(0,r.getHomeDeeplink)();break;case"Dashboard":e=i.NavBar.home,s=(0,r.getDefaultDashboardDeeplink)();break;default:e=i.SideBar.allServices,s=(0,r.getAllServicesDeeplink)()}o.bladeTitle(e),o.href(s)}})),n.splice(a.length),s||n.splice(n.length-1,1),MsPortalFx.deepEquals(n,f())||(o.toggleClass("fxs-display-none",n.length<2),f(n))}))}));const y=f.filter(p,(e=>!e.visible()));y.extend(h);const C=this.breadCrumbsVisible=f.filter(p,(e=>e.visible()));v(p,C,c.breadCrumbsVisibleUI,!1),v(p,y,c.breadCrumbsOverflowUI,!1);const x=o.find(".fxs-breadcrumb-container"),B=o.find(".fxs-breadcrumb-wrapper");y.subscribeAndRun(p,(e=>c.hasOverflow(e.length>0)));const M=()=>{const e=f(),t=x.width(),i=e.map((e=>{return t=e.bladeTitle(),I.measureText(t).width+6;var t}));if(i.reduce(((e,t)=>e+t),0)+16*Math.max(0,i.length-1)<=t)e.forEach((e=>e.visible(!0)));else{let s=t-32,o=e.length-1;for(;o>=0&&s>=0;)s-=16+i[o--];const n=o+1;e.forEach(((e,t)=>e.visible(!(t<=n))))}},S=s.throttleByAnimationFrame(M);n.track(p,o.first(),M),ko.computed(p,(()=>{const e=f(),t=MsPortalFx.last(e);t&&t.bladeTitle(),S()}));const P=new a.KeyboardNavigation(p,{element:B,tabTriggers:12,itemSelector:"> .fxs-breadcrumb-crumb-active, .fxs-breadcrumb-dropmenu:not(.weave-display-none2) .fxs-dropmenu-button"});p.registerForDispose([o.setEvents(["click keydown",".fxs-breadcrumb-crumb",e=>{if(u.isCtrlOrCommandOnly(e)||e.shiftKey)return!0;if("click"===e.type||13===e.which||32===e.which){const t=$(e.currentTarget),i=(0,l.getElementData)(e.currentTarget).bladeId,s=i===g;if(t.hasClass("fxs-breadcrumb-crumb-active")&&i){const e=s?void 0:{bladeId:i};b.Diagnostics.Telemetry.trace({source:"Desktop",action:s?"BreadCrumbHomeClicked":"BreadCrumbClicked",data:e}),s||t.trigger("fxbreadcrumbclick",e)}s||(e.preventDefault(),e.stopPropagation())}}])]);let _=!1;ko.computed(p,C,(e=>{c.lastVisibleIdx(e.length-1),_||(_=!0,(0,d.invokeAfterChangePropagation)((()=>{_=!1,P.correctState()})))}))}}t.Widget=y;const I=document.createElement("canvas").getContext("2d");I.font="14px az_ea_font,'Segoe UI',az_font,system-ui,-apple-system,BlinkMacSystemFont,Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif"})),
define("MsPortalImpl/Widgets/Widgets.BreadCrumb.Component",["require","exports","Weave/DirectMode","MsPortalImpl/Resources/ImplScriptResources","Weave","_generated/MsPortalImpl/Svg/Startup/CaretUp.svg","FxInternal/Weave/Util","MsPortalImpl/Widgets/Widgets.DropMenu.Component","MsPortalImpl/Widgets/Widgets.DropMenu","FxInternal/Weave"],(function(e,t,i,s,o,n,a,r,l,d){"use strict";function c(e,t){return e>0||t}function p(e,t,i,s){return e&&(i<s||!t)}Object.defineProperty(t,"__esModule",{value:!0}),t.BreadCrumbInner=void 0,t.BreadCrumbInner=function(e){const{vm:t}=e;return i("div",{className:"fxs-breadcrumb-container"},i("nav",{className:"fxs-breadcrumb-wrapper","aria-label":s.Breadcrumb.navlabel},i(o.If,{condition:t.hasOverflow,trueFn:()=>{const e=new l.ViewModel(void 0,void 0,".fxs-breadcrumb-crumb-active",!0);e.setItemFocusWhenOpen=!0,e.buttonTooltip(s.Breadcrumb.navhistory),e.alignMenu=0;const n=i("div",{className:"fxs-breadcrumb-overflow-btn fxs-portal-hover",role:"presentation"},"..."),c=i("ul",{className:"fxs-breadcrumb-overflow"},i(o.ForEach,{collection:(0,d.toComputation)(t.breadCrumbsOverflowUI),fn:({item:e})=>i("li",{className:["fxs-portal-hover",{"fxs-display-none":(0,d.toComputation)(e.visible).compose(a.negation)}]},i("a",{className:["fxs-breadcrumb-crumb",{"fxs-breadcrumb-crumb-active":(0,d.toComputation)(e.visible)}],title:(0,d.toComputation)(e.bladeTitle),href:(0,d.toComputation)(e.href),tabindex:"-1",data:e},(0,d.toComputation)(e.bladeTitle)))}));return i("div",{className:"fxs-breadcrumb-dropmenu",afterMount:(t,i)=>{i.registerForDispose(new l.Widget($(t),e,!0))}},i(r.DropMenuInner,{button:n,content:c,vm:e}))}}),i(o.ForEach,{collection:(0,d.toComputation)(t.breadCrumbsVisibleUI),fn:({item:e,index:s})=>{const r=(0,d.toComputation)(e.visible).compose(a.negation),l=(0,o.composeComputation)([(0,d.toComputation)(e.visible),(0,d.toComputation)(e.isDefaultItemSelected),s,t.lastVisibleIdx],p);return i(o.Fragment,null,i(o.If,{condition:(0,o.composeComputation)([s,t.hasOverflow],c),concealmentBehavior:"remove",trueFn:()=>i("div",{className:["fxs-breadcrumb-divider fxs-portal-svg-secondary",{"fxs-display-none":r}],image:n})}),i("a",{className:["fxs-breadcrumb-crumb fxs-portal-text",{"fxs-display-none":r,"fxs-breadcrumb-crumb-active":l}],href:(0,d.toComputation)(e.href),tabindex:"-1",data:e},(0,d.toComputation)(e.bladeTitle)))}})))}})),
define("_generated/Less/MsPortalImpl/Widgets/Widgets.Journey.css",["module"],(function(e){"use strict";return{css:".fxs-journey{overflow-x:hidden;overflow-y:auto;display:flex;flex-direction:column}.fxs-journey-layout{flex:1 1 auto;z-index:0;position:relative}.fxs-journey-layout>.fxs-blade{display:none}.fxs-journey-layout>.fxs-blade.fxs-blade-display-in-journey:last-of-type{display:flex}.fxs-journey-breadcrumb{display:none;z-index:1;box-sizing:border-box;padding-top:8px;flex:0 0 auto}.fxs-show-journey .fxs-journey-breadcrumb{display:block}@media(min-width:640px) and (min-height:500px){.fxs-journey .fxs-blade.fxs-blade-display-in-journey{display:flex}}@media(min-height:500px){.fxs-journey{overflow:hidden}.fxs-journey-layout{height:100%;overflow-x:auto;overflow-y:hidden}.fxs-blade{overflow:hidden}}@media(max-height:499.99999px){.fxs-journey .fxc-gc-vscroll{max-height:calc(100vh - 45px)}.fxs-blade{min-height:calc(100vh - 40px - 20px - 8px)}}",moduleId:e.id}})),
define("MsPortalImpl/Widgets/Widgets.Journey",["require","exports","MsPortalImpl/Widgets/Widgets.WidgetBase","MsPortalImpl/Widgets/Widgets.Blade","MsPortalImpl/Widgets/Widgets.LayoutBase","MsPortalImpl/Widgets/Widgets.StackLayout","MsPortalImpl/Widgets/Widgets.UIElementBase","MsPortalImpl/Widgets/Widgets.BreadCrumb","Viva.Controls/Util/Viva.Resize","MsPortalImpl/Base/Base.Timers","MsPortalImpl/Widgets/Widgets.BreadCrumb","MsPortalImpl/Base/Base.Router","MsPortalImpl/Widgets/Widgets.BreadCrumb.Component","MsPortalImpl/Weave/DirectRender","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.Journey.css","MsPortalImpl/Base/Base.Events"],(function(e,t,i,s,o,n,a,r,l,d,c,p,u,m,b,h,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Widget=t.ViewModel=t.EventNames=t.scrollLogDebounce=void 0,(0,b.injectCss)(h);const f=window,v=f.fx.environment,y="fxs-journey",I="fxs-blade-lastblade",C="fxs-blade-has-activation",x="fxs-blade-display-in-journey";t.scrollLogDebounce=1e3;const B=1280;t.EventNames={addingChild:"addingChild",removingChild:"removingChild"};class M extends a.ViewModel{constructor(e,t,i){super(e),this.getRootPageType=t,this.diContainer=i;const s=new n.ViewModel("fxs-journey-stacklayout-instanceid",void 0,".fxs-extension-frame");s.orientation(o.Orientation.Horizontal),this.stackLayoutOptions=s}getViewSettings(){return{}}}t.ViewModel=M;class S extends a.Widget{constructor(e,t){super(e,t),this._childElementCount=ko.observable(),this._lastBladeCalcInfo=[],this._lifetime=new FxImpl.TriggerableLifetimeManager,this._scheduleFocusOnLastChild=d.throttleByAnimationFrame((e=>{if(this.ltm&&!this.ltm.isDisposed()&&e&&this._childElementCount()>0){const e=this.options.stackLayoutOptions.childElements(),t=e[e.length-1];i.Widget.getWidget(t,s.Widget).setFocus()}})),this._loadingBladeIdList=[],e.addClass(y),e.toggleClass("fxs-journey-nobladeheader",!!v.chrome.hideBladeHeader);const o=e.find(".fxs-journey-layout");this._layout=new n.Widget(o,t.stackLayoutOptions),this._childElementCount(0);const a=[this._layout,()=>this.element.removeClass(y)],b=[["fxbladerepos",()=>{this._rePositionBlades()}]];if(t.diContainer.get(g.PortalCustomEvents).addHandler(this._lifetime,"fxdeeplinkchanged",(()=>{v.chrome.hideBreadcrumb||this.calculateBreadcrumbs()})),!v.chrome.hideBreadcrumb){const i=e.find(".fxs-journey-breadcrumb"),s=new c.ViewModel(t.getRootPageType);this._breadCrumbVM=s,(0,m.applyToElement)({element:i[0],ltm:this.ltm,weaveNode:(0,u.BreadCrumbInner)({vm:s}),weaveContext:{diContainer:t.diContainer},opName:"breadCrumb"}),a.push(new r.Widget(i,s)),b.push(["fxbreadcrumbclick",(e,t)=>{const i=t.bladeId,s=this.getBlades();for(let e=0;e<s.length;++e){const t=s[e];if(t.options.id===i){e<s.length-1&&s[e+1].close(!1),e===s.length-1?t.goToDefaultItem():t.goToFirstDetailContent();break}if(t.goToDetailContent(i)){e<s.length-1&&s[e+1].close(!1);break}}}])}this.ltm.registerForDispose(a.concat(this.element.setEvents(...b)));const h=e.parent(".fxs-panorama");this._rePositionBlades=d.throttleByAnimationFrame((()=>{if(!this.ltm||this.ltm.isDisposed())return;const e=h.width(),t=this._getBladeCalculatedInfo(),i=t.length,s=this._lastBladeCalcInfo.length;this._lastBladeCalcInfo=t,i&&t[i-1].actStyle&&setTimeout((()=>{this._rePositionBlades()}),2e3),s>i?function(e,t){const i=e.length,s=e[i-1],o=e[i-2];i>0&&(s.visibleInJourney?F(e,t)&&(o.visibleInJourney=!0):P(e,t,!0))}(t,e):s===i?P(t,e):function(e,t){const i=e.length;if(e[i-1].subjourney)for(let t=i-2;t>=0&&e[t].visibleInJourney;--t)e[t].visibleInJourney=!1;else{w(e,t).freespace<0&&_(e,i-(F(e,t)?3:2))}}(t,e);let o=!1,n=-1;t.forEach(((e,i)=>{const s=e.widget.element;!function(e,t){const i=e.widget.element,s={};let o=e.maximized?"100%":`${e.idealWidth}px`;window.innerWidth<640?o="100%":e.maximized&&t&&t.visibleInJourney&&t.actStyle&&!e.subjourney&&!e.appblade&&(o=`calc(100% - ${t.idealWidth}px)`);s.width=o,i.css(s).toggleClass(C,e.actStyle).toggleClass("fxs-blade-maximized",e.maximized).toggleClass("fxs-blade-appblade",e.appblade).toggleClass("fxs-blade-has-activation-fit",e.actStyleCanFit)}(e,t[i-1]),s.toggleClass("fxs-blade-firstblade",e.visibleInJourney&&!o).removeClass(I),e.widget.options.collapseVisible(e.actStyle),e.widget.options.hideCloseButton(!0),e.actStyle||e.widget.options.collapsed(!1),e.visibleInJourney&&(o=!0,n=i),e.widget.element.toggleClass(x,e.visibleInJourney);const a=document.getElementsByClassName("fxs-part-reactframe"),r=document.createEvent("Event");r.initEvent("resize",!0,!0);for(let e=0;e<a.length;e++)a[e].dispatchEvent(r)})),n>=0&&t[n].widget.element.addClass(I),i&&this.options.diContainer.get(p.Router).ensureRouteInView("Journey")})),l.track(this.ltm,this.element.first(),(()=>{this._rePositionBlades()}),{ignoreInitialState:!0})}hasChildren(){return this._childElementCount()>0}addChild(e){this.insertChild(e,void 0)}insertChild(e,i){const s=e.element?e.element:e,o=a.Widget.getId(s);this.trigger(t.EventNames.addingChild,o),this._scheduleFocusOnLastChild(!1),i>=0?this._layout.insertChild(e,i):this._layout.addChild(e),this._childElementCount(this._childElementCount()+1),this.trigger("fxbladerepos")}_getBladeCalculatedInfo(){const e=this.getBlades().map((e=>{const t=e.isMenuBladeLoadingDetailBlade(),i=e.bladeDefinitionLoaded&&!t;return{blade:e,pending:!i&&e.element.hasClass("fxs-blade-shows-pending"),loaded:i}})).filter((e=>e.loaded||e.pending)),t=f.fx.getTimestamp(),i=function(e,t){const i=e.length;return e.map(((e,s)=>{const o=e.blade,n=o.options,a=12===o.getContentWidget().options.bladeStyle.value,r=!a&&!e.pending&&n.useActivationStyle&&(s!==i-1||t&&o.element.hasClass(C)),l=a||e.pending||2===n.displayState()&&!r;return{widget:o,idealWidth:o.idealWidth(r),actStyle:r,maximized:l,subjourney:n.asSubJourney,visibleInJourney:o.element.hasClass(x)||!o.element[0].style.width,appblade:a}}))}(e,this._loadingBladeIdList.some((e=>e.ts+2e3>t)));return i}removeChild(e){const i=this._layout.removeChild(e);return i&&(this.trigger(t.EventNames.removingChild,e),this._childElementCount(this._childElementCount.peek()-1),this.trigger("fxbladerepos"),this._scheduleFocusOnLastChild(!0)),i}removeChildren(e){const t=this.options,i=t&&t.stackLayoutOptions&&t.stackLayoutOptions.childElements();i&&i.slice(0).forEach((t=>{const i=a.Widget.getId(t);e&&e(i),this.removeChild(i)}))}saveViewSettings(){return this.options.getViewSettings()}setFocus(){if(this._childElementCount()>0){const e=this.options.stackLayoutOptions.childElements()[0],t=i.Widget.getWidget(e,s.Widget);t&&t.setFocus()}}getBlades(){let e=[];return this._childElementCount()>0&&(e=this.options.stackLayoutOptions.childElements().map((e=>i.Widget.getWidget(e,s.Widget)))),e}close(){const e=this.getBlades()[0];e&&e.close(!1)}getFocusedBlade(){const e=$(document.activeElement).closest(".fxs-blade")[0];let t=null;return e&&(t=MsPortalFx.find(this.getBlades(),(t=>t.element[0]===e))),t}setFocusedBlade(e){const t=f.document.querySelectorAll(".fxs-blade.fxs-blade-active"),i=e.parentElement.parentElement;i.classList.add("fxs-blade-active");for(let e=0;e<t.length;++e)t[e]!==i&&t[e].classList.remove("fxs-blade-active")}loadingHint(e,t){const i=MsPortalFx.findIndex(this._loadingBladeIdList,(t=>t.id===e)),s=this._loadingBladeIdList[i],o=f.fx.getTimestamp();t?s?s.ts=o:this._loadingBladeIdList.push({id:e,ts:o}):s&&this._loadingBladeIdList.splice(i,1)}calculateBreadcrumbs(){const e=this.getBlades(),t=[];for(let i=0;i<e.length;i++){const s=i===e.length-1,o=e[i].getBreadCrumbs(s);i>0&&e[i].options.crumb()===e[i-1].options.crumb()?t[t.length-1]=o:t.push(o)}const i=MsPortalFx.mapMany(t,(e=>e));this._breadCrumbVM.breadCrumbs(i)}}function P(e,t,i=!1){_(e,w(e,t,i).unfitIdx)}function _(e,t){let i=t+1;for(;i<e.length&&!e[i].visibleInJourney;)e[i++].visibleInJourney=!0;for(;t>=0&&e[t].visibleInJourney;)e[t--].visibleInJourney=!1}function w(e,t,i=!1){const s=t,o=e.length;let n=o-1;for(;n>=0&&(i||e[n].visibleInJourney)&&t>=0&&(n===o-1||!e[n+1].subjourney);){const i=e[n];i.maximized?t=-1:t-=i.idealWidth,(t>=0||n===o-1)&&--n}return n===o-2&&F(e,s)&&--n,{freespace:t,unfitIdx:n}}function F(e,t){const i=e.length,s=e[i-1],o=e[i-2];return i>1&&o.actStyle&&!s.appblade&&!s.subjourney&&t>=B&&t>=s.idealWidth+o.idealWidth}t.Widget=S})),
define("MsPortalImpl/UI/Compositions/UI.Composition.DelayedBladeManager",["require","exports","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/UI/UI.JourneyManager","MsPortalImpl/Base/Telemetry","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Widgets/Widgets.Journey","MsPortalImpl/Widgets/Widgets.Portal.init"],(function(e,t,i,s,o,n,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DelayedBladeManager=void 0;var l=MsPortalFx.Base,d=l.Diagnostics.Telemetry;const c=l.Diagnostics.createLog(e),p=MsPortalFx.getUniqueIdGenerator("DBS");function u(e,t){e&&e.enableTrace&&c.verbose(`${t} Debug Id: '${e.debugId}'.`)}t.DelayedBladeManager=class{constructor(e,t,i){if(this._journeyEventAttached=!1,this._loadingVisible=!1,this._config=i,this._portal=(0,r.getPortalViewModel)(i.diContainer),i&&void 0===i.enableTrace&&(i.enableTrace=o.isDesktopTraceEnabled),this._loadingHintId=p(),t){let s,o,n="Selectable";if(t.delayedBladeSelection){const e=t;s=e.delayedBladeSelection,o=t=>{e.selectedValue(t),e.isSelected(!0)}}else if(t._msPortalFxDelayedBladeSelection){n="SelectableSet";const e=t;s=e._msPortalFxDelayedBladeSelection,o=t=>{e.selectedItems.splice(0,0,t),e.activateAllSelectedItems()}}s&&(d.trace({source:"Shell",action:"DelayedBladeManagerSubscribe",extension:i.extension,data:{viewModelType:n,id:i.debugId}}),this._processDelayedBladeSelection(e,s,o,i.extension))}}_loadingHintSignal(e){this._loadingVisible!==e&&(this._loadingVisible=e,this._portal.customEvents.trigger("fxloadingontopbar",{id:this._loadingHintId,cancel:!e}))}_processDelayedBladeSelection(e,t,i,s){t.subscribeAndRun(e,(t=>{t&&(this._journeyEventAttached||(this._journeyEventAttached=!0,this._portal.customEvents.addHandler(e,a.EventNames.addingChild,(()=>this._abort())),e.registerForDispose([()=>{this._loadingHintSignal(!1)}])),this._processDelayedBladeSelectionChange(t,i,s))}))}_abort(){this._currentBladeSelectionPromise=null,this._loadingHintSignal(!1)}_processDelayedBladeSelectionChange(t,o,a){const r=this._config,l=r.diContainer.get(s.JourneyManager),c=r.diContainer.get(i.Finder),p=r.getSelectableContainerComposition(),m=c.findBlades(p).filter((e=>!(1&e.flags)));if(m.length>0){if(!l.confirmBladesCanClose(m))return u(r,"Closing of detail blade(s) was cancelled by user, aborting delayed blade selection operation."),void this._abort();{const e=m[0].widget;e&&e.options.loaded(!1),u(r,"Closing all detail blades except the first one."),(m||[]).forEach(((e,t)=>{t&&l.forceCloseBlade(e)}))}}else this._currentBladeSelectionPromise||this._loadingHintSignal(!0);const b=this._currentBladeSelectionPromise=Promise.resolve(t.selectedValuePromise);MsPortalFx.tryImmediateResolve(b,(e=>{b===this._currentBladeSelectionPromise?(d.trace({source:"Shell",action:"DelayedBladeManagerOpenBlade",extension:this._config.extension,data:{selectedValue:e,id:this._config.debugId}}),this._loadingHintSignal(!1),u(r,"Activate master selectable. Value: {0}.".format(ko.toJSON(e))),o(e)):u(r,"Another delayed operation is underway, selected value will be ignored. Value: {0}.".format(ko.toJSON(e)))}),(t=>{b===this._currentBladeSelectionPromise&&this._loadingHintSignal(!1);const i=p&&p.toString()||"N/A",s=FxImpl.createError("Promise provided to Selectable.delayedBladeSelection/SelectableSet.setCreateDelayedBladeSelection has been rejected. PartId:"+i,{innerErrors:t});(0,n.logToExtension)(e,a,2,s)}))}}})),
define("MsPortalImpl/UI/Compositions/UI.Composition.SelectableSetBinder",["require","exports","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/UI/Compositions/UI.Composition.CompositionBinder"],(function(e,t,i,s){"use strict";var o;return function(e){var t=FxImpl.TriggerableLifetimeManager,o=s.CompositionBinder;class n extends t{get selectablePath(){return this._selectablePath}constructor(e,t,i,s,o,n){super(),this._diContainer=e,this._bindings=[],this._selectablePath=t,this._modelId=i,this._modelIdPostFix=s,this._inputs=o,this._referenceComposition=n,this.registerForDispose((()=>{this._bindings.forEach((e=>{e.unbind()})),this._bindings=[]}))}createTargetForSelectedItem(e){const t=this._bindElement(e,this._inputs,this._referenceComposition);return this._deleteBindings(t),t}_bindElement(e,t,s,n){const a=[],r=[];t.forEach((e=>{6===e.valuesFrom[0].referenceType?a.push(e):r.push(e)}));const l=n||{},d=this._modelId+this._modelIdPostFix,c=new i.PropertyBindings(d,l);let p;return this._bindings.push(c),r.length>0&&(p=o.mapInputBindingDefinitions(r,s),p.forEach((e=>{i.setModelValue(l,e.targetProperty,ko.observable())})),o.setupPropertyBindings(this._diContainer,s,c,p)),a.forEach(((t,s,o)=>{i.getModelValue(l,t.property).exists||i.setModelValue(l,t.property,ko.observable()),c.mapProperty(t.valuesFrom[0].property,t.property).bind(d,e,!0)})),l}_deleteBindings(e){const t=this._findBindings(e);t&&(t.unbind(),MsPortalFx.remove(this._bindings,t))}_findBindings(e){return MsPortalFx.find(this._bindings,(t=>t.targetModel===e))}}e.SelectableSetBinderBase=n;function a(e,t,i){return MsPortalFx.find(e.selectableItems(),(e=>l(t,e.data,i)))}function r(e,t,i){return MsPortalFx.find(e(),(e=>l(t,i,e)))}function l(e,t,s){return Object.getOwnPropertyNames(e).reduce(((o,n)=>{let a;if(!o)return o;const r=i.getModelValue(s,n,!0);return!!r.exists&&(a=i.getModelValue(t,e[n],!0),MsPortalFx.deepEquals(r.value,a.value,!0))}),!0)}function d(e,t,i,s,o,n,a){let r=[];ko.reactor(e,(()=>{ko.utils.compareArrays(r,t()).forEach((e=>{switch(e.status){case"added":case"retained":if(!i().some((t=>s(e.value,t)))){const t=o(e.value);t&&i.push(t)}break;case"deleted":i.remove((t=>!!s(e.value,t)&&(a(t),!0))),n(e.value)}})),r=t.slice(0)}))}e.SelectableSetBinder=class extends n{constructor(e,t,i,s,o,n,c){super(e,t,i," - [SelectableSetElement]",n,c);let p=!1,u=!1;const m=n.reduce(((e,t)=>{const i=t.valuesFrom;return i&&i.length&&6===i[0].referenceType&&(e[t.property]=i[0].property),e}),{}),b=o.activatedItems;if(b().forEach((e=>{const t=a(s,m,e);t&&(t.isActivated(!0),t.isSelected(!0),this._bindElement(t.data,n,c,e))})),s.activatedItems().forEach((e=>{r(b,m,e)||b.push(this._bindElement(e,n,c))})),b().length>this._bindings.length){const e=this.createChildLifetime();s.selectableItems.subscribeArrayAdds(e,(t=>{const i=r(b,m,t.data);null===i||this._findBindings(i)||(t.isSelected(!0),t.isActivated(!0),this._bindElement(t.data,n,c,i),this._bindings.length>=b().length&&e.dispose())}))}s.activatedItems.subscribeArrayChanges(this,(e=>{if(!u){const t=r(b,m,e);try{p=!0,t||b.splice(0,0,this._bindElement(e,n,c))}finally{p=!1}}}),(e=>{if(!u)try{p=!0,b.remove((t=>!!l(m,e,t)&&(this._deleteBindings(t),!0)))}finally{p=!0}})),b.subscribeArrayChanges(this,(e=>{const t=a(s,m,e);if(t){if(!p)try{u=!0,t.isSelected(!0),t.isActivated(!0)}finally{u=!1}this._findBindings(e)||this._bindElement(t.data,n,c,e)}}),(e=>{if(!p)try{u=!0,s.activatedItems.remove((t=>!!l(m,t,e)&&(this._deleteBindings(e),!0)))}finally{u=!1}})),function(e,t,i,s,o,n){const a=t.itemsWithChildEdits;d(e,a,i,((e,t)=>e.editScopeId===t.editScopeId&&o(e.item,t.item)),(e=>({editScopeId:e.editScopeId,item:s(e.item)})),(e=>{}),(e=>{n(e.item)})),d(e,i,a,((e,t)=>t.editScopeId===e.editScopeId&&o(t.item,e.item)),(e=>{const i=MsPortalFx.find(t.selectableItems(),(t=>o(t.data,e.item)));if(i)return{editScopeId:e.editScopeId,item:i.data}}),(e=>{n(e.item)}),(e=>{}))}(this,s,o.itemsWithChildEdits,(e=>this._bindElement(e,n,c)),((e,t)=>l(m,e,t)),(e=>{this._deleteBindings(e)}))}}}(o||(o={})),o})),
define("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener",["require","exports","Fx/DependencyInjection","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Base/Base.Pipeline","MsPortalImpl/Base/Base.Selectable2","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/UI/UI.JourneyManager","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpenerBase","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Helpers","MsPortalImpl/UI/Compositions/UI.Composition.CompositionBinder","MsPortalImpl/UI/Compositions/UI.Composition.DelayedBladeManager","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/UI/Compositions/UI.Composition.SelectableSetBinder"],(function(e,t,i,s,o,n,a,r,l,d,c,p,u,m,b,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOrGetInternalSelectionState=t.BladeOpener=void 0;var g=FxImpl.TriggerableLifetimeManager,f=MsPortalFx.Base.Diagnostics,v=c.mapMasterModelToBladeModel,y=MsPortalFx.deepEquals;const I=f.createLog(e),C=MsPortalFx.noop,x="internal.selectable",B=ko.toJS,M=a.Locator.forExtension,S=(0,o.createDescriptor)(d.Configuration,d.Resources,void 0);function P(e){return!!(e.value&&16&e.value.flags)}S.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Handler","OpenBladeHandler",((e,t,i)=>!P(i))),S.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Selectable1","SelectableV1Handler",((e,t,i)=>!t.selectable2&&!P(i))),S.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Selectable2","SelectableV2Handler",((e,t,i)=>t.selectable2&&!P(i))),S.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.PendingBladeHint","PendingBladeHandler",((e,t,i)=>P(i))),S.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.PPV3","ParameterProviderV3Handler",((e,t,i)=>!P(i)&&t.selectable2&&i.value&&!!i.value.container));let _=class extends g{constructor(e,t){super(),this._diContainer=e,this.bladeOpenedCallbacks=$.Callbacks(),this.selectableSetBinders=[],this.options=MsPortalFx.extend2(d.DefaultConfiguration,t),this.invocationPropertyBindings=new b.PropertyBindings(this.options.masterModelId+"-[Invocation]",{}),this.invocationQueue=this._diContainer.get(j),this.bladeOpenedCallbacks.add(this.options.onBladeOpened),this.registerForDispose([()=>{this.invocationPropertyBindings.unbind()},()=>this.bladeOpenedCallbacks.empty()])}registerInvocationProperty(e,t,i){const s=this.createChildLifetime(),o=this._diContainer.get(r.JourneyManager),n=this._diContainer.get(m.Finder);let a=null;const h=n.findPartsContainer(this.options.referenceComposition),g=F(this.options,e),f=L(this._diContainer,this.options,s,e,!0,this.selectableSetBinders),v={container:h,bladeOpenedCallbacks:this.bladeOpenedCallbacks,bladesClosedByPart:new WeakMap,detailsBladeLocator:g,disableInvocation:t,isThrottled:ko.observable(!1),resettingMasterArrayValue:!1,registrationInfo:void 0,prevValue:void 0,previousInvocationPromise:void 0};v.selectable2=f.selectable2;const y=S.createPipeline(this._diContainer,s,this.options,v);if(!f.success)return;v.registrationInfo=function(e,t,i,s,o){let n,a,r;const l=t.referenceComposition,d=e.get(m.Finder);l?(n=w(s.additionalInputArguments,l,b.ReferenceScope.MasterContainer),a=w(o.invocationInputArguments,l,b.ReferenceScope.MasterContainer,s,o.isSelectableSetV1)[0],r=p.CompositionBinder.mapInputBindingDefinitions(s.outputArguments,l,(e=>{e.source.scope=b.ReferenceScope.DetailsContainer})),new u.DelayedBladeManager(i,E(t,a),{diContainer:e,debugId:t.masterModelId,extension:t.referenceExtension.name,getSelectableContainerComposition:()=>d.findPartsContainer(l)})):a={targetProperty:void 0,source:{property:o.invocationInputArguments[0].valuesFrom[0].property,modelType:0,scope:1,cardinality:0,partLocator:void 0,id:"Desktop"},optional:!1,isIdentityInput:!1,selectableSetV1:!1,opensDynamicBlades:!0};return{additionalInputs:n||[],invocationInput:a,invocationOutputs:r||[],detailsDefinition:s}}(this._diContainer,this.options,s,e,f);const C=v.registrationInfo.invocationInput,x=()=>{const e=(0,b.getModelValue)(this.options.masterModel,C.source.property).value;return v.selectable2?e():B(e)};v.prevValue=x(),function(e,t,i,s){const o=E(t,i);if(o&&o.isSelected&&o.isCommandSelected){const n=o.isSelected,a=o.isCommandSelected,r=e.get(m.Finder).findBlades(t.referenceComposition).filter((e=>e.masterInvocationProperty===i.source.property&&t.isBladeOpenedByMaster(e)));a()&&0===r.length&&a(!1),n()&&0===r.length?(n(!1),s()):!n()&&r.length>0?(s(),n(!0)):s()}}(this._diContainer,this.options,C,(()=>{f.updateSelectedValue()})),function(e,t,i,s,o){const n=t.get(r.JourneyManager);let a,d=n.activeJourney();const p=i.referenceComposition&&i.referenceComposition.getCompositionType()===l.CompositionType.StartboardPart;let u=null;const b=o=>{o&&o.originTile&&(p&&o.originTile.id!==i.referenceComposition.id||(a=e.createChildLifetime(),function(e,t,i,s,o){if(!s)throw new Error("Journey is required.");const n=E(t,o),a={timestamp:Date.now(),locator:null,masterInvocationProperty:o.source.property};t.configureBindings&&a.bindings&&a.bindings.length&&t.configureBindings(a.bindings);t.configureBladeDescriptor(a);const r=c.getBladeOpenerJourneyPathSegment(a),l=e.get(m.Finder);U(t,l,n,s,r,o),s.ambientSettings.getObservable().subscribe(i,(()=>{U(t,l,n,s,r,o)}))}(t,i,a,o,s),p&&o.onDispose((()=>{a&&(a.dispose(),a=null)}))))};b(d),p&&(u=()=>{a||(d=n.activeJourney(),b(d))},o.add(u),e.registerForDispose((()=>{o.remove(u)})))}(s,this._diContainer,this.options,C,this.bladeOpenedCallbacks),t&&t.subscribe(s,(e=>{e?((0,d.traceInvocationChange)(I,"Disabled listening for invocation property change.",this._diContainer,this.options,C,x()),T(o,n,this.options,v.bladesClosedByPart,C)):(v.prevValue=x(),void 0!==v.prevValue&&R(this.options,`Selectability was enabled for the part (container.isSelectable(true)) and the part is already in a selected state.  Current selection state will be ignored and blade will not be opened. Part Id: ${this.options.masterModelId}`,v.prevValue))}));const M=C.source.property,P=this.invocationPropertyBindings;return(0,b.setModelValue)(P.targetModel,M,B(v.prevValue)),a=P.addProperty(M).bind(this.options.masterModelId,this.options.masterModel,!!v.selectable2,(e=>{const t=x(),i={timestamp:Date.now(),value:t,invocationInput:C,propertyChanges:e};(0,d.traceInvocationChange)(I,"Detected invocation property change.",this._diContainer,this.options,C,t),v.selectable2?this.invocationQueue.enqueue({id:M,pipeline:y,taskArgs:i}):y.startTask(i)}),(e=>{R(this.options,`Failed to subscribe to changes for the selectable ${M}. Error: ${e}`)})),s.registerForDispose((()=>{o.activeJourney()&&!this._diContainer.isDisposed()&&T(o,n,this.options,v.bladesClosedByPart,C),P.removeProperty(a)})),i&&i.registerForDispose(s),{viewStatePropertyRemovals:f.viewStatePropertyRemovals}}modifyViewStateProperties(e,t){return e.filter((e=>!t.viewStatePropertyRemovals.some((t=>e===t))))}createBladeModelForSelectedItem(e,t){const i=e.invocationInputArguments,s=new g,o=L(this._diContainer,this.options,s,e,!1,this.selectableSetBinders),n=w(o.invocationInputArguments,this.options.referenceComposition,b.ReferenceScope.MasterContainer,e)[0];let a,r={},l=F(this.options,e);const c=()=>{const e=this.options.referenceComposition;return e.containerModel||e.getBindableContainer().getViewModel()};return o.updateSelectedValue(),l||e.blade||(l=(0,d.mapDynamicSelectionToBladeLocator)(this._diContainer,t,M(this.options.referenceExtension.name),this.options.masterModelId)),i&&i.length&&i[0].property?r[n.targetProperty]=t:(a=t,!i&&e.selectablePath&&this.selectableSetBinders.some((i=>i.selectablePath===e.selectablePath&&(a=i.createTargetForSelectedItem(t),!0))),r=v(this.options.referenceComposition.locator.toString(),a,n)),(e.additionalInputArguments||[]).forEach((e=>{if(e.valuesFrom&&e.valuesFrom.length){const t=e.property,i=e.valuesFrom[0];0!==i.referenceType||i.part&&i.part!==this.options.referenceComposition.locator.name?1===i.referenceType?r[t]=c()[i.property]:(r[t]=void 0,I.warning(`Part Selection: Blade ${l} Property ${t} has an input that's from part ${i.part} instead of its list part ${this} or the blade.`)):r[t]=(0,b.getModelValue)(this.options.masterModel,i.property).value}})),s.dispose(),{model:r,locator:l}}};function w(e,t,i,s,o){return p.CompositionBinder.mapInputBindingDefinitions(e,t,((e,t)=>{e.source.scope=i,e.selectableSetV1=void 0!==o?o:s&&s.isMultiple,e.opensDynamicBlades=s&&!s.blade}))}function F(e,t){const i=e.referenceExtension;return t.blade&&t.bladeExtension?M(t.bladeExtension).withBlade(t.blade):t.blade&&i?M(i.name).withBlade(t.blade):null}function E(e,t){return function(e,t){const i=e.lastIndexOf("."),s=i>0?e.substring(0,i):"";return(0,b.getModelValue)(t,s).value}(t.source.property,e.masterModel)}function k(e,t,i){return e(ko.unwrap(i?(0,b.getModelValue)(t,i).value:t))}function D(e,t,i,s,o,n){let a;if(n){const n=p.CompositionBinder.mapInputBindingDefinitions(s.selectableBindings,i.referenceComposition),r={},l=new b.PropertyBindings(i.masterModelId+"-[Selection]",r),d=(0,b.getModelValue)(i.masterModel,o).value,c=function(e,t,i){let s=t;if(!t)return;s.lock&&s.setInternalSelectedValue&&s.isLocked||(R(e,`This property '${i}' must be of type MsPortalFx.ViewModels.Selectable, view model = '${e.masterModelId}'`),s={lock:C,setInternalSelectedValue:function(e){t.selectedValue(e)},isLocked:C});return s}(i,d,o);a=()=>{c&&c.setInternalSelectedValue(!0)},n.length>0&&(i.configureBindings&&i.configureBindings(n),e.registerForDispose((()=>{l.unbind()})),n.forEach((e=>{const t=(0,b.getModelValue)(r,e.targetProperty).value;(0,b.setModelValue)(r,e.targetProperty,ko.observable(t))})),p.CompositionBinder.setupPropertyBindings(t,i.referenceComposition,l,n),a=()=>{c&&(c.lock(),c.setInternalSelectedValue(l.targetModel),n.forEach((t=>{r[t.targetProperty].subscribe(e,(e=>{d.isSelected()&&c.setInternalSelectedValue(l.targetModel)}))})))})}return{invocationInputArguments:[{valuesFrom:[{property:o+".value",referenceType:0}]}],updateSelectedValue:a||C,isSelectableSetV1:!1,viewStatePropertyRemovals:[],success:!0}}function V(e,t,i,s,o,n){let a;const r=i.masterModel,l=(d=o.selectablePath,{path:ko.observable(d),activatedItems:ko.observableArray(),itemsWithChildEdits:ko.observableArray()});var d;const c=o.selectablePath+".activatedItems";let p;const u=x;let m="",g="";const f=[];let v=!0;const y=(0,b.getModelValue)(i.masterModel,o.selectablePath).value;y&&y.activatedItems&&(p=y.activatedItems);const B=W(r),M=o.selectablePath;return n?(g=u+"._sets."+B._sets().length.toString(),m=g+".activatedItems",B._sets.push(l),f.push(c,M+".selectedItems",M+".itemsWithChildEdits"),y&&p?(a=new h.SelectableSetBinder(t,M,i.masterModelId,y,l,o.selectableBindings,i.referenceComposition),s.push(a),e.registerForDispose((()=>{a.dispose(),MsPortalFx.remove(s,a)}))):(R(i,`The view model for '${i.masterModelId}' is missing the required property '${c}' needed to open the child blade(s) '${o.blade}'`),v=!1)):(B._sets().some(((e,t)=>e.path()===M&&(g=u+"._sets."+t.toString(),m=g+".activatedItems",!0))),""===m&&(I.error(`Failed to find a selectable set reflection for view model '${i.masterModelId}'. Selectable set path is '${M}'`),v=!1)),{invocationInputArguments:[{valuesFrom:[{property:m,referenceType:0}]}],updateSelectedValue:C,isSelectableSetV1:!0,viewStatePropertyRemovals:f,success:v}}function W(e){let t=e.internal.selectable();return t||(t={_sets:ko.observableArray(),_selectables:ko.observableArray(),_dynamicSelections:ko.observableArray(),_selectable2Invocations:{},_contextMenu2Selectables:ko.observable({}),commandBar2Selectables:ko.observable({}),callbacks:ko.observableArray()},e.internal.selectable(t)),t}function T(e,t,i,s,o){const n=t.findBlades(i.referenceComposition).filter((e=>!e.isDisposed()&&e.masterInvocationProperty===o.source.property&&i.isBladeOpenedByMaster(e))),a=e.confirmBladesCanClose(n);if(a)for(let t=n.length-1;t>=0;t--){const o=n[t];i.removeOutputBindings(o),s.set(o,!0),e.forceCloseBlade(o)}return a}function O(e,t,i,s){W(t.masterModel);var o,n;return(o=t.masterModel,n=s,k(FxImpl.tryGetSelectableViewModelContract,o,n))._msPortalFxSelectable2?A(e,t,i,s+"._msPortalFxSelectable2"):(s+="._msPortalFxSelectable",i[0].valuesFrom[0].property=s+".value",{success:!0,isSelectableSetV1:!1,invocationInputArguments:i,viewStatePropertyRemovals:[],updateSelectedValue:C})}function A(e,t,i,s){const o=t.masterModel,a=W(o),r=(l=e,k((e=>(0,n.getOrCreate)(l,e)),o,s));var l;const d=s.replace(/\./g,"_");return a._selectable2Invocations[d]=r.value,a.callbacks.push(r.callbacks),i[0].valuesFrom[0].property="internal.selectable._selectable2Invocations."+d,{success:!0,isSelectableSetV1:!1,invocationInputArguments:i,viewStatePropertyRemovals:[],updateSelectedValue:C,selectable2:r}}function U(e,t,i,s,o,n){const a=i,r=i,l=t.findPartsContainer(e.referenceComposition).journeyPath.concat([o]),d=s.ambientSettings.getItemsUnderPath(l);a&&a.selectedValue?a.hasChildEdits(d.length>0):r&&r.itemsWithChildEdits&&function(e,t,i,s,o){const n=(t,i,s,o)=>{t.forEach(((t,n)=>{const a=v(e,t,s),r=MsPortalFx.find(i,(e=>y(a,e.invocationModel)));o(t,n,r&&r.editScopeId)}))};if(0===s.length){const e=t.itemsWithChildEdits,i=e().length;i>0&&e.splice(0,i)}else{const e=MsPortalFx.mapMany(s,(e=>{if(e.path.length-i.length>2)return[];const t=e.path[i.length];let s;try{s=MsPortalFx.parseSortedString(t)}catch(t){I.error(`Failed to parse journey path segment. Path: '${JSON.stringify(e.path)}'. Error: '${t.message}'.`)}const o=s&&s.model,n=e&&e.value&&e.value.editScope&&e.value.editScope.editScopeId;return o&&n?[{invocationModel:o,editScopeId:n}]:[]})),a=t.itemsWithChildEdits().slice();let r=!1;n(t.activatedItems(),e,o,((e,t,i)=>{i&&(a.some((t=>y(t.item,e)))||(r=!0,a.push({item:e,editScopeId:i})))})),a.length>e.length&&n(a.map((e=>e.item)),e,o,((e,t,i)=>{i||(r=!0,a.splice(t,1))})),r&&t.itemsWithChildEdits(a.slice())}}(e.masterModelId,r,l,d,n)}function L(e,t,i,s,o,n){let a,r,l;if(s.invocationInputArguments&&s.invocationInputArguments.length>0){if(r=s.invocationInputArguments,l=s.isMultiple,r=(e=>e.map((e=>MsPortalFx.clone(e,!0,!1))))(s.invocationInputArguments),!s.blade&&s.invocationInputArguments[0].valuesFrom&&s.invocationInputArguments[0].valuesFrom.length>0){a=s.invocationInputArguments[0].valuesFrom[0].property;const i=t.masterModel;if(a="container.selectable"===a?"container":a,c=i,p=a,k(FxImpl.tryGetSelectableViewModelContract,c,p))return O(e,t,r,a);if(function(e,t){return k(FxImpl.isSelectable2,e,t)}(i,a))return A(e,t,r,a);(0,d.isSelectableSet)(i,a)?(l=!0,r[0].valuesFrom[0].property=a+".activatedItems"):(0,d.isSelectable)(i,a)&&(l=!1,r[0].valuesFrom[0].property=a+".value")}return{success:!0,isSelectableSetV1:l,invocationInputArguments:r,viewStatePropertyRemovals:[],updateSelectedValue:C}}var c,p;return function(e,t,i,s,o,n){let a={success:!0,isSelectableSetV1:!1,invocationInputArguments:null,viewStatePropertyRemovals:[],updateSelectedValue:C};if(s.selectablePath)if((0,d.isSelectableSet)(t.masterModel,s.selectablePath)){if(!s.selectableBindings||!s.selectableBindings.some((e=>!!(e.valuesFrom&&e.valuesFrom.length>0)&&6===e.valuesFrom[0].referenceType)))return a.success=!1,R(t,`The view model '${t.masterModelId}' has a selectable source '${s.selectablePath}' that is a selectable set.  There must be at least one <BladeInput> which has SelectedItem as the Source for a selectable set to indentify which row is opening the blade.`),a;a=V(i,e,t,n,s,o)}else(0,d.isSelectable)(t.masterModel,s.selectablePath)?a=D(i,e,t,s,s.selectablePath,o):(a.success=!1,R(t,`The view model for '${t.masterModelId}' with property '${s.selectablePath}' must of type MsPortalFx.ViewModels.Selectable or MsPortalFx.ViewModels.SelectableSet to open the child blade(s) '${s.blade}'`));else a=function(e,t,i,s,o){return D(e,t,i,s,"container.selectable",o)}(i,e,t,s,o);return a}(e,t,i,s,o,n)}function R(t,i,o){(0,s.logToExtension)(e,t.referenceExtension.name,2,i,{contextData:o})}t.BladeOpener=_,t.BladeOpener=_=__decorate([__metadata("fx:diagnostics",[e,"BladeOpener"]),i.Class("composition"),__metadata("design:paramtypes",[i.Container,d.OpenerConfiguration])],_),t.createOrGetInternalSelectionState=W;let j=class{constructor(){this.queue=[]}enqueue(e){const t=this.queue,i=!t.length;MsPortalFx.remove(t,(t=>t.pipeline===e.pipeline),1),t.push(e);const s=e=>{e.pipeline.startTask(e.taskArgs).finally((()=>{t.shift(),t.length&&s(t[0])}))};i&&s(t[0])}};j=__decorate([__metadata("fx:diagnostics",[e,"InvocationQueue"]),i.Class()],j)}));