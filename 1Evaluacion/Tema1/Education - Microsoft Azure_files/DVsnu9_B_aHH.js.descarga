define("MsPortalImpl/Widgets/ServiceHoverCard",["require","exports","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/TsxStringMode/Tsx","Fx/Controls/Toolbar","MsPortalImpl/Resources/ImplScriptResources","FxHubs/RpcEndPoints","MsPortalImpl/Services/Services.BrowseCuration","FxHubs/ResourceCommands/BrowseCommanding","MsPortalImpl/UI/UI.BladeOpener","Fx/Experimentation","MsPortalImpl/UI/Hubs/UI.FavoritesManagerDeferred","MsPortalImpl/UI/Hubs/UI.FavoritesManager","FxHubs/RpcEndPoints","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Widgets/Widgets.HoverCard","MsPortalImpl/Services/Services.Recents","MsPortalImpl/Base/Base.SvgHelper","_generated/MsPortalImpl/Svg/Internal/AzureCopilot.svg"],(function(e,i,t,a,s,r,o,n,l,d,c,v,p,h,f,u,x,g,b){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ViewModel=void 0;var m=s.ToolbarItems.createBasicButton,k=MsPortalFx.Base.Images,I=FxImpl.TriggerableLifetimeManager;function C(e){MsPortalFx.require("MsPortalImpl/Widgets/Widgets.AllServicesMenu").then((i=>{const t=e.diContainer.get(p.FavoritesManager);i.toggleFavorite({clickedFavorite:e.favorite,favoritesManager:e.diContainer.get(p.FavoritesManager),favoritesManagerDeferred:e.diContainer.get(v.FavoritesManagerDeferred),telemetrySource:"ServiceHoverCard"}),t.loadFavorites()}))}class F extends u.ViewModel{constructor(e,i,t,a){super(),this.onClickToggleExpandedState=()=>{this.isDescriptionExpanded(!this.isDescriptionExpanded())},this.additionalInfo=ko.observable(),this.possibleFavorite=ko.observable(),this.favoriteInitial=null,this.addIcon=k.Add({palette:3}),this.viewIcon=k.View({palette:3}),this.favoriteIcon=k.Star({palette:99}),this.notFavoriteIcon=k.Favorite({palette:99}),this.isDescriptionExpanded=ko.observable(!1),this.seeMoreString=ko.pureComputed((()=>this.isDescriptionExpanded()?r.ServicesInfo.HoverCard.seeLess:r.ServicesInfo.HoverCard.seeMore)),this.expandIcon=k.CaretDown(),this.toolbar=ko.observable(),this.tweakHoverCard=ko.observable(!1),this.showCopilotButton=ko.observable(!1),this.copilotButtonText=ko.observable(f.SideBarFlyout.copilotButtonText),this.showPartnerTag=ko.pureComputed((()=>this.possibleFavorite().isPartner)),this.lifetime=new I,this.template=S,this.dockingElement=i,this.focusContent=this.toolbar,this._hoverCardSource=a,this._recentsManager=t.get(x.RecentServicesManager),this.possibleFavorite(e),this.onFavoritesChange=e=>{const i=MsPortalFx.find(e,(e=>e&&e.id===this.possibleFavorite().id));i&&this.possibleFavorite(i)},this.setFavorite=()=>{if(this.favoriteOnDismiss){this.updateFavorite=()=>{const e=this.possibleFavorite(),i=e.isFavorite();i!==!!t.get(p.FavoritesManager).favorites.value.find((i=>i.id===e.id))&&(e.isFavorite=ko.observable(!i),C({favorite:e,diContainer:t}))};const e=this.possibleFavorite();e.isFavorite(!e.isFavorite())}else C({favorite:this.possibleFavorite(),diContainer:t})},this.shouldShowExpandButton=e=>$(e.parentNode).find(".fxs-hover-card-description")[0].scrollHeight>90,this._bladeManagement={openBlade:e=>t.get(d.BladeOpener).openBlade(e,{flags:8,telemetryName:"ServiceHoverCard"}),openContextPane:e=>t.get(d.BladeOpener).openBlade(e,{flags:9,telemetryName:"ServiceHoverCard"}),openBladeAsync:()=>Promise.resolve(!1),openContextPaneAsync:()=>Promise.resolve(!1)};const g=t.get(c.Experimentation).shellAssignments;this.tweakHoverCard(g.getBooleanValue("tweakservicehovercard"));const b=g.getBooleanValue("hovercardcopilotentry"),F=e?.assetType?.compositeDisplayName?.plural;b&&F&&MsPortalFx.require("Fx/Copilot/Handler").then((e=>{e.isCopilotEnabled().then((i=>{this.showCopilotButton(i),this.onClickCopilotButton=()=>{t.get(e.Copilot).nudge({prompt:f.SideBarFlyout.copilotButtonPrompt.format(F)}),this.widget.dispose(),(0,u.logTelemetry)("CopilotClick")}}))})),(0,n.getAllServicesAdditionalData)().then((e=>{this.additionalInfo(function(e,i,t,a){const s=e.id,r=i&&i[s]||{},o=(0,v.getServiceAssetTypeManifest)(e),{createLink:n,createBladeReference:l}=(0,v.getServiceCreateLink)(e),d=ko.observable();(0,v.getServiceBrowseDeepLink)(e,t).then((e=>d(e)));const c=ko.observableArray();return Promise.all([MsPortalFx.require("MsPortalImpl/UI/UI.DeepLink"),h.AssetTypes.getRecentResourcesEndPoint.invoke(t.get(FxImpl.Rpc.Client),MsPortalFx.Base.Constants.ExtensionNames.Hubs,{limit:3,assetTypeId:"HubsExtension_BrowseAllResources"===s?void 0:s})]).then((([e,i])=>{c(i.map((i=>{const{resourceId:a,timeStamp:s,name:r}=i,{icon:o}=i.assetTypeInformation,n=new Date(s).toRelativeString("difference");return{resourceId:e.getResourceDeepLink(t,a),timeStamp:n,icon:o,name:r}})))})),{recentClick:i=>((0,u.logTelemetry)("BrowseRecentResourceLinkClicked",e.id,{resourceName:i.name,resourceId:i.resourceId,source:a}),!0),usefulClick:i=>((0,u.logTelemetry)("UsefulResourceLinkClicked",e.id,{linkDestination:i.link,displayTitle:i.linkTitle,source:a}),!0),trainingClick:i=>((0,u.logTelemetry)("TrainingLinkClicked",e.id,{linkDestination:i.link,displayTitle:i.title,source:a}),!0),freeClick:i=>((0,u.logTelemetry)("FreeOfferingLinkClicked",e.id,{linkDestination:i.createUri,displayTitle:i.title,source:a}),!0),createLink:n,createBladeReference:l,deepLink:d,description:o.description,freeOfferings:r.freeOfferings,recents:c,trainings:r.trainings,usefulLinks:r.usefulLinks}}(this.possibleFavorite(),e.assetTypesDataMap,t,this._hoverCardSource)),o.ArtBrowse.getBrowsePrereqsEndpoint.invoke(FxImpl.Rpc.client,"fxw",{resourceType:this.possibleFavorite()?.assetType?.lowerCaseResourceType,includeColumnsVersion:2}).then((async e=>{const i=e&&(0,l.createServiceHoverCardCommand)({showLabel:!0,showIcon:!0,showCustomIcon:!0},`ServiceHoverCard-${this._hoverCardSource}`,e?.browseQueryManifest,this.lifetime,(()=>this.possibleFavorite()?.assetType?.extension),this.possibleFavorite()?.resourceType,this._bladeManagement,this.possibleFavorite()?.isDisabled,e?.assetTypes[this.possibleFavorite()?.resourceType?.toLowerCase()]?.hiddenCommands,this.possibleFavorite()?.kind),a=[];i?a.push(i):(this.additionalInfo()?.createLink||this.additionalInfo()?.createBladeReference)&&a.push(m(this.lifetime,{label:r.ActionBarButtons.create,icon:this.addIcon,tooltip:this.possibleFavorite()?.isDisabled&&f.SideBarFlyout.disabledMessage,onClick:()=>{(0,u.logTelemetry)("CreateResourceLinkClicked",this.possibleFavorite().id,{source:this._hoverCardSource}),this.additionalInfo().createLink?window.location.hash=this.additionalInfo().createLink:t.get(d.BladeOpener).openBlade(this.additionalInfo().createBladeReference,{flags:2,telemetryName:"ServiceHoverCard"}),this.widget.dispose()},disabled:this.possibleFavorite()?.isDisabled})),this.additionalInfo()?.deepLink&&a.push(m(this.lifetime,{label:r.ActionBarButtons.view,icon:this.viewIcon,onClick:()=>{(0,u.logTelemetry)("ViewResourceLinkClicked",this.possibleFavorite().id,{source:this._hoverCardSource}),window.location.hash=this.additionalInfo().deepLink();const e=this.possibleFavorite().id,i=this.possibleFavorite().kind;e&&this._recentsManager.addService(e+(i?"."+i:""))}})),this.toolbar(s.create(this.lifetime,{items:a,showLabels:!0}))}))}))}}i.ViewModel=F;const S=t(a.Root,null,t("div",{class:"fxs-hover-card-container fxs-portal-background fxs-portal-text"},t("div",{class:"fxs-hide-accessible-label",id:"hoverCardDescriptionId",title:r.ServicesInfo.showServiceCard,"aria-hidden":"true"},r.ServicesInfo.showServiceCard),t("div",{class:"fxs-hover-card-initial","data-bind":{css:{"fxs-hover-card-padbottom":"!additionalInfo()"}}},t("div",{class:"fxs-hover-card-header"},t("div",{class:"fxs-hover-card-icon","data-bind":{image:"possibleFavorite().icon || possibleFavorite().image"}}),t("div",null,t("header",{class:"fxs-hover-card-title","data-bind":{text:"possibleFavorite().label",attr:{title:"possibleFavorite().label"}}}),t("div",{class:"fxs-hover-card-tags"},t(a.KoIf,{condition:"possibleFavorite().isDisabled"},t("div",{class:"msportalfx-preview-text fxs-service-disabled-tag",title:f.SideBarFlyout.disabledMessage},f.SideBarFlyout.disabled)),t(a.KoIf,{condition:"showPartnerTag()"},t("div",{class:"msportalfx-preview-text fxs-service-partner-tag",title:f.SideBarFlyout.Partnertag.title},f.SideBarFlyout.Partnertag.name)),t(a.KoIf,{condition:"tweakHoverCard() && possibleFavorite().isPreview"},t("div",{class:"msportalfx-preview-text fxs-service-preview-tag",title:f.SideBarFlyout.preview},f.SideBarFlyout.preview)))),t(a.KoIf,{condition:"additionalInfo()"},t("div",{class:"fxs-hover-card-favoriteicon",role:"button","aria-pressed":"false","aria-label":r.KeyboardShortcuts.Toggle.toggleFavoriteService,"data-bind":{fxclick:"setFavorite",image:"possibleFavorite().isFavorite() ? favoriteIcon : notFavoriteIcon"}}))),t("div",{class:"fxs-hover-card-commands"},t("div",{"data-bind":{pcControl:"toolbar"}}))),t("div",{class:"fxs-hover-card-border"}),t("div",{class:"fxs-hover-card"},t(a.KoIf,{condition:"additionalInfo()"},t("div",{class:"fxs-hover-card-additional","data-bind":{with:"additionalInfo"}},t(a.KoIf,{condition:"recents"},t(a.KoIf,{condition:"recents().length"},t("div",{class:"fxs-hover-card-padless-header"},t("header",{class:"fxs-hover-card-heading"},r.ServicesInfo.HoverCard.Header.recents)),t("ul",{class:"fxs-hover-card-training fxs-hover-card-list fxs-hover-card-padbottom","data-bind":{foreach:"recents"}},t("li",{class:"fxs-hover-card-list-item"},t("div",{class:"fxs-hover-card-training-item fxs-portal-hover"},t("div",{class:"fxs-hover-card-training-icon","data-bind":{image:"$data.icon"}}),t("div",{class:"fxs-hover-card-training-link"},t("a",{class:"fxs-hover-card-training-link",href:"","data-bind":{click:"$parent.recentClick",text:"$data.name",attr:{title:"$data.name",href:"$data.resourceId"}}}),t("div",{class:"fxs-hover-card-training-sub"},t("span",{"data-bind":{text:"$data.timeStamp"}}))))))),t(a.KoIfNot,{condition:"recents().length"},t(a.KoIf,{condition:"description"},t("div",{class:"fxs-hover-card-section"},t("header",{class:"fxs-hover-card-heading"},r.ServicesInfo.HoverCard.Header.description),t("div",{"data-bind":{text:"description",css:{"fxs-hover-card-description":"true","fxs-hover-card-expanded-description":"$parent.isDescriptionExpanded()"}}}),t(a.KoIf,{condition:"$parent.shouldShowExpandButton($element)"},t("a",{href:"#",class:"fxs-hover-card-seemore-link",tabindex:"0","data-bind":{click:"$parent.onClickToggleExpandedState",clickBubble:"false"}},t("div",{class:"fxs-hover-card-see-more-less","data-bind":{text:"$parent.seeMoreString",attr:{title:"$parent.seeMoreString",ariaLabel:"$parent.seeMoreString"}}}),t("div",{"data-bind":{image:"$parent.expandIcon",css:{"fxs-hover-card-expand-icon":"true","fxs-hover-card-icon-vertical-transform":"$parent.isDescriptionExpanded()"}}}))))))),t(a.KoIf,{condition:"$parent.showCopilotButton()"},t("div",{class:"fxs-hover-card-section fxs-hover-card-azure-copilot-link-section","data-bind":{click:"$parent.onClickCopilotButton",attr:{"aria-label":"$parent.copilotButtonText",title:"$parent.copilotButtonText"}}},t("div",{class:"fxs-portal-svg fxs-hover-card-azure-copilot-icon"},g.getSvgReferenceOrFallBackToData(b).outerHTML),t("div",{class:"fxs-portal-text fxs-hover-card-azure-copilot-link","data-bind":{text:"$parent.copilotButtonText"}}))),t(a.KoIf,{condition:"trainings && trainings.length"},t("div",{class:"fxs-hover-card-padless-header"},t("header",{class:"fxs-hover-card-heading"},r.ServicesInfo.HoverCard.Header.training)),t("ul",{class:"fxs-hover-card-training fxs-hover-card-list fxs-hover-card-padbottom","data-bind":{foreach:"trainings"}},t("li",{class:"fxs-hover-card-list-item"},t("div",{class:"fxs-hover-card-training-item fxs-portal-hover"},t("div",{class:"fxs-hover-card-training-link"},t("a",{class:"msportalfx-ext-link",href:"",target:"_blank","data-bind":{click:"$parent.trainingClick",text:"$data.title",attr:{title:"$data.title",href:"$data.link"}}}),t("div",{class:"fxs-hover-card-training-sub"},t("span",{"data-bind":{text:"$data.units"}}),t(a.KoIf,{condition:"$data.units && $data.duration"},t("span",null," · ")),t("span",{"data-bind":{text:"$data.duration"}}))))))),t(a.KoIf,{condition:"usefulLinks && usefulLinks.length"},t("div",{class:"fxs-hover-card-section fxs-hover-card-padleftright"},t("header",{class:"fxs-hover-card-heading"},r.ServicesInfo.HoverCard.Header.usefulLinks),t("ul",{class:"fxs-hover-card-list","data-bind":{foreach:"usefulLinks"}},t("li",{class:"fxs-hover-card-list-item"},t("a",{target:"_blank","data-bind":{click:"$parent.usefulClick",text:"$data.title",attr:{href:"$data.link"},css:{"msportalfx-ext-link":"$data.isExternalLink"}}}))))),t(a.KoIf,{condition:"!$parent.tweakHoverCard() && freeOfferings && freeOfferings.length"},t("div",{class:"fxs-hover-card-padless-header"},t("header",{class:"fxs-hover-card-heading"},r.ServicesInfo.HoverCard.Header.freeOfferings)),t("ul",{class:"fxs-hover-card-training fxs-hover-card-list fxs-hover-card-padbottom","data-bind":{foreach:"freeOfferings"}},t("li",{class:"fxs-hover-card-list-item"},t("div",{class:"fxs-hover-card-training-item fxs-portal-hover"},t("div",{class:"fxs-hover-card-training-link"},t("a",{class:"fxs-hover-card-training-link",href:"","data-bind":{click:"$parent.freeClick",text:"$data.title",attr:{href:"$data.createUri"}}}),t("div",{class:"fxs-hover-card-training-sub"},t("span",{"data-bind":{text:"$data.subTitle"}}))))))))))))}));