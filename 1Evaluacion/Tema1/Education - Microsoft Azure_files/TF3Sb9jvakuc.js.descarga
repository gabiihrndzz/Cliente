define("_generated/Less/MsPortalImpl/Widgets/Widgets.GlobalNotificationBanner.css",["module"],(function(e){"use strict";return{css:".fxs-global-notification-banner-item{position:relative}.fxs-global-notification-banner-content{font-size:13px;padding:10px 20px}.fxs-global-notification-banner-title{font-size:14px;font-weight:600;margin-right:10px}.fxs-global-notification-banner-message{font-size:13px;display:block;display:-webkit-box;max-height:36px;overflow:hidden;text-overflow:ellipsis;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:18px;position:relative;white-space:pre-wrap}.fxs-global-notification-banner-expandedmessage{max-height:100%;overflow-y:auto;-webkit-line-clamp:initial;-webkit-box-orient:vertical}.fxs-global-notification-banner-seemore-container{display:inline-block;width:100%}.fxs-notification-banner-seemore-link{display:flex;margin-top:2px;float:right}.fxs-global-notification-banner-see-more-less{padding-right:5px}.fxs-global-notification-banner-expandicon{cursor:pointer;background-color:transparent;border:0;margin:0;padding:0;height:10px;width:10px;opacity:.4}.fxs-global-notification-banner-dismissicon{cursor:pointer;background-color:transparent;border:0;margin:0;padding:0;height:14px;width:10px;opacity:.4;top:0;right:0;position:absolute;margin-left:auto}",moduleId:e.id}})),
define("MsPortalImpl/Widgets/Widgets.GlobalNotificationBanner.Component",["require","exports","MsPortalImpl/UI/UI.AuthStateManager","Weave/DirectMode","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/Base.KnockoutTemplateSanitizer","MsPortalImpl/Services/Services.PortalPollingManager","_generated/Less/MsPortalImpl/Widgets/Widgets.GlobalNotificationBanner.css","Weave","FxInternal/Weave/Util","MsPortalImpl/Weave/Components","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Services/Services.BrowserTelemetry"],(function(e,i,t,n,a,o,r,s,l,c,f,d,m){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DEV=i.GlobalNotificationBanner=void 0;var g=MsPortalFx.Base,p=g.Diagnostics.Telemetry,u=g.Images;const b=window,x={Edg:["chromiumedge","edgechromium","edge"],Edge:["legacyedge","edgelegacy","edge"],Chrome:["chrome"],Safari:["safari"],Firefox:["firefox"]};function h(e,i,t,n,a){return e.filter((e=>function(e,i){return!e?.affectedPortalDomains?.length||e.affectedPortalDomains.includes(i)}(e,t))).filter((e=>function(e,i){return!e?.affectedTenants?.length||e.affectedTenants.includes(i)}(e,n))).filter((e=>function(e,i,t){const n=Object.keys(e.affectedBrowsers??{}).length;if(!e?.affectedBrowsers||!n)return!0;const a=x[i],o=e.affectedBrowsers[Object.keys(e.affectedBrowsers).find((e=>a?.includes(e.toLowerCase())))];if(void 0===o&&n)return!1;if(!o||!t)return!0;if(o){const e=o.split(".").map((e=>"x"===e.toLowerCase()||isNaN(parseInt(e,10))?-1:parseInt(e,10))),i={major:e[0],minor:e[1],patch:e[2]};return i.major<0||t.major<0||i.major===t.major&&(i.minor<0||t.minor<0||i.minor===t.minor&&(i.patch<0||t.patch<0||i.patch===t.patch))}}(e,i,a)))}function v(e,i){p.trace({source:"GlobalNotificationBanner",action:e,data:i})}function w(i){const t=i.trackingId,n=(0,l.makeWritableComputation)(!1);return{expandIcon:n.compose((e=>e?u.CaretUp():u.CaretDown())),id:t,isExpanded:n,message:(0,l.makeWritableComputation)((0,o.sanitizeHTML)(i.message,e).sanitizedMarkup),onClickToggleExpandedState:()=>n(!n.value),seeMoreString:n.compose((e=>e?a.NotificationMenu.collapse:a.NotificationMenu.seeMore)),title:(0,l.makeWritableComputation)((0,o.sanitizeHTML)(i.title,e).sanitizedMarkup)}}i.GlobalNotificationBanner=function(i){v("ReceiveNotifications",{notifications:i.notifications});const o=i.container.get(t.AuthStateManager).getCurrentUser()?.tenantId.toLowerCase(),g=b?.location?.hostname?.toLowerCase(),p=d.isChrome?"Chrome":d.isEdge?"Edge":d.isChromiumEdge?"Edg":d.isFirefox?"Firefox":d.isSafari?"Safari":"Other",x=function(e,i){if(i.includes(e)){const t=new RegExp(`\\s${e}/((\\d|\\.)+[\\s]|(\\d|\\.)+$)`).exec(i),n=t&&t[1]&&t[1].trim().split(".").map((e=>isNaN(parseInt(e,10))?-1:parseInt(e,10)));return n?.length>=2?{major:n[0]??-1,minor:n[1]??-1,patch:n[2]??-1}:null}}(p,m.getBrowserInfo().UserAgent),M=(0,l.makeWritableComputation)(!1),N=(0,l.makeArrayComputation)(h(i.notifications,p,g,o,x).map(w)),I={},k={};return v("SetNotifications",{notifications:N.value}),N.value.forEach((e=>{k[e.id]=e})),n(l.GetContext,{fn:i=>n(l.LifetimeManagerScoped,{fn:t=>{const d=i.diContainer.get(r.PollingManager);return(0,l.subscribe)(t,[d.getPolledDataObservable()],(e=>{const i=function(e,i,t){if(!e||!e.length)return[];return e.reduce(((e,n)=>{const a=n.trackingId,o=i[a],r=w(n);if(o){const i=r.title.value,n=r.message.value;return o.title.value===i&&o.message.value===n||(o.title(i),o.message(n),t[a]=void 0),t[a]||e.push(o),e}return t[a]||(v("ShowGlobalNotification",{id:a}),e.push(r)),e}),[])}(h(e.outages,p,g,o,x),k,I);N.setAll(i)})),n(l.If,{condition:N.compose(c.isNonEmptyArray),concealmentBehavior:"remove",trueFn:()=>n(l.Fragment,null,n(l.Css,{css:s}),n("div",{className:"fxs-global-notification-banner-content fxs-portal-text",role:"banner"},n(l.ForEach,{collection:N,fn:({item:i})=>{const t=i.seeMoreString;return n("div",{className:"fxs-global-notification-banner-item",afterMount:e=>{const t=e.parentNode.querySelector(".fxs-global-notification-banner-message").scrollHeight>36||$(e).hasClass("fxs-global-notification-banner-expandedMessage");M(t),i.isExpanded(!t)}},n("div",{className:"fxs-global-notification-banner-title"},i.title),n("button",{className:"fxs-global-notification-banner-dismissicon",image:u.Close(),onClick:()=>function(e,i,t){i.removeIf((i=>i.id===e)),v("DismissNotification",{trackingId:e}),t[e]=!0}(i.id,N,I),tabindex:"0",title:a.NotificationMenu.dismissNotification,"aria-label":a.NotificationMenu.dismissNotification}),n("div",{className:["fxs-global-notification-banner-message msportalfx-tooltip-overflow",{"fxs-global-notification-banner-expandedmessage":i.isExpanded}]},n(f.ShellHtml,{content:i.message,require:e})),n(l.If,{condition:M,concealmentBehavior:"remove",trueFn:()=>n("div",{className:"fxs-global-notification-banner-seemore-container"},n("a",{href:"#",tabindex:"0",className:"fxs-notification-banner-seemore-link",onClick:i.onClickToggleExpandedState},n("div",{className:"fxs-global-notification-banner-see-more-less",title:t,"aria-label":t},t),n("div",{className:"fxs-global-notification-banner-expandicon",image:i.expandIcon})))}))}})))})}})})}}));