define("MsPortalImpl/Base/Base.HierarchyMap",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HierarchyMap=void 0;const o="##-##";t.HierarchyMap=class{constructor(){this._observable=ko.observableArray()}addItem(e,t){if(!e||!e.length)throw new Error("Invalid path");if(e.some((e=>!e)))throw new Error("Invalid path segment");if(this._getItemIndex(e)>=0)throw new Error(`Duplicate path '${JSON.stringify(e)}'.`);this._observable.push({path:e,_pathKey:e.join(o),value:t})}removeItem(e){const t=this._getItemIndex(e);t>=0&&this._observable.splice(t,1)}removeItemsInPath(e){const t=[];this._getItemsWithPath(e,!0,((e,o)=>!e&&t.push(o))),this._observable(t)}_getItemIndex(e){const t=e.join(o);return MsPortalFx.findIndex(this._observable.peek(),(e=>e._pathKey===t))}getItem(e){const t=this._getItemIndex(e);return t>=0?this._observable.peek()[t]:null}getItemsInPath(e){return this._getItemsWithPath(e,!0)}getItemsUnderPath(e){return this._getItemsWithPath(e,!1)}getObservable(){return this._observable}_getItemsWithPath(e,t,n){const s=e.join(o);return this._observable.peek().filter((o=>{const i=o._pathKey.startsWith(s)&&(t||o.path.length>e.length);return n&&n(i,o),i}))}}})),
define("MsPortalImpl/UI/Compositions/UI.Composition.Journey",["require","exports","MsPortalImpl/Base/Base.HierarchyMap","MsPortalImpl/Services/Services.EditScopeManagement","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition.Base","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/Widgets/Widgets.Journey","Fx/ResourceManagement","MsPortalImpl/Widgets/Widgets.Portal.init","MsPortalImpl/UI/Compositions/UI.Composition.Blade"],(function(e,t,o,n,s,i,r,a,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=t.Instance=void 0;var c=s.CompositionType;function p(e,t){return e.id===t.id}class u extends i.Instance{constructor(e,t,n,s,i,r){super("Journey",e,null,n,s,i),this.journeyBlades=ko.observableArray(),this.lastModifiedTime=ko.observable(Date.now()),this.originTile=t,this._updateBladesMetadata(),this._ambientSettings=r||new o.HierarchyMap,this._setupEditScopeReactor(this.originTile)}get ambientSettings(){return this._ambientSettings}getCompositionType(){return c.Journey}getDeepLink(){return this.await(7).then((()=>{const e=this.children,t=e.length;return t?e[t-1].getDeepLink():this.diContainer.get(r.Finder).findPartsContainer(this.originTile).getDeepLink()}))}isStartedWithContextBlade(){const e=this.children;return e.length>0&&!!(1&e[0].flags)}observeEditScopeChanges(e,t){this._observeEditScopeChanges(e,t,!0)}_observeEditScopeChanges(e,t,o){ko.computed(e,(()=>{const e=t.editScopeId&&t.editScopeId();if(e){const s=this.diContainer.get(n.EditScopeManager).getStateObservable(e)(),i=2===s,r=1===s||i,a=t.ownerLocatable.journeyPath,l=this._ambientSettings;if(r){let n;const s=l.getItem(a);if(s){const e=s.value;if(e){const t=e.editScope;!t||t.dirty===r&&t.saving===i||(l.removeItem(a),n=!0)}}else n=!0;n&&l.addItem(a,{type:t.ownerType,editScope:{editScopeId:e,dirty:r,saving:i,disposeOnSelectionChange:t.disposeOnSelectionChange,disposeOnJourneyDiscard:o}})}else l.removeItem(a)}}))}removeChildAt(e,t){super.removeChildAt(e,t),this._updateBladesMetadata()}_addChildrenInternal(e,t){super._addChildrenInternal(e,t),this._updateBladesMetadata()}_setupEditScopeReactor(e){e&&e.await(7).then((()=>{if(!this.isDisposed()&&e.partDefinition.editScopeType){const t=e,o={editScopeId:e.editScopeId,ownerType:e.locator.type,ownerLocatable:e,disposeOnSelectionChange:!1};this._observeEditScopeChanges(t,o,!1)}}))}_updateBladesMetadata(){const e=this.journeyBlades;if(e){const t=e(),o=MsPortalFx.unique(this.children,p);let n=[];t.forEach((e=>{const t=MsPortalFx.find(o,(t=>p(e,t)));t&&(n.push(e),e.subtitle(t.subtitle()),e.title(t.title()))})),n=MsPortalFx.pushUnique(n,o,p),e(n)}}_compose(e,t){if(!e.options.getJourneyWidget()){const t=new a.ViewModel(this.id,(()=>(0,d.getPortalViewModel)(this.diContainer).getRootPageDisplayType()),this.diContainer);this.widget=new a.Widget(e.options.getJourneyArea(),t)}t.resolve()}getCurrentResourceId(){const e=this.children;for(let t=e.length-1;t>=0;t--){const o=e[t].assetId();if(o&&0!==l.ArmId.parse(o,!0).kind)return o}}}t.Instance=u,t.create=function(e,t){return new u(e,t)}})),
define("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Handler",["require","exports","Fx","Fx/DependencyInjection","Fx/Experimentation","Fx/ResourceManagement","MsPortalImpl/Base/Telemetry","MsPortalImpl/Base/Base.Pipeline","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/UI/UI.ContextPane","MsPortalImpl/UI/UI.JourneyManager","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition.Blade","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpenerBase","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Helpers","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/Extension/ViewModelManager","MsPortalImpl/UI/Compositions/UI.Composition.Journey","MsPortalImpl/UI/Compositions/UI.Composition.Blade"],(function(e,t,o,n,s,i,r,a,l,d,c,p,u,m,g,f,h,I,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldSkipPromptForBladesWithEdits=t.OpenBladeHandler=void 0;var b=MsPortalFx.Base.Diagnostics,v=f.mapMasterModelToBladeModel;const M=b.createLog(e),C=MsPortalFx.noop,B=I.getModelValue,_="disablermbrebindresourcetypes",P=l.Locator.forExtension("HubsExtension").withBlade("ResourceMenuBlade");let S=class{constructor(e,t,o,n){this._diContainer=e,this._options=t,this._resources=o,this._bladeRedirector=n}createDescriptor(e,t){const o=t.value;if(void 0!==o&&(!Array.isArray(o)||o.length)){let e=t.timestamp;const n=t.invocationInput.selectableSetV1?o[0]:o,s=!!this._resources.selectable2,{registrationInfo:{invocationInput:i,detailsDefinition:r,additionalInputs:a}}=this._resources,d=v(this._options.masterModelId,n,i);let c=i.opensDynamicBlades?function(e,t,o){const n=t.referenceExtension;return(0,g.mapDynamicSelectionToBladeLocator)(e,o,l.Locator.forExtension(n.name),t.masterModelId)}(this._diContainer,this._options,n):this._resources.detailsBladeLocator;const{container:p}=this._resources;let u,f;c=this._bladeRedirector.applyRedirects(c,d,p instanceof m.Instance&&{bladeDefinition:p.bladeDefinition,locator:p.locator,model:p.getViewModel(1)});let h=!1,I=!!r.asSubJourney,y=!1,b=!1,M=!1,C=!1,B=!1,_=!1,P=!1,S="";i.opensDynamicBlades&&n&&(u=n.openInContextPane,f=n.persistentContextPane,s&&(e=n.timestamp,h=!!(2&n.flags),I=!!(8&n.flags),y=!!(128&n.flags),b=!!(256&n.flags),M=!!(512&n.flags),C=!!(64&n.flags),B=!!(1024&n.flags),_=!!(2048&n.flags),P=!!(4096&n.flags),S=n.telemetryName)),void 0===u&&(u=r.openInContextPane,f=r.persistentContextPane);let x=u?1:0;f&&(x|=2),!h&&(x|=4),I&&(x|=8),y&&(x|=16),b&&(x|=32),M&&(x|=128),C&&(x|=64),B&&(x|=256),_&&(x|=512),P&&(x|=1024);const D={timestamp:e,locator:c,masterInvocationProperty:i.source.property,bindings:a.slice(0),model:d,masterInputKeys:Object.keys(d),masterDetailsDefinition:r,flags:x};a.forEach((e=>{D.model[e.targetProperty]=e.source.constantValue})),this._options.configureBindings&&D.bindings&&D.bindings.length&&this._options.configureBindings(D.bindings),this._options.configureBladeDescriptor(D),n&&(D.openedByContext=n.context,n.defaultMenuItemId&&(D.defaultMenuItemId=n.defaultMenuItemId,D.contentBladeReference=n.contentBladeReference,n.flags|=64)),D.telemetryName=S;const O=this._options.referenceComposition&&this._options.referenceComposition.partDefinition;n&&(n.assetType&&n.detailBladeInputs?D.originAssetType=n.assetType:n.originAssetType&&n.detailBladeInputs&&n.detailBlade?(D.originAssetType=n.originAssetType,D.originAssetTypeExtension=n.originExtension):O&&(D.originAssetType=O&&O.assetType,D.originAssetTypeExtension=this._options.referenceExtension&&this._options.referenceExtension.name)),t.descriptor=D}}openBlade(e,t){const n=this._options,a=this._resources,l=t.invocationInput,m=a.container,f=t.value;(0,g.traceInvocationChange)(M,"Executing invocation property change",this._diContainer,n,l,f),m&&m.onInvocationStarted();const b=function(e,t,n,a,l,m,g){const f=g.invocationInput;let b=!0;const C=f.selectableSetV1&&l;if(!(void 0===l||C&&0===C.length))return function(e,t,n,a,l,m,g){const f=e.get(h.Finder),b=g.invocationInput,C=g.additionalInputs,S=g.detailsDefinition,D=Promise.withResolvers(),O=()=>{D.resolve([])},E=l;let w=!0;const A=n.getCloseOtherDetailBladesHandler(b,S)||((t,r)=>function(e,t,n,r,a,l,d){const p=e.get(c.JourneyManager),m=e.get(h.Finder),g=m.findSiblingBlades(t.referenceComposition,!!(32&l.flags),!!(512&l.flags)),f=e=>t.isBladeOpenedByMaster(e)&&e.masterInvocationProperty===r.source.property;let I,y,b=!0,v=!1,C=d&&d.getContent();C&&C.id&&g.some((e=>e.id===C.id))&&(C=null);I=g.filter((e=>{let t=!1;const o=e.bladeDefinition,n=!!(2&l?.flags),s=!!(2&e.flags);if(!(e.isDisposed()||256&e.flags||512&e.flags||n!==s))if(!f(e)||1&o?.attributes||64&l?.flags)t=!0;else{if(e.locator.equals(l.locator)){const o=function(e,t){let o=e;if(e&&t&&t.length){const n={};t.forEach((e=>{n[e.targetProperty]=!0})),o=MsPortalFx.forEachKey(e,((e,t,o)=>{n[e]||(o[e]=t)}),{})}return o}(l.model,a);t=!(0,u.deepSubset)(e.getBindableContainer().getViewModel(),o),y=e}else t=!0}return t}));let B=x(e,I);if(I.length===g.length&&y&&function(e,t,n){let s=[];const r=e.widget,a=n.shellAssignments.getBooleanValue("disablebladerebind");r&&(s=r.options.commandBar.menuItems(),e.children.forEach((e=>{e.children.forEach((e=>{const t=e.widget;t&&(s=s.concat(t.options.commands))}))})));const l=t.masterDetailsDefinition,d=l&&!!l.parameterCollector,c=!!(1&e.bladeDefinition?.attributes)||!!(64&t.flags)||(0,o.isFeatureEnabled)("disablebladerebind")||a;let p=!e.isDisabled&&e.bladeDefinition&&!e.bladeDefinition.waitForInputsSet&&!c&&!d&&s.every((e=>e.canRebind));p||c||d||M.warning(`Unable to rebind Blade '${e.id}', it was either disabled, cleared, or one of its commands was executing. Will close and reopen blade instead.`);if(p&&P.equals(t.locator)){const s=(0,o.getFeatureValue)(_)||n.shellAssignments.getStringValue(_);let r;try{r=s&&JSON.parse(s),s&&!Array.isArray(r)&&M.error(`The feature setting/experiment value '${_}' is incorrectly formatted.  Expected a JSON formatted array but received '${s}'`)}catch(e){M.error(`Failed to parse the feature setting/experiment value '${_}'`,0,e)}if(Array.isArray(r)){const o=i.ArmId.parse(t.model?.id,!0);o&&0!==o.kind&&(p=!r.includes(o.resourceType.toLowerCase()),p||(t.defaultMenuItemId=t.defaultMenuItemId||e.menu?.getSelectedItem()?.id))}}return p}(y,l,e.get(s.Experimentation))){MsPortalFx.remove(I,y),I=I.concat(m.findBlades(y));const e=p.discardEditsOfBlade(y,{includeSelf:!1,includeDescendants:!0,force:B});b=e.successful,v=b&&e.confirmationRequired}const S=!(21===l?.flags);if(b&&!v&&S){let e=!0;const t=I.length>0,o=t;C&&C.id&&!t&&(e=p.confirmBladesCanClose([C])),t&&(B=!1),b=B?e:p.confirmBladesCanClose(I,null,o)}if(b)for(let e=I.length-1;e>=0;e--){const o=I[e];f(o)&&(t.removeOutputBindings(o),n.bladesClosedByPart.set(o,!0)),p.forceCloseBlade(o,1,{openBlade:!0})}return b}(e,n,a,b,C,t,r)),U=e=>n.onBladesOpening(e),T=e.get(c.JourneyManager);let F;if(!Array.isArray(l)||E.length){const s=!!(2&t?.flags),i=e.get(d.RightContextPane);if(w=!!(256&t.flags)||A(t,i),w){"getCompositionType"in(i.getContent()||{})||1&t.flags||m.menu||i.close();const d=f.findBlades(a.container,!!(32&t?.flags),!!(512&t?.flags));let c;const u=d[0];if(256&~t.flags&&1===d.length&&u.widget&&64&~t.flags&&!s==!(2&u.flags)){c=!0;const e=b.selectableSetV1?l[0]:l,t=v(n.referenceComposition?n.referenceComposition.locator.toString():n.masterModelId,e,b);r.isDesktopTraceEnabled&&M.verbose(`[BladeOpener] Rebinding blade.\n  ${u.id}.\n  New Model: ${ko.toJSON(t)}`),F=u;const o=u.rebindAsync(t);a.selectable2?o.finally(O):O()}if(!c){let s;if(U([t]),"##NOT_SPECIFIED##"!==t.locator.name){e.get(y.ViewModelManager).tryEarlyGetViewModel(t.locator.getExtensionName(),t.locator.name,t.model,{isPrefetch:!0,menuId:t.defaultMenuItemId,inContextPane:!!(1&t.flags),isMenuBladeContent:(()=>{if(16&t.flags)return!0;const o=e.get(h.Finder).findPartsContainer(n.referenceComposition),s=o&&o.getCompositionType()===p.CompositionType.Blade&&o.bladeDefinition;return!(!s||!s.menuBlade&&!s.tabMenuBlade)})(),menuContentOverride:t.contentBladeReference,inSideBar:!!(256&t.flags),inDockedContextPane:!!(512&t.flags)}),s=!0}MsPortalFx.tryImmediateResolve(s?(0,o.delay)(0):Promise.resolve(),(()=>{e.isDisposed()?D.reject(new MsPortalFx.Errors.DisposedCanceledError):T.openBlade(m,t).then((e=>{e&&e.onDispose((()=>{!function(e,t,o,n,s,i){const r=e.referenceComposition&&e.referenceComposition.id;if(r&&r!==o.masterPartId)return;const a=t.get(o);e.removeOutputBindings(o),a||function(e,t,o,n){const s=B(e.masterModel,t.source.property).value,i=ko.toJS(s);if(Array.isArray(i))s.splice(0,i.length);else{!!(o&&64&n.flags)&&ko.unwrap(s)!==n||I.setModelValue(e.masterModel,t.source.property,void 0)}}(e,n,s,i)}(n,a.bladesClosedByPart,e,b,!!a.selectable2,l)})),D.resolve([e])}))})),a.previousInvocationPromise=D.promise.finally((()=>{a.previousInvocationPromise=void 0}))}}else O()}return D.promise.then((e=>{const t=a.selectable2,o=g.invocationOutputs,s=(e=e||[]).filter((e=>t||!(2&e?.flags))),i=1===s.length?s[0]:void 0;if(e.filter((e=>!!e)).forEach(a.bladeOpenedCallbacks.fire),!t&&s.length>0&&Array.isArray(o)&&o.length>0)if(i)i.await(7).then((()=>{n.addOutputBindings(i,o)}));else{const t=e.map((e=>e.getDiagnosticsData())),s=`Unable to create output binding with detail blade, multiple detail blades found.\nMaster Model Debug Id: ${n.masterModelId}.\nOutput Arguments: ${ko.toJSON(o,null,2)}\nDetail Blades: ${ko.toJSON(t,null,2)}`;M.error(s)}})),{succeeded:w,bladeOpenPromise:D.promise,reboundBlade:F}}(e,t,n,a,l,m,g);{const t=n.getCloseOwnedDetailBladesHandler(f)||(()=>function(e,t,o,n){const s=e.get(c.JourneyManager);if(!s.activeJourney())return!0;const i=e.get(h.Finder),r=i.findBlades(t.referenceComposition).filter((e=>!e.isDisposed()&&e.masterInvocationProperty===n.source.property&&t.isBladeOpenedByMaster(e))),a=x(e,r),l=a||s.confirmBladesCanClose(r);if(l){const e=D(t,n)||{};for(let n=r.length-1;n>=0;n--){const i=r[n],a=e._msPortalFxDelayedBladeSelection;o.set(i,!0),t.removeOutputBindings(i),s.forceCloseBlade(i,1,{openBlade:a})}}return l}(e,n,a.bladesClosedByPart,f));b=t()}return{succeeded:b,bladeOpenPromise:void 0,reboundBlade:void 0}}(this._diContainer,t.descriptor,n,a,f,m,a.registrationInfo);b.succeeded?(a.resettingMasterArrayValue=!1,a.prevValue=f):a.resettingMasterArrayValue?(M.error("Resetting value of master '{0}' also caused a prompt".format(n.masterModelId),0,a.prevValue),a.resettingMasterArrayValue=!1):(a.resettingMasterArrayValue=l.selectableSetV1,function(e,t,o){const n=e.referenceExtension,s=()=>n.processMessages();s().then((()=>{const n=`Set invocation property '${t.source.property}' of master '${e.masterModelId}' to value.`;M.verbose("START: "+n,o);const i=t.source.property,r=D(e,t),a=r&&r.isSelected;if(r&&a&&void 0!==o){const t=function(e,t){let o=e;if(!e)return;o.lock&&o.setInternalSelectedValue&&o.isLocked||(M.error(`selectable is not a framework implementation, view model = '${t}'`),o={lock:C,setInternalSelectedValue:function(t){e.selectedValue(t)},isLocked:C});return o}(r,e.masterModelId);t.setInternalSelectedValue(o),a()||a(!0)}else I.setModelValue(e.masterModel,i,o);if(i.includes("activatedItems")){const t=i.replace("activatedItems","selectedItems"),n=B(e.masterModel,t),r=n.exists&&n.value;ko.isObservable(r)&&Array.isArray(r())&&s().then((()=>{r.splice.apply(r,[0,r().length].concat(o))}))}M.verbose("END: "+n,o)}))}(n,l,a.prevValue)),t.reboundBlade=b.reboundBlade;const S=b.bladeOpenPromise;return S?S.then((e=>{t.openedBlades=e})):null}};function x(e,t){const o=e.get(c.JourneyManager).activeJourney();return t.every((e=>{if(!e.isInitialized)return!0;const t=!!e.bladeDefinition.actionBar;if(e.shouldAlertOnClose({legacyMode:t})){if(!t)return!1;{const t=e.getViewModel(2),o=t&&t.content(),n=o&&o.output&&o.output();if(3!==(n&&n.status))return!1}}return o.ambientSettings.getItemsInPath(e.journeyPath).every((e=>!(!e||!e.value||1!==e.value.type)&&(!e.value.editScope||e.value.editScope.disposeOnSelectionChange)))}))}function D(e,t){const o=t.source.property.lastIndexOf("."),n=o>0?t.source.property.substring(0,o):"";return B(e.masterModel,n).value}t.OpenBladeHandler=S,__decorate([__metadata("fx:diagnostics",[e,"OpenBladeHandler.prototype"]),a.Step(4),__metadata("design:type",Function),__metadata("design:paramtypes",[a.Task,Object]),__metadata("design:returntype",void 0)],S.prototype,"createDescriptor",null),__decorate([__metadata("fx:diagnostics",[e,"OpenBladeHandler.prototype"]),a.Step(5),__metadata("design:type",Function),__metadata("design:paramtypes",[a.Task,Object]),__metadata("design:returntype",void 0)],S.prototype,"openBlade",null),t.OpenBladeHandler=S=__decorate([__metadata("fx:diagnostics",[e,"OpenBladeHandler"]),n.Class("pipeline"),__metadata("design:paramtypes",[n.Container,g.Configuration,g.Resources,f.BladeRedirector])],S),t.shouldSkipPromptForBladesWithEdits=x}));