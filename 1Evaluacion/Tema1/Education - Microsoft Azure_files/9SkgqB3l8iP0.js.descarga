define("MsPortalImpl/Weave/SandboxDomAgents/Button",["require","exports","MsPortalImpl/Base/Base.Selectable2","MsPortalImpl/UI/UI.LinkHandler","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Widgets/Widgets.Common"],(function(e,t,o,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attachDomAgent=void 0;MsPortalFx.Base.Diagnostics;t.attachDomAgent=function(t,l,c,d){const p=$(t).parent(),u=s+a++,g=(0,o.getFxClickSelectable)(c,l,p,s,u);let m,k=(e,t,o)=>!0,b="";ko.reactor(l,(()=>{m&&m.dispose(),m=l.createChildLifetime();const t=ko.unwrap(d.onClick);if(b=t&&t.telemetryName||"",!ko.unwrap(d.aggregatedDisabled)&&t){const o=p.find(".fxs-button");ko.ignoreDependencies((()=>{let s;if("function"==typeof t){const o=t;s=t=>{t.stopPropagation(),Q.isPromiseAlike(o)&&(0,n.logToExtension)(e,p,2,FxImpl.createError("SimpleButton binding argument is not a callback function. The click handler is "+o)),g.invokeClick(void 0,o,t)}}else s=t;(0,i.isLink)(t)?o.attr("role","link"):o.attr("role","button");const a=(0,r.getUriAndHandler)(m,c,s,!0);a.errorMessage.subscribeAndRun(m,(t=>{t&&(0,n.logToExtension)(e,p,1,FxImpl.createError(`SimpleButton failure: ${MsPortalFx.getLogFriendlyMessage(t)}`))}));(a.uriPromise&&a.uriPromise()?a.uriPromise():Promise.resolve()).then((()=>{!m.isDisposed()&&a.uri.subscribeAndRun(m,(e=>{d.selfDisabled(!e)}))})),k=a.handler}))}}));const f=t=>{if(t.stopPropagation(),t.preventDefault(),!ko.unwrap(d.aggregatedDisabled))try{k(t,g,b)}catch(t){(0,n.logToExtension)(e,p,2,FxImpl.createError("Button control failed to execute click handler",{innerErrors:t,data:{databind:$(p).attr("data-bind")}}))}};l.registerForDispose(p.setEvents(["click",f],["keydown",e=>{13!==e.keyCode&&32!==e.keyCode||(f(e),32===e.keyCode&&(e.preventDefault(),e.stopPropagation()))}]))};const s="simplebutton";let a=0}));