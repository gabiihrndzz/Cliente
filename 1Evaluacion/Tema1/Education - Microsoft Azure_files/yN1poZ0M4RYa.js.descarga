define("@microsoft/azureportal-reactview/Deployments",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.endCustomDeploy=t.startCustomDeploy=t.setMarketplaceId=t.deployStack=t.deployTemplate=t.validateTemplate=t.DeploymentStatusCode=t.TemplateDeploymentMode=void 0;const o=__InternalAzurePortal.AzInternalApi.internalApi;var r,a;!function(e){e[e.RequestDeploymentOnly=1]="RequestDeploymentOnly",e[e.DeployAndAwaitCompletion=2]="DeployAndAwaitCompletion",e[e.DeployAndGetAllOperations=3]="DeployAndGetAllOperations",e[e.PreflightOnly=4]="PreflightOnly"}(r||(t.TemplateDeploymentMode=r={})),function(e){e[e.Failure=-1]="Failure",e[e.Success=0]="Success",e[e.DeploymentRequestFailed=1]="DeploymentRequestFailed",e[e.DeploymentFailed=2]="DeploymentFailed",e[e.DeploymentStatusUnknown=3]="DeploymentStatusUnknown",e[e.ErrorProvisioningResourceGroup=4]="ErrorProvisioningResourceGroup",e[e.ErrorSubmittingDeploymentRequest=5]="ErrorSubmittingDeploymentRequest",e[e.ErrorGettingDeploymentStatus=6]="ErrorGettingDeploymentStatus",e[e.InvalidArgs=7]="InvalidArgs",e[e.ErrorRegisteringResourceProviders=8]="ErrorRegisteringResourceProviders",e[e.DeploymentCanceled=9]="DeploymentCanceled",e[e.UnknownError=10]="UnknownError"}(a||(t.DeploymentStatusCode=a={})),t.validateTemplate=function(e){return o.validateTemplate(e)},t.deployTemplate=function(e){return o.deployTemplate(e)},t.deployStack=function(e){return o.deployStack(e)},t.setMarketplaceId=function(e){return o.setMarketplaceId(e)},t.startCustomDeploy=function(){return o.initDeployCustom()},t.endCustomDeploy=function(e){return o.resolveDeployCustom({deploymentId:e})}})),
define("@microsoft/azureportal-reactview/Footer",["require","exports","react","@microsoft/azureportal-reactview/Styling","@microsoft/azureportal-reactview/Css","@microsoft/azureportal-reactview/internal/ReactView"],(function(e,t,o,r,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Footer=void 0;const i=(0,r.getClassNames)({footer:{"border-top":"1px solid lightgrey",overflow:"hidden"}});t.Footer=e=>o.createElement(n.ReactPortalContent,{containerId:"__bladeFooter"},o.createElement("div",{className:`${a.CSSClasses.Padding} ${i.footer}`},e.children))})),
define("@microsoft/azureportal-reactview/Provisioning",["require","exports","@microsoft/azureportal-reactview/Navigation","@microsoft/azureportal-reactview/Deployments","@microsoft/azureportal-reactview/internal/ReactView"],(function(e,t,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInitialDropdownValues=t.doesProvisioning=void 0;const n=__InternalAzurePortal.AzInternalApi.internalApi;t.doesProvisioning=function(){return n.doesProvisioning().then((e=>({...e,validateTemplate:r.validateTemplate,deployTemplate:r.deployTemplate,deployStack:r.deployStack,setMarketplaceId:r.setMarketplaceId,deployCustom:e=>(0,r.startCustomDeploy)().then((t=>(e.provisioningPromise.then((()=>(0,r.endCustomDeploy)(t))),e.provisioningPromise))),getArmErrorsBladeReference:o.getArmErrorsBladeReference,getAutomationBladeReference:o.getAutomationBladeReference})))},t.getInitialDropdownValues=function(){return a.ReactView.getInstance().getInitialDropdownValues()}})),
define("@microsoft/azureportal-reactview/LocationDropdown",["require","exports","react","FxInternal/Resources/ReactComponents","@microsoft/azureportal-reactview/Az","@microsoft/azureportal-reactview/internal/ErrorBoundary","react","@fluentui/react/lib/Stack","@fluentui/react/lib/Button","@fluentui/react/lib/SelectableOption","@fluentui/react/lib/Utilities","@microsoft/azureportal-reactview/ResourceManagement","@microsoft/azureportal-reactview/Shimmer","@microsoft/azureportal-reactview/FormLabel","@microsoft/azureportal-reactview/BladeLink","@fluentui/react/lib/Label","@microsoft/azureportal-reactview/Provisioning","@microsoft/azureportal-reactview/ControlPlaneValidators","@microsoft/azureportal-reactview/internal/DefaultResourceValidation","@microsoft/azureportal-reactview/FilterableDropdown","@microsoft/azureportal-reactview/internal/ResourceManagement","@microsoft/azureportal-reactview/internal/FormLabelValidationContextType","@microsoft/azureportal-reactview/DataManagement"],(function(e,t,o,r,a,n,i,s,l,c,u,d,p,m,g,f,v,b,y,S,x,w,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocationDropdown=t.LocationsScope=void 0;const C={dropdownItemHeader:{fontWeight:600,color:"rgb(1, 92, 218)",height:"36px",lineHeight:"36px",padding:"0 8px",userSelect:"none"},dropdownOptionText:{margin:"1px",textOverflow:"ellipsis",overflow:"hidden"}},E=e=>{const[t]=o.useContext(y.DefaultResourceValidationContext),{selectedLocationId:r}=e,a=o.useMemo((()=>t.resourceTypes?.map((([e])=>e)).sort().join(",")),[t.resourceTypes]);return(0,m.useValidationEffect)((()=>{if(t.skipDefault)return[];const e=d.ArmId.parse(r).resourceName;return(t.resourceTypes||[]).map((async([o,r])=>{const{scopeId:a,resourceScopeId:n}=t,i=await(0,b.ControlPlanePolicyEvaluator)({...n&&{resourceScopeId:n},...a&&{scopeId:a}},{resourceTypeMetadata:{apiVersion:r,resourceType:o,resourceTypeProperty:"location",resourceTypePropertyAlias:""},resolvedValuesToField:[e],additionalTelemetry:{DefaultResourceContext:"LocationDropDown"}}),{customHtml:s,allErrorResults:l}=i;return{message:s,state:l.length>0?3:2}}))}),[t.skipDefault,a,r]),o.createElement(S.FilterableDropdown,{...e})},D=(0,m.withFormLabelAndValidation)(E),I=o.memo((function(e){const{customizeLocations:t,disableDefaultSelection:d,initialLocationName:m}=e,[b,S]=(0,i.useState)([]),[I,F]=o.useContext(y.DefaultResourceValidationContext),N=o.useContext(w.FormLabelValidationContext),L=o.useRef(null),k=(0,n.useTriggerErrorBoundary)(),z=o.useMemo((()=>e.resourceTypes),[JSON.stringify(e.resourceTypes)]),T="string"==typeof e.subscriptionId?e.subscriptionId:e.subscriptionId?.subscriptionId,{result:P,loading:V}=(0,h.useAsync)(x.getLocationsAndResourceTypes,[T,z],{disabled:0===e.scope&&!T,onError:e=>{a.log([{level:2,message:"Unable to retrieve locations",area:"LocationDropdown.tsx-getLocations",timestamp:Date.now(),args:[e]}]),k(e)}}),{result:B,loading:A}=(0,h.useAsync)(v.getInitialDropdownValues,[]),O=o.useMemo((()=>{if(P?.locations){const e=P.locations.map((e=>({id:e.name,...e})));return t?t(e):e}return[]}),[P,t]),G=(0,i.useMemo)((()=>[...O,...b]),[O,b]),M=(0,i.useMemo)((()=>{const t=function(e,t){const o=[],a=[],n=[],i=[],s={key:"providedHeader",text:r.LocationsDropdown.serviceProvided,itemType:c.SelectableOptionMenuItemType.Header,title:r.LocationsDropdown.providedHeaderInfo},l={key:"recommendedHeader",text:r.LocationsDropdown.recommended,itemType:c.SelectableOptionMenuItemType.Header,title:r.LocationsDropdown.recommendedHeaderInfo},d={key:"otherHeader",text:r.LocationsDropdown.other,itemType:c.SelectableOptionMenuItemType.Header,title:r.LocationsDropdown.otherHeaderInfo};e.forEach((e=>{switch(e.metadata&&e.metadata.regionCategory){case"ServiceProvided":a.push(e);break;case"Recommended":n.push(e);break;case"Other":i.push(e)}})),a.length&&(o.push(s),o.push(...R(a,t).map((e=>({...e,ariaLabel:e.ariaLabel??(0,u.format)(r.LocationsDropdown.optionAriaLabel,r.LocationsDropdown.serviceProvided,e.text)})))),o.push({key:"providedDivider",text:"-",itemType:c.SelectableOptionMenuItemType.Divider}));n.length&&(o.push(l),o.push(...R(n,t).map((e=>({...e,ariaLabel:e.ariaLabel??(0,u.format)(r.LocationsDropdown.optionAriaLabel,r.LocationsDropdown.recommended,e.text)})))),o.push({key:"recommendedDivider",text:"-",itemType:c.SelectableOptionMenuItemType.Divider}));i.length&&(o.push(d),o.push(...R(i,t).map((e=>({...e,ariaLabel:e.ariaLabel??(0,u.format)(r.LocationsDropdown.optionAriaLabel,r.LocationsDropdown.other,e.text)})))));return o}(G,e.customizeDropdownOptions);return e.customizeOptions?e.customizeOptions(t):t}),[G]),[H,q]=(0,i.useState)(""),_=e.selectedLocationId||H,j=(t,o)=>{q(t||"");try{e.onLocationChange?.(t||"",o||null),e.onChange?.(void 0,o||null)}catch(e){a.log([{level:2,message:e,area:"LocationDropdown.tsx-onLocationChange",timestamp:Date.now()}])}};(0,i.useEffect)((()=>{if(L.current!==T&&P&&!A){L.current=T,S([]),F({resourceTypes:Object.entries(P.resourceTypeApis).map((([e,[t]])=>[e,t]))});let e=null;const t=_.lastIndexOf("/")+1;if(t>1){const o=_.substring(t);e=O.find((e=>e.name===o))}else if(m)if("string"==typeof m)e=O.find((e=>e.name===m));else for(const t of m){if(e)break;e=O.find((e=>e.name===t))}if(e)j(e.id,e);else if(!d){const e=B?.locationNames?.length>0&&B.locationNames[0],t=e&&O.find((t=>t.name===e))||O[0];j(t?.id,t)}}}),[T,A,P,O]);const $={label:void 0,"aria-labelledby":e.ariaLabelledBy,"aria-required":e.ariaRequired,onRenderItem:(e,t)=>e.itemType===c.SelectableOptionMenuItemType.Header?o.createElement(s.Stack,{key:e.key,className:"ms-Dropdown-header",horizontal:!0,verticalAlign:"center",style:C.dropdownItemHeader},o.createElement("span",{className:"ms-Dropdown-optionText",style:C.dropdownOptionText},e.text),o.createElement(l.IconButton,{iconProps:{iconName:"Info"},styles:{root:{marginBottom:-3}},ariaLabel:"Group info",title:e.title})):t(e),onChange:(e,t)=>{j(t.key,O.find((e=>e.id===t.key)))},selectedKey:_,selectedLocationId:_,options:M,ariaLabel:e.ariaLabel||r.LocationsDropdown.label,optionFilter:(e,t)=>{const o=e.data;return[o.regionalDisplayName,o.displayName,o.name].some((e=>e.toLocaleLowerCase().indexOf(t)>=0))}},U=I.skipDefault||!!N;return o.createElement("div",null,U&&e.label&&o.createElement(f.Label,null,e.label),o.createElement(p.Shimmer,{stretch:!0,isDataLoaded:[!V&&!A]},U?o.createElement(E,{...e,...$}):o.createElement(D,{...e,...$,formLabelProps:{displayValue:e.label||r.LocationsDropdown.label,hideLabel:!e.label}}),...e.enableEdgeLocations?[o.createElement(g.BladeLink,{key:"EdgeLocationLink",bladeReference:{extensionName:"Microsoft_Azure_Compute",bladeName:"EdgeZonesPicker.ReactView",onClosed(e,t){2===e&&t?.id&&(S([t]),j(t.id,t))}}},r.LocationsDropdown.edgeLocationsLabel)]:[]))}));var F;function R(e,t){return e.sort(((e,t)=>e.metadata.geographyGroup===t.metadata.geographyGroup?e.displayName<t.displayName?-1:1:e.metadata.geographyGroup<t.metadata.geographyGroup?-1:1)).map((e=>{const o=t&&t(e,{text:e.regionalDisplayName});return{key:e.id,text:e.regionalDisplayName,data:e,...o}}))}!function(e){e[e.Subscription=0]="Subscription",e[e.Tenant=1]="Tenant"}(F||(t.LocationsScope=F={})),t.LocationDropdown=(0,n.withErrorBoundary)(I,"LocationDropdown")})),
define("@microsoft/azureportal-reactview/ResourceGroups",["require","exports","@microsoft/azureportal-reactview/internal/ReactView"],(function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateResourceGroup=t.getResourceGroups=void 0;const r=__InternalAzurePortal.AzInternalApi.internalApi;t.getResourceGroups=function(e){return o.ReactView.getInstance().getResourceGroups(e)},t.validateResourceGroup=function(e){return r.validateResourceGroup(e)}})),
define("@microsoft/azureportal-reactview/ResourceGroupDropdown",["require","exports","react","@microsoft/azureportal-reactview/Az","react","@microsoft/azureportal-reactview/internal/ErrorBoundary","FxInternal/Resources/ReactComponents","@fluentui/react/lib/Callout","@fluentui/react/lib/Link","@fluentui/react/lib/TextField","@fluentui/react/lib/Separator","@microsoft/azureportal-reactview/ResourceManagement","@fluentui/react/lib/Button","@microsoft/azureportal-reactview/ResourceGroups","@fluentui/react/lib/Utilities","@microsoft/azureportal-reactview/Shimmer","@microsoft/azureportal-reactview/FilterableDropdown","@fluentui/react/lib/Label","@microsoft/azureportal-reactview/Provisioning","@microsoft/azureportal-reactview/internal/DefaultResourceValidation","@microsoft/azureportal-reactview/DataManagement"],(function(e,t,o,r,a,n,i,s,l,c,u,d,p,m,g,f,v,b,y,S,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceGroupDropdown=void 0;const w=e=>{const[t,r]=(0,a.useState)(""),[n,l]=(0,a.useState)(!1);return o.createElement(s.Callout,{target:e.linkRef,onDismiss:()=>e.dismiss(),style:{maxWidth:"370px"},setInitialFocus:!0,styles:{root:{zIndex:1e3}}},o.createElement("div",{style:{padding:"20px"}},o.createElement("p",null,i.ResourceGroupDropdown.description),o.createElement(c.TextField,{required:!0,validateOnLoad:!1,label:i.ResourceGroupDropdown.name,onChange:(e,t)=>r(t),onGetErrorMessage:()=>(0,m.validateResourceGroup)({existingResourceGroupNames:e.existingResourceGroupNames,resourceGroupName:t,subscriptionId:e.subscriptionId}).then((t=>(l(t.valid),t.message||!t.valid&&i.ResourceGroupDropdown.unknownValidationError.replace("{0}",e.subscriptionId))),(t=>(l(!1),(0,g.format)(i.ResourceGroupDropdown.unknownValidationError,e.subscriptionId))))})),o.createElement(u.Separator,{styles:{root:{padding:0,height:"1px"}}}),o.createElement("div",{style:{padding:"20px"}},o.createElement(p.PrimaryButton,{text:i.ResourceGroupDropdown.ok,disabled:!t||!n,style:{marginRight:"10px"},onClick:()=>e.dismiss(t)}),o.createElement(p.DefaultButton,{text:i.ResourceGroupDropdown.cancel,onClick:()=>e.dismiss()})))},h=o.memo((function(e){const[t,s]=(0,a.useState)(null),[c,u]=(0,a.useState)(!1),p=o.useRef(),g=(0,n.useTriggerErrorBoundary)(),[,h]=o.useContext(S.DefaultResourceValidationContext),{result:C,loading:E}=(0,x.useAsync)((async e=>{const t=(await(0,m.getResourceGroups)({subscriptionIds:[e]})).map((e=>({...e,resourceId:e.id}))),o=Intl.Collator(void 0,{sensitivity:"base"});return t.sort(((e,t)=>o.compare(e.name,t.name))),t}),[e.subscriptionId],{disabled:!e.subscriptionId,onError:e=>{r.log([{level:2,message:"Unable to retrieve resource groups",area:"ResourceGroupDropdown.tsx-getResourceGroups",timestamp:Date.now(),args:[e]}]),g(e)}}),D=(0,a.useMemo)((()=>C||[]),[C]),{result:I,loading:F}=(0,x.useAsync)(y.getInitialDropdownValues,[]),[R,N]=(0,a.useState)({}),L=o.useRef({}),[k,z,T]=(0,a.useMemo)((()=>{let t=e.selectedResourceGroupId??R.group?.id,o=!1,r=!1;if((!e.createNew||L.current.group&&L.current.subscriptionId!==e.subscriptionId)&&(L.current={}),e.createNew&&C&&e.subscriptionId)if("string"==typeof e.selectedResourceGroupId){let r=e.newResourceGroupName,a=!0;if(e.selectedResourceGroupId){const t=d.ArmId.parse(e.selectedResourceGroupId,!0);if(t.subscription===e.subscriptionId){D.find((e=>e.name.toLowerCase()===t.resourceGroup.toLowerCase()))?r="":(r=t.resourceGroup,a=!1)}}if(r){const n=`/subscriptions/${e.subscriptionId}/resourceGroups/${r}`;L.current={group:{id:n,location:"",name:r,resourceId:n},subscriptionId:e.subscriptionId,validated:!1,isDefaultNewGroup:a},t=n,o=!0}}else{if(e.newResourceGroupName&&(!L.current.group||L.current.isDefaultNewGroup)){const o=`/subscriptions/${e.subscriptionId}/resourceGroups/${e.newResourceGroupName}`;L.current.group?.id!==o&&(r=!!L.current.group&&R.new,L.current={group:{id:o,location:"",name:e.newResourceGroupName,resourceId:o},subscriptionId:e.subscriptionId,validated:!1,isDefaultNewGroup:!0}),R.new&&(t=o)}o=R.new&&!!L.current.group}return[t,o,r]}),[e.createNew,L.current.group,L.current.subscriptionId,L.current.isDefaultNewGroup,e.subscriptionId,C,e.selectedResourceGroupId,R,e.newResourceGroupName]),{result:P,loading:V}=(0,x.useAsync)((async(e,t)=>(0,m.validateResourceGroup)({resourceGroupName:e,subscriptionId:t,existingResourceGroupNames:D.map((e=>e.name))})),[L.current.group?.name,e.subscriptionId,D],{disabled:!L.current.group||L.current.validated}),B=L.current.validated||P?.valid,A=(0,a.useMemo)((()=>{const t=[],o=new Set,r=[];L.current.group&&B&&r.push({group:L.current.group,new:!0}),r.push(...D.map((e=>({group:e,new:!1}))));for(const a of r)if(!o.has(a.group.id)){o.add(a.group.id);const r=a.new?i.ResourceGroupDropdown.newGroup.replace("{0}",a.group.name):a.group.name,n=e.customizeOptions?.(a.group,{text:r});t.push({key:a.group.id,text:r,data:a,...n})}return t}),[D,L.current.group,B]),O=(t,o)=>{const a=t?.name||"";p.current=e.subscriptionId,h({resourceGroup:a,createNew:o}),N({group:t,new:o});try{e.onResourceGroupChange?.(a,t,o),e.onChange?.(void 0,t,o)}catch(e){r.log([{level:2,message:e,area:"ResourceGroupDropdown.tsx-onLocationChange",timestamp:Date.now()}])}};return(0,a.useEffect)((()=>{T&&O(L.current.group,!0)}),[T,L.current.group]),(0,a.useEffect)((()=>{if(e.subscriptionId&&p.current!==e.subscriptionId&&!E&&!F&&!V){if(z)return void O(L.current.group,!0);if(k){const e=A.find((e=>e.data.group.id===k));if(e)return void O(e.data.group,e.data.new)}if(L.current.group&&L.current.isDefaultNewGroup)return void O(L.current.group,!0);if(!e.disableDefaultSelection&&D.length){const t=I?.subscriptionIds?.[0],o=t===e.subscriptionId?I.resourceGroupNames?.[0]:void 0,r=o&&D.find((e=>e.name.toLowerCase()===o.toLowerCase()))||D[0];O(r,!1)}else R.group&&O(void 0,!1)}}),[e.subscriptionId,p.current,E,F,V,z,L.current.group,k,A,e.disableDefaultSelection,D,I]),o.createElement("div",{className:e.className,"aria-label":e.ariaLabel},e.label&&o.createElement(b.Label,null,e.label),o.createElement(f.Shimmer,{stretch:!0,isDataLoaded:!E&&!F},o.createElement(v.FilterableDropdown,{...e,label:void 0,"aria-labelledby":e.ariaLabelledBy,"aria-required":e.ariaRequired,onChange:(e,t)=>{t.data&&O(t.data.group,t.data.new)},options:A,selectedKey:k,ariaLabel:e.ariaLabel||i.ResourceGroupDropdown.title})),e.createNew&&e.subscriptionId&&o.createElement(l.Link,{onClick:()=>u(!0)},o.createElement("span",{ref:s},i.ResourceGroupDropdown.createNew)),c&&e.subscriptionId&&o.createElement(w,{dismiss:t=>{if(t){const o=`/subscriptions/${e.subscriptionId}/resourceGroups/${t}`;L.current={group:{id:o,location:"",name:t,resourceId:o},subscriptionId:e.subscriptionId,validated:!0,isDefaultNewGroup:!1},O(L.current.group,!0)}u(!1)},linkRef:t,subscriptionId:e.subscriptionId,existingResourceGroupNames:D.map((e=>e.name))}))}));t.ResourceGroupDropdown=(0,n.withErrorBoundary)(h,"ResourceGroupDropdown")})),
define("@microsoft/azureportal-reactview/SubscriptionDropdown",["require","exports","react","@microsoft/azureportal-reactview/Az","react","FxInternal/Resources/ReactComponents","@microsoft/azureportal-reactview/internal/ErrorBoundary","@microsoft/azureportal-reactview/Subscriptions","@microsoft/azureportal-reactview/Shimmer","@microsoft/azureportal-reactview/FormLabel","@fluentui/react/lib/Label","@microsoft/azureportal-reactview/Provisioning","@microsoft/azureportal-reactview/internal/DefaultResourceValidation","@microsoft/azureportal-reactview/FilterableDropdown","@microsoft/azureportal-reactview/DataManagement"],(function(e,t,o,r,a,n,i,s,l,c,u,d,p,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionDropdown=void 0;const f=__InternalAzurePortal.AzInternalApi.internalApi,v=["enabled","active","pastdue"],b=o.memo((function(e){const{customizeOptions:t,disableDefaultSelection:b,onChange:y,onSubscriptionDropdownChange:S,...x}=e,[w,h]=(0,a.useState)(""),C=e.selectedSubscriptionId??w,E=(0,i.useTriggerErrorBoundary)(),[,D]=(0,a.useContext)(p.DefaultResourceValidationContext),I=o.useRef(!1),F=(0,g.useAsync)(d.getInitialDropdownValues,[]),R=(0,g.useAsync)(s.getGlobalSubscriptions,[],{onError:e=>{r.log([{level:2,message:"Unable to retrieve subscriptions",area:"SubscriptionDropdown.tsx-getGlobalSubscriptions",timestamp:Date.now(),args:[e]}]),E(e)}}),N=(0,a.useMemo)((()=>R.result?.map((e=>{const o=t&&t(e,{text:e.uniqueDisplayName});return{key:e.subscriptionId,text:e.uniqueDisplayName,data:e,disabled:!v.includes(e.state.toLowerCase()),...o}}))||[]),[R.result]),L=(t,o)=>{D({subscription:t}),h(t);try{e.onSubscriptionDropdownChange?.(t,o),e.onChange?.(void 0,o)}catch(e){r.log([{level:2,message:e,area:"SubscriptionDropdown.tsx-onLocationChange",timestamp:Date.now(),args:[e]}])}};return(0,c.useValidationEffect)((()=>{const t=R.result?.find((e=>e.subscriptionId===C));return t?f.validateResourceProviderRegistration({subscription:t,resourceProviders:e.resourceProviders,requiredPermissions:e.requiredPermissions}).then((e=>e.valid?{state:2}:{state:3,message:e.message})):{state:2}}),[e.resourceProviders,C,R.result,e.requiredPermissions]),(0,a.useEffect)((()=>{if(!I.current&&R.result?.length&&!F.loading){I.current=!0;const e=C&&R.result.find((e=>e.subscriptionId===C));if(e)L(C,e);else if(!b){const e=F.result?.subscriptionIds?.length>0&&F.result.subscriptionIds[0],t=e&&R.result.find((t=>t.subscriptionId===e))||R.result[0];t&&L(t.subscriptionId,t)}}}),[R.result,F.loading,C]),o.createElement("div",null,e.label&&o.createElement(u.Label,null,e.label),o.createElement(l.Shimmer,{stretch:!0,isDataLoaded:!R.loading&&!F.loading},o.createElement(m.FilterableDropdown,{...x,label:void 0,"aria-labelledby":e.ariaLabelledBy,"aria-required":e.ariaRequired,onChange:(e,t)=>{const o=t.data;o&&L(o.subscriptionId,o)},options:N,selectedKey:C,ariaLabel:e.ariaLabel||n.SubscriptionsDropdown.label,optionFilter:(e,t)=>{const o=e.data;return!!o&&[o?.uniqueDisplayName,o?.subscriptionId].some((e=>e.toLocaleLowerCase().includes(t)))}})))}));t.SubscriptionDropdown=(0,i.withErrorBoundary)(b,"SubscriptionDropdown")})),
define("@microsoft/azureportal-reactview/FormBuilder",["require","exports","react","@microsoft/azureportal-reactview/Az","FxInternal/Resources/ReactComponents","FxInternal/Resources/FormBuilderResources","@fluentui/react/lib/Button","@fluentui/react/lib/Icon","@fluentui/react/lib/Link","@fluentui/react/lib/Pivot","@fluentui/react/lib/Spinner","@fluentui/react/lib/Styling","@fluentui/react/lib/utilities/ThemeProvider/makeStyles","@microsoft/azureportal-reactview/internal/Creapi","@microsoft/azureportal-reactview/Footer","@microsoft/azureportal-reactview/FormLabel","@microsoft/azureportal-reactview/LocationDropdown","@microsoft/azureportal-reactview/Provisioning","@microsoft/azureportal-reactview/ResourceGroupDropdown","@microsoft/azureportal-reactview/StatusBar","@microsoft/azureportal-reactview/SubscriptionDropdown","@microsoft/azureportal-reactview/ControlPlaneValidators","@microsoft/azureportal-reactview/Navigation","@microsoft/azureportal-reactview/Environment","@microsoft/azureportal-reactview/internal/ReactView","@microsoft/azureportal-reactview/BladeLink","@microsoft/azureportal-reactview/internal/ContextUtilities","@microsoft/azureportal-reactview/internal/FormTelemetry","@microsoft/azureportal-reactview/internal/SharedFormContext","@microsoft/azureportal-reactview/Experimentation","@microsoft/azureportal-reactview/Environment"],(function(e,t,o,r,a,n,i,s,l,c,u,d,p,m,g,f,v,b,y,S,x,w,h,C,E,D,I,F,R,N,L){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formBuilder=t.CreateFooter=t.SingleStepFooter=t.FormNavigationFooter=t.lazyStepContent=t.FormWizardNavigation=t.FormAsyncNavigation=t.FormSingleStepNavigation=t.ResourceScopeSection=t.ReviewStep=t.useFormTelemetry=t.useDeploymentOptions=t.useFormValidation=t.useFormNavigation=t.TemplateDeploymentScope=void 0;const k=(0,f.withFormLabelAndValidation)(x.SubscriptionDropdown),z=(0,f.withFormLabelAndValidation)(y.ResourceGroupDropdown),T=(0,f.withFormLabelAndValidation)(v.LocationDropdown),P=()=>{},V="stepSection",B="sectionLabel",A=(0,d.mergeStyleSets)({navigationStep:{maxWidth:"700px",paddingLeft:8,[`& .${V}:first-child .${B}`]:{marginTop:"0"}},footerButton:{marginRight:"5px",marginBottom:"5px"},steppedWizardHeaderIcon:{height:20,width:20,marginRight:8,marginTop:2,display:"inline-flex",lineHeight:20,verticalAlign:-3},stepValidationIconTabs:{width:17,height:17,maxWidth:17,maxHeight:17,float:"left",marginLeft:-2,marginRight:8},footer:{height:16},sectionLabel:[B,{margin:"10px 0px",fontSize:"14px",fontWeight:"600"}],sectionDescription:{marginBottom:"20px"},statusBarForwardIcon:{verticalAlign:"middle",marginLeft:"6px",fontSize:"10px"},pivotToolbar:{display:"flex",flexFlow:"column nowrap",height:"100%"},pivotItemContainer:{overflow:"auto",height:"100%",marginTop:"20px"},reviewSummary:{[`& .${V} .ms-Fabric div:first-child h3`]:{marginTop:"0"}},automationLink:{marginBottom:"16px",display:"flex",justifyContent:"center",alignItems:"center"},instanceDetails:{marginTop:"10px"},feedbackLink:{float:"right"},feedbackIcon:{marginRight:"5px"}}),O=(0,p.makeStyles)((({semanticColors:e})=>({hoverStyle:{paddingLeft:8,paddingRight:8,selectors:{"&:hover":{backgroundColor:e.buttonBackgroundHovered}}},stepValidationIconSuccess:{fontSize:"17px",marginRight:8,lineHeight:20,verticalAlign:"-2px",color:e.successIcon},stepValidationIconError:{fontSize:"17px",marginRight:8,lineHeight:20,verticalAlign:"-2px",color:e.errorIcon},iconStyles:{root:{color:e.link},marginRight:2}}))),G={selectors:{"&::before":{backgroundColor:"#0078d4",bottom:0,content:"",left:8,right:8,height:2,position:"absolute",transition:"left 0.267s cubic-bezier(0.1, 0.25, 0.75, 0.9) 0s  right 0.267s cubic-bezier(0.1, 0.25, 0.75, 0.9) 0s"},"&:hover::before":{left:0,right:0}}},M=e=>o.createElement("span",{className:A.steppedWizardHeaderIcon},o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},o.createElement("g",null,o.createElement("circle",{cx:"10",cy:"10",r:"8.5",fill:"none",stroke:"#949494",strokeWidth:"1"}),o.createElement("text",{textAnchor:"middle",x:"10",y:"14",fill:"#949494",fontWeight:"700",fontSize:"10"},e.index+1)))),H=e=>o.createElement("span",{className:A.steppedWizardHeaderIcon},o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},o.createElement("g",null,o.createElement("circle",{cx:"10",cy:"10",r:"8.5",fill:"#0078d4"}),o.createElement("text",{textAnchor:"middle",x:"10",y:"14",fill:"white",fontWeight:"bold",fontSize:"10"},e.index+1)))),q=e=>!1!==e.visible&&o.createElement("div",{className:e.className??""},e.label?o.createElement("h3",{className:A.sectionLabel},e.label):null,e.description?o.createElement("div",{className:A.sectionDescription},e.description):null,e.children),_=e=>{const t=o.useCallback((()=>{r.openContextPane((0,h.getArmErrorsBladeReference)({errors:e.error}))}),[e.error]);return o.createElement(l.Link,{onClick:t,underline:!1},n.FormBuilder.Preflight.validationFailure,o.createElement(s.FontIcon,{className:A.statusBarForwardIcon,iconName:"Forward"}))},j=e=>{let t=n.FormBuilder.Footer.Feedback.Create.cesQuestion,r=n.FormBuilder.Footer.Feedback.Create.cvaQuestion;return o.useContext(X)||(t=n.FormBuilder.Footer.Feedback.NonCreate.cesQuestion,r=n.FormBuilder.Footer.Feedback.NonCreate.cvaQuestion),o.createElement("div",{className:A.feedbackLink},o.createElement(D.BladeLink,{openAsContextPane:!0,bladeReference:{bladeName:"InProductFeedbackBlade",extensionName:"HubsExtension",parameters:{bladeName:E.ReactView.getInstance().getViewName(),cesQuestion:e.cesQuestion??t,cvaQuestion:e.cvaQuestion??r,extensionName:(0,C.getEnvironmentValue)("extensionName"),featureName:e.featureName??"FormBuilder",surveyId:e.surveyId??"FormBuilder08052023"}}},o.createElement(s.Icon,{iconName:"Feedback",className:A.feedbackIcon}),n.FormBuilder.Footer.Feedback.linkName))},$=({deploymentOptions:e})=>{const t=O();return o.createElement(o.Fragment,null,o.createElement(l.Link,{onClick:t=>{r.openBlade({extensionName:"HubsExtension",bladeName:"TemplateViewerBlade",parameters:{options:{templateJson:e.templateJson,parameters:e.parameters}}})},className:A.automationLink,underline:!0},o.createElement(s.Icon,{className:t.iconStyles,iconName:"View"}),n.FormBuilder.Step.ReviewCreate.automationLink))},U=e=>{const{children:t,consolidatedValidation:r,forceTriggerOnAllSteps:a}=e,[n,i]=o.useState(!1),s=o.useMemo((()=>({consolidatedValidation:r,disablePrimaryAction:n,forceTriggerOnAllSteps:a,setDisablePrimaryAction:i})),[r,n,a]);return o.createElement(Z.Provider,{value:s},t)},W=e=>{const{children:t,forceTriggerValidation:r}=e,a=o.useCallback((()=>!0),[]),n=o.useMemo((()=>({isActive:a,registerStep:P,validationTriggerState:r})),[r,a]);return o.createElement(R.FormStepContext.Provider,{value:n},t)},K=e=>{const{children:t,forceTriggerValidation:r,selectedStepIndex:a,setStepContext:n,stepIndex:i}=e,s=o.useCallback((()=>a===i),[a,i]),l=o.useCallback((e=>{n((t=>Q(t,i,e)))}),[n,i]),c=o.useMemo((()=>({isActive:s,registerStep:l,validationTriggerState:r})),[r,s,l]);return o.createElement(R.FormStepContext.Provider,{value:c},t)},Q=(e,t,o)=>{const r=[...e];return r[t]=o,r},J=(0,I.createContext)(null,"PivotCreateContext"),X=(0,I.createContext)(null,"FormNavigationContext"),Z=(0,I.createContext)(null,"FormValidationContext"),Y=(0,I.createContext)({setStepsRenderState:P,setStepsHydrateState:P,setLazyStepsLoadState:P,registerStepDependencies:P,forceHydrate:P},"LazyStepSettersContext"),ee=(0,I.createContext)({stepsRenderState:{},lazyStepsLoadState:{},stepsHydrateState:{}},"LazyStepStateContext"),te=(0,m.createNode)("input").register.wrapper((e=>{const t=(0,f.withFormLabelAndValidation)(e);return({formLabelProps:e,validator:r,visible:a,props:n})=>{const i=o.useContext(R.FormStepContext),s=i?.validationTriggerState,l=(0,m.useCustomizationState)("validator"),c=(0,m.useTriggerCustomizer)("validator");o.useEffect((()=>{s&&c()}),[s]);const u=o.useCallback(((e,t)=>{n.onChange&&n.onChange(e,t)}),[n.onChange]);return(e=>{const[t,r]=o.useState(!1);o.useEffect((()=>{if(!t){const t=e.defaultValue??e.defaultChecked??e.defaultRating??void 0;if(void 0!==t)e.onChange(void 0,t),r(!0);else if(e.defaultSelectedKey&&e.options){const t=e.options.find((t=>t.key===e.defaultSelectedKey));e.onChange(void 0,t),r(!0)}}}),[e.defaultValue,e.defaultChecked,e.defaultRating,e.defaultSelectedKey,e.options?.length])})(n),!1!==a&&o.createElement(t,{...n,onChange:u,formLabelProps:{...e,forceTriggerValidation:s,validations:r,runningValidation:1===l}})}}),["validator"],{validator:{deferredTime:500}}).seal(),oe=(0,m.createNode)("customInput").register.wrapper((e=>({visible:t=!0,props:r})=>t&&o.createElement(o.Fragment,null,o.createElement(e,{...r,onChange:(e,t)=>{r.onChange&&r.onChange(e,t)}})))).seal(),re=(0,m.createNode)("section").add.child(te).add.child(oe).register.wrapper((e=>({children:t,props:r,...a})=>o.createElement(q,{...a,className:`${a.className??""} ${V}`},o.createElement(e,{...r},t)))).register.defaultComponent((e=>o.createElement(o.Fragment,null,e.children))).seal(),ae=(0,m.createNode)("step").add.child(re).add.child(te).add.child(oe).register.wrapper((e=>({props:t,...r})=>{const a=(0,m.useId)().split(".")[1],n=o.useContext(R.FormStepContext),i=o.useContext(X),s=n?.isActive?.(),{setStepsRenderState:l,registerStepDependencies:c,forceHydrate:u}=o.useContext(Y),{stepsHydrateState:d}=o.useContext(ee),p=N.shellAssignments.getBooleanValue("tabLazyLoadingEnabled"),g=(0,L.isFeatureEnabled)("enableAKSLazyRendering"),f=(p||g)&&!i?.lazyRenderingDisabled,v=s||d[a],b=!f||v,y=!1!==r.visible;return o.useEffect((()=>{l((e=>({...e,[a]:"Awaiting"}))),c(a,r.stepDependencies)}),[]),o.useEffect((()=>{b&&l((e=>({...e,[a]:"Loaded"})))}),[b]),o.useEffect((()=>{n?.registerStep?.({label:r.label,visible:y})}),[y,r.label]),o.useEffect((()=>{s&&(r.onSelected?.(),u(a))}),[r.onSelected,s]),b?o.createElement("div",{className:`${i?A.navigationStep:""} ${r.className??""}`},r.description?o.createElement("div",{className:A.sectionDescription},r.description):null,o.createElement(e,{...t},r.children)):o.createElement(o.Fragment,null)})).register.defaultComponent((e=>o.createElement(o.Fragment,null,e.children))).seal(),ne=(0,m.createNode)("footer").register.wrapper((e=>({props:t})=>o.createElement(g.Footer,null,o.createElement(e,{...t})))).seal(),ie=(0,m.createNode)("navigation").add.child(ae).add.child(ne,!0).register.wrapper((e=>({props:t,children:r})=>o.createElement(e,{...t},r))).register.defaultComponent((e=>o.createElement(o.Fragment,null,e.children))).seal();var se;!function(e){e[e.Subscription=0]="Subscription",e[e.ResourceGroup=1]="ResourceGroup"}(se||(t.TemplateDeploymentScope=se={}));t.useFormNavigation=()=>{const e=o.useContext(X);return null===e&&console.error("useFormNavigation called incorrectly. No context was provided."),{canMoveNext:e&&e.canMoveNext,navigationDisabled:e&&e.disableNavigation,moveLast:e&&e.pivotMode===pe.Async?e.moveLast:P}};t.useFormValidation=()=>{const e=o.useContext(Z);return null===e&&console.error("useFormValidation called incorrectly. No context was provided."),{validationState:e&&e.consolidatedValidation,primaryActionDisabled:e&&e.disablePrimaryAction,validateAllSteps:e&&e.forceTriggerOnAllSteps}};t.useDeploymentOptions=()=>{const e=o.useContext(J);null===e&&console.error("useDeploymentOptions called incorrectly. No context was provided.");return{setDeploymentOptions:e&&e.setDeploymentOptions,setGetDeploymentOptionsAsync:e&&(t=>(e.setUsingGetDeploymentOptions(!0),e.setGetDeploymentOptions(t)))}};t.useFormTelemetry=()=>{const e=o.useContext(F.FormTelemetryContext);return null===e&&console.error("useFormTelemetry called incorrectly. No context was provided."),{logFormComplete:e&&e.logFormComplete}};const le=e=>{const t=o.useContext(F.FormTelemetryContext);t.initializeStepInfo(e);const[r,a]=o.useState({index:0,mapIndex:0}),[n,i]=o.useState([]),[s,l]=o.useState({}),[c,u]=o.useState({}),[d,p]=o.useState({}),m=o.useRef({totalStepCount:e.length,journey:[]}),g=o.useMemo((()=>e.reduce(((t,o,r)=>{const a=o.props.metadata.id,n=new Set(e.slice(0,r).map((e=>e.props.metadata.id)));return t[a]=n,t}),{})),[e]),f=(e,t)=>{t?.forEach((t=>{g[e].add(t)}))},v=e=>{u((t=>{const o={...t};return o[e]=!0,g[e].forEach((e=>{o[e]=!0})),o}))},b=o.useMemo((()=>({setLazyStepsLoadState:l,registerStepDependencies:f,forceHydrate:v,setStepsHydrateState:u,setStepsRenderState:p})),[]),y=o.useMemo((()=>({lazyStepsLoadState:s,stepsHydrateState:c,stepsRenderState:d})),[s,c,d]);return o.useEffect((()=>{if(n[r.index]?.label&&-1!==r.mapIndex){const e=new Date,o=m.current.journey[m.current.journey.length-1],a=t.steps[r.index].props.metadata.id;m.current={...m.current,currentStep:a,journey:o?[...m.current.journey.slice(0,-1),{...o,timeOnStep:e.getTime()-o.stepOpenedTime.getTime()},{stepIndex:r.index,visitOrder:m.current.journey.length,name:a,stepOpenedTime:e}]:[...m.current.journey,{stepIndex:r.index,visitOrder:m.current.journey.length,name:a,stepOpenedTime:e}]},t.logTabOpen(m.current);const i=t.stepVisits.get(a),s=void 0===i?1:i+1;t.stepVisits.set(a,s),t.logStepTelemetry(),t.setCurrentStep(r),R.FormStateExtractor.getInstance().registerStepState(n.map(((e,t)=>({tabName:e.label,isSelected:r.index===t}))))}}),[r,n[r.index]?.label]),{selectedStep:r,setSelectedStep:a,stepContext:n,setStepContext:i,lazyStepSettersContext:b,lazyStateValuesContext:y}},ce=(e,t)=>{const r=o.useMemo((()=>e.reduce(((e,t,o)=>(t.visible&&e.push(o),e)),[])),[e]),a=o.useCallback((e=>({index:r[e],mapIndex:e})),[r]);return o.useEffect((()=>{t((e=>{const t=r.indexOf(e.index);return e.mapIndex!==t?{index:e.index,mapIndex:t}:e}))}),[r,t]),{indexMap:r,stepMetadataFromMapIndex:a}},ue=(e,t,o)=>{Object.keys(e).forEach((r=>{let a=o[r];a||(((e,t)=>{const o={};e.forEach((e=>{const[t]=e.split("-");o[t]?o[t]++:o[t]=1})),e.forEach((e=>{const[r]=e.split("-");o[r]>1?t[e]=e:t[e]=r}))})(t,o),a=o[r]),a!==r&&(e[a]=e[r],delete e[r])}))},de=e=>{const t=o.useRef(null),{trace:r}=(0,m.useDiagnostics)();return t.current||(t.current={aggregatedStepValidationData:{},compositeIds:new Set,compositeIdMapping:{},deploymentPreflightSuccessRate:{success:0,failure:0},startTime:Date.now(),selectedStep:{index:0,mapIndex:0},steps:[],stepVisits:new Map,terminalValidationState:{},initializeStepInfo:e=>{t.current.steps.length||0===e.length||(t.current.steps=e,t.current.currentStepName=t.current.steps[t.current.selectedStep.index].props.metadata.id,t.current.steps.forEach((e=>{const o=e.props.metadata.id;t.current.aggregatedStepValidationData[o]=[]})))},logTabOpen:e=>{r([{action:"TabOpened",data:e}])},logFormComplete:()=>{r([{action:"FormCompleted",timestamp:Date.now()}])},logStepTelemetry:()=>{if(t.current.steps.length){const{currentStepName:e,compositeIds:o,compositeIdMapping:a}=t.current,n=t.current.stepVisits.get(e)-1,i=t.current.aggregatedStepValidationData[e][n];if(i){ue(i.validationData,o,a);const e={totalSuccesses:0,totalFailures:0};Object.keys(i.validationData).forEach((t=>{e.totalSuccesses+=i.validationData[t].successes,e.totalFailures+=i.validationData[t].failures})),r([{action:"StepValidationInfo",timestamp:Date.now(),data:{...i,aggregatedValidationData:e}}])}}},logTerminalState:e=>{const{terminalValidationState:o,compositeIds:a,compositeIdMapping:n}=t.current;ue(o,a,n),r([{action:"FormUnmounted",data:{timeSpentOnForm:e-t.current.startTime,stepIndexUnmounted:t.current.selectedStep.index,stepNameUnmounted:t.current.currentStepName,terminalValidationState:t.current.terminalValidationState,deploymentPreflightSuccessRate:t.current.deploymentPreflightSuccessRate}}])},registerCompositeIds:(e,o)=>{t.current.compositeIds.add(`${e}-${o}`)},setCurrentStep:e=>{t.current.selectedStep=e,t.current.currentStepName=t.current.steps[e.index].props.metadata.id},setStepValidationInfo:(e,o,r)=>{if(t.current.steps.length){const{currentStepName:a}=t.current,n=t.current.aggregatedStepValidationData[a],i=t.current.stepVisits.get(a),s=i-1;n[s]||(n[s]={stepName:a,visit:i,validationData:{}});const l=`${e}-${o}`;((e,t,o)=>{const r=e[t]||{successes:0,failures:0};2===o?r.successes++:3===o&&r.failures++,e[t]=r})(n[s].validationData,l,r)}},setTerminalValidationState:(e,o,r)=>{const a=`${e}-${o}`;t.current.terminalValidationState[a]=["Unset","Running","Success","Error"][r]}}),o.useEffect((()=>(r([{action:"FormOpened",timestamp:t.current.startTime}]),()=>{const e=Date.now();t.current.logStepTelemetry(),t.current.logTerminalState(e)})),[]),o.createElement(F.FormTelemetryContext.Provider,{value:t.current},e.children)};t.ReviewStep=e=>{const t=o.useContext(F.FormTelemetryContext),{isActive:r}=o.useContext(R.FormStepContext),{log:a,trace:i}=(0,m.useDiagnostics)(),s=r(),{setDisableNavigation:l}=o.useContext(X),{forceTriggerOnAllSteps:c,setDisablePrimaryAction:d,consolidatedValidation:p}=o.useContext(Z),{stepsRenderState:g,lazyStepsLoadState:f}=o.useContext(ee),{deploymentOptions:v,setDeploymentOptions:y,getDeploymentOptions:x,usingGetDeploymentOptions:w}=o.useContext(J),[h,C]=o.useState(!1),[E,D]=o.useState(null),[I,N]=o.useState(!0),L=o.useRef(!0),k=o.useMemo((()=>[...Object.values(g),...Object.values(f)].every((e=>"Awaiting"!==e))),[g,f]);o.useEffect((()=>{s?(C(!0),k&&c()):(h&&(0,S.dismissStatusBar)(),C(!1))}),[s,k]),o.useEffect((()=>{L.current=!1}),[v,x()]);const z=o.useCallback(((e,t)=>{e&&(d(!0),D(t),N(!1))}),[d,D,N]),T=o.useCallback((e=>{e&&(d(!1),D(null),N(!1))}),[d,D,N]),P=o.useCallback(((e,t)=>{e&&y(t)}),[y]);return o.useEffect((()=>{s&&(l(I),I||!E?(0,S.dismissStatusBar)():E&&(0,S.showStatusBar)(S.StatusBarType.Error,E))}),[l,s,E,I]),o.useEffect((()=>{let e=!0;if(s)if(N(!0),3===p)z(e,n.FormBuilder.Validations.failure);else if(2===p){const r=async()=>{try{let r;d(!0);try{r=w?await x()():v,P(e,r)}catch(t){return z(e,n.FormBuilder.Preflight.getDeploymentOptionsFailure),void a([{message:"useDeploymentOptionsFailed",args:[t],level:2}])}const s=await(0,b.doesProvisioning)();try{await s.validateTemplate(r),t.deploymentPreflightSuccessRate.success++,T(e)}catch(r){let a;t.deploymentPreflightSuccessRate.failure++;try{a=r&&(r.error??JSON.parse(r.message))}catch(e){a=r.message}z(e,a?o.createElement(_,{error:a}):n.FormBuilder.Preflight.failure),i([{action:"DeploymentValidation",data:{status:"Failed",errors:{error:r},telemetryId:s.telemetryId}}])}finally{e&&(L.current=!0)}}catch(t){z(e,n.FormBuilder.Preflight.failure),console.error("There was an issue with the configuration of this blade's provisioning. Please ensure your form is wrapped with `withProvisioning` when you export it and double check your deployment options. Error:",t),a([{message:"doesProvisioningFailed",args:[t],level:2}])}};v||w?L.current?E?z(e,E):T(e):r():T(e)}return()=>{e=!1}}),[p,s]),o.createElement(o.Fragment,null,I?o.createElement(u.Spinner,{label:n.FormBuilder.Validations.inProgress,labelPosition:"right",styles:{root:{justifyContent:"flex-start"}}}):o.createElement(o.Fragment,null,3!==p&&v?o.createElement($,{deploymentOptions:v}):null,o.createElement("div",{className:A.reviewSummary},e.children)))};t.ResourceScopeSection=e=>{const[t,r]=o.useState(),[i,s]=o.useState(),[l,c]=o.useState(),u=o.useCallback((t=>e.location?.allowedValues?t.filter((t=>e.location.allowedValues.includes(t.name))):t),[e.location?.allowedValues]),d=n.FormBuilder.ResourceScope.Subscription.label,p=a.ResourceGroupDropdown.title,g=e.location?.label??a.LocationsDropdown.label;if(o.useEffect((()=>{e.onChange?.(null,{resourceGroup:i,subscription:t,location:l});const o={[d]:"subscriptionId",[p]:"name",[g]:"name"};R.FormStateExtractor.getInstance().registerFormScopeState({deploymentScope:0===e.deploymentScope?"Subscription":"ResourceGroup",resourceTypes:e.resourceTypes,scopeId:i?.id?i.id:t?.subscriptionId,region:l?.name},o)}),[i,t,l]),o.useContext(R.FormStepContext)){const{validationTriggerState:a}=o.useContext(R.FormStepContext),i=(0,m.useCustomizationState)("subscriptionValidations"),l=(0,m.useTriggerCustomizer)("subscriptionValidations"),f=(0,m.useCustomizationState)("rgValidations"),v=(0,m.useTriggerCustomizer)("rgValidations"),b=(0,m.useCustomizationState)("locationValidations"),y=(0,m.useTriggerCustomizer)("locationValidations");return o.useEffect((()=>{a&&(l(),v(),y())}),[a]),o.createElement(o.Fragment,null,o.createElement(q,{label:n.FormBuilder.ResourceScope.Section.label,description:n.FormBuilder.ResourceScope.Section.description},o.createElement(k,{formLabelProps:{displayValue:d,tooltip:n.FormBuilder.ResourceScope.Subscription.tooltip,required:!0,forceTriggerValidation:a,validations:e.subscriptionValidations,runningValidation:1===i},onChange:(e,t)=>{r(t)}}),1!==e.deploymentScope?null:o.createElement(z,{formLabelProps:{displayValue:p,tooltip:n.FormBuilder.ResourceScope.ResourceGroup.tooltip,required:!0,nested:!0,forceTriggerValidation:a,validations:e.rgValidations,runningValidation:1===f},onChange:(e,t)=>{s(t)},subscriptionId:t?.subscriptionId,createNew:!0})),o.createElement(q,{label:n.FormBuilder.ResourceScope.Section.instanceLabel,className:A.instanceDetails},e.children,o.createElement(T,{formLabelProps:{displayValue:g,tooltip:e.location?.tooltip??n.FormBuilder.ResourceScope.Location.tooltip,required:!0,forceTriggerValidation:a,validations:e.locationValidations,runningValidation:1===b},onChange:(e,t)=>{c(t)},subscriptionId:t?.subscriptionId,resourceTypes:e.resourceTypes,customizeLocations:u,calloutProps:{directionalHintFixed:!0}})))}return o.createElement(o.Fragment,null,o.createElement(q,{label:n.FormBuilder.ResourceScope.Section.label,description:n.FormBuilder.ResourceScope.Section.description},o.createElement(k,{formLabelProps:{displayValue:d,tooltip:n.FormBuilder.ResourceScope.Subscription.tooltip,required:!0,validations:e.subscriptionValidations},onChange:(e,t)=>{r(t)}}),1!==e.deploymentScope?null:o.createElement(z,{formLabelProps:{displayValue:p,tooltip:n.FormBuilder.ResourceScope.ResourceGroup.tooltip,required:!0,nested:!0,validations:e.rgValidations},onChange:(e,t)=>{s(t)},subscriptionId:t?.subscriptionId,createNew:!0})),o.createElement(q,{label:n.FormBuilder.ResourceScope.Section.instanceLabel,className:A.instanceDetails},e.children,o.createElement(T,{formLabelProps:{displayValue:g,tooltip:e.location?.tooltip??n.FormBuilder.ResourceScope.Location.tooltip,required:!0,validations:e.locationValidations},onChange:(e,t)=>{c(t)},subscriptionId:t?.subscriptionId,resourceTypes:e.resourceTypes,customizeLocations:u,calloutProps:{directionalHintFixed:!0}})))},t.FormSingleStepNavigation=o.memo((e=>{const t=o.Children.toArray(e.children).filter((e=>"step"===(0,m.getNodeType)(e)));if(t.length>1)throw"Not more than 1 step allowed for SingleStepNav.";le(t);const[r,a]=o.useState(!1),[n,i]=o.useState(null),s=o.useCallback((e=>{i(e)}),[i]),l=o.useCallback((()=>{a(!0)}),[]);return o.createElement(o.Fragment,null,o.createElement(U,{consolidatedValidation:n,forceTriggerOnAllSteps:l},o.createElement(f.ValidationAggregator,{forceTriggerValidation:r,onChange:s},o.Children.map(e.children,(e=>o.createElement(W,{forceTriggerValidation:r},e))))))})),t.FormAsyncNavigation=o.memo((e=>{const t=O(),r=o.Children.toArray(e.children),a=r.filter((e=>"step"===(0,m.getNodeType)(e))),n=r.filter((e=>"footer"===(0,m.getNodeType)(e))),[i,l]=o.useState(!1),[u,d]=o.useState(!1),[p,g]=o.useState(null),v=o.useRef(null),b=o.useCallback((()=>v.current),[]),y=o.useCallback((e=>{v.current=e}),[v]),S=o.useRef(!1),x=o.useCallback((e=>{S.current=e}),[S]),w=o.useRef(e.disableLazyLoading??!1),h=le(a),{indexMap:C,stepMetadataFromMapIndex:E}=ce(h.stepContext,h.setSelectedStep),[D,I]=o.useState(null),F=o.useCallback((e=>{I(e)}),[I]),R=o.useCallback((()=>{l(!0)}),[]);return o.createElement(U,{consolidatedValidation:D,forceTriggerOnAllSteps:R},o.createElement(X.Provider,{value:{pivotMode:pe.Async,moveNext:()=>h.setSelectedStep((e=>E(e.mapIndex+1))),movePrevious:()=>h.setSelectedStep((e=>E(e.mapIndex-1))),moveLast:()=>h.setSelectedStep(E(C.length-1)),canMovePrevious:()=>h.selectedStep.mapIndex>0,canMoveNext:()=>h.selectedStep.mapIndex<C.length-1,disableNavigation:u,setDisableNavigation:d,lazyRenderingDisabled:w.current}},o.createElement(Y.Provider,{value:h.lazyStepSettersContext},o.createElement(ee.Provider,{value:h.lazyStateValuesContext},o.createElement(J.Provider,{value:{deploymentOptions:p,setDeploymentOptions:g,getDeploymentOptions:b,setGetDeploymentOptions:y,usingGetDeploymentOptions:S.current,setUsingGetDeploymentOptions:x}},o.createElement(f.ValidationAggregator,{onChange:F},o.createElement(c.Pivot,{onLinkClick:e=>{const t=parseInt(e.props.itemKey);h.setSelectedStep({index:t,mapIndex:C.indexOf(t)})},className:A.pivotToolbar,overflowBehavior:"menu",styles:{linkIsSelected:G,itemContainer:A.pivotItemContainer},selectedKey:h.selectedStep.index.toString()},o.Children.map(a,((e,r)=>{const[a,n]=o.useState(null),l=o.useCallback((e=>{n(3===e?o.createElement(s.FontIcon,{iconName:"StatusErrorFull",className:A.stepValidationIconTabs,style:{color:"#a4262c"}}):o.createElement(o.Fragment,null))}),[n]),d=h.stepContext[r]?.visible??!0,p={display:"none"};return o.createElement(c.PivotItem,{style:d?void 0:p,itemKey:r.toString(),alwaysRender:!0,headerButtonProps:{disabled:u,style:d?u?{color:"grey"}:void 0:p},headerText:h.stepContext[r]?.label??"",onRenderItemLink:(e,r)=>o.createElement("span",{className:t.hoverStyle},a,r(e))},o.createElement(K,{forceTriggerValidation:i,selectedStepIndex:h.selectedStep.index,setStepContext:h.setStepContext,stepIndex:r},o.createElement(f.ValidationAggregator,{forceTriggerValidation:i,onChange:l},e)))})))),n)))))})),t.FormWizardNavigation=o.memo((e=>{const t=O(),r=o.Children.toArray(e.children),a=r.filter((e=>"step"===(0,m.getNodeType)(e))),n=r.filter((e=>"footer"===(0,m.getNodeType)(e))),[i,l]=o.useState([]),[u,d]=o.useState([]),[p,g]=o.useState(!1),[v,b]=o.useState(null),[y,S]=o.useState(!1),x=o.useRef(),w=o.useCallback((()=>x.current),[]),h=o.useCallback((e=>{x.current=e}),[x]),C=o.useRef(!1),E=o.useCallback((e=>{C.current=e}),[C]),D=o.useRef(e.disableLazyLoading??!1),I=le(a),{indexMap:F,stepMetadataFromMapIndex:R}=ce(I.stepContext,I.setSelectedStep),{lazyStateValuesContext:N,lazyStepSettersContext:L}=I,k=a[I.selectedStep.index].props.metadata.id,z=!1===N.stepsHydrateState[k]||void 0!==N.lazyStepsLoadState[k]&&"Loaded"!==N.lazyStepsLoadState[k];return o.useEffect((()=>{y&&(I.selectedStep.mapIndex<F.length-1&&2===u[I.selectedStep.index]&&I.setSelectedStep((e=>R(e.mapIndex+1))),2!==u[I.selectedStep.index]&&3!==u[I.selectedStep.index]||S(!1))}),[u[I.selectedStep.index],y]),o.useEffect((()=>{g(z)}),[z]),o.createElement(U,{consolidatedValidation:u[I.selectedStep.index],forceTriggerOnAllSteps:P},o.createElement(X.Provider,{value:{pivotMode:pe.Wizard,moveNext:()=>{l((e=>Q(e,I.selectedStep.index,!0))),S(!0)},movePrevious:()=>I.setSelectedStep((e=>R(e.mapIndex-1))),canMovePrevious:()=>I.selectedStep.mapIndex>0,canMoveNext:()=>I.selectedStep.mapIndex<F.length-1,disableNavigation:p,setDisableNavigation:g,lazyRenderingDisabled:D.current}},o.createElement(Y.Provider,{value:L},o.createElement(ee.Provider,{value:N},o.createElement(J.Provider,{value:{deploymentOptions:v,setDeploymentOptions:b,getDeploymentOptions:w,setGetDeploymentOptions:h,usingGetDeploymentOptions:C.current,setUsingGetDeploymentOptions:E}},o.createElement(c.Pivot,{onLinkClick:e=>{const t=parseInt(e.props.itemKey);t<I.selectedStep.index&&I.setSelectedStep({index:t,mapIndex:F.indexOf(t)})},overflowBehavior:"menu",styles:{linkIsSelected:G,itemContainer:A.pivotItemContainer},selectedKey:I.selectedStep.index.toString()},o.Children.map(a,((e,r)=>{const a=I.stepContext[r]?.visible??!0,n={display:"none"},l=o.useCallback((e=>{d((t=>Q(t,r,e)))}),[d]);return o.createElement(c.PivotItem,{style:a?void 0:n,itemKey:r.toString(),alwaysRender:!0,headerText:I.stepContext[r]?.label??"",headerButtonProps:r<=I.selectedStep.index?{style:a?void 0:n}:{disabled:!0,style:a?{color:"grey"}:n},onRenderItemLink:(e,a)=>{const n=u[r],i=o.createElement(s.FontIcon,{iconName:"SkypeCircleCheck",className:t.stepValidationIconSuccess}),l=o.createElement(s.FontIcon,{iconName:"StatusErrorFull",className:t.stepValidationIconError}),c=o.createElement(H,{index:r});return o.createElement("span",{className:r===I.selectedStep.index?t.hoverStyle:void 0},r===I.selectedStep.index?z?c:3===n?l:2===n?i:c:r<I.selectedStep.index?i:o.createElement(M,{index:r}),a(e))}},o.createElement(K,{forceTriggerValidation:i[r]??!1,selectedStepIndex:I.selectedStep.index,setStepContext:I.setStepContext,stepIndex:r},o.createElement(f.ValidationAggregator,{forceTriggerValidation:i[r],onChange:l},e)))}))),n)))))})),t.lazyStepContent=function(e){let t;return r=>{const a=(0,m.useId)().split(".")[1],{setLazyStepsLoadState:n}=o.useContext(Y);o.useEffect((()=>{n((e=>e[a]?e:{...e,[a]:"Awaiting"}))}),[]),void 0===t&&(t=e());const i=o.useMemo((()=>o.lazy((async()=>{const e=await t;return n((e=>({...e,[a]:"Loaded"}))),e}))),[]);return o.createElement(o.Suspense,{fallback:o.createElement(o.Fragment,null)},o.createElement(i,{...r}))}};t.FormNavigationFooter=e=>{const t=o.useContext(X),r=t.disableNavigation||!t.canMoveNext();return o.createElement("div",{className:A.footer},o.createElement(i.DefaultButton,{className:A.footerButton,text:n.FormBuilder.Footer.Button.prev,disabled:t.disableNavigation||!t.canMovePrevious(),onClick:()=>t.movePrevious()}),t.pivotMode===pe.Async?o.createElement(i.DefaultButton,{className:A.footerButton,text:n.FormBuilder.Footer.Button.next,disabled:r,onClick:()=>t.moveNext()}):t.canMoveNext()?o.createElement(i.PrimaryButton,{className:A.footerButton,text:n.FormBuilder.Footer.Button.next,disabled:t.disableNavigation,onClick:()=>t.moveNext()}):null,e.postFixElements,e.feedbackProps?.show&&o.createElement(j,{...e.feedbackProps}))};t.SingleStepFooter=e=>{const{validationState:r,primaryActionDisabled:a,validateAllSteps:s}=(0,t.useFormValidation)(),{logFormComplete:l}=o.useContext(F.FormTelemetryContext),[c,u]=o.useState(!1);return o.useEffect((()=>{c&&2===r?(e.submitButtonProps.onClick(),u(!1)):3===r&&u(!1)}),[r,c]),o.createElement(o.Fragment,null,o.createElement(i.PrimaryButton,{className:A.footerButton,text:e.submitButtonProps.text??n.FormBuilder.Footer.Button.ok,disabled:0!==r&&2!==r||a||e.submitButtonProps.disabled,onClick:()=>{u(!0),l(),0===r&&s()}}),!0===e.cancelButtonProps.hide?o.createElement(o.Fragment,null):o.createElement(i.DefaultButton,{className:A.footerButton,text:e.cancelButtonProps.text??n.FormBuilder.Footer.Button.cancel,onClick:e.cancelButtonProps.onClick}),!e.feedbackProps?.hide&&o.createElement(j,{...e.feedbackProps}))};var pe;t.CreateFooter=e=>{const{logFormComplete:r}=o.useContext(F.FormTelemetryContext),a=o.useContext(J),s=o.useContext(X),l=o.useContext(Z);return o.useEffect((()=>{a.setDeploymentOptions(e.deploymentOptions)}),[e.deploymentOptions]),o.useEffect((()=>{e.getDeploymentOptions&&(a.setGetDeploymentOptions(e.getDeploymentOptions),a.setUsingGetDeploymentOptions(!0))}),[e.getDeploymentOptions]),o.createElement(t.FormNavigationFooter,{postFixElements:o.createElement(o.Fragment,null,s.canMoveNext()?s.pivotMode===pe.Async?o.createElement(i.PrimaryButton,{className:A.footerButton,text:n.FormBuilder.Footer.Button.reviewCreate,onClick:()=>{s.moveLast()}}):null:o.createElement(i.PrimaryButton,{className:A.footerButton,text:n.FormBuilder.Footer.Button.create,disabled:s.disableNavigation||2!==l.consolidatedValidation||l.disablePrimaryAction,onClick:()=>(r(),s.setDisableNavigation(!0),(0,b.doesProvisioning)().then((t=>(e.beforeProvision?.(),t.deployTemplate(a.deploymentOptions)))))}),!e.feedbackProps?.hide&&o.createElement(j,{...e.feedbackProps}))})},t.formBuilder=(0,m.createNode)("form").add.child(ie,!0).register.wrapper((()=>e=>o.createElement(o.Fragment,null,o.createElement(w.ControlPlanePolicyScopeContext.Provider,{value:e.controlPlanePolicyScope},o.createElement(de,null,e.children))))).toBuilder(),function(e){e[e.Wizard=0]="Wizard",e[e.Async=1]="Async"}(pe||(pe={}))}));