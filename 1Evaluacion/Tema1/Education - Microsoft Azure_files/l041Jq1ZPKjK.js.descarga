define("MsPortalImpl/Notifications/WhatsNewCheck",["require","exports","FxHubs/HubsSettingsSchema","MsPortalImpl/Notifications/NotificationsClientStrings","MsPortalImpl/Services/Services.BrowserSettings","MsPortalImpl/Services/Services.Settings","FxInternal/AsyncLoader","MsPortalImpl/UI/Compositions/UI.Composition.Services"],(function(t,e,i,n,o,s,a,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.checkForPortalUpdates=e.showWhatsNewNotification=void 0;var r=MsPortalFx.ViewModels,c=MsPortalFx.Hubs.Notifications,d=c.NotificationStatus;let u=!1;function h(t,e){const i=1===e.length?n.WhatsNewNotification.oneTitle:n.WhatsNewNotification.twoOrMoreTitle.format(e.length);return t.getAsync(a.get("MsPortalImpl/UI/Hubs/UI.NotificationManager","NotificationHandler")).then((o=>o.notificationCallback({diContainer:t,messageContext:{callStack:null,destWindowId:null,srcWindowId:null},messageArg:new c.ClientNotification({status:d.Information,title:i,description:n.WhatsNewNotification.description.format(`<ul>${e.map((t=>"<li>"+MsPortalFx.encodeHtml(t.title)+"</li>")).join("")}</ul>`),descriptionAsHtml:!0,linkedBlade:r.getBladeSelection("HubsExtension","WhatsNewBlade",{})}).package()})))}e.showWhatsNewNotification=h,e.checkForPortalUpdates=function(t){const e=i.Keys.whatsNewLastNotificationTime,n=t.get(s.SettingsManager);return(0,s.readUserSettings)(n,[e]).then((i=>{const a=i[e];if(a)MsPortalEarly.preload.then((t=>t&&t.whatsNew)).then((i=>{if(i&&i.length){const r=i.filter((t=>t.published&&new Date(t.published)>new Date(a)));if(r&&r.length){const a={};if(a[e]=(new Date).toISOString(),(0,s.writeUserSettings)(n,a,null),!MsPortalFx.isFeatureEnabled("whatsnew")||(0,o.hideSmallModals)()||u)return h(t,r);u=!0,t.get(l.WhatsNewModal).callBack({items:i.map((t=>({title:t.title,description:t.content,published:t.published,uri:t.uri})))})}}}));else{({})[e]=(new Date).toISOString(),(0,s.writeUserSettings)(n,i,null)}}))}}));