define("MsPortalImpl.Controls/Controls/SearchBox.Component",["require","exports","Weave/DirectMode","Weave","_generated/MsPortalImpl/Svg/Startup/Search.svg","_generated/MsPortalImpl/Svg/Startup/Close.svg","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl.Controls/Fields/TextField.Component","FxInternal/Weave/Util","MsPortalImpl/Weave/Util","FxInternal/Weave"],(function(t,e,s,i,o,a,r,n,l,c,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SearchBoxInner=e.listClass=e.iconDiscardClass=e.comboBoxClass=void 0,e.comboBoxClass="fxc-searchbox-container",e.iconDiscardClass="fxc-search-discard-icon",e.listClass="fxc-search-list",e.SearchBoxInner=function(t){const{vm:h,state:p}=t,u=(0,n.TextFieldInner)({vm:p.textFieldViewModel,state:p.textFieldState});return s(i.GetContext,{fn:t=>{const{disabled:n,tabIndex:x}=(0,c.aggregateContext)(t,h,p);return s(i.SetContext,{disabled:n,tabIndex:x},s("div",{className:"fxc-search-icon fxs-portal-svg-secondary",image:o}),s("div",{className:[e.comboBoxClass,u.parentClassName],"aria-disabled":n},u.weaveNode),s("div",{className:[e.iconDiscardClass,"fxs-portal-svg-secondary"],role:"button","aria-hidden":"true",title:r.Controls.SearchBox.deleteButtonLabel,tabindex:-1,image:MsPortalFx.Base.Images.CustomImageWithOptions(a,{customClass:"msportalfx-search-discard-icon"})}),s("ul",{role:"listbox",className:["azc-bg-default","fxs-portal-border",e.listClass,{"fxs-display-none":(0,i.composeComputation)([p.popupOpen,(0,d.toComputation)(h.hideSuggestions)],((t,e)=>!t||e))}],tabindex:"-1","aria-label":MsPortalFx.encodeAttribute(r.DropDown.optionContainer),"aria-disabled":n},s(i.ForEach,{collection:(0,d.toComputation)(p.currentItems),fn:({item:t})=>s("li",{role:"option",className:"fxs-portal-hover",title:t},t)}),s(i.If,{condition:(0,d.toComputation)(p.currentItems).compose(l.isEmptyArray),concealmentBehavior:"remove",trueFn:()=>s("li",{role:"option",className:"fxc-search-no-result","aria-disabled":"true",title:r.Search.noResults},r.Search.noResults)})))}})}})),
define("_generated/Less/MsPortalImpl.Controls/Controls/SearchBox.css",["module"],(function(t){"use strict";return{css:'.fxc-search{display:block;position:relative}.fxc-search .azc-form-labelcontainer{display:none!important}.fxc-search-icon{top:4px;left:6px}.fxc-search-discard-icon{height:8px;width:8px;position:absolute;top:2px;right:7px;cursor:pointer;display:none}.fxc-search-populated .fxc-search-discard-icon{display:block}.fxc-search .azc-textBox{display:block}.fxc-search .azc-textBox .azc-textBox-wrapper input{padding-left:29px;padding-right:24px}.fxc-search ul{padding:0;margin:0;position:absolute;width:100%;z-index:150}.fxc-search li{border-left:1px solid;border-left-color:inherit;border-right:1px solid;border-right-color:inherit;list-style-type:none;border-top-width:0;border-bottom-width:0;padding:9px 32px;cursor:pointer;overflow-x:hidden;white-space:nowrap;text-overflow:ellipsis}.fxc-search li:last-child{border-bottom:1px solid;border-bottom-color:inherit}.fxc-search.azc-fabric .fxc-search-discard-icon{top:2px;right:2px;padding:6px}.fxc-search.azc-fabric .msportalfx-search-discard-icon{padding-bottom:6px}.fxc-search.azc-fabric .azc-textBox .azc-textBox-wrapper .azc-input{padding-left:24px}.fxc-searchbox-container[aria-disabled="true"]+.fxc-search-discard-icon{display:none}.fxc-search-no-result{pointer-events:none}',moduleId:t.id}})),
define("MsPortalImpl.Controls/Controls/SearchBox",["require","exports","MsPortalImpl.Controls/Controls/Base/OptionsBase","MsPortalImpl.Controls/Controls/Base/Base","MsPortalImpl/Base/Base.KeyboardHelper","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl.Controls/Controls/SearchBox.Component","MsPortalImpl.Controls/Fields/TextField","MsPortalImpl/Weave/Util","MsPortalImpl/Interactions/Interactions.PortalReader","FxInternal/Css","_generated/Less/MsPortalImpl.Controls/Controls/SearchBox.css","Weave","FxInternal/Controls/TextBox"],(function(t,e,s,i,o,a,r,n,l,c,d,h,p,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SearchBox=e.Widget=e.WidgetUIState=e.InnerTsxComponent=void 0,(0,d.injectCss)(h);const x=MsPortalFx.isNullOrUndefined,m="fxs-portal-selected",b="fxc-search-populated",f="fxc-search",_=a.Controls.searchBox,g=MsPortalFx.encodeAttribute(_);function v(t,e){return t.update?t.update(e||""):Promise.resolve([])}e.InnerTsxComponent=r.SearchBoxInner;class C extends i.WidgetUIState{constructor(t){super(),this.popupOpen=(0,p.makeWritableComputation)(!1),this.currentItems=ko.observableArray();const e=t.vm;this.textFieldViewModel=new u.ViewModel(this._ltm,{disabled:e.disabled,label:_,placeHolderText:e.placeholder,valueUpdateTrigger:4,suppressDirtyBehavior:!0}),this.textFieldState=new n.WidgetUIState({diContainer:t.diContainer,vm:this.textFieldViewModel})}}e.WidgetUIState=C;class I extends s.Widget{constructor(t,e,s,i){super(t,e,s,i),this._clickedInsideWidget=!1,this._events=[],this._ignoreTextBoxValueUpdate=!1,this._busy=ko.observable(!1),this._dirty=!1,this._forceDismiss=!1,this._announce=new c.PortalReader(this.ltm,{idPrefix:"searchbox"});const o=this.ltm,a=this.state.textFieldViewModel.value;t.addClass(f),t.toggleClass("azc-fabric",function(t){return t.hasOwnProperty("valueUpdateTimeout")}(this.options)),this._attachEventHandlers();const l=this.options.defaultText;x(l)||(a(l),this._originalText=l,l&&this.element.addClass(b));const d=this.options._msPortalFxValue;let h=!1;d&&(d.subscribeAndRun(o,a),h=!!d());const p=t=>{this._ignoreTextBoxValueUpdate||(this._originalText=t,clearTimeout(this._typingTimer),t?this._typingTimer=setTimeout((()=>{this.isDisposed()||this._updateDropdown(t)}),this.options.updateFrequency):(this.element.removeClass(b),this.state.currentItems([]),v(this.options)))};h?a.subscribeAndRun(o,p):a.subscribe(o,p),this.options._msPortalFxresetTrigger((()=>this._reset()));const u=this.options.resultLimit;x(u)?this._unchangingResultLimit=5:ko.isObservable(u)?u.subscribe(o,(t=>{const e=this.state.currentItems();t<e.length&&this.state.currentItems(e.slice(0,t))})):this._unchangingResultLimit=u,this.ltm.registerForDispose(new n.Widget(t.find(`.${r.comboBoxClass}`),this.state.textFieldViewModel,{weaveContext:this.weaveContext},this.state.textFieldState)),this._accessibility(),this.state.currentItems.subscribeAndRun(o,(t=>{this._forceDismiss?(this._dirty=!1,this._forceDismiss=!1):!this._dirty&&a()&&this.element.find(".azc-input")[0]===document.activeElement?this._dirty=!0:a()||(this._dirty=!1);const e=!(!t.length&&!this._dirty);this.state.popupOpen(e),this._searchBoxElement.removeAttr("aria-activedescendant")}))}dispose(){this.element.removeClass(f),MsPortalFx.disposeDisposable(this._events),this._events=[],super.dispose()}_accessibility(){const t=this.element.find("label").attr("id"),e=`${t}-for`,s=`${t}-listbox`;this._activeItemId=`${t}-active`,this._comboBoxElement=this.element.find(`.${r.comboBoxClass}`),this._searchBoxElement=this._comboBoxElement.find(`#${e}`),this._listBoxElement=this.element.find("> ul"),this._listBoxElement.attr("id",s),this._searchBoxElement.attr({role:"searchbox","aria-haspopup":"listbox","aria-controls":s,"aria-autocomplete":"list",placeholder:this.options.placeholder(),"aria-multiline":null,"aria-readonly":null}),this._busy.subscribeAndRun(this.ltm,(t=>{this._searchBoxElement.attr("aria-busy",t),this._listBoxElement.attr("aria-busy",t)})),this.options.ariaLabel.subscribeAndRun(this.ltm,(e=>{const s=(e||"").trim();s?(this._comboBoxElement.attr({"aria-labelledby":null,"aria-label":s}),this._searchBoxElement.attr({"aria-labelledby":null,"aria-label":s})):(this._comboBoxElement.attr("aria-label",g),this._comboBoxElement.attr("aria-labelledby",t),this._searchBoxElement.attr("aria-label",g),this._searchBoxElement.attr("aria-labelledby",t))})),this.options.hideSuggestions.subscribeAndRun(this.ltm,(t=>{this._searchBoxElement.attr("autocomplete",t?null:"off")}))}_reset(){return this._updateTextBoxWithOutOpeningDropDown(""),this._dirty=!1,this.state.currentItems([]),this.element.removeClass(b),clearTimeout(this._typingTimer),Promise.resolve()}_attachEventHandlers(){const t=()=>{if(this.options&&this.options.submit){const t=this.state.textFieldViewModel.value();this._busy(!0),this.options.submit(t,this._originalText).finally((()=>{this._busy(!1)})),this._originalText=t,this.state.popupOpen(!1)}};this._events.push(this.element.setEvents(["mousedown",t=>{const e=$(t.target);e.is("li")&&(this._clickedInsideWidget=!0,$(e).click())}],["keydown",t=>{(38===t.which&&this.state.popupOpen.value||40===t.which)&&t.preventDefault()}],["keyup",e=>{const s=this.element.find(`.${m}`);let i,a;const n=t=>{t.addClass(m).attr({id:this._activeItemId,"aria-selected":!0}),this._searchBoxElement.attr("aria-activedescendant",this._activeItemId)},l=t=>"[object object]"!==t?.text().toLowerCase(),c=(t,e,s)=>{if(t.length){t.removeClass(m).removeAttr("id aria-selected");const s=e&&e.length,i=s&&e.text();s&&l(e)?(this._updateTextBoxWithOutOpeningDropDown(i),n(e)):this._updateTextBoxWithOutOpeningDropDown(this._originalText)}else l(s)&&(this._updateTextBoxWithOutOpeningDropDown(s.text()),n(s))};if(0===o.getModifierKeys(e))switch(e.which){case 13:e.stopPropagation(),clearTimeout(this._typingTimer),this.state.currentItems([]),t();break;case 27:this.state.currentItems([]),this.state.textFieldViewModel.value("");case 9:this.state.popupOpen(!1);break;case 8:case 46:""===this.state.textFieldViewModel.value()&&(this._dirty=!1,this.state.popupOpen(!1));break;case 40:{const t=this.state.textFieldViewModel.value();if(t){if(!this.state.popupOpen.value){this._updateDropdown(t);break}if(i=s.next("li"),a=this.element.find(`.${r.listClass} li`).first(),"disabled"===a.attr("disabled"))break;c(s,i,a)}break}case 38:if(this.state.popupOpen.value){if(i=s.prev("li"),a=this.element.find("."+r.listClass+" li").last(),"disabled"===a.attr("disabled"))break;c(s,i,a)}}}],["focusout",t=>{this._forceDismiss=!0,this.state.popupOpen(!1),this._clickedInsideWidget||this.state.currentItems([])}],["click",e=>{const s=$(e.target);s.is("li")&&(this._updateTextBoxWithOutOpeningDropDown(s.text()),this.state.currentItems([]),t()),this._clickedInsideWidget=!1}])),this._events.push(this.element.find(`.${r.iconDiscardClass}`).setEvents(["click",()=>{this._busy(!0),v(this.options).finally((()=>{this._busy(!1)})),this._originalText="",this._reset(),t(),this.element.find(".azc-input").focus()}]))}_updateTextBoxWithOutOpeningDropDown(t){this._ignoreTextBoxValueUpdate=!0,this.state.textFieldViewModel.value(t),this._ignoreTextBoxValueUpdate=!1}_updateDropdown(t){this.element.addClass(b),this._busy(!0),MsPortalFx.Base.Promises.cancelOnDispose(this.ltm,(()=>v(this.options,t))).then((e=>{let s=0;if("number"==typeof(e=e||0))s=e,this.state.currentItems([]);else{s=e.length;let t=this._unchangingResultLimit;x(t)&&(t=this.options.resultLimit()),t&&e.length>t&&(e=e.slice(0,t)),this.state.currentItems(e)}this._options.suppressSearchResultsAnnouncements()||this._announce.read(a.DropDown.filterResult.format(s,t))})).finally((()=>{this._busy(!1)}))}}e.Widget=I,e.SearchBox=(0,l.createControlComponent)({widgetCtor:I,widgetUIStateCtor:C,innerComponent:r.SearchBoxInner})}));