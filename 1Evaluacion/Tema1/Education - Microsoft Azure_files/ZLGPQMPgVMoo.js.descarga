define("_generated/MsPortalImpl/Svg/Internal/CollapseAll.svg",["require","exports"],(function(e,t){"use strict";return{type:1,data:"<svg viewBox='0 0 18 18' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><path d='M14.932 0 9 6.18 3.068 0 2.25.851 9 7.875 15.75.851 14.932 0ZM3.068 18 9 11.82 14.932 18l.818-.851L9 10.125l-6.75 7.024.818.851Z'/></g></svg>"}})),
define("_generated/MsPortalImpl/Svg/Internal/ExpandAll.svg",["require","exports"],(function(e,t){"use strict";return{type:1,data:"<svg viewBox='0 0 18 18' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><path d='M14.932 7.875 9 1.695l-5.932 6.18-.818-.851L9 0l6.75 7.024-.818.851Zm-11.864 2.25L9 16.305l5.932-6.18.818.851L9 18l-6.75-7.024.818-.851Z'/></g></svg>"}})),
define("MsPortalImpl.Controls/Controls/Lists/Menu.Component",["require","exports","Weave/DirectMode","Weave","MsPortalImpl.Controls/Controls/Lists/List1/ListView1.Component","Viva.Controls/Controls/Lists/List1/Viva.ListView1.Groupable","MsPortalImpl.Controls/Controls/SearchBox.Component","FxInternal/Weave","Fx/Images","MsPortalImpl/Resources/ImplScriptResources","_generated/MsPortalImpl/Svg/Internal/ExpandAll.svg","_generated/MsPortalImpl/Svg/Internal/CollapseAll.svg","Fx/Experimentation"],(function(e,t,i,s,a,n,o,r,l,c,u,d,m){"use strict";function p(e){let t,s,a;switch(e.state){case 0:t=c.Menu.removeFavoriteItem.format(e.item.displayText),s=l.Images.Star({palette:3}),a="fxc-menu-unfavorite";break;case 1:t=c.Menu.unmatchedMenuItem,s=l.Images.Star({palette:3}),a="fxc-menu-unfavorite";break;case 3:t=c.Menu.addFavoriteItem.format(e.item.displayText),s=l.Images.Favorite({palette:3}),a="fxc-menu-favorite";break;case 2:t=c.Menu.maxFavoritesReached,s=l.Images.Favorite({palette:5}),a="fxc-menu-favorite";break;case 4:t=c.Menu.cantFavoriteDisabledItem,s=l.Images.Favorite({palette:5}),a="fxc-menu-favorite"}return i("div",{image:s,className:`fxc-menu-favoriteicon ${a}`,"data-itemId":e.item.id,title:t,role:"button"},t)}Object.defineProperty(t,"__esModule",{value:!0}),t.menuItem=t.menuGroupHeader=t.MenuInner=void 0,t.MenuInner=function(e){const{state:t}=e,m=(0,r.toComputation)(t.favoriteMenuItemsListLength).compose((e=>e>=7)),p=t.listState.vivaListViewModel.plugins.groupable;return i(s.GetContext,{fn:e=>i(s.SetContext,{isMaxFavoritesReached:m,favoritesList:(0,r.toComputation)(t.favoriteItems),unmatchedFavoriteItems:(0,r.toComputation)(t.unmatchedFavoriteItems)},i(s.Fragment,null,i("div",{className:"fxc-menu-header"},t.searchBoxViewModel?i("div",{className:"fxc-menu-search"},i(o.SearchBoxInner,{vm:t.searchBoxViewModel,state:t.searchBoxState})):i("div",{className:"fxc-menu-nosearch-placeholder"}),i(s.PromiseFragment,{"data-odebug":"p16",promise:(0,n.isCollapsibilityEnabled)(e.diContainer).then((e=>e?i("button",{className:(0,r.toComputation)(p.shouldCollapseOrExpand).compose((e=>"collapse"===e?"fxc-menu-collapseexpandall fxc-menu-collapseall":"fxc-menu-collapseexpandall fxc-menu-expandall")),image:(0,r.toComputation)(p.shouldCollapseOrExpand).compose((e=>"collapse"===e?l.Images.CustomImageWithOptions(d,{}):l.Images.CustomImageWithOptions(u,{}))),title:(0,r.toComputation)(p.shouldCollapseOrExpand).compose((e=>"collapse"===e?c.Menu.collapseAllHeaders:c.Menu.expandAllHeaders)),onClick:()=>p.toggleCollapseStatusOfAllGroupHeaders(),type:"button"}):null))})),i("div",{className:"fxc-menu-scrollarea"},i("div",{className:["fxc-menu-grid",{"fxs-maxfavoritesreached":m}]},i(a.ListViewInner,{vm:t.listViewModel,state:t.listState})))))})},t.menuGroupHeader=function(e){const t=e.value!==MsPortalFx.Resources.Strings.Part.SettingList.Group.quickAccess,a=(0,r.toComputation)(e.isCollapsed);return i(s.GetContext,{fn:o=>{return i(s.Fragment,null,i(s.PromiseFragment,{"data-odebug":"p17",promise:(r=o.diContainer,(0,n.isCollapsibilityEnabled)(r).then((e=>e?i("div",{image:a.compose((e=>e?l.Images.Chevron():l.Images.CaretDown())),className:["fxc-menu-icon","fxc-menu-groupheader-icon",t?"":"fxs-display-none"]}):null)))}),i("div",{className:["fxc-menu-groupheader",t?"":"fxs-display-none"]},e.value));var r}})},t.menuItem=function(e){return i(s.Fragment,null,i("div",{image:(0,r.toValueOrComputation)(e.icon),className:"fxc-menu-icon msportalfx-svg-c07"}),i("div",{className:"fxc-menu-listView-item","data-telemetryName":`Menu-${e.id}`},(0,r.toValueOrComputation)(e.displayText)),i(s.GetContext,{fn:t=>{const{favoritesList:a,isMaxFavoritesReached:n,unmatchedFavoriteItems:o}=t,l=a.compose((t=>t.includes(e.id))),c=o.compose((t=>t.includes(e.id)));return i(s.PromiseFragment,{"data-odebug":"p18",promise:t.diContainer.get(m.Experimentation).shellAssignments.whenAvailable().then((t=>t.getBooleanValue("FavoritesInMenu")||MsPortalFx.isFeatureEnabled("FavoritesInMenu")?i(s.If,{condition:l,trueFn:()=>i(s.If,{condition:c,trueFn:()=>i(p,{state:1,item:e}),falseFn:()=>i(p,{state:0,item:e})}),falseFn:()=>i(s.If,{condition:n,trueFn:()=>i(p,{state:2,item:e}),falseFn:()=>i(s.If,{condition:(0,r.toComputation)(e.metadata?.disabled),trueFn:()=>i(p,{state:4,item:e}),falseFn:()=>i(p,{state:3,item:e})})})}):null))})}}))}})),
define("_generated/Less/MsPortalImpl.Controls/Controls/Lists/Menu.css",["module"],(function(e){"use strict";return{css:'.fxc-menu{display:flex;flex-direction:column}.fxc-menu-groupheader{padding:0;font-size:13px;line-height:1.385;line-height:32px;border-bottom-color:inherit;border-bottom-style:solid;border-bottom-width:1px}.ext-menublade-part{height:100%}.fxc-menu-search{flex:0 0 auto;min-height:23px;margin:7px 35px 7px 20px}.fxc-menu-nosearch-placeholder{display:block;flex:0 0 24px;min-height:24px}.fxc-menu-scrollarea{overflow:auto;flex:1 1 auto}.fxc-menu-icon{height:15px;width:15px;flex:0 0 auto}.fxc-menu-favoriteicon{opacity:0;width:12px;height:15px;flex:0 0 auto}.fxc-menu-item:hover .fxc-menu-favoriteicon,.fxc-menu-item:focus .fxc-menu-favoriteicon,.fxc-menu-item:active .fxc-menu-favoriteicon,.azc-listView-item:focus-visible .fxc-menu-favoriteicon{opacity:1}.azc-group-quickaccess .fxc-menu-favoriteicon{display:none}.fxs-maxfavoritesreached .fxc-menu-favorite{cursor:default}.fxc-menu-grid{padding:0}.fxc-menu-grid .azc-listView-item{display:flex;font-size:13px;margin:0}.fxc-menu-grid .azc-listView-item[aria-disabled="true"] .fxc-menu-listView-item,.fxc-menu-grid .azc-listView-item[aria-disabled="true"] .fxc-menu-icon{opacity:.5}.fxc-menu-grid .fxc-menu-item{display:flex;align-items:center;width:100%;padding:7px 20px;box-sizing:border-box;min-height:32px;overflow:hidden}.fxc-menu-grid .fxc-menu-item:hover,.fxc-menu-grid .fxc-menu-item:focus,.fxc-menu-grid .fxc-menu-item:active{text-decoration:none}.fxc-menu-grid .fxc-menu-icon{position:relative;padding-right:10px;align-self:flex-start;margin-top:2px}.fxc-menu-grid .fxc-menu-icon.fxc-menu-groupheader-icon{align-self:center;margin-top:0}.fxc-menu-grid .fxc-menu-listView-item{overflow:hidden;text-overflow:ellipsis;flex-grow:1}.fxc-menu-grid .azc-listView-groupheader{margin:0 20px}.fxs-menublade .fxs-blade-content-container .fxs-blade-content-container-default{display:none}.fxs-menublade .fxs-blade-content-container .fxs-blade-content-container-default .fxs-part{overflow:hidden!important}.fxc-menu .azc-listView-group{margin-bottom:8px}@media(min-width:640px) and (min-height:500px){.fxs-menublade .fxs-blade-content-container .fxs-blade-content-container-default{display:flex}}.fxc-menu.fxc-collapsible-menu{flex-direction:column;align-content:flex-start}.fxc-menu.fxc-collapsible-menu .fxs-portal-activated{box-shadow:inset 2px 0 var(--colorButtonBackgroundPrimary);font-weight:600}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup{margin:0}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .fxc-menu-groupheader-icon{width:12px;padding:2px}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .fxc-menu-groupheader,.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .azc-listView-collapsible-groupheader{border:0;padding:0}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .fxc-menu-item,.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .azc-listView-collapsible-groupheader{column-gap:8px;padding-left:20px}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup ul{margin-left:0}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup ul a.fxc-menu-item .fxc-menu-icon{height:16px;width:16px;padding-right:0;align-self:auto}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup:not(.azc-group-quickaccess) .fxc-menu-item{padding-left:44px}.fxc-menu.fxc-collapsible-menu .fxc-menu-header{display:flex;flex-flow:row;gap:4px;align-items:center;justify-content:space-between;margin:7px 34px 7px 16px}.fxc-menu.fxc-collapsible-menu .fxc-menu-header .fxc-menu-search{flex-grow:1;flex-shrink:1;margin:0}.fxc-menu.fxc-collapsible-menu .fxc-menu-header .fxc-menu-collapseexpandall{height:24px;width:24px;display:flex;padding:8px;border:0}.fxc-menu.fxc-collapsible-menu .fxc-menu-header .fxc-menu-collapseexpandall>svg{width:8px;height:8px}.fxc-menu.fxc-collapsible-menu .fxc-menu-header .fxc-menu-collapseexpandall:hover{background-color:var(--colorControlBackgroundHover)}.fxc-menu.fxc-collapsible-menu .fxc-menu-header .fxc-menu-collapseexpandall:active{background-color:var(--colorControlBackgroundSelected)}',moduleId:e.id}})),
define("MsPortalImpl.Controls/Controls/Lists/Menu",["require","exports","MsPortalImpl.Controls/Controls/Base/Loadable","MsPortalImpl/Base/Base.Selectable2","Fx/Controls/SearchBox","MsPortalImpl/Base/Base.KeyboardHelper","MsPortalImpl/Base/Base.DeepLink","MsPortalImpl.Controls/Controls/Base/Base","MsPortalImpl.Controls/Controls/Lists/Menu.Component","MsPortalImpl.Controls/Controls/Lists/List1/ListView1","MsPortalImpl.Controls/Controls/SearchBox","MsPortalImpl.Controls/Controls/Lists/List1/ListView1.InternalViewModel","_oss/fuse","FxInternal/Css","_generated/Less/MsPortalImpl.Controls/Controls/Lists/Menu.css","FxInternal/Controls/ListView1","Viva.Controls/Controls/Lists/List1/Viva.ListView1.Groupable","MsPortalImpl/Services/Services.Storage","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Services/Services.Settings","Fx/Images","Fx/Experimentation","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Services/Services.GeneralSettings","Fx"],(function(e,t,i,s,a,n,o,r,l,c,u,d,m,p,g,h,f,v,x,b,y,w,C,I,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFavoritesEnabled=t.MenuFavoritesGroupId=t.Widget=t.InnerTsxComponent=t.WidgetUIState=void 0,(0,p.injectCss)(g);var M=MsPortalFx.Base.Promises;const F=MsPortalFx.Base.Diagnostics.createLog(e),T=s.getOrCreate,k="fxc-menu",D={shouldSort:!0,includeScore:!0,includeMatches:!0,tokenize:!0,threshold:.3,location:0,distance:100,maxPatternLength:32,minMatchCharLength:2,keys:[{name:"displayText",weight:.8},{name:"keywords",weight:.3}],getFn:(e,t)=>{const i=ko.unwrap(e[t]);return"displayText"===t?i:"string"==typeof i?i.split(","):i}};class A extends r.WidgetUIState{constructor(e){super(),this.queryString=ko.observable(""),this.searchMissCallbacks=$.Callbacks(),this.ariaLabel=ko.observable(""),this.menuIdentificationKey=ko.observable(void 0),this.favoriteMenuItemsListLength=ko.observable(0),this.unmatchedFavoriteItems=ko.observableArray([]),this.favoriteItems=ko.observable([]);const t=e.vm,i=e.diContainer.get(v.StorageService),s=e.diContainer.get(I.GeneralSettings),n=ko.observable({}),o=new Map;t.groups.subscribe(this._ltm,(e=>{for(const t of e)o.set(ko.unwrap(t.displayText),t.id)})),ko.computed(this._ltm,this.menuIdentificationKey,(e=>{const t=e?JSON.parse(i.getValue(v.ComponentName.Menu,H(e),0)||"{}"):{};Object.prototype.hasOwnProperty.call(t,C.Menu.favorites)||(t[C.Menu.favorites]=!1),n(t),R("GroupableStateStorage","GroupableStateFetched",{keyUsed:e,isCollapsedByDefault:3===(0,I.getMenuBehaviorSettingFromSettings)(s),verboseUserSettingForCollapse:(0,I.stringifyDefaultMenuCollapseState)(s.defaultMenuCollapseState()),groupableStateMap:t})}));let r=null;ko.computed(this._ltm,[n,this.menuIdentificationKey],((e,t)=>{t&&(i.setValue(v.ComponentName.Menu,H(t),JSON.stringify(e),0),r&&clearTimeout(r),r=setTimeout((()=>{r=null,R("GroupableStateStorage","GroupableStateSaved",{keyUsed:t,isCollapsedByDefault:3===(0,I.getMenuBehaviorSettingFromSettings)(s),verboseUserSettingForCollapse:(0,I.stringifyDefaultMenuCollapseState)(s.defaultMenuCollapseState()),groupableStateMap:e})}),1e3))}));const m=this.listViewModel=new d.ViewModel(this._ltm,h.Extensions.Selectable|h.Extensions.Groupable|h.Extensions.ContextMenu,{ariaLabel:this.ariaLabel,groupable:{groupKey:ko.observable("group"),order:ko.observable(h.GroupOrder.Collection),headerTsxFn:l.menuGroupHeader,searchState:ko.observable(0),selectedGroup:ko.observable(),collapseStatusMap:n,nonCollapsibleGroups:[{groupNameId:MsPortalFx.Assets.QuickAccessGroupId,value:MsPortalFx.Resources.Strings.Part.SettingList.Group.quickAccess},{value:" "}],isCollapsedByDefault:void 0===s.defaultMenuCollapseState()||1===s.defaultMenuCollapseState(),collapseOrExpandAllListener:e=>{R("MenuCollapseOrExpandAllClick",e?"CollapseAll":"ExpandAll",{keyUsed:this.menuIdentificationKey()})},collapseOrExpandListener:(e,t)=>{R("MenuGroupCollapseOrExpand",t?"Collapse":"Expand",{keyUsed:this.menuIdentificationKey(),headerName:e,headerId:o.get(e)})}},selectable:{listRole:!0}},l.menuItem);m.outlineStyle(!1),m.extensionOptions.selectable.activateOnSelected=!0,this.listState=new c.WidgetUIState({vm:m,isTrusted:!0,sanitizationContext:e.sanitizationContext}),t.showSearch&&(this.searchBoxViewModel=a.create(this._ltm,{resultLimit:0,hideSuggestions:!0,update:e=>{this.queryString(e);let t=[];return e.trim()?(m.extensionOptions?.groupable?.searchState(1),t=function(e,t){let i=V(e=e.trim(),t);if(e.split(" ").length>1){const s=V(e,t,!0);i.push(...s),i.sort(((e,t)=>e.score-t.score)),i=MsPortalFx.unique(i,((e,t)=>MsPortalFx.areEqual(e.item.id,t.item.id)))}return i.map((e=>ko.unwrap(e.item.displayText)))}(e.toLowerCase(),m.items()),0===t.length?(this.searchMissCallbacks.fire({query:this.queryString()}),m.items().forEach((e=>{const i=ko.unwrap(e.displayText);e.metadata.hidden(!t.includes(i))}))):m.items().forEach((e=>{const i=ko.unwrap(e.displayText);e.metadata.hidden(!t.includes(i))}))):(m.items().forEach((e=>{e.metadata.hidden(!1)})),m.extensionOptions?.groupable?.searchState(0)),Promise.resolve(t)},submit:e=>(this.queryString(e),Promise.resolve(!0))}),this.searchBoxState=new u.WidgetUIState({diContainer:e.diContainer,vm:this.searchBoxViewModel}))}}t.WidgetUIState=A,t.InnerTsxComponent=l.MenuInner;class P extends i.Widget{constructor(e,i,s,a){super(e,i,s,a),this._overview=ko.observable(),this._callbacks=$.Callbacks(),this._noDefaultIdDeferred=Promise.withResolvers(),this._favoriteItems=ko.observableArray([]),this.selectedItemText=ko.observable(),i._msPortalFxData.storageKey.subscribeAndRun(this.ltm,(e=>{e?this.state.menuIdentificationKey(e):this.state.menuIdentificationKey(this._diContainer.get(x.CompositionProvenance).locator.getCacheFriendlyKeyPart())})),this._partContainer=e.parent(),e.addClass(k),(0,f.isCollapsibilityEnabled)(this._diContainer).then((t=>{t&&e.addClass("fxc-collapsible-menu")})),i.showSearch&&e.parents(".fxs-blade-content-wrapper").addClass("fxs-menu-show-search");const r=this.ltm;a.ariaLabel()||a.ariaLabel(e.closest(".fxs-blade").find(".fxs-blade-title-titleText").text());const{items:l,selectableMap:d,options:m}=this._data=i._msPortalFxData,p=this._data.menuDeepLink||ko.observable("");this.getResourceType=()=>(m.peek()||{}).resourceType;const g=ko.observableArray([]),h={};ko.explicitComputed(r,[l,this._overview],((e,t)=>{const i=this._overview(),s=[];i&&s.push(i),g(s.concat(e))})),p.subscribe(r,(e=>{e&&g().forEach((t=>{const i=t.id;h[i]((0,o.replaceMenuIdFromDeepLink)(e,i))}))}));const v=ko.observable(!1);this.state.favoriteMenuItemsListLength.subscribeAndRun(this.ltm,(e=>v(e>=7))),this._visibleItems=g.map(r,((e,t)=>{const i=t.id;ko.ignoreDependencies((()=>{if(!h[i]){const e=p();h[i]=ko.observable(e&&this._selectedItem&&(0,o.replaceMenuIdFromDeepLink)(e,i)||"#")}}));const s=MsPortalFx.extend({metadata:{},url:h[i]},t);return!s.metadata.disabled&&(s.metadata.disabled=ko.observable(!1)),s.metadata.hidden=ko.observable(!1),s.enabled&&s.enabled.subscribeAndRun(e,(e=>s.metadata.disabled(!e))),s})).filter(r,(e=>!e.visible||e.visible()));const w=this.state.listViewModel;z(this._diContainer).then((e=>{if(e){const e=[];ko.computed(this.ltm,this.state.menuIdentificationKey,(i=>{const s=O(i);R("FavoritesStorage","WillStartFetch",{keyUsed:s}),this._diContainer.get(b.SettingsManager).querySetting(8,s).then((i=>{if(i?.storedFavorites){e.push(this._visibleItems.subscribeAndRun(this.ltm,(e=>{this._favoriteItems(i.storedFavorites.map((i=>{const a=e.find(E(i));if(a)return R("FavoritesMatching","MatchFound",{favoriteId:i.id,keyUsed:s}),this.state.unmatchedFavoriteItems.remove(i.id),{...a,group:C.Menu.favorites,groupId:t.MenuFavoritesGroupId};R("FavoritesMatching","MatchNotFound",{favoriteId:i.id,keyUsed:s}),this.state.unmatchedFavoriteItems.indexOf(i.id)<0&&this.state.unmatchedFavoriteItems.push(i.id);return{id:i.id,aggregatedKeywords:"",displayText:i.displayText??i.id,group:C.Menu.favorites,groupId:t.MenuFavoritesGroupId,icon:y.Images.Blank(),enabled:ko.observable(!1),supplyBladeReference:()=>new FxImpl.Composition.Selectable.PdlBladeReference("",""),metadata:{disabled:ko.observable(!0)},url:ko.observable("#")}})))})));const a=new Date;a.setMonth(a.getMonth()-1),new Date(i.lastModified)<a&&this.updateSavedFavoriteItems(i.storedFavorites).then((()=>{R("FavoritesStorage","FavoritesSaved",{favorites:i.storedFavorites.map((e=>e.id)),keyUsed:s,isRefresh:!0})})).catch((e=>{F.error(new Error("Request to refresh a one month old record of Favorites failed"),void 0,{data:e})}))}})).catch((e=>{F.error(new Error("FavoritesFetchedFailed, request to fetch list of Favorites from server failed"),void 0,{data:e})}))})),ko.computed(r,(()=>{const e=w.extensionOptions?.groupable?.nonCollapsibleGroups??[],t=this._visibleItems().reduce(((t,i,s)=>e.some((e=>void 0!==e.groupNameId&&e.groupNameId===i.groupId||e.value===i.group))?s:t),-1);w.items([...this._visibleItems().slice(0,t+1),...this._favoriteItems(),...this._visibleItems().slice(t+1)])}))}else this._visibleItems.subscribeAndRun(r,w.items)})),e.on("click",".fxc-menu-favoriteicon",(e=>{if(e?.currentTarget instanceof HTMLElement){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=e.currentTarget.dataset?.itemid;t&&this.toggleFavoriteItemFromId(t)}})),e.on("keydown",(e=>{if("F"===e.key&&e.ctrlKey&&e.shiftKey){const e=document.activeElement.querySelector(".fxc-menu-favoriteicon");e instanceof HTMLElement&&void 0!==e.dataset.itemid&&this.toggleFavoriteItemFromId(e.dataset.itemid)}}));const I=w.extensionOptions.selectable.selectedItem,S=new M.CancelationToken;I.subscribe(r,(e=>{this.resetStartupLifetimeManager(),S.cancel();const t=this._overview();let i;if(e){let s;this._selectedTab?.menuId===e.id?s=d()[this._selectedTab.tabMenuId]:(this._selectedTab=null,s=d()[e.id]);const a=T(this._diContainer,s);if(!a.isSelected()){this._clickSelectable(e,a);const s=this._selectedItem;this._selectedItem=e;const n=a.isSelected.subscribe(a.createChildLifetime(),(o=>{a.isCanceled&&s&&d()[s.id]&&(w.extensionOptions.selectable.selectedItem(s),this._selectedItem=s,i=(t&&t.id)===s.id?null:ko.unwrap(s.displayText)),e===w.extensionOptions.selectable.selectedItem()&&w.extensionOptions.selectable.selectedItem(null),n.dispose()}))}i=(t&&t.id)===e.id?null:ko.unwrap(e.displayText)}this.selectedItemText(i)})),I.subscribe(r,(e=>{w.extensionOptions.groupable?.selectedGroup?.(e?.group)})),e.on("click",".fxc-menu-item",(e=>{if(n.isCtrlOrCommandOnly(e)||e.shiftKey)return!0;e.preventDefault()})),this._favoriteItems.subscribe(r,(e=>{this.updateFavoriteItemsStorage(e)})),e.trigger("fxregistermenu",this);const D={weaveContext:this.weaveContext};this.ltm.registerForDispose(new c.Widget(e.find(".fxc-menu-grid"),w,D,this.state.listState)),this.state.searchBoxViewModel&&this.ltm.registerForDispose(new u.Widget(e.find(".fxc-menu-search"),this.state.searchBoxViewModel,D,this.state.searchBoxState)),this._favoriteItems.subscribeAndRun(this.ltm,(e=>{this.state.favoriteMenuItemsListLength(e.length),this.state.favoriteItems(e.map((e=>e.id)))})),this.getTelemetryInfo=()=>{const e=m.peek()||{},t={itemCount:this._visibleItems.peek().length};return MsPortalFx.extendStringMapIntoMap(t,e,((e,t)=>MsPortalFx.isPrimitive(e)?e:void 0),!0),t}}onItemClick(e){this._callbacks.add(e)}onSearchMiss(e){this.state.searchMissCallbacks.add(e)}resetStartupLifetimeManager(){this._startupLifetimeManager&&this._startupLifetimeManager.dispose()}saveFavoriteItem(e){e.metadata?.disabled()||(this._favoriteItems().find(E(e))?F.warning(`Menu item to be favorited is already in Favorites list, ${ko.unwrap(e.displayText)}, ID: ${e.id}`):this._favoriteItems().length>=7?(F.warning(`Favorites list is full with 7 items, cannot add new item ${ko.unwrap(e.displayText)}, ID: ${e.id}.`),R("FavoriteUserActions","FavoriteItemLimitHit",{itemId:e.id,keyUsed:O(this.state.menuIdentificationKey())})):e.groupId===MsPortalFx.Assets.QuickAccessGroupId?F.warning(`Cannot add QuickAccess items to Favorites list, trying to add ${ko.unwrap(e.displayText)}, ID: ${e.id}.`):(this._favoriteItems.push({...e,groupId:t.MenuFavoritesGroupId,group:C.Menu.favorites}),R("FavoriteUserActions","FavoriteItemAdded",{itemId:e.id,keyUsed:O(this.state.menuIdentificationKey())})))}removeFavoriteItem(e){this._favoriteItems().find(E(e))?(this._favoriteItems.remove(E(e)),R("FavoriteUserActions","FavoriteItemRemoved",{itemId:e.id,keyUsed:O(this.state.menuIdentificationKey())})):F.warning(`Menu item to be unfavorited is not found in Favorites list, ${ko.unwrap(e.displayText)}, ID: ${e.id}`)}updateFavoriteItemsStorage(e){const t=e.map((e=>e.id));return this.updateSavedFavoriteItems(e).then((()=>{R("FavoritesStorage","FavoritesSaved",{favorites:t,keyUsed:O(this.state.menuIdentificationKey()),isRefresh:!1})})).catch((e=>{F.error("Failed to update Favorites storage",void 0,{data:e})}))}updateSavedFavoriteItems(e){return this._diContainer.getAsync(b.SettingsManager).then((t=>{const i=O(this.state.menuIdentificationKey()),s={storedFavorites:e.map((e=>({id:e.id,displayText:ko.unwrap(e.displayText)}))),lastModified:(new Date).toISOString()};return t.setSetting(8,i,s)}))}setDefaultId(e){const t=this.state.listViewModel,i=e.recommendedId,s=t.extensionOptions.selectable.selectedItem;s()&&s(null);const{selectableMap:a,options:n}=this._data;this.resetStartupLifetimeManager();const o=this._startupLifetimeManager=this.ltm.createChildLifetime(),r=ko.observable(),l=(e,i=!0)=>{i?t.extensionOptions.selectable.selectedItem(e):r()?t.extensionOptions.selectable.selectedItem(L(this._visibleItems(),r())):t.extensionOptions.selectable.selectedItem(MsPortalFx.first(this._visibleItems()))};ko.computed(o,[a,this._visibleItems,r],((t,s,a)=>{if(!t||!a)return;if(e.bladeReference&&t[i]){T(this._diContainer,t[i]).referenceOverride=e.bladeReference,e.bladeReference=null}const n=MsPortalFx.find(s,(e=>this._selectedItem&&e.id===this._selectedItem.id));(n?N(o,n,500,l):Promise.resolve(!1)).then((e=>{if(e||o.isDisposed())return;const i=L(s,a);if(i)_(i,a.toLowerCase())||(this._selectedTab={menuId:i.id,tabMenuId:a}),N(o,i,500,l);else if(t[a]){let e=!1;MsPortalFx.forEachKey(t,((i,a)=>{if(e)return;const n=T(this._diContainer,t[i]),r=MsPortalFx.find(s,(e=>e.id===i));r&&(!n.isSelected()||r.enabled&&!r.enabled()?ko.computed(o,[n.isSelected,r.enabled||ko.observable(!0)],((e,t)=>{e&&t&&(l(r),this.resetStartupLifetimeManager())})):(e=!0,l(r),S.nextTick((()=>this.resetStartupLifetimeManager()))))}))}else{const e=MsPortalFx.first(s);e&&N(o,e,-1,l)}}))}));const c=n.subscribe(o,(e=>{if(!e)return;const t=e.overview;let s=e.defaultId;t?(this._overview(MsPortalFx.extend2(t,{groupId:MsPortalFx.Assets.QuickAccessGroupId,group:MsPortalFx.Resources.Strings.Part.SettingList.Group.quickAccess,aggregatedKeywords:[t.displayText].concat(t.keywords).join(" ")})),s||(s=t.id)):this._overview(null),s=i||s,s?r(s):this._noDefaultIdDeferred.resolve()}));e.rebinding||c.callback(n())}switchItem(e,t,i){this._selectedTab=null;const s=i?this._favoriteItems():this._visibleItems(),a=L(s,e),n=a||MsPortalFx.first(s);if(n.tabItems&&(this._selectedTab={menuId:a.id,tabMenuId:e}),this._selectedItem?.id===e){T(this._diContainer,this._data.selectableMap()[a.id]).refresh()}if(t){const{selectableMap:i}=this._data,s=T(this._diContainer,i()[e]);s.referenceOverride=t,n&&this._clickSelectable(n,s)}else n&&this.state.listViewModel.extensionOptions.selectable.selectedItem(n)}internalGetAndSelectItem(e){const t=L(this._visibleItems(),e);if(t&&this._selectedItem?.id===t.id&&t.tabItems){this._selectedTab={menuId:t.id,tabMenuId:e};const i=B(t,e);if(i)return(i.supplyBladeReference?Promise.resolve(i.supplyBladeReference()):i.supplyBladeReferenceAsync()).then((t=>(t.menuId=e,t)))}return null}getSelectedItem(){if(this._selectedTab){return B(L(this._visibleItems(),this._selectedTab.menuId),this._selectedTab.tabMenuId)}return this._selectedItem}getPartContainer(){return this._partContainer}dispose(){this._cleanElement(k),super.dispose()}selectDefaultItem(){this.state.listViewModel.extensionOptions.selectable.selectedItem(this._visibleItems.peek()[0])}getDefaultItem(){return this._visibleItems.peek()[0]}_clickSelectable(e,t){t.onClick(),this._callbacks.fire(e.id,{query:this.state.queryString(),group:e.groupId})}toggleFavoriteItemFromId(e){const i=L(this._visibleItems(),e);if(this._favoriteItems().find(E(e))){const i=L(this._favoriteItems(),e);if(this._selectedItem?.groupId===t.MenuFavoritesGroupId&&this._selectedItem?.id===e){const e=this._visibleItems().find(E(this._selectedItem));e?this.state.listViewModel.extensionOptions.selectable.selectedItem(e):this.selectDefaultItem()}this.removeFavoriteItem(i)}else this.saveFavoriteItem(i)}}function N(e,t,i,s){const a=Promise.withResolvers(),n=e.createChildLifetime();let o;return t.enabled?t.enabled.subscribeAndRun(n,(e=>{e&&a.resolve(!0)})):a.resolve(!0),-1!==i&&(o=setTimeout((()=>{a.resolve(!1)}),i)),a.promise.finally((()=>{o&&clearTimeout(o),n.dispose()})).then((e=>(s(t,e),e)))}function _(e,t){return e.id.toLowerCase()===t||e.id.toLowerCase()===t.replace(/\s/g,"")}function L(e,t){const i=t?t.toLowerCase():"";return MsPortalFx.find(e,(e=>_(e,i)||!!B(e,i)))}function B(e,t){const i=t?t.toLowerCase():"";return MsPortalFx.find(e.tabItems||[],(e=>_(e,i)))}function V(e,t,i){const s=i?MsPortalFx.extend({matchAllTokens:!0},D):D;let a=new m(t,s).search(e);a=a.filter((e=>e.score<=s.threshold));return a.reduce(((e,t)=>(t.score<=s.threshold&&e.push(t),e)),[]).sort(((e,t)=>e.score-t.score))||[]}function O(e){return`${e}-favorites`}function H(e){return`${e}-collapseStatus`}function E(e){const t="string"==typeof e||"number"==typeof e?e:e.id;return e=>t===e.id}function R(e,t,i){MsPortalFx.Base.Diagnostics.Telemetry.trace({source:"MenuBlade",action:e,actionModifier:String(t),data:i})}async function z(e){const t=await e.get(w.Experimentation).shellAssignments.whenAvailable();return t.getBooleanValue("areMenusCollapsible")||t.getBooleanValue("FavoritesInMenu")||MsPortalFx.isFeatureEnabled("FavoritesInMenu")}t.Widget=P,P.flightNewRender=!0,t.MenuFavoritesGroupId="favorites_group",t.isFavoritesEnabled=z})),
define("MsPortalImpl/Weave/Components/SettingsFlyoutHelpers",["require","exports","FxHubs/ArtHelpers/ArtApis","FxHubs/ArmHelpers/ArmApisStartup","Fx/Ajax","MsPortalImpl/Services/Services.BrowserSettings","MsPortalImpl/Services/Services.ProjectedDirectories","MsPortalImpl/Services/Services.SubscriptionsDeferred","MsPortalImpl/Services/GlobalResourceFilterHelpers","MsPortalImpl/Resources/ImplScriptResources"],(function(e,t,i,s,a,n,o,r,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAllPossibleFacetValues=t.getResourceCountsForFilter=void 0;var u=MsPortalFx.Base.Diagnostics,d=u.Telemetry;const m=c.UiSettings.Flyout,p=u.createLog(e);async function g(){const e=(0,r.loadAllSubscriptionsFromArm)(),t=async function(){const e=[];try{await(0,s.callBatchWithContinuation)([{uri:(0,a.getEndpoints)().arm+"providers/Microsoft.Management/managementGroups?api-version=2020-05-01",telemetry:"SettingsHelpers.getManagementGroups",arrayResponse:!0}],(t=>{e.push(...t)}),(e=>{p.warning(`Error fetching management groups from ARM. Error: ${MsPortalFx.getLogFriendlyMessage(e)}`)}),!1)}catch(e){return p.warning(`Error fetching management groups from ARM. Error: ${MsPortalFx.getLogFriendlyMessage(e)}`),[]}return e.map((e=>({name:e.name,displayName:e.properties?.displayName||e.name})))}();let i;try{if(i=(await e).subscriptions,!i.length)return i}catch(e){p.warning(`Error loading all subscriptions from ARM. Error: ${MsPortalFx.getLogFriendlyMessage(e)}`)}try{const e=await t;MsPortalFx.first(i).managementGroupAncestorsChain=e}catch(e){p.warning(`Error loading all management groups from ARM. Error: ${MsPortalFx.getLogFriendlyMessage(e)}`)}return i}t.getResourceCountsForFilter=async function(e,t){const s=d.start({source:`SettingsHelpers.${t}`,action:"getResourceCountsForFilter"}),a=e=>{d.endTrace(s,"failed",{errorThrown:e})},n=(0,l.getQueryPredicates)(e,["subscriptionId","subscriptionName","subscriptionState","managementGroupName"]);let o;try{o=await(0,i.getDataFromArt)({query:['resourcecontainers | where type =~ "microsoft.resources/subscriptions"',"| project id, subscriptionId, name, tenantId,","  state = properties.state,","  subscriptionPolicies = properties.subscriptionPolicies,","  authorizationSource = properties.authorizationSource,","  managementGroupAncestorsChain = properties.managementGroupAncestorsChain,","  promotions = properties.promotions"].join("\r\n")+(n.length?"\r\n"+n.join("\r\n"):"")+"\r\n| summarize subscriptionCount = count()",options:{resultFormat:"table"}},"HubsExtension.GetCountsForGlobalFilter",void 0,{apiVersion:"2021-03-01"})}catch(e){throw a(MsPortalFx.getLogFriendlyMessage(e)),e}const r=o.data,c=FxImpl.lowerCaseStringMap();if((r.columns||[]).forEach(((e,t)=>{c.set(e.name,t)})),!Object.keys(c).length){const e="Response from ARG contained no columns";throw a(e),e}const u=r.rows||[];if(1!==u.length){const e=`Response from ARG for filtered resource counts contained ${u.length} rows (expect 1)`;throw a(e),e}const m=c.get("subscriptionCount");if(MsPortalFx.isNullOrUndefined(m)){const e="Unable to find row index for column 'subscriptionCount' in response from ARG for filtered resource counts";throw a(e),e}const p={subscriptions:u[0][m]};return d.completeTrace(s,p),p},t.getAllPossibleFacetValues=async function e(t){const i={subscriptionDisplayNames:[],subscriptionIds:[],subscriptionStates:[],managementGroups:[]},s=FxImpl.lowerCaseStringMap(),a=[],l=Object.create(null),c=FxImpl.lowerCaseStringMap(),u=Object.create(null),d=Object.create(null),h=t.get(n.ServiceDependencyState).azureResourceGraphUnavailable.value;try{const i=[h?g().then((e=>({subscriptions:e,resultCode:"Success",numberOfPages:1,totalRecords:e.length}))):(0,r.fetchSubscriptionsFromArg)({telemetryHeader:"HubsExtension.Settings.GetItemsForAdvancedFilters",includeProperties:!0}),null],p=t.get(FxImpl.Features).isEnabled("mspfilter");let f=!1;if(p){const e=async()=>{const e=await t.getAsync(o.ServicesProjectedDirectories);if(f=await e.hasProjectedDirectories(),f){return await e.getDirectoriesMap()}return null};i[1]=e()}const[v,x]=await Promise.all(i),b=x;if("Success"!==v.resultCode){if("Failure_ArgServiceUnavailable"===v.resultCode)return t.get(n.ServiceDependencyState).azureResourceGraphUnavailable(!0),e(t);throw new Error("Failed to fetch subscriptions from ARG")}t.get(n.ServiceDependencyState).azureResourceGraphUnavailable(!1),(v.subscriptions||[]).forEach((e=>{const{subscriptionId:t,displayName:i,tenantId:n,state:o}=e;if(o&&(u[o]=!0),p&&f){const e=c.get(n)||Object.create(null);e[i]=!0,c.set(n,e);const a=s.get(n)||[];a.push({value:t,text:m.subscriptionIdNameFormat.format(t,i)}),s.set(n,a)}else a.push({value:t,text:m.subscriptionIdNameFormat.format(t,i)}),l[i]=!0;e.managementGroupAncestorsChain?.length&&e.managementGroupAncestorsChain.forEach((e=>{d[e.name]=e.displayName}))}));const y=MsPortalFx.stableSort(Object.keys(u),MsPortalFx.localeCompareIgnoreCase).map((e=>({value:e,text:e})));let w,C;if(p&&f&&b){const e=[],t=[];b.forEach(((i,a)=>{const n=c.get(a);if(n){const t=MsPortalFx.stableSort(Object.keys(n),MsPortalFx.localeCompareIgnoreCase);e.push({text:i.displayName,children:t.map((e=>({text:e,value:e})))})}const o=s.get(a);if(o){const e=MsPortalFx.stableSort(o,((e,t)=>MsPortalFx.localeCompareIgnoreCase(e.text,t.text)));t.push({text:i.displayName,children:e})}})),w=e,C=t}else w=Object.keys(l).map((e=>({value:e,text:e}))),C=a;const I=Object.keys(d).map((e=>{const t=d[e];return{text:t&&t!==e?m.managementGroupNameFormat.format(t,e):e,value:e}}));return{subscriptionDisplayNames:MsPortalFx.stableSort(w,((e,t)=>MsPortalFx.localeCompareIgnoreCase(e.text,t.text))),subscriptionIds:MsPortalFx.stableSort(C,((e,t)=>MsPortalFx.localeCompareIgnoreCase(e.text,t.text))),subscriptionStates:y,managementGroups:MsPortalFx.stableSort(I,((e,t)=>MsPortalFx.localeCompareIgnoreCase(e.text,t.text)))}}catch(e){return p.warning(new MsPortalFx.Errors.Error({message:`Failed to get filter values for dropdowns. Error details: ${MsPortalFx.getLogFriendlyMessage(e)}`,innerErrors:e})),i}}})),
define("_generated/MsPortalImpl/Svg/Library/HighContrastModes/HighContrastBlack.svg",["require","exports"],(function(e,t){"use strict";return{type:1,data:"<svg viewBox='0 0 102 62' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><rect width='101' height='61' x='.5' y='.5' fill='#000' stroke='#fff' rx='4.5'/><path fill='#000' stroke='#fff' d='M1.5 5A3.5 3.5 0 0 1 5 1.5h17A3.5 3.5 0 0 1 25.5 5v55.5H5A3.5 3.5 0 0 1 1.5 57V5z'/><path fill='#000' stroke='#fff' d='M1.5 5A3.5 3.5 0 0 1 5 1.5h92a3.5 3.5 0 0 1 3.5 3.5v7.5h-99V5z'/><path d='M34 23h10v10H34zm0 12h10v3H34zm32-12h10v10H66zm0 12h10v3H66zm16-12h10v10H82zm0 12h10v3H82zM50 23h10v10H50zm0 12h10v3H50zm-16 8h58v3H34zm0 5h58v3H34z' class='msportalfx-svg-c01'/><rect width='99' height='59' x='1.5' y='1.5' stroke='#787878' rx='3.5'/></g></svg>"}})),
define("_generated/MsPortalImpl/Svg/Library/HighContrastModes/HighContrastWhite.svg",["require","exports"],(function(e,t){"use strict";return{type:1,data:"<svg viewBox='0 0 100 60' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><rect width='99' height='59' x='.5' y='.5' stroke='#000' rx='3.5' class='msportalfx-svg-c01'/><path stroke='#000' d='M.5 4A3.5 3.5 0 0 1 4 .5h17A3.5 3.5 0 0 1 24.5 4v55.5H4A3.5 3.5 0 0 1 .5 56V4z'/><path stroke='#000' d='M.5 4A3.5 3.5 0 0 1 4 .5h92A3.5 3.5 0 0 1 99.5 4v7.5H.5V4z' class='msportalfx-svg-c01'/><path fill='#A19F9D' d='M33 22h10v10H33zm0 12h10v3H33zm32-12h10v10H65zm0 12h10v3H65zm16-12h10v10H81zm0 12h10v3H81zM49 22h10v10H49zm0 12h10v3H49zm-16 8h58v3H33zm0 5h58v3H33z'/></g></svg>"}})),
define("_generated/MsPortalImpl/Svg/Library/MenuBehaviors/MenuDocked.svg",["require","exports"],(function(e,t){"use strict";return{type:1,data:"<svg viewBox='0 0 100 60' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><rect width='99' height='59' x='.5' y='.5' stroke='#D2D2D2' rx='3.5' class='msportalfx-svg-c01'/><path fill='#D2D2D2' d='M0 4a4 4 0 0 1 4-4h17a4 4 0 0 1 4 4v56H4a4 4 0 0 1-4-4V4z'/><path fill='#0078D4' d='M0 4a4 4 0 0 1 4-4h92a4 4 0 0 1 4 4v8H0V4z'/><path fill='#D2D2D2' d='M33 22h10v10H33zm0 12h10v3H33zm32-12h10v10H65zm0 12h10v3H65zm16-12h10v10H81zm0 12h10v3H81zM49 22h10v10H49zm0 12h10v3H49zm-16 8h58v3H33zm0 5h58v3H33z'/></g></svg>"}})),
define("_generated/MsPortalImpl/Svg/Library/MenuBehaviors/MenuFlyout.svg",["require","exports"],(function(e,t){"use strict";return{type:1,data:"<svg viewBox='0 0 100 60' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><rect width='99' height='59' x='.5' y='.5' stroke='#D2D2D2' rx='3.5' class='msportalfx-svg-c01'/><path fill='#0078D4' d='M0 4a4 4 0 0 1 4-4h92a4 4 0 0 1 4 4v8H0V4z'/><path fill='#D2D2D2' d='M33 22h10v10H33zm0 12h10v3H33zm32-12h10v10H65zm0 12h10v3H65zm16-12h10v10H81zm0 12h10v3H81zM49 22h10v10H49zm0 12h10v3H49zm-16 8h58v3H33zm0 5h58v3H33z'/><path fill='#E2E2E2' d='M0 4a4 4 0 0 1 4-4h21v60H4a4 4 0 0 1-4-4V4z'/><path stroke='#787878' stroke-linecap='round' stroke-width='2' d='m14 26 6 6.24L14.461 38'/><path stroke='#787878' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 32.25H8'/></g></svg>"}})),
define("_generated/MsPortalImpl/Svg/Library/ServiceMenuCollapseBehavior/CollapsedByDefault.svg",["require","exports"],(function(e,t){"use strict";return{type:1,data:"<svg viewBox='0 0 100 60' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><path d='M0 4a4 4 0 0 1 4-4h92a4 4 0 0 1 4 4v52a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4Z' class='msportalfx-svg-c01'/><path fill-rule='evenodd' clip-rule='evenodd' d='M96 1H4a3 3 0 0 0-3 3v52a3 3 0 0 0 3 3h92a3 3 0 0 0 3-3V4a3 3 0 0 0-3-3ZM4 0a4 4 0 0 0-4 4v52a4 4 0 0 0 4 4h92a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4H4Z' fill='#D2D2D2'/><path d='M0 4a4 4 0 0 1 4-4h17a4 4 0 0 1 4 4v56H4a4 4 0 0 1-4-4V4Z' fill='#D2D2D2'/><path d='M22 14H3a1 1 0 1 0 0 2h19a1 1 0 1 0 0-2Zm0 4H3a1 1 0 1 0 0 2h19a1 1 0 1 0 0-2Zm0 4H3a1 1 0 1 0 0 2h19a1 1 0 1 0 0-2Zm0 4H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Zm0 4H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Zm0 4H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Z' fill='#787878'/><path d='m3 28 .646-.646a.5.5 0 0 0 0-.708L3 26m0 6 .646-.646a.5.5 0 0 0 0-.708L3 30m0 6 .646-.646a.5.5 0 0 0 0-.708L3 34' stroke='#787878' stroke-linecap='round'/><path d='M0 4a4 4 0 0 1 4-4h21v12H0V4Z' fill='#0078D4'/></g></svg>"}})),
define("_generated/MsPortalImpl/Svg/Library/ServiceMenuCollapseBehavior/ExpandedByDefault.svg",["require","exports"],(function(e,t){"use strict";return{type:1,data:"<svg viewBox='0 0 100 60' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><path d='M0 4a4 4 0 0 1 4-4h92a4 4 0 0 1 4 4v52a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4Z' class='msportalfx-svg-c01'/><path fill-rule='evenodd' clip-rule='evenodd' d='M96 1H4a3 3 0 0 0-3 3v52a3 3 0 0 0 3 3h92a3 3 0 0 0 3-3V4a3 3 0 0 0-3-3ZM4 0a4 4 0 0 0-4 4v52a4 4 0 0 0 4 4h92a4 4 0 0 0 4-4V4a4 4 0 0 0-4-4H4Z' fill='#D2D2D2'/><path d='M0 4a4 4 0 0 1 4-4h17a4 4 0 0 1 4 4v56H4a4 4 0 0 1-4-4V4Z' fill='#D2D2D2'/><path d='M22 14H3a1 1 0 1 0 0 2h19a1 1 0 1 0 0-2Zm0 4H3a1 1 0 1 0 0 2h19a1 1 0 1 0 0-2Zm0 4H3a1 1 0 1 0 0 2h19a1 1 0 1 0 0-2Zm0 8H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Zm0 12H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Zm0 12H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Zm0-20H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Zm0 12H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Zm0-20H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Zm0 12H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Zm0 12H7a1 1 0 1 0 0 2h15a1 1 0 1 0 0-2Z' fill='#787878'/><path d='m2.5 26.5.646.646a.5.5 0 0 0 .708 0L4.5 26.5m-2 12 .646.646a.5.5 0 0 0 .708 0L4.5 38.5m-2 12 .646.646a.5.5 0 0 0 .708 0L4.5 50.5' stroke='#787878' stroke-linecap='round'/><path d='M0 4a4 4 0 0 1 4-4h21v12H0V4Z' fill='#0078D4'/></g></svg>"}})),
define("_generated/MsPortalImpl/Svg/Library/StartupPages/Dashboard.svg",["require","exports"],(function(e,t){"use strict";return{type:1,data:"<svg viewBox='0 0 100 60' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><rect width='99' height='59' x='.5' y='.5' stroke='#000' rx='3.5' class='msportalfx-svg-c01'/><path stroke='#000' d='M.5 4A3.5 3.5 0 0 1 4 .5h17A3.5 3.5 0 0 1 24.5 4v55.5H4A3.5 3.5 0 0 1 .5 56V4z'/><path stroke='#000' d='M.5 4A3.5 3.5 0 0 1 4 .5h92A3.5 3.5 0 0 1 99.5 4v7.5H.5V4z' class='msportalfx-svg-c01'/><path fill='#A19F9D' d='M33 22h10v10H33zm0 12h10v3H33zm32-12h10v10H65zm0 12h10v3H65zm16-12h10v10H81zm0 12h10v3H81zM49 22h10v10H49zm0 12h10v3H49zm-16 8h58v3H33zm0 5h58v3H33z'/><rect width='99' height='59' x='.5' y='.5' stroke='#D2D2D2' rx='3.5' class='msportalfx-svg-c01'/><path fill='#0078D4' d='M0 4a4 4 0 0 1 4-4h92a4 4 0 0 1 4 4v8H0V4z'/><path fill='#D2D2D2' d='M10 19h24.652v18H10zm29 0h24.652v18H39zm29 0h24.652v18H68z'/></g></svg>"}})),
define("_generated/MsPortalImpl/Svg/Library/StartupPages/Home.svg",["require","exports"],(function(e,t){"use strict";return{type:1,data:"<svg viewBox='0 0 100 60' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><rect width='99' height='59' x='.5' y='.5' stroke='#D2D2D2' rx='3.5' class='msportalfx-svg-c01'/><path fill='#0078D4' d='M0 4a4 4 0 0 1 4-4h92a4 4 0 0 1 4 4v8H0V4z'/><path fill='#D2D2D2' d='M18 22h10v10H18zm0 12h10v3H18zm36-12h10v10H54zm0 12h10v3H54zm18-12h10v10H72zm0 12h10v3H72zM36 22h10v10H36zm0 12h10v3H36zm-18 8h64v3H18zm0 5h64v3H18z'/></g></svg>"}})),
define("MsPortalImpl/Weave/Components/SettingsFlyout",["require","exports","Fx","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/Themes","MsPortalImpl/Base/Languages","MsPortalImpl/Base/Base.ImplUtils","Weave","MsPortalImpl/Services/Services.GeneralSettings","MsPortalImpl/Services/Services.Settings","MsPortalImpl/Services/Services.Storage","MsPortalImpl/Services/Services.Tenants","MsPortalImpl/Services/Services.Subscriptions","MsPortalImpl/Services/Services.FavoritesSettings","MsPortalImpl/Services/Services.GlobalResourceFilters","MsPortalImpl/Services/Services.ProjectedDirectories","MsPortalImpl/UI/UI.AuthStateManager","MsPortalImpl/UI/UI.DialogManager","MsPortalImpl/UI/UI.NavigationManager","MsPortalImpl/UI/Hubs/UI.NotificationManager","MsPortalImpl/Notifications/ContactabilityHelper","FxInternal/Composition/ContainerViewModel","MsPortalImpl.Controls/Controls/Base/Base","Fx/Controls/Button","Fx/Controls/DropDown","FxInternal/Controls/CheckBox","Fx/Controls/InfoBox","Fx/Controls/NumericTextBox","Fx/Controls/TextBox","Fx/Controls/Toggle","Fx/Controls/RadioButtons","Fx/Controls/SearchBox","Fx/Controls/DataGrid","Fx/Controls/Summary","Fx/UriBuilder","MsPortalImpl/Widgets/Widgets.CommandBar","FxInternal/Weave","Fx/Telemetry","Fx/Ajax","MsPortalImpl/Services/Services.Tenants","MsPortalImpl/Services/Services.SecurityTokens","MsPortalImpl/UI/UI.BladeOpener","Fx/Composition/Selectable","MsPortalImpl/Weave/Components/SettingsFlyoutHelpers","MsPortalImpl/UI/UI.PassthroughUser","Fx/Controls/DropDown","MsPortalImpl/Resources/UpdateContactModalClientStrings","MsPortalImpl/Shared/Constants","_oss/fuse","_oss/luxon","_generated/MsPortalImpl/Svg/Library/MenuBehaviors/MenuFlyout.svg","_generated/MsPortalImpl/Svg/Library/MenuBehaviors/MenuDocked.svg","_generated/MsPortalImpl/Svg/Library/HighContrastModes/HighContrastWhite.svg","_generated/MsPortalImpl/Svg/Library/HighContrastModes/HighContrastBlack.svg","_generated/MsPortalImpl/Svg/Library/StartupPages/Home.svg","_generated/MsPortalImpl/Svg/Library/StartupPages/Dashboard.svg","_generated/MsPortalImpl/Svg/Library/ServiceMenuCollapseBehavior/CollapsedByDefault.svg","_generated/MsPortalImpl/Svg/Library/ServiceMenuCollapseBehavior/ExpandedByDefault.svg","Fx/Experimentation","MsPortalImpl/Base/Themes","MsPortalImpl/Widgets/PersonalizedSurvey.Data","MsPortalImpl/Widgets/Widgets.PersonalizedSurvey","Fx/Controls/Validations"],(function(e,t,i,s,a,n,o,r,l,c,u,d,m,p,g,h,f,v,x,b,y,w,C,I,S,M,F,T,k,D,A,P,N,_,L,B,V,O,H,E,R,z,W,U,G,q,j,K,Z,Q,J,X,Y,ee,te,ie,se,ae,ne,oe,re,le,ce,ue,de){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEV=t.createFlyout=t.MoreAzureResourcesViewModel=t.SignoutAndNotificationSettingsViewModel=t.MyInformationSettingsViewModel=t.LanguageAndRegionSettingsViewModel=t.AppearanceAndStartupSettingsViewModel=t.FilterSettingsViewModel=t.DirectorySettingsViewModel=t.SettingsOverviewViewModel=t.ViewModel=t.initializeUsefulLinks=t.displaySystemThemeBubble=t.displayMyInfoBubble=t.telemetryTrace=t.mainContentClass=void 0;var me=MsPortalFx.Base,pe=me.Resources,ge=me.Images,he=me.Diagnostics,fe=he.Telemetry,ve=MsPortalFx.ViewModels.Toolbars,xe=MsPortalFx.Hubs.Notifications.NotificationStatus,be=MsPortalFx.Hubs.Notifications;const ye=window,we=$(document),Ce=he.createLog(e),Ie=ye.fx.environment,Se=n.UiSettings,Me=n.Directory,Fe=Se.HighContrastToggleOption,Te=n.Shell.Dialogs,ke=Se.Flyout,De=n.Themes.Names,Ae=n.Themes.SystemThemeBubble,Pe=ge.Star({palette:3}),Ne=ge.Favorite({palette:3}),_e=ge.StatusBadge.Success({palette:4}),Le=ee,Be=Y,Ve=se,Oe=ae,He=ee,Ee=te,Re=ie,ze=me.Resources.getAppRelativeUri("/api/Settings/DeleteAll");let We=fx.environment.meControl.appId;const Ue=new G.PdlBladeReference("InProductFeedbackBlade","HubsExtension",{parameters:{bladeName:"SettingsFlyout",cesQuestion:ke.cesQuestion,cvaQuestion:ke.cvaQuestion,extensionName:"Shell",featureName:"SettingsFlyout",surveyId:"SettingsFlyout082021"}}),Ge={Overview:0,DirectoriesAndSubscriptions:1,Filters:2,AppearanceAndStartup:3,LanguageAndRegion:4,MyInformation:5,SignoutAndNotifications:6},qe={DirectoriesAndSubscriptions:0,Filters:1,AppearanceAndStartup:2,LanguageAndRegion:3,MyInformation:4,SignoutAndNotifications:5},je=[{label:ke.appearanceAndStartupViewsTitle,view:"AppearanceAndStartup"},{label:ke.colorTheme,view:"AppearanceAndStartup"},{label:ke.highContrastTheme,view:"AppearanceAndStartup"},{label:ke.menuBehavior,view:"AppearanceAndStartup"},{label:ke.startupPage,view:"AppearanceAndStartup"},{label:ke.startupDirectory,view:"AppearanceAndStartup"},{label:ke.language,view:"LanguageAndRegion"},{label:ke.regionalFormat,view:"LanguageAndRegion"},{label:ke.signingOut,view:"SignoutAndNotifications"},{label:ke.notifications,view:"SignoutAndNotifications"},{label:ke.enableToasts,view:"SignoutAndNotifications"}],$e=(0,ce.getUserIntents)();let Ke=r.currentLocaleContext;const Ze=FxImpl.knownCulturesMap;let Qe=Ke?.selectableFormatCultures.map((e=>({text:ko.observable(e.localizedName),value:e.locale})));const Je=Object.create(null),Xe=MsPortalFx.ensureSuffix(pe.getAppRelativeUri("/"),"/"),Ye=(0,R.getEndpoints)().msGraph+"beta/policies/activityBasedTimeoutPolicies";let et;const tt={shouldSort:!0,includeScore:!0,includeMatches:!0,tokenize:!0,threshold:.3,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:[{name:"label",weight:.9},{name:"view",weight:.1}]};t.mainContentClass="fxs-settings-main";const it=[{text:Se.idleTimeoutNever,value:0},{text:Se.idleTimeout15Minutes,value:15},{text:Se.idleTimeout30Minutes,value:30},{text:Se.idleTimeout45Minutes,value:45},{text:Se.idleTimeout60Minutes,value:60},{text:Se.idleTimeout90Minutes,value:90},{text:Se.idleTimeout120Minutes,value:120},{text:Se.idleTimeoutCustom,value:-1}],st={1:"Overview",2:"DirectoriesAndSubscriptions",3:"Filters",4:"AppearanceAndStartup",5:"LanguageAndRegion",6:"MyInformation",7:"SignoutAndNotifications",9:"MoreAzureResources"},at={Overview:1,DirectoriesAndSubscriptions:2,Filters:3,AppearanceAndStartup:4,LanguageAndRegion:5,MyInformation:6,SignoutAndNotifications:7,MoreAzureResources:9},nt={Overview:ke.overviewTitle,DirectoriesAndSubscriptions:ke.directoriesTitle,Filters:ke.filtersTitle,AppearanceAndStartup:ke.appearanceAndStartupViewsTitle,LanguageAndRegion:ke.languageAndRegionTitle,MyInformation:ke.myInformationTitle,SignoutAndNotifications:ke.signoutAndNotificationsTitle,MoreAzureResources:ke.moreAzureResourcesTitle};function ot(e,t){(0,E.trace)({source:"SettingsFlyout",action:e,data:t})}async function rt(e){const t=await MsPortalFx.require("MsPortalImpl/Widgets/Widgets.TeachingBubble"),i=e.get(d.SettingsManager);if((await i.querySettings({store:7,keys:["MyInfoBubble"]})).MyInfoBubble)return;const s=(s=null)=>{const a=$.querySelectorAll(".fxs-settings-menu-item"),n=Array.from(a).find((e=>e.textContent===ke.myInformationTitle));n&&t.createTeachingBubble({teachingBubbleOptions:[{targetElement:n,directionalHint:"left",title:ke.MyInfoBubble.title,description:ke.MyInfoBubble.description}],onCompletion:()=>{i.setSetting(7,"MyInfoBubble",{viewed:+Date.now(),action:"complete"}),s?.disconnect()},onDismiss:()=>{i.setSetting(7,"MyInfoBubble",{viewed:+Date.now(),action:"dismiss"}),s?.disconnect()},isCoachmark:!1,diContainer:e,featureName:"PersonalizedSurveyMyInfoBubble"})},a=$.querySelectorAll(`.${ue.surveyRootClass}`);if(a.length>0){const e=a[0];new MutationObserver(((t,i)=>{for(const a of t)"childList"===a.type&&Array.from(a.removedNodes).includes(e)&&s(i)})).observe(document.body,{childList:!0,subtree:!0})}else s()}async function lt(e){const t=await MsPortalFx.require("MsPortalImpl/Widgets/Widgets.TeachingBubble"),i=e.get(d.SettingsManager);if((await i.querySettings({store:7,keys:["SystemThemeBubble"]})).SystemThemeBubble)return;const s=(s=null)=>{const a=$.querySelectorAll(".fxs-settings-thumbnail-frame"),n=Array.from(a).find((e=>De.system===e.textContent));n&&($(n).isInScrollView()||n.scrollIntoView(),setTimeout((()=>t.createTeachingBubble({teachingBubbleOptions:[{targetElement:n,title:Ae.title,description:Ae.description}],onCompletion:()=>{i.setSetting(7,"SystemThemeBubble",{viewed:+Date.now(),action:"complete"}),s?.disconnect()},onDismiss:()=>{i.setSetting(7,"SystemThemeBubble",{viewed:+Date.now(),action:"dismiss"}),s?.disconnect()},isCoachmark:!1,diContainer:e,featureName:"PersonalizedSurveySystemThemeBubble"})),200))},a=$.querySelectorAll(`.${ue.surveyRootClass}`);if(a.length>0){const e=a[0];new MutationObserver(((t,i)=>{for(const a of t)"childList"===a.type&&Array.from(a.removedNodes).includes(e)&&s(i)})).observe(document.body,{childList:!0,subtree:!0})}else s()}function ct(e,t,i,n){const o=async()=>{await(u?.refresh())};let r;const l=(0,_.create)(e,{update:async e=>(r=e,await o(),Promise.resolve(u?.rows().length)),hideSuggestions:!0}),u=(0,L.create)(e,{columns:[(0,L.createTemplateColumn)({id:"favorite",header:{ariaLabel:ke.favorite},canResize:!1,canSort:!1,cell:{template:'<div class="fxs-settings-svg fxs-settings-pointer" tabindex="0" data-bind="image: favoriteImage, attr: { \'data-isfavorite\': isFavorite }, fxclick: onToggleFavorite"></div>',viewModel:(e,t)=>({isFavorite:(0,H.toObservable)(t,e.isFavorite),favoriteImage:(0,H.toObservable)(t,e.favoriteImage),onToggleFavorite:()=>{const t=e.isFavorite.value;e.isFavorite(!t),ot("ToggleFavoriteDirectory",{directoryId:e.id,isFavorite:!t})}})},width:"15px"}),(0,L.createTextColumn)({id:"displayName",header:ke.directoryName,cell:{text:e=>e.displayName},canSort:!0}),(0,L.createTemplateColumn)({id:"state",header:{ariaLabel:Me.switchDirectoryLabel},canResize:!1,canSort:!1,cell:{template:s("div",{class:"fxs-settings-activatecell"},s(a.KoIf,{condition:"isCurrentDirectory"},s("div",{class:"fxs-settings-svg","data-bind":{image:"selectedIcon"}}),s("div",{"data-bind":{text:"currentLabel"}})),s(a.KoIfNot,{condition:"isCurrentDirectory"},s("div",{"data-bind":{pcControl:"switchButton"}}))),viewModel:(e,t)=>({isCurrentDirectory:e.isCurrentDirectory,currentLabel:ke.current,selectedIcon:_e,switchButton:(0,M.create)(t,{text:ke.switch,style:1,onClick:()=>n(e.id)})})}}),(0,L.createTextColumn)({id:"domainName",header:ke.domain,cell:{text:e=>e.domainName},canSort:!0}),(0,L.createTextColumn)({id:"id",header:ke.directoryId,cell:{text:e=>e.id},canSort:!0})],noDataMessage:Me.noDirectoriesFound,ariaLabel:t,dataSource:t=>{let s=function(e,t){let i=e.slice();if(t){const e=t.split(/\s+/).map((e=>new RegExp(MsPortalFx.regexEscape(e),"i")));e.length&&(i=i.filter((t=>{const i=[t.displayName,t.domainName];return e.every((e=>i.some((t=>e.test(t)))))})))}return i}((0,c.evaluate)(e,i),r);if(t.sortOrder?.length){const e=t.sortOrder[0],i=e.id;s=MsPortalFx.stableSort(s,((t,s)=>e.direction*MsPortalFx.compare(t[i],s[i])))}return s.map((e=>({id:e.id,item:e})))},selection:{selectionMode:0}});return(0,S.setTrustedViewModel)(u),(0,c.subscribeAndRun)(e,[i],(()=>{o()})),{gridVm:u,searchVm:l,title:t}}function ut(e){return[2,4].includes(e)?2:1}function dt(e){return[2,4].includes(e)?2:1}function mt(e){switch(e){case 0:return"Off";case 1:return"Light";case 2:return"Dark";default:return""}}function pt(e){switch(e){case 2:return"Dashboard";case 1:return"Home";case 4:return"InitAsDashboard";case 3:return"InitAsHome";default:return""}}function gt(e,t){ot("ThemeSelected",{mode:t.name}),e(t)}function ht(e,t,i){return{onClick:()=>{i(e,"menu")},item:{value:e,text:t.title}}}function ft(e,i,s,a,n){return MsPortalFx.Base.Promises.cancelOnDispose(a,(()=>s.getAsync(b.DialogManager).then((s=>function(e,i,s,a){return e.showDialog({telemetryName:"settings flyout dialog",type:I.Dlg2,title:a.title,content:a.content,buttons:a.buttons||[]},i,s.find(`.${t.mainContentClass}`)[0],{locator:null,modal:!1,trustedTemplate:!0,sideload:!0})}(s,i,e,n)))))}function vt(e){return(e||"").toLowerCase()}function xt(e){return("0"+e).slice(-2)}function bt(e,t,i){const s=JSON.stringify(((t.jqXHR||{}).responseJSON||{}).error,null,4);fe.trace({source:"SettingsFlyout",action:i,actionModifier:"failed",data:s}),yt(e,s,Se.TenantIdleTimeout.notificationFetchError)}function yt(e,t,i){e.get(w.NotificationManager).addClientNotification({title:Se.TenantIdleTimeout.notificationTitle,description:i.format(t),status:be.NotificationStatus.Error,timestamp:new Date})}async function wt(e){const{tenantId:t,source:i,diContainer:s}=e,a=Je[t];if(!a)return void console.warn(`Can't find tenant with ID "${t}" in map`);const n={domain:a.domainName,tenantId:a.id,source:i},o=s.get(x.AuthStateManager),r=o.getCurrentUser();if(r&&vt(t)!==vt(r.tenantId)){ot("SwitchTenant",n);const e=l.getHashQueryStringSegment(location.href),t=s.get(FxImpl.Features).isEnabled("preferredusername")?r.preferredUsername:r.emailAddress,i=await s.getAsync(d.SettingsManager);await i.flushSettings();const u=new V((c=o.bootstrapState.loginReplyUrlPath,Xe+c.slice(1)));u.path+="@"+a.domainName,l.redirectWithCdn(s,{uri:u.toString(),parameters:t?{loginHint:t}:null,hash:e,redirectAction:2})}var c}function Ct(e){return[0,15,30,45,60,90,120].includes(e)}function It(e){return e.map((e=>({type:(0,c.makeWritableComputation)(e.type),operator:(0,c.makeWritableComputation)(e.operator),value:(0,c.makeArrayComputation)(Array.isArray(e.value)?e.value:[e.value])})))}function St(e){return{displayName:e.displayName,domainName:e.domainName,id:e.id,isCurrentDirectory:e.isCurrentDirectory}}async function Mt(e,t){try{(0,ce.checkPersonalizedSurveyEligibility)(e)&&await(0,ce.deleteSurvey)(),await t(),e.get(m.StorageService).clearAll();const i=new me.UriBuilder(location.pathname+location.search);i.query.removeParameter("l"),e.get(FxImpl.Features).isEnabled("msaljs")&&(i.path=e.get(x.AuthStateManager).bootstrapState.loginReplyUrlPath),e.get(y.WindowManager).redirect({uri:i.toString(),reason:"clearSettingsAndReloadPortal"})}catch(t){e.get(w.NotificationManager).addClientNotification({title:Se.resetSettingsErrorTitle,description:n.genericErrorMessage,status:xe.Error,timestamp:new Date})}}function Ft(e,t){return[new ve.FileDownloadButton({label:ke.exportSettings,icon:ge.Download(),name:"exportsettings",targetUri:ko.observable(me.Resources.getAbsoluteUri("/api/Settings/ExportAll")),targetFileName:ko.observable("settings.json"),httpMethod:ko.observable("POST"),addDefaultAuthorizationToken:!0}),new ve.CommandButton({label:Se.resetStateLabel,icon:ge.Undo(),name:"restoredefaultsettings",command:{canExecute:ko.observable(!0),execute:async()=>{const{diContainer:i,confirm:s}=t;4===await s(e,{title:Se.resetStateLabel,content:Te.reloadMessageDescription,buttons:[{displayText:ke.restore,button:4},{displayText:ke.cancel,button:1}]})&&(ot("RestoreDefaultSettings"),await Mt(i,(()=>i.get(d.SettingsManager).clearSettings())))}}}),new ve.CommandButton({label:Se.deleteAllLabel,icon:ge.TrashOutline(),name:"deleteallsettings",command:{canExecute:ko.observable(!0),execute:async()=>{const{diContainer:i,confirm:s}=t;4===await s(e,{title:Se.deleteAllLabel,content:Te.deleteSettingsDescription,buttons:[{displayText:ke.delete,button:4},{displayText:ke.cancel,button:1}]})&&(ot("DeleteAllSettingsAndPrivateDashboards"),Mt(i,(()=>(0,R.ajax)({uri:ze,type:"POST"}))))}}})]}t.telemetryTrace=ot,t.displayMyInfoBubble=rt,t.displaySystemThemeBubble=lt,t.initializeUsefulLinks=function(e){const t=window.fx.environment.links,i=[{url:t.settingsLearnMore,text:ke.learnMore,target:"_blank",telemetryAction:"SettingsLearnMoreLinkClicked"},{url:t.settingsSafeListUrls,text:ke.safelistUrls,target:"_blank",telemetryAction:"SafelistUrlsLinkClicked"},{url:"#blade/Microsoft_Azure_Billing/managementpartnerblade",text:ke.partnerNetwork,target:"_self",telemetryAction:"PartnerNetworkLinkClicked",className:"fxs-settings-management-partner-link"},{url:t.privacyStatement,text:ke.privacyStatement,target:"_blank",telemetryAction:"PrivacyStatementLinkClicked"}];return function(e){return"fr-fr"===e?.selectedFormatCulture?.toLowerCase()&&"fr"===e?.selectedDisplayLanguage}(e)&&i.push({url:"https://go.microsoft.com/fwlink/?linkid=2121428",text:"Accessibilité: partiellement conforme",target:"_blank",telemetryAction:"FrenchConformanceLinkClicked"}),function(e){return"it-it"===e?.selectedFormatCulture?.toLowerCase()&&"it"===e?.selectedDisplayLanguage}(e)&&i.push({url:"https://go.microsoft.com/fwlink/?linkid=2121429",text:"Dichiarazione di accessibilità",target:"_blank",telemetryAction:"ItalianConformanceLinkClicked"}),i};t.ViewModel=class{constructor(e){this.isLoading=(0,c.makeWritableComputation)(!0),this._settingsViewState=e.settingsView;const t=this.diContainer=e.diContainer;this._bladeOpener=this.diContainer.get(U.BladeOpener);const i=t.get(FxImpl.Features),s=this.showOverview=!i.isEnabled("hidesettingsoverview");this.showDirectoriesAndSubscriptionsView=!(i.isEnabled("hidedirectorypanebutton")||ye?.chrome?.hideDirectoryPaneButton),this.showMoreAzureResourcesLink=!i.isEnabled("hidemoreazrsrc"),this.showFeedbackLink=!i.isEnabled("hideazfb");let a="Overview";s||(a=this.showDirectoriesAndSubscriptionsView?"DirectoriesAndSubscriptions":"AppearanceAndStartup"),this.currentView=this._settingsViewState.compose((e=>st[e]??a));const n=this.flyoutLifetime=e.lifetime,o=[...je],r=i.isEnabled("contactinfo"),l=(0,ce.checkPersonalizedSurveyEligibility)(t);this.showMyInformation=r||l;const u=s?Ge:qe;t.get(g.SubscriptionsUserContext).useAdvancedFiltersPromise.then((e=>{const i=new Array(Object.keys(qe).length),a=this.directorySettingsVm=new kt(n,t,e,((e,t)=>this._confirmationCallback(e,t)),((e,t)=>this.navigateToSettingsTab(e,t)));this.showDirectoriesAndSubscriptionsView&&(i[u.DirectoriesAndSubscriptions]=ht("DirectoriesAndSubscriptions",a,((e,t)=>this.navigateToSettingsTab(e,t))),o.push({label:ke.directoriesTitle,view:"DirectoriesAndSubscriptions"},{label:Me.switchDirectoryLabel,view:"DirectoriesAndSubscriptions"},{label:ke.favoriteDirectories,view:"DirectoriesAndSubscriptions"}),e&&(this.filterSettingsVm=new Dt(n,t,((e,t)=>this._confirmationCallback(e,t))),i[u.Filters]=ht("Filters",this.filterSettingsVm,((e,t)=>this.navigateToSettingsTab(e,t))),o.push({label:ke.filtersTitle,view:"Filters"},{label:ke.createFilter,view:"Filters"},{label:ke.subscriptionId,view:"Filters"},{label:ke.subscriptionName,view:"Filters"},{label:ke.subscriptionState,view:"Filters"})));const d=s?"Overview":"MyInformation";o.push({label:ke.exportSettings,view:d},{label:Se.resetStateLabel,view:d},{label:Se.deleteAllLabel,view:d});const m=this.appearanceSettingsVm=new At(n,t,{loadedTenantsPromise:a.tenantsLoadedPromise});i[u.AppearanceAndStartup]=ht("AppearanceAndStartup",m,((e,t)=>this.navigateToSettingsTab(e,t)));const p=this.languageAndRegionSettingsVm=new Pt(n,t,((e,t)=>this._confirmationCallback(e,t)));i[u.LanguageAndRegion]=ht("LanguageAndRegion",p,((e,t)=>this.navigateToSettingsTab(e,t))),this.myInformationSettingsVm=new Nt(n,t,{confirm:(e,t)=>this._confirmationCallback(e,t),enableEmailUpdate:r,showDirectories:this.showDirectoriesAndSubscriptionsView,enablePersonalizationOptions:l}),i[u.MyInformation]=ht("MyInformation",this.myInformationSettingsVm,((e,t)=>this.navigateToSettingsTab(e,t))),o.push({label:ke.myInformationTitle,view:"MyInformation"},{label:ke.emailAddress,view:"MyInformation"}),(0,c.subscribeAndRun)(n,[this._settingsViewState],(e=>{6===e&&(this.myInformationSettingsVm.isLoading(!0),Promise.all([this.myInformationSettingsVm.loadProfile(),this.myInformationSettingsVm.loadUserIntentSurvey()]).then((()=>{this.myInformationSettingsVm.isLoading(!1)})))}));const g=this.moreAzureResourcesVm=new Lt(t),h=this.signoutAndNotificationSettingsVm=new _t(n,t);if(i[u.SignoutAndNotifications]=ht("SignoutAndNotifications",h,((e,t)=>this.navigateToSettingsTab(e,t))),h.isTenantAdmin&&o.push({label:Se.TenantIdleTimeout.checkboxLabel,view:"SignoutAndNotifications"}),h.idleTimeoutFromTokenInMinutes>1?o.push({label:Se.idleTimeoutOverrideLabel,view:"SignoutAndNotifications"}):h.idleTimeoutFromTokenInMinutes||o.push({label:ke.signoutInactive,view:"SignoutAndNotifications"}),s){const e=this.overviewVm=new Tt(n,{diContainer:t,directorySettingsVm:a,appearanceSettingsVm:m,languageAndRegionSettingsVm:p,myInformationSettingsVm:this.myInformationSettingsVm,signoutAndNotificationSettingsVm:h,filterSettingsVm:this.filterSettingsVm,confirm:(e,t)=>this._confirmationCallback(e,t),showDirectories:this.showDirectoriesAndSubscriptionsView,moreAzureResourcesVm:g});i[Ge.Overview]=ht("Overview",e,((e,t)=>this.navigateToSettingsTab(e,t)))}this.settingsNavItems=i.filter((e=>e&&!e.hidden)),this.isLoading(!1),l&&6!==this._settingsViewState.value&&rt(t);t.get(re.Experimentation).shellAssignments.getBooleanValue(le.noHCThemesFlag)&&(0,c.subscribeAndRun)(n,[this._settingsViewState],(e=>{4===e&&lt(t)}))}));const d=e=>{if(!e)return[];let t=new J(o,tt).search(e);t=t.filter((e=>e.score<=tt.threshold));return(t.reduce(((e,t)=>(t.score<=tt.threshold&&e.push(t),e)),[])||[]).sort(((e,t)=>e.score-t.score)).map((e=>e.item)).filter(MsPortalFx.identity)};let m;this.menuSearch=(0,_.create)(n,{ariaLabel:ke.searchMenu,placeHolderText:ke.searchMenu,update:e=>{const t=d(e);return Promise.resolve(t.map((e=>{const{view:t,label:i}=e,s=nt[t];return s===i?i:ke.searchResultFormat.format(s,i)})))},submit:(e,t)=>{const i=e.includes("|")?e.split("|")[1].trim():e,s=MsPortalFx.find(o,(e=>e.label===i))?.view;if(s)return this.navigateToSettingsTab(s,"SearchMenu"),Promise.resolve(!0);const a=d(t);return a.length?(this.navigateToSettingsTab(a[0].view,"SearchMenu"),Promise.resolve(!0)):Promise.resolve(!0)}}),(0,c.subscribeAndRun)(n,[this._settingsViewState],(e=>{MsPortalFx.isNullOrUndefined(m)||0===m?setTimeout((()=>this._element.find("input").eq(0).focus()),200):0===e&&this.menuSearch?.reset(),m=e}))}onClose(){this._currentTabIsClean()&&(ot("ClosedWithXButton"),this._settingsViewState(0))}navigateToSettingsTab(e,t){this._currentTabIsClean()&&(ot("OpenSettingsTab",{item:e,source:t}),this._settingsViewState(at[e]))}openFeedbackPane(){this._bladeOpener?.openBlade(Ue,{flags:1,telemetryName:"SettingsFlyout.InProductFeedbackBlade"})}initializeElement(e,t,i){if(this._element||this._formTarget)throw"Already initialized";this._element=t,this._formTarget=i,this._attachEventHandlers(e)}_attachEventHandlers(e){const t=(t,i,s,a)=>{t.on(i,s,a),e&&e.registerForDispose((()=>{t.off(i,s,a)}))};t(this._element,"keydown",".fxs-settings-menu-list > .fxs-settings-menu-item",(e=>{switch(e.which){case 38:$(e.currentTarget).prev()?.focus();break;case 40:e.preventDefault(),$(e.currentTarget).next()?.focus();break;case 9:e.preventDefault(),this._element.find(".fxs-settings-menu-footer a").first().focus();break;case 32:$(e.currentTarget).click();break;default:return!0}return!1})),t(we,"keydown",null,(e=>{if(0!==this._settingsViewState.value)return 27===e.which?(e.preventDefault(),this._currentTabIsClean()&&this._settingsViewState(0),!1):void 0}))}_currentTabIsClean(){const e=(0,c.evaluate)(this.flyoutLifetime,this.currentView),t=this._getVmForView(e),i=t;let s=!1;if(t&&i.dirty&&(s=(0,c.evaluate)(this.flyoutLifetime,i.dirty)),s){if(!this.diContainer.get(y.Browser).confirm(n.Desktop.confirmEditScopeDiscard))return!1;i.revertChanges&&i.revertChanges()}return!0}_confirmationCallback(e,t){return ft(this._element,this._formTarget,this.diContainer,e,t)}_getVmForView(e){switch(e){case"AppearanceAndStartup":return this.appearanceSettingsVm;case"DirectoriesAndSubscriptions":return this.directorySettingsVm;case"LanguageAndRegion":return this.languageAndRegionSettingsVm;case"MyInformation":return this.myInformationSettingsVm;case"SignoutAndNotifications":return this.signoutAndNotificationSettingsVm;case"Filters":return this.filterSettingsVm;case"Overview":return this.overviewVm;case"MoreAzureResources":return this.moreAzureResourcesVm;default:throw`ViewModel for view "${e}" could not be located`}}};class Tt{constructor(e,t){this._ltm=e,this.title=nt.Overview,this.filtersGrid=(0,c.makeWritableComputation)();const i=t.directorySettingsVm.recentDirectories;if(t.showDirectories){const e=this.recentDirectoriesGrid=(0,L.create)(this._ltm,{ariaLabel:ke.directoriesTitle,noDataMessage:Me.noDirectoriesFound,dataSource:()=>(0,c.evaluate)(this._ltm,i).map((e=>({id:e.id,item:e}))),columns:[(0,L.createTextColumn)({id:"name",header:{ariaLabel:ke.directoryName},canSort:!1,cell:{text:e=>e.displayName}}),(0,L.createTemplateColumn)({id:"switchdirectory",header:{ariaLabel:Me.switchDirectoryLabel},canResize:!1,canSort:!1,width:"20%",cell:{template:s("div",{class:"fxs-settings-activatecell"},s(a.KoIf,{condition:"isCurrentDirectory"},s("div",{class:"fxs-settings-svg","data-bind":{image:"selectedIcon"}}),s("div",{"data-bind":{text:"currentLabel"}})),s(a.KoIfNot,{condition:"isCurrentDirectory"},s("div",{"data-bind":{pcControl:"switchButton"}}))),viewModel:(e,t)=>({isCurrentDirectory:e.isCurrentDirectory,currentLabel:ke.current,selectedIcon:_e,switchButton:(0,M.create)(t,{text:ke.switch,style:1,onClick:()=>this._switchDirectory(e.id)})})}})]});(0,S.setTrustedViewModel)(e),(0,c.subscribeAndRun)(this._ltm,[i],(()=>{e.refresh()}))}const n=t.filterSettingsVm;if(n){const e=(0,L.create)(this._ltm,{ariaLabel:ke.filtersTitle,columns:[(0,L.createTextColumn)({id:"filtername",canSort:!1,header:{ariaLabel:ke.filterName},cell:{text:(e,t)=>(0,c.evaluate)(t,e.name)}}),(0,L.createTemplateColumn)({id:"activefilter",header:{ariaLabel:ke.active},canResize:!1,canSort:!1,width:"20%",cell:{template:s("div",{class:"fxs-settings-activatecell"},s(a.KoIf,{condition:"isActive"},s("div",{class:"fxs-settings-activatecell"},s("div",{class:"fxs-settings-svg","data-bind":{image:"successIcon"}}),s("div",null,ke.active))),s(a.KoIfNot,{condition:"isActive"},s("div",{"data-bind":{pcControl:"switchButton"}}))),viewModel:(e,t)=>{const i=ko.observable(!!e.resourceCountsPromise),s=ko.observable(!!e.resourceCountsPromise);return e.resourceCountsPromise&&(0,c.subscribeAndRun)(t,[e.resourceCountsPromise],(e=>{i(!0),s(!0),e.then((e=>{s(0===e.subscriptions)}),(()=>{s(!1)})).finally((()=>i(!1)))})),{isActive:(0,H.toObservable)(this._ltm,n.selectedFilterId.compose((t=>e.id===t))),successIcon:_e,switchButton:(0,M.create)(t,{text:ke.activate,disabled:s,loading:i,loadingText:ke.countsLoading,style:1,onClick:()=>n.onClickActivateFilter(e.id)})}}}})],dataSource:()=>{const e=[{id:"",facets:(0,c.makeArrayComputation)([]),name:(0,c.makeConstantComputation)(ke.default),resourceCountsPromise:null}],t=(0,c.evaluate)(this._ltm,n.selectedFilterId);if(""===t)e.push(...n.globalResourceFilters.value.slice(0,2));else{const i=n.globalResourceFilters.value,s=i.slice(0,2);if(s.map((e=>e.id)).includes(t))e.push(...s);else{const a=MsPortalFx.find(i,(e=>e.id===t));a?e.push(a,...s.slice(0,1)):e.push(...s)}}return e.map((e=>({id:`${e.id}.${(0,c.evaluate)(this._ltm,e.name)}`,item:e})))}});(0,S.setTrustedViewModel)(e),(0,c.subscribeAndRun)(this._ltm,[n.globalResourceFilters.cMap((e=>e.name)),n.selectedFilterId],(()=>e.refresh())),this.filtersGrid(e)}this._switchDirectory=e=>wt({diContainer:t.diContainer,tenantId:e,source:"recents"});(this.commandBar=new O.ViewModel).setItems(Ft(this._ltm,{diContainer:t.diContainer,confirm:t.confirm}))}}t.SettingsOverviewViewModel=Tt;class kt{constructor(e,t,s,a,o){this._ltm=e,this._diContainer=t,this._confirm=a,this._navigateToSettingsTab=o,this.title=nt.DirectoriesAndSubscriptions,this.currentDirectoryName=(0,c.makeWritableComputation)(),this.currentDomainName=(0,c.makeWritableComputation)(),this.allTenants=(0,c.makeArrayComputation)(),this.subscriptionText=(0,c.makeWritableComputation)(),this.showSubscriptionFilterLabel=(0,c.makeWritableComputation)(!1),this.activeTabIndex=(0,c.makeWritableComputation)(0),this.pimEnabled=(0,c.makeWritableComputation)(!1),this.finishedLoading=(0,c.makeWritableComputation)(!1),this.passthroughUser=(0,c.makeWritableComputation)(!1),this._currentDirectoryId=(0,c.makeWritableComputation)("");const r=this._diContainer.get(FxImpl.Features);this.recentDirectories=(0,c.composeComputation)([this.allTenants],(e=>{const t=e.map((e=>vt(e.id))),s=this._diContainer.get(h.UserDirectorySettings),a=Object.create(null),o=s.recentDirectoriesList().reduce(((i,s)=>{const n=t.indexOf(s);if(n>-1){const t=e[n];i.push(St(t)),a[t.id]=!0}return i}),[]);let r=0;for(;o.length<3&&o.length<t.length;){const t=e[r++];a[t.id]||o.push(St(t))}const l=Object.create(null);return o.forEach(((e,t)=>{const i=l[e.displayName];i?i.push(t):l[e.displayName]=[t]})),i.forEachKey(l,((e,t)=>{1!==t.length&&t.forEach((e=>{const t=o[e];t.displayName=n.Directory.defaultDirValue.format(t.displayName,t.domainName)}))})),o}));const l=this.allTenants.cFilter((e=>e.isFavorite));this.tenantsLoadedPromise=this._initialize().then((()=>this.allTenants.value));const u=this._diContainer.get(h.UserDirectorySettings);(0,c.subscribe)(this._ltm,[l],(e=>{u.favoriteDirectoriesList(e.map((e=>e.id)))})),this.startupDirectoryName=(0,c.composeComputation)([(0,H.toComputation)(u.signInToLastVisitedDirectory),(0,H.toComputation)(u.userDefaultDirectory)],((e,t)=>!1!==e?n.Directory.lastVisited:t.displayName)),this.showSwitchDirectoryOption=!r.isEnabled("hideswitchdiroption");const m=e=>wt({diContainer:this._diContainer,source:"directoriesView",tenantId:e});if(this.allDirectoriesTab=ct(this._ltm,Me.allDirectories,this.allTenants,m),this.favoritesTab=ct(this._ltm,Me.favorites,l,m),this._enableMspFilter=r.isEnabled("mspfilter"),this.showBasicSubscriptionFilter=!s,r.isEnabled("globalresourcefilter")){const e=this.advancedFiltersToggle=(0,P.create)(this._ltm,{ariaLabel:ke.filtersTitle,label:ke.filtersTitle,infoBalloonContent:ke.advancedSubsFilterDescription,value:s,suppressDirtyBehavior:!0,cssClass:"fxs-settings-section-title"});(0,S.setTrustedViewModel)(e);let t=!1;e.value.subscribe(this._ltm,(async i=>{if(t)return void(t=!1);t=!1;const s=i?n.filtersOptInConfirmTitle:ke.filtersOptOutDialogTitle,a=i?n.filtersOptInConfirmMessage:ke.filtersOptOutDialogMessage;4===await this._confirm(this._ltm,{title:s,content:a,buttons:[{displayText:ke.continue,button:4},{displayText:ke.cancel,button:1}]})?await(i?async function(e){const t=e.getAsync(f.ResourceFilterManager),i=fe.startTrace({source:"SettingsFlyout",action:"OptIntoGlobalResourceFilters"}),s=await t;try{const e=await s.createSelectedSubscriptionsFilter();e&&MsPortalImpl.sessionStorage.setItem("subscriptions_selected_migrated",e.id)}catch(e){fe.endTrace(i,"failed",{error:MsPortalFx.getLogFriendlyMessage(e)}),MsPortalImpl.sessionStorage.setItem("subscriptions_selected_migratefailed","true")}const a=await e.getAsync(d.SettingsManager);return a.setSetting(19,"optedIn","true"),await a.flushSettings(),fe.completeTrace(i,{result:"completed"}),setTimeout((()=>e.get(y.WindowManager).redirect({reason:"optIntoGlobalFilters"})),500)}(this._diContainer):async function(e){const t=fe.startTrace({source:"SettingsFlyout",action:"OptOutOfGlobalResourceFilters"}),i=await e.getAsync(d.SettingsManager);return i.deleteSettings({store:19,keys:["optedIn"]}),await i.flushSettings(),fe.completeTrace(t),setTimeout((()=>{e.get(y.WindowManager).redirect({reason:"optOutOfGlobalFilters"})}),500)}(this._diContainer)):(t=!0,e.value(!i))}))}r.isEnabled("enablepiminglobalsettings")&&this.getEligibleAssignments().then((e=>{e.length>0&&this.pimEnabled(!0)})),Promise.all([(0,j.checkPassthroughUserWithNoSubs)(t),this.tenantsLoadedPromise]).then((([e,t])=>{this.passthroughUser(e),this.finishedLoading(!0)}))}async switchDirectory(){let e,t,i="favorites";0===this.activeTabIndex.value?t=this.favoritesTab.gridVm:(t=this.allDirectoriesTab.gridVm,i="allDirectories");const s=t.selection.selectedItems();1===s.length&&(e=s[0].id,await wt({diContainer:this._diContainer,tenantId:e,source:i}))}onActivateTab(e){const t=e.tabPageIndex;this.activeTabIndex(t),0===t&&this.favoritesTab.gridVm.refresh()}async _initialize(){const[{directoryId:e,uniqueDirectoryName:t},i,a]=await Promise.all([this._diContainer.get(x.AuthStateManager).getUserInfo(),this._diContainer.get(p.TenantsService).getHomeTenants(),this._diContainer.get(g.SubscriptionsUserContext).getGlobalDisplayedSubscriptions()]);this._currentDirectoryId(e);const n=this._diContainer.get(h.UserDirectorySettings);this.currentDirectoryName(t);const o=MsPortalFx.convertArrayToMap(n.favoriteDirectoriesList(),MsPortalFx.identity),r=a.length;r?(this.showSubscriptionFilterLabel(!0),1!==r||this._enableMspFilter&&a[0].tenantId!==e||this.subscriptionText(Me.oneSubscriptionText.format(a[0].displayName))):this.subscriptionText(Me.noSubscriptionText.format(this.currentDirectoryName.value));const l=MsPortalFx.stableSort(i||[],((e,t)=>{let i=MsPortalFx.localeCompareIgnoreCase(e.displayName,t.displayName);return i||(i=MsPortalFx.localeCompareIgnoreCase(e.domainName,t.domainName)),i}));let u=!1;l.forEach((t=>{if(!t)return;const i=!!o[t.id];u=u||i;const s=(0,c.makeWritableComputation)(i),a={displayName:t.displayName,domainName:t.domainName,id:t.id,tenantCategory:t.tenantCategory,isFavorite:s,favoriteImage:s.compose((e=>e?Pe:Ne)),isCurrentDirectory:e===t.id};a.isCurrentDirectory?this.allTenants.unshift(a):this.allTenants.push(a),Je[t.id]=t})),u||this.activeTabIndex(1);let d=!1;if(this._enableMspFilter){const e=await this._diContainer.getAsync(v.ServicesProjectedDirectories);d=await e.hasProjectedDirectories()}if(this.showBasicSubscriptionFilter?this.resourceFilter=new MsPortalFx.Azure.ResourceFilter.ViewModel(this._ltm,{showDirectoryFilter:d,showSubscriptionFilter:ko.observable(!0),showSubscriptionSummary:ko.observable(!1),isPersistentSubscriptionFilter:!0,context:ko.observable("SettingsFlyout")}):this.globalFilterDropDown=(0,F.create)(this._ltm,{ariaLabel:ke.advancedFilter,label:{htmlTemplate:s("span",{"data-bind":{text:"label"},class:"msportalfx-font-semibold"}),viewModel:{label:ke.advancedFilter}},items:[],multiselect:!1,selectAll:!1,subLabel:{htmlTemplate:s("a",{tabindex:"0","data-bind":{fxclick:"onClickModifyFilters",text:"modifyFilters"}}),viewModel:{onClickModifyFilters:()=>(this._navigateToSettingsTab("Filters","DirectoriesAndSubscriptions"),!1),modifyFilters:ke.modifyFilters}},filter:!0}),!this.showBasicSubscriptionFilter){const e=await this._diContainer.getAsync(f.ResourceFilterManager),t={id:"",name:ke.default,facets:[]};this.globalFilterDropDown.value.subscribe(this._ltm,(t=>e.activateFilter(t.id))),(0,c.subscribeAndRun)(this._ltm,[e.filters,e.currentFilter],((e,i)=>{this.globalFilterDropDown.items([t,...e].map((e=>({text:e.name,value:e}))));const s=i??t;this.globalFilterDropDown.value(s)}))}}async getEligibleAssignments(){const e=await(0,R.batch)({uri:"/providers/Microsoft.Authorization/roleEligibilityScheduleInstances?api-version=2020-10-01-preview&$filter=asTarget()&$count=true",type:"GET",setTelemetryHeader:"GlobalSettings.GetEligibleAssignments"});return e?.content?.value||Ce.warning("Invalid roleEligibilityScheduleInstances response"),e.content.value}}t.DirectorySettingsViewModel=kt;class Dt{constructor(e,t,i){this._ltm=e,this._diContainer=t,this._confirm=i,this.title=nt.Filters,this.selectedFilterId=(0,c.makeWritableComputation)(""),this.globalResourceFilters=(0,c.makeArrayComputation)([]),this._showingCreateFormImpl=(0,c.makeWritableComputation)(!1),this._canAddFilter=(0,c.makeWritableComputation)(!1),this._addingFilter=(0,c.makeWritableComputation)(!1),this.createFormIsDirty=(0,c.makeWritableComputation)(!1),this.modifyingFiltersAreDirty=(0,c.makeWritableComputation)(!1),this.importFailedInfoBox=(0,c.makeWritableComputation)(null),this._filterSettingsManagerPromise=this._diContainer.getAsync(f.ResourceFilterManager);let a=!1;if(this._initializeFilters().then((()=>{a=!0})),this.showAddFilterLink=(0,c.composeComputation)([this._canAddFilter,this._addingFilter],((e,t)=>e&&!t)),this.showingCreateForm=this._showingCreateFormImpl,this.showMaxFiltersMessage=this._canAddFilter.compose((e=>a&&!e)),et=null,this.getSubscriptionFilterFacetValues(),MsPortalImpl.sessionStorage.getItem("subscriptions_selected_migratefailed")){const t=(0,k.create)(e,{style:5,canClose:!0,onCloseClickCallback:()=>{MsPortalImpl.sessionStorage.removeItem("subscriptions_selected_migratefailed")},text:{htmlTemplate:s("div",null,s("span",{"data-bind":{text:"failedMessage"}})," ",s("a",{class:"fxs-settings-pointer",tabindex:"0","data-bind":{fxclick:"onClick",text:"retryMessage"}})),viewModel:{failedMessage:n.filtersOptInFailedMessage,retryMessage:n.tryAgain,onClick:async()=>{const e=await this._diContainer.getAsync(f.ResourceFilterManager),t=fe.startTrace({source:"SettingsFlyout",action:"RetryImportSelectedSubscriptionsFilter"});try{await e.createSelectedSubscriptionsFilter()}catch(e){return fe.endTrace(t,"failed",{error:MsPortalFx.getLogFriendlyMessage(e)}),void this._diContainer.get(w.NotificationManager).addClientNotification({title:n.filtersOptInFailedTitle,description:n.filtersOptInFailedMessage,status:xe.Error,timestamp:new Date})}this._diContainer.get(w.NotificationManager).addClientNotification({title:n.filtersOptInSuccessTitle,description:n.filtersOptInSuccessMessage,status:xe.Success,timestamp:new Date}),MsPortalImpl.sessionStorage.removeItem("subscriptions_selected_migratefailed"),this.importFailedInfoBox(null)}}}});(0,S.setTrustedViewModel)(t),this.importFailedInfoBox(t)}this.welcomeInfoBox=(0,k.create)(this._ltm,{canClose:!0,onCloseClickCallback:()=>{ot("FiltersWelcomeDismissed")},text:ke.advancedFilteringWelcome}),(0,S.setTrustedViewModel)(this.welcomeInfoBox),this.dirty=(0,c.composeComputation)([this.createFormIsDirty,this.modifyingFiltersAreDirty],((e,t)=>e||t))}async onClickActivateFilter(e){const t=await this._filterSettingsManagerPromise;ot("FilterActivated",{previousFilterId:((0,c.evaluate)(this._ltm,t.currentFilter)||{}).id||"",newActiveFilterId:e}),t.activateFilter(e)}async onClickDeleteFilter(e,t){const i=(0,c.evaluate)(this._ltm,t);if(4!==await this._confirm(this._ltm,{title:ke.deleteFilter,content:ke.confirmDeleteFilterFormat.format(i),buttons:[{displayText:ke.delete,button:4},{displayText:ke.cancel,button:1}]}))return;const s=await this._filterSettingsManagerPromise;ot("FilterDeleted",{filterId:e,filterName:i,newTotalFilterCount:(0,c.evaluate)(this._ltm,s.filters).length-1}),s.deleteFilter(e)}async createFilter(e,t){const i=(await this._filterSettingsManagerPromise).addFilter(e,t);this._addingFilter(!1),this._showingCreateFormImpl(!1),ot("FilterCreateNewComplete",{status:"completed",newFilter:i})}onClickAddFilter(){this._showingCreateFormImpl(!0),this._addingFilter(!0)}onClickCancelCreateNew(){this._showingCreateFormImpl(!1),this._addingFilter(!1),ot("FilterCreateNewComplete",{status:"abandoned"})}async updateFilter(e){(await this._filterSettingsManagerPromise).updateFilter(e),ot("FilterModifyComplete",{filterId:e.id,filterName:e.name,facetCount:e.facets.length,status:"completed"})}async revertFacets(e){const t=await this._filterSettingsManagerPromise,i=new FxImpl.TriggerableLifetimeManager,s=(0,c.evaluate)(i,t.filters);i.dispose();const a=MsPortalFx.find(s||[],(t=>t.id===e.id));if(!a)throw`Unable to locate filter with ID: "${e.id}"`;e.facets.setAll(It(a.facets)),ot("FilterModifyComplete",{status:"abandoned"})}async getSubscriptionFilterFacetValues(){return e=this._diContainer,et||(et=(0,q.getAllPossibleFacetValues)(e));var e}async _initializeFilters(){const e=await this._filterSettingsManagerPromise;(0,c.subscribeAndRun)(this._ltm,[e.canAddFilter],(e=>{this._canAddFilter(e)})),(0,c.subscribeAndRun)(this._ltm,[e.filters],(e=>{const t=this.globalResourceFilters.value.reduce(((e,t)=>(e[t.id]=t,e)),Object.create(null)),i=Object.create(null);e.forEach((e=>{const s=It(e.facets);i[e.id]=!0;const a=t[e.id];if(a)return a.resourceCountsPromise((0,q.getResourceCountsForFilter)(e,"SettingsFlyout")),void a.facets.setAll([...s]);this.globalResourceFilters.push({id:e.id,name:(0,c.makeWritableComputation)(e.name),facets:(0,c.makeArrayComputation)(s),resourceCountsPromise:(0,c.makeWritableComputation)((0,q.getResourceCountsForFilter)(e,"SettingsFlyout"))})}));const s=Object.keys(t).reduce(((e,t)=>(i[t]||(e[t]=!0),e)),Object.create(null));this.globalResourceFilters.removeIf((e=>s[e.id]))})),(0,c.subscribeAndRun)(this._ltm,[e.currentFilter],(e=>{this.selectedFilterId(e?.id||"")}))}}t.FilterSettingsViewModel=Dt;class At{async applyChanges(){const e=Object.create(null),t=this._diContainer.get(u.GeneralSettingsManager),s=t.value,a=this.selectedSidebarLayoutMode.value;s.sideBarLayout()!==a&&(e.newSidebarLayout=function(e){switch(e){case 2:case 4:return"Docked";case 1:case 3:return"FlyOut";default:return""}}(a),s.sideBarLayout(a));const n=this._diContainer.get(o.ThemeManager),r=this.selectedTheme.value,l=n.currentTheme();l.name!==r.name&&(e.oldTheme=l.name,e.newTheme=r.name),n.currentTheme(r);const d=this.selectedHighContrastMode.value,m=s.highContrastKey();m!==d&&(e.oldHighContrastMode=mt(m),e.newHighContrastMode=mt(d),e.newTheme&&await i.delay(200),s.highContrastKey(d));const p=this.selectedLandingPage.value;s.landingPage(p),e.newLandingPage=pt(p);const g=this._diContainer.get(h.UserDirectorySettings),f=this.startupDirectoryRadioButtons.value();g.signInToLastVisitedDirectory(f),e.signIntoLastDirectory=f;const v=f?(0,c.evaluate)(this._ltm,this._currentDirectoryId):this.selectedSignInDirectoryId.value,x=Je[v];x&&(MsPortalImpl.localStorage.setItem("SavedDefaultDirectory",x.id),e.newDefaultDirectoryId=x.id,g.userDefaultDirectory(x)),s.defaultMenuCollapseState()!==this.selectedDefaultMenuCollapseState.value&&(e.newDefaultMenuCollapseState=(0,u.stringifyDefaultMenuCollapseState)(this.selectedDefaultMenuCollapseState.value),s.defaultMenuCollapseState(this.selectedDefaultMenuCollapseState.value)),t.flush(),ot("AppearanceAndStartupSettingsApplied",e)}revertChanges(){this.selectedSidebarLayoutMode(ut((0,c.evaluate)(this._ltm,this.savedSidebarLayoutMode))),this.selectedHighContrastMode((0,c.evaluate)(this._ltm,this.savedHighContrastMode)),this.selectedTheme((0,c.evaluate)(this._ltm,this.savedTheme));const e=(0,c.evaluate)(this._ltm,this.savedSignInToLastDirectory),t=(0,c.evaluate)(this._ltm,this.savedSignInDirectoryId);this.selectedLandingPage((0,c.evaluate)(this._ltm,this.savedLandingPage)),this.selectedSignInToLastDirectory(e),this.selectedSignInDirectoryId(t),this.selectedDefaultMenuCollapseState((0,c.evaluate)(this._ltm,this.savedDefaultMenuCollapseStatus)),e||this.startupDirectoryDropDown.value(t),ot("AppearanceAndStartupSettingsReverted")}constructor(e,t,i){this._ltm=e,this._diContainer=t,this.title=nt.AppearanceAndStartup,this.themes=(0,c.makeWritableComputation)(),this.showDefaultDirectorySelector=(0,c.makeWritableComputation)(!1),this._currentDirectoryId=(0,c.makeWritableComputation)("");const r=t.get(FxImpl.Features);this.showLayoutOptions=r.isEnabled("sidebarhamburgermode")&&!Ie.chrome.hideSidebarNav;const l=r.isEnabled("azurehome");this.showStartupOptions=(0,c.composeComputation)([this.showDefaultDirectorySelector],(e=>e||l));const d=t.get(u.GeneralSettingsManager),m=d.value,p=this.selectedSidebarLayoutMode=(0,c.makeWritableComputation)(ut(m.sideBarLayout())),g=this.savedSidebarLayoutMode=(0,H.toComputation)(m.sideBarLayout).compose((e=>ut(e)));var f;this.sidebarLayoutModes=(f=p,[{onClick:()=>{f(1),ot("LayoutSelected",{mode:"flyout"})},item:{title:n.SideBarLayout.flyOut,value:1,svg:Be}},{onClick:()=>{f(2),ot("LayoutSelected",{mode:"docked"})},item:{title:n.SideBarLayout.docked,value:2,svg:Le}}]);const v=t.get(o.ThemeManager),x=this.selectedTheme=(0,c.makeWritableComputation)(v.currentTheme()),b=this.savedTheme=(0,H.toComputation)(v.currentTheme),y=()=>{this.themes(function(e,t){return e.getThemes().map((e=>({item:{value:e,title:e.title,svg:e.svg},onClick:()=>{gt(t,e)}})))}(v,x))};y();const w=(e,t)=>{!t&&y();const i=e||v.currentTheme();De.system===i.title&&gt(x,i)};v.updateThemesCallback=w;const C=this.selectedHighContrastMode=(0,c.makeWritableComputation)(m.highContrastKey());if(t.get(re.Experimentation).shellAssignments.getBooleanValue(le.noHCThemesFlag)){const e=C.value;if(C(0),0!==e){const[t,i,s]=v.getThemes();let a=i;2===e&&(a=s),w(a,!0)}}const I=this.savedHighContrastMode=(0,H.toComputation)(m.highContrastKey);this.highContrastModes=function(e){return[{onClick:()=>{e(0),ot("HighContrastModeSelected",{mode:"off"})},item:{title:Fe.off,value:0,svg:He}},{onClick:()=>{e(1),ot("HighContrastModeSelected",{mode:"white"})},item:{title:Fe.light,value:1,svg:Ee}},{onClick:()=>{e(2),ot("HighContrastModeSelected",{mode:"black"})},item:{title:Fe.dark,value:2,svg:Re}}]}(C),this.savedDefaultMenuCollapseStatus=(0,H.toComputation)(m.defaultMenuCollapseState).compose((e=>(0,u.effectiveMenuBehaviorSetting)(e))),this.selectedDefaultMenuCollapseState=(0,c.makeWritableComputation)((0,u.effectiveMenuBehaviorSetting)(m.defaultMenuCollapseState())),this.defaultMenuCollapseStatusOptions=function(e){return[{item:{title:Se.DefaultMenuCollapseState.collapsed,value:3,svg:ne},onClick(){e(3),ot("DefaultMenuCollapseStatusChanged",{mode:(0,u.stringifyDefaultMenuCollapseState)(3)})}},{item:{title:Se.DefaultMenuCollapseState.expanded,value:2,svg:oe},onClick(){e(2),ot("DefaultMenuCollapseStatusChanged",{mode:(0,u.stringifyDefaultMenuCollapseState)(2)})}}]}(this.selectedDefaultMenuCollapseState);const M=this._diContainer.get(u.GeneralSettingsManager).value,F=s("div",{class:"fxs-settings-previewsummary"},s("div",{class:"fxs-settings-previewicon","data-bind":{image:"icon"}}),s("span",{class:"fxs-settings-previewlabel","data-bind":{text:"label"}})),T=(e,t)=>({htmlTemplate:F,viewModel:{icon:t,label:e}}),k=T(n.SideBarLayout.docked,Le),D=T(n.SideBarLayout.flyOut,Be),A=v.getThemes().reduce(((e,t)=>(e[t.name]=T(t.title,t.svg),e)),Object.create(null)),P=T(Fe.off,He),_=T(Fe.light,Ee),L=T(Fe.dark,Re),V=dt(d.value.landingPage());this.selectedLandingPage=(0,c.makeWritableComputation)(V),this.savedLandingPage=(0,H.toComputation)(m.landingPage).compose((e=>dt(e))),this.landingPages=[{onClick:()=>{ot("LandingPageSelected",{newMode:pt(1)}),this.selectedLandingPage(1)},item:{svg:Ve,title:n.AzureHome.home,value:1}},{onClick:()=>{ot("LandingPageSelected",{newMode:pt(2)}),this.selectedLandingPage(2)},item:{svg:Oe,title:n.NavBar.home,value:2}}],this._initialize();const O=this._diContainer.get(h.UserDirectorySettings),E=!1!==O.signInToLastVisitedDirectory();this.selectedSignInToLastDirectory=(0,c.makeWritableComputation)(E),this.savedSignInToLastDirectory=(0,H.toComputation)(O.signInToLastVisitedDirectory).compose((e=>!1!==e));const R=O.userDefaultDirectory()?.id;this.selectedSignInDirectoryId=(0,c.makeWritableComputation)(R),this.savedSignInDirectoryId=(0,H.toComputation)(O.userDefaultDirectory).compose((e=>e.id));const z=this.startupDirectoryDropDown=this._setupDefaultDirectoryDropDown(i.loadedTenantsPromise,R);z.value.subscribe(this._ltm,this.selectedSignInDirectoryId);const W=(0,H.toObservable)(this._ltm,this.selectedSignInToLastDirectory);(this.startupDirectoryRadioButtons=(0,N.create)(e,{label:ke.startupDirectory,items:[{text:Me.lastVisited,value:!0},{text:{htmlTemplate:s("div",null,s("div",null,ke.selectDirectory),s(a.KoIf,{condition:"showDropDown"},s("div",{"data-bind":{pcControl:"directoryDropDown"}}))),viewModel:{showDropDown:ko.pureComputed((()=>!W())),directoryDropDown:z}},value:!1}],singleItemPerLine:!0,value:W})).value.subscribe(e,(e=>{ot("SignIntoLastDirectoryChanged",{newValue:e}),this.selectedSignInToLastDirectory(e)}));const U=[{label:ke.menuBehavior,value:ko.explicitComputed(this._ltm,M.sideBarLayout,(e=>2===ut(e)?k:D))},{label:ke.colorTheme,value:ko.explicitComputed(this._ltm,v.currentTheme,(e=>A[e.name]))},{label:ke.highContrastTheme,value:ko.explicitComputed(this._ltm,M.highContrastKey,(e=>{switch(e){case 1:return _;case 2:return L;default:return P}}))}].filter((e=>void 0!==e)),G=this.summary=(0,B.create)(this._ltm,{children:[{children:U},{children:[{label:ke.startupPage,value:ko.explicitComputed(e,d.value.landingPage,(e=>1===dt(e)?n.AzureHome.home:n.NavBar.home))},{label:ke.startupDirectory,value:ko.explicitComputed(e,O.userDefaultDirectory,(e=>e?.displayName||""))}]}]});(0,S.setTrustedViewModel)(G),this.dirty=(0,c.composeComputation)([p,g,x,b,C,I,this.selectedLandingPage,this.savedLandingPage,this.selectedSignInToLastDirectory,this.savedSignInToLastDirectory,this.selectedSignInDirectoryId,this.savedSignInDirectoryId,this.selectedDefaultMenuCollapseState,this.savedDefaultMenuCollapseStatus],((e,t,i,s,a,n,o,r,l,c,u,d,m,p)=>e!==t||i!==s||a!==n||o!==r||l!==c||u!==d||m!==p))}async _initialize(){const e=await this._diContainer.get(x.AuthStateManager).getUserInfo();this._currentDirectoryId(e.directoryId)}_setupDefaultDirectoryDropDown(e,t){const i=ko.observableArray([]),s=ko.observable();return e.then((e=>{const a=[];e.forEach((e=>{a.push({text:Me.defaultDirValue.format(e.displayName,e.domainName),value:e.id})})),e.length>1&&this.showDefaultDirectorySelector(!0),i(a);const n=Je[t];n&&s(n.id)})),(0,F.create)(this._ltm,{ariaLabel:Me.defaultDirLabel,items:i,filter:!0,filterPlaceholder:ke.search,multiselect:!1,value:s})}}t.AppearanceAndStartupSettingsViewModel=At;class Pt{async applyChanges(){const e=this._diContainer.get(u.GeneralSettingsManager),t=e.value,i=this.languagesDropDown.value(),s=this.regionalFormatDropDown.value()||this.sessionRegionalFormat,a=Ke.selectedDisplayLanguage,n=Ke.selectedFormatCulture,o=r.localeDelimiter;let l=i;const c=`${a}${o}${n}`;s&&(l+=`${o}${s}`);if(4!==await this._confirm(this._ltm,{title:ke.confirmLanguageTitle,content:ke.confirmLanguageMessage,buttons:2}))return;ot("LanguageAndRegionSettingsApplied",{currentLocale:c,newLocale:l}),t.rawLocale(l);const d=new me.UriBuilder(ye.location.href);d.query.removeParameter("l");const m={reason:"settingsApplied"};d.toString()!==ye.location.href&&(m.uri=d.toString()),await e.flush(),this._diContainer.get(y.WindowManager).redirect(m)}revertChanges(){this.languagesDropDown.value(this.sessionLanguage),this.regionalFormatDropDown.value(this.sessionRegionalFormat),ot("LanguageAndRegionSettingsReverted")}constructor(e,t,i){this._ltm=e,this._diContainer=t,this._confirm=i,this.title=nt.LanguageAndRegion;const s=Ke.selectableDisplayLanguages.map((e=>({text:ko.observable(e.localizedName),value:e.locale}))),a=MsPortalFx.find(s,(e=>Ke.selectedDisplayLanguage===e.value))||MsPortalFx.first(s);this.sessionLanguage=a.value;const n=MsPortalFx.find(Qe,(e=>Ke.selectedFormatCulture===e.value))||MsPortalFx.first(Qe);this.sessionRegionalFormat=n.value;const o=this.languagesDropDown=(0,F.create)(this._ltm,{ariaLabel:ke.language,label:ke.language,items:s,suppressDirtyBehavior:!0,value:a.value});(0,S.setTrustedViewModel)(o);const r=(0,H.toComputation)(o.value),l=this.regionalFormatDropDown=(0,F.create)(this._ltm,{ariaLabel:ke.regionalFormat,label:ke.regionalFormat,filter:!0,items:Qe,suppressDirtyBehavior:!0,value:n.value});(0,S.setTrustedViewModel)(l);const u=(0,H.toComputation)(l.value);o.value.subscribe(this._ltm,(e=>{l.value(MsPortalFx.find(Qe,(t=>t.value===(Ze[e].specificCulture||e))).value)})),this.summary=(0,B.create)(this._ltm,{children:[{children:[{label:ke.language,value:a.text},{label:ke.regionalFormat,value:n.text}]}]}),this.dirty=(0,c.composeComputation)([r,u],((e,t)=>{const i=t;return e!==this.sessionLanguage||i!==this.sessionRegionalFormat}))}}t.LanguageAndRegionSettingsViewModel=Pt;class Nt{constructor(e,t,i){this._ltm=e,this._diContainer=t,this.title=nt.MyInformation,this.errorInfoBox=(0,c.makeWritableComputation)(null),this.enableEmailUpdate=(0,c.makeWritableComputation)(!0),this.isLoading=(0,c.makeWritableComputation)(!0),this._savedEmail=(0,c.makeWritableComputation)(),this.savedOptedInState=(0,c.makeWritableComputation)(!1),this._savedCountryValue=(0,c.makeWritableComputation)(""),this.showCheckbox=(0,c.makeWritableComputation)(!1),this.showCountryDropDown=(0,c.makeWritableComputation)(!1),this.enableUserIntentSurvey=(0,c.makeWritableComputation)(!1),this.savedUserIntents=(0,c.makeWritableComputation)(),this.savedOtherIntentText=(0,c.makeWritableComputation)("");const{enableEmailUpdate:a,confirm:n,enablePersonalizationOptions:o}=i;this.enableEmailUpdate(a),this.enableUserIntentSurvey(o),this.emailTextBox=(0,A.create)(this._ltm,{label:ke.emailAddress,ariaLabel:ke.emailAddress,placeHolderText:ke.enterYourEmailAddress,validations:[new MsPortalFx.ViewModels.RequiredValidation,new MsPortalFx.ViewModels.RegExMatchValidation("^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$",ke.invalidEmail)],disabled:!a}),this.countryDropdown=K.create(this._ltm,{label:Z.UpdateContact.countryRegion,items:Object.keys(Q.contactabilityCountries).map((e=>({text:ko.observable(Q.contactabilityCountries[e]),value:e}))),filter:!0,showSearchIcon:!0,disabled:!a,validations:[new MsPortalFx.ViewModels.RequiredValidation],placeholder:Z.UpdateContact.emptyCountryPlaceholder}),this.emailOptInCheckBox=new T.ViewModel(this._ltm,{ariaLabel:ke.enableEmailCommunication,value:!1,disabled:!a}),this.otherIntentTextbox=(0,A.create)(this._ltm,{placeHolderText:ke.otherIntentTextboxPlaceholder,value:ko.observable("")}),this.userIntentDropdown=K.create(this._ltm,{label:ke.portalPlan,items:$e.map((e=>"Other"===e.id?{text:{htmlTemplate:s("span",{class:"msportalfx-settings-personalization-textbox","data-bind":{pcControl:"otherIntentTextbox"}}),viewModel:{otherIntentTextbox:this.otherIntentTextbox}},value:e.id,ariaLabel:ke.otherIntentTextboxPlaceholder,selectedItemOverride:this.otherIntentTextbox.value}:{text:e.title,value:e.id})),multiselect:!0}),this.summary=(0,B.create)(e,{children:[{children:[{label:ke.emailAddress,value:ko.explicitComputed(e,(0,H.toObservable)(this._ltm,this._savedEmail),(e=>e))}]}]});(this.commandBar=new O.ViewModel).setItems(Ft(this._ltm,{diContainer:this._diContainer,confirm:n})),this.userIntentChanged=(0,c.composeComputation)([(0,H.toComputation)(this.otherIntentTextbox.value),this.savedOtherIntentText,(0,H.toComputation)(this.userIntentDropdown.value),this.savedUserIntents],((e,t,i,s)=>e!==t||!MsPortalFx.arrayEquals(i?.sort(),s?.sort()))),this.emailChanged=(0,c.composeComputation)([(0,H.toComputation)(this.emailOptInCheckBox.value),(0,H.toComputation)(this.emailTextBox.valid),(0,H.toComputation)(this.emailTextBox.value),this.showCountryDropDown,this.showCheckbox,this.savedOptedInState,this._savedEmail,(0,H.toComputation)(this.countryDropdown.value)],((e,t,i,s,a,n,o,r)=>(i!==o||!!e!=!!n)&&(i&&t&&a&&e&&!(!s||!r)||t&&i&&a&&!e))),this.enableApplyButton=(0,c.composeComputation)([this.emailChanged,this.userIntentChanged],((e,t)=>e||t)),this.dirty=(0,c.composeComputation)([(0,H.toComputation)(this.emailOptInCheckBox.value),(0,H.toComputation)(this.emailTextBox.value),(0,H.toComputation)(this.countryDropdown.value),this.showCountryDropDown,this.showCheckbox,this.savedOptedInState,this._savedEmail,this._savedCountryValue,this.userIntentChanged],((e,t,i,s,a,n,o,r,l)=>a&&e!==n||t!==o||s&&i!==r||l))}async loadUserIntentSurvey(){if(!this.enableUserIntentSurvey.value)return;const e=(await(0,ce.fetchSurvey)()).filter((e=>"UserIntent"===e.Question));let t;const i=[];if(e.length){t=e[0].Answers;const s=$e.map((e=>e.id));Object.keys(t).filter((e=>{s.includes(e)&&(i.push(e),"Other"===e&&(this.savedOtherIntentText(t.Other),this.otherIntentTextbox.value(t.Other)))}))}this.savedUserIntents(i),this.userIntentDropdown.value(i)}async loadProfile(){if(!this.enableEmailUpdate.value)return;let e;const t=await this._diContainer.getAsync(d.SettingsManager),i=await(0,C.readContactabilitySettingsFromUserSettings)(t)||{},s=i.country?.toUpperCase();this._savedCountryValue(s),this.countryDropdown.value(s);try{let t;e=await(0,C.getCMProfile)({onTokenFetchFailed:()=>{this.emailTextBox.disabled(!0),this.countryDropdown.disabled(!0),this.enableEmailUpdate(!1),this.errorInfoBox((0,k.create)(this._ltm,{text:ke.myInformationTokenError,style:5}))}}),e&&(this._currentProfile=e,t=e?.azure_preferred_email,this._savedEmail(t),this.emailTextBox.value(t))}catch(e){ot("UserProfileLoadedFailed",{error:e})}finally{this.emailTextBox.value.subscribeAndRun(this._ltm,(e=>{e&&e===this._savedEmail.value?i.optedIn&&this.showCheckbox(!1):this.showCheckbox(!0)})),this.emailOptInCheckBox.value.subscribeAndRun(this._ltm,(e=>{e?this.showCountryDropDown(!0):this.showCountryDropDown(!1)})),i?.optedIn?(this.showCheckbox(!1),this.showCountryDropDown(!1)):(this.showCheckbox(!0),this.showCountryDropDown(!1)),this._currentProfile||this.showCheckbox(!0),ot("MyInformationLoaded",{profile:e,contactabilitySettings:i,showCheckbox:this.showCheckbox.value,showCountryDropDown:this.showCountryDropDown.value})}}async applyChanges(){if((0,c.evaluate)(this._ltm,this.emailChanged)){this.errorInfoBox(null);const e=this.emailOptInCheckBox.value(),t=this.emailTextBox.value(),i=this.countryDropdown.value();ot("UpdateContactabilityUpdateEmailClick",{emailAddress:t,countryValue:i,optedIn:e});try{await(0,C.updateContactEmail)(this._diContainer,this._currentProfile,t,"SettingsFlyout",this.showCheckbox.value?e:null,this.showCountryDropDown.value?i:null),this._savedEmail(this.emailTextBox.value()),this.savedOptedInState(this.emailOptInCheckBox.value()),e&&(this.emailOptInCheckBox.value(!1),this.showCheckbox(!1),this.showCountryDropDown(!1))}catch(e){const t=(0,k.create)(this._ltm,{text:ke.errorSaving,style:5});this.errorInfoBox(t),ot("UpdateContactabilityUpdateEmailFailed",{error:e})}}(0,c.evaluate)(this._ltm,this.userIntentChanged)&&this._applyUserIntentChanges()}async _applyUserIntentChanges(){const e=this.userIntentDropdown.value();this.savedUserIntents(e),this.savedOtherIntentText(this.otherIntentTextbox.value());const t={};$e.slice(0,$e.length-1).forEach(((i,s)=>{e.includes(i.id)&&(t[i.id]="true")})),e.includes("Other")&&this.otherIntentTextbox.value().trim().length&&(t.Other=this.otherIntentTextbox.value()),(0,ce.submitSurvey)([{Question:"UserIntent",Answers:t}])}revertChanges(){this.emailTextBox.value(this._savedEmail.value),this.emailOptInCheckBox.value(this.savedOptedInState.value),this.countryDropdown.value(this._savedCountryValue.value),this.userIntentDropdown.value(this.savedUserIntents.value),this.otherIntentTextbox.value(this.savedOtherIntentText.value)}}t.MyInformationSettingsViewModel=Nt;class _t{constructor(e,t){this._ltm=e,this._diContainer=t,this.title=nt.SignoutAndNotifications,this.tenantDefaultTimeout=(0,c.makeWritableComputation)(""),this.isLoadingTenantTimeout=(0,c.makeWritableComputation)(!0),this.savedTenantTimeout=(0,c.makeWritableComputation)(),this.tenantTimeoutHasValidChange=!1,this.tenantLevelIdleTimeoutDescription=(0,c.makeWritableComputation)(""),this.displayRegularTimeoutFields=(0,c.makeWritableComputation)(!1),this.displayOverrideTimeoutFields=(0,c.makeWritableComputation)(!1),this.savedOverrideValues=(0,c.makeWritableComputation)();const i=t.get(x.AuthStateManager).bootstrapState||{},s=t.get(u.GeneralSettingsManager).value;"number"!=typeof s.idleTimeoutMins()&&s.idleTimeoutMins(0);const a=this.currentIdleTimeout=s.idleTimeoutMins();let n=!1,o=!1;const r=this.isTenantAdmin=(i.user||{}).isTenantAdmin;r?(n=!0,o=!0,this._portalApplicationId=We,this.tenantPortalPolicyCheckbox=new T.ViewModel(e,{ariaLabel:Se.TenantIdleTimeout.checkboxLabel,label:Se.TenantIdleTimeout.checkboxLabel}),this.tenantMinutesTextBox=(0,D.create)(e,{label:Se.idleTimeoutMinutesLabel,ariaLabel:Se.idleTimeoutMinutesLabel,placeHolderText:Se.idleTimeoutMinutesLabel,min:0,max:59,decimalPoint:0,disabled:ko.computed(e,(()=>!this.tenantPortalPolicyCheckbox.value())),validations:[new de.Custom(Se.tenantIdleTimeoutValidationMessage,(()=>{const e=this.tenantHoursTextBox.value(),t=this.tenantMinutesTextBox.value();return Promise.resolve({valid:e>0||(void 0===e||0===e)&&t>=5,message:Se.tenantIdleTimeoutValidationMessage})}))]}),this.tenantHoursTextBox=(0,D.create)(e,{label:Se.idleTimeoutHoursLabel,ariaLabel:Se.idleTimeoutHoursLabel,placeHolderText:Se.idleTimeoutHoursLabel,min:0,max:23,decimalPoint:0,disabled:ko.computed(e,(()=>!this.tenantPortalPolicyCheckbox.value()))}),this._fetchTenantTimeoutPolicy().then((()=>{this.savedTenantTimeout({enableTenantTimeout:this.tenantPortalPolicyCheckbox.value(),hours:this.tenantHoursTextBox.value(),minutes:this.tenantMinutesTextBox.value()}),r&&this.tenantPortalPolicyCheckbox.value.subscribeAndRun(e,(e=>{this.isLoadingTenantTimeout.value||(!0!==e?(this.displayOverrideTimeoutFields(!1),this.displayRegularTimeoutFields(!0)):(this.displayOverrideTimeoutFields(!0),this.displayRegularTimeoutFields(!1)))})),this.isLoadingTenantTimeout(!1)}))):this.isLoadingTenantTimeout(!1);const l=this.idleTimeoutFromTokenInMinutes=Math.ceil((i.idleTimeoutSeconds||0)/60);let d,m,p,g;if(l?(this.tenantLevelIdleTimeoutDescription(Se.idleTimeoutForced.format(l)),l>1?(o=!0,this.displayOverrideTimeoutFields(!0)):s.idleTimeoutMins(0)):(n=!0,this.displayRegularTimeoutFields(!0)),n){let t,i;g=ko.observable(a),Ct(a)||(g(-1),t=Math.floor(a/60),i=a%60),p=this.idleTimeoutDropDown=(0,F.create)(e,{ariaLabel:Se.idleTimeoutDropdownLabel,cssClass:"fxs-settings-dropdownrow",label:Se.idleTimeoutDropdownLabel,items:it,value:g}),(0,S.setTrustedViewModel)(p),this.customIdleTimeoutHoursField=(0,D.create)(e,{label:Se.idleTimeoutHoursLabel,min:0,decimalPoint:0,allowEmpty:!1,value:t}),this.customIdleTimeoutMinutesDropDown=(0,F.create)(e,{label:Se.idleTimeoutMinutesLabel,items:[{text:"00",value:0},{text:"15",value:15},{text:"30",value:30},{text:"45",value:45}],value:i}),p.value.subscribeAndRun(this._ltm,(e=>{-1!==e&&(this.customIdleTimeoutHoursField.value(0),this.customIdleTimeoutMinutesDropDown.value(0))}))}o&&(d=this.overrideCheckBox=new T.ViewModel(e,{label:Se.idleTimeoutOverrideLabel,infoBalloonContent:Se.idleTimeoutOverrideDetails}),m=this.overrideTextBox=(0,D.create)(e,{allowEmpty:!1,ariaLabel:Se.idleTimeoutOverrideMinutes,label:ke.overrideTextBoxLabel,placeHolderText:Se.idleTimeoutOverrideMinutes,min:1,max:ko.computed(e,(()=>{let e;return e=!r||"number"!=typeof this.tenantHoursTextBox?.value()&&"number"!=typeof this.tenantMinutesTextBox?.value()?l-1:60*(this.tenantHoursTextBox?.value()||0)+(this.tenantMinutesTextBox.value()||0)-1,Math.max(e,1)})),disabled:ko.computed(e,(()=>!d.value()))}),this.shouldCheckOverrideCheckBox()?(d.value(!0),m.value(a)):(d.value(!1),this.displayOverrideTimeoutFields.value&&s.idleTimeoutMins(0)),this.savedOverrideValues({checked:d.value(),minutes:m.value()})),this.savedIdleTimeout=(0,H.toComputation)(s.idleTimeoutMins).compose((e=>{let t=e;const i=e;return Ct(t)||(t=-1),{dropdownOption:t,timeoutInMinutes:i}})),this._customIdleTimeoutInMinutes=(0,c.composeComputation)([(0,H.toComputation)(this.customIdleTimeoutHoursField?.value),(0,H.toComputation)(this.customIdleTimeoutMinutesDropDown?.value),(0,H.toComputation)(this.overrideTextBox?.value),this.displayOverrideTimeoutFields,this.displayRegularTimeoutFields],((e,t,i,s,a)=>{if(s&&i)return i||0;if(a){const i=e,s=t;return MsPortalFx.isNullOrUndefined(i)&&MsPortalFx.isNullOrUndefined(s)?-1:60*(i||0)+(s||0)}return 0}));const h=s.notificationToastEnabledKey(),f=s.notificationTeachingBubbleEnabledKey();this.savedEnableToasts=(0,H.toComputation)(s.notificationToastEnabledKey),this.savedEnableTeachingBubble=(0,H.toComputation)(s.notificationTeachingBubbleEnabledKey);const v=this.enableToastsCheckbox=new T.ViewModel(e,{ariaLabel:Se.NotificationToastCheckbox.label,value:h,label:Se.NotificationToastCheckbox.label}),b=this.enableTeachingBubbleCheckbox=new T.ViewModel(e,{ariaLabel:Se.NotificationTeachingBubbleCheckbox.label,value:f,label:Se.NotificationTeachingBubbleCheckbox.label});this.summary=(0,B.create)(e,{children:[{children:[{label:ke.signoutInactive,value:ko.explicitComputed(e,[(0,H.toObservable)(e,this.savedIdleTimeout),(0,H.toObservable)(e,this.savedTenantTimeout)],((e,t)=>{let i=e?.timeoutInMinutes;return i||(i=t?t.enableTenantTimeout?60*t.hours+t.minutes:0:l),function(e){if(Ct(e)){const t=MsPortalFx.find(it,(t=>t.value===e));return t?.text||Se.idleTimeoutNever}return ke.signoutSummaryDescription.format(e)}(i)}))},{label:ke.enableToasts,value:ko.explicitComputed(e,v.value,(e=>e?ke.yes:ke.no))},{label:ke.enableTeachingBubbles,value:ko.explicitComputed(e,b.value,(e=>e?ke.yes:ke.no))}]}]}),this.enableApplyButton=(0,c.composeComputation)([this.savedIdleTimeout,(0,H.toComputation)(g),(0,H.toComputation)(v.value),(0,H.toComputation)(b.value),(0,H.toComputation)(this.customIdleTimeoutHoursField?.valid),this._customIdleTimeoutInMinutes,this.savedTenantTimeout,(0,H.toComputation)(this.tenantPortalPolicyCheckbox?.value),(0,H.toComputation)(this.tenantHoursTextBox?.value),(0,H.toComputation)(this.tenantMinutesTextBox?.value),(0,H.toComputation)(this.overrideTextBox?.value),(0,H.toComputation)(this.overrideTextBox?.valid),(0,H.toComputation)(this.overrideCheckBox?.value),this.savedOverrideValues,this.displayOverrideTimeoutFields,this.displayRegularTimeoutFields,(0,H.toComputation)(this.overrideTextBox?.max),this.savedEnableToasts,this.savedEnableTeachingBubble,(0,H.toComputation)(this.tenantMinutesTextBox?.valid)],((e,t,i,s,a,n,o,l,u,d,m,p,g,h,f,v,x,b,y,w)=>{let C=!1,I=!1;if(f){const e=h.checked&&!0!==g;let t=!1;g&&(t=m&&p&&m!==h.minutes),I=t||e}else v&&(Ct(t)||(t=-1),-1!==t?C=t!==e.timeoutInMinutes:-1!==n&&a&&n!==e.timeoutInMinutes&&(this.customIdleTimeoutHoursField.value()||this.customIdleTimeoutMinutesDropDown.value())&&(C=!0));let S=!1;if(r&&o){const e=l,t=!0===o.enableTenantTimeout,i=o.hours!==u||o.minutes!==d,s=t&&!e,a=e&&i&&w;this.tenantTimeoutHasValidChange=S=s||a}let M=!1;return M=!f||!g||m&&x&&m<=x&&m>=1,M&&(C||i!==(0,c.evaluate)(this._ltm,this.savedEnableToasts)||s!==(0,c.evaluate)(this._ltm,this.savedEnableTeachingBubble)||I||S)})),this.dirty=(0,c.composeComputation)([this.savedIdleTimeout,(0,H.toComputation)(g),(0,H.toComputation)(v.value),(0,H.toComputation)(b.value),(0,H.toComputation)(this.customIdleTimeoutHoursField?.valid),this._customIdleTimeoutInMinutes,this.savedTenantTimeout,(0,H.toComputation)(this.tenantPortalPolicyCheckbox?.value),(0,H.toComputation)(this.tenantHoursTextBox?.value),(0,H.toComputation)(this.tenantMinutesTextBox?.value),(0,H.toComputation)(this.overrideTextBox?.value),(0,H.toComputation)(this.overrideTextBox?.valid),(0,H.toComputation)(this.overrideCheckBox?.value),this.savedOverrideValues,this.displayOverrideTimeoutFields,this.displayRegularTimeoutFields,(0,H.toComputation)(this.overrideTextBox?.max),this.savedEnableToasts,this.savedEnableTeachingBubble],((e,t,i,s,a,n,o,l,u,d,m,p,g,h,f,v,x,b,y)=>{let w=!1,C=!1,I=!1,S=!1,M=!1,F=!1;return f?(w=!!h.checked!=!!g,C=m!==h.minutes):v&&(Ct(t)||(t=-1),I=-1!==t?t!==e.timeoutInMinutes:n!==e.timeoutInMinutes,a||(I=!0)),r&&o&&(S=o.enableTenantTimeout!==l||o.hours!==u||o.minutes!==d),M=i!==(0,c.evaluate)(this._ltm,this.savedEnableToasts),F=s!==(0,c.evaluate)(this._ltm,this.savedEnableTeachingBubble),w||C||I||S||M||F}))}shouldCheckOverrideCheckBox(){return this.currentIdleTimeout&&this.currentIdleTimeout<this.idleTimeoutFromTokenInMinutes}async _fetchTenantTimeoutPolicy(){try{const e=await(0,R.ajax)({uri:Ye,setAuthorizationHeader:{resourceName:"microsoft.graph"}}),t=MsPortalFx.find(e.value,(e=>e.isOrganizationDefault));if(t){this._policyId=t.id;try{const e=this._policyDefinition=JSON.parse(t.definition);i.forEachKey(e,((e,t)=>{let i,s;if(t.ApplicationPolicies.forEach((e=>{e.ApplicationId===this._portalApplicationId?i=e.WebSessionIdleTimeout:"default"===e.ApplicationId&&(s=e.WebSessionIdleTimeout)})),i){this.tenantPortalPolicyCheckbox.value(!0);const e=i.split(":"),t=X.Duration.fromObject({hours:+e[0],minutes:+e[1],seconds:+e[2]});this.tenantHoursTextBox.value(t.hours),this.tenantMinutesTextBox.value(t.minutes)}s&&this.tenantDefaultTimeout(Se.TenantIdleTimeout.defaultTimeoutFormat.format(s))}))}catch(e){bt(this._diContainer,e,"ParseIdleTimeoutPolicy")}}}catch(e){bt(this._diContainer,e,"ParseIdleTimeoutPolicy")}}async applyChanges(){let e;this.displayRegularTimeoutFields.value?(e=this.idleTimeoutDropDown.value(),-1===e&&(e=(0,c.evaluate)(this._ltm,this._customIdleTimeoutInMinutes))):this.displayOverrideTimeoutFields.value&&(e=this.overrideCheckBox.value()?this.overrideTextBox.value():0);const t=this.enableToastsCheckbox.value(),i=this.enableTeachingBubbleCheckbox.value();ot("SignoutAndNotificationSettingsApplied",{currentIdleTimeout:(0,c.evaluate)(this._ltm,this.savedIdleTimeout),savedOverrideValues:(0,c.evaluate)(this._ltm,this.savedOverrideValues),newIdleTimeout:e,currentEnableToasts:(0,c.evaluate)(this._ltm,this.savedEnableToasts),currentEnableTeachingBubble:(0,c.evaluate)(this._ltm,this.savedEnableTeachingBubble),newEnableToasts:t,newEnableTeachingBubble:i});const s=this._diContainer.get(u.GeneralSettingsManager).value;void 0!==e&&s.idleTimeoutMins(e),s.notificationToastEnabledKey(t),s.notificationTeachingBubbleEnabledKey(i),this.displayOverrideTimeoutFields.value&&(this.savedOverrideValues({checked:this.overrideCheckBox.value(),minutes:this.overrideCheckBox.value()?this.overrideTextBox.value():0}),this.overrideCheckBox.value()||this.overrideTextBox.value(0)),await this._applyTenantTimeoutChanges()}async _applyTenantTimeoutChanges(){if(this.tenantTimeoutHasValidChange){const e=xt(this.tenantHoursTextBox.value()||0),t=xt(this.tenantMinutesTextBox.value()||0),s=`${e}:${t}:00`,a={ApplicationId:this._portalApplicationId,WebSessionIdleTimeout:s};let n,o;const r={};let l,c,u=!1;this._policyDefinition?i.forEachKey(this._policyDefinition,((i,s)=>{const l=s.ApplicationPolicies.filter((e=>e.ApplicationId!==this._portalApplicationId));this.tenantPortalPolicyCheckbox.value()?(n=Se.TenantIdleTimeout.notificationDescriptionAdd.format(e,t),o="SetIdleTimeoutPolicy",l.push(a)):(n=Se.TenantIdleTimeout.notificationDescriptionRemove,o="RemoveIdleTimeoutPolicy"),l.length?r[i]={Version:s.Version,ApplicationPolicies:l}:u=!0})):(r.ActivityBasedTimeoutPolicy={Version:1,ApplicationPolicies:[a]},n=Se.TenantIdleTimeout.notificationDescriptionAdd.format(e,t));let d={definition:[JSON.stringify(r)]};this._policyId?(l=MsPortalFx.ensureSuffix(Ye,"/")+this._policyId,c=u?"DELETE":"PATCH"):(l=Ye,c="POST",d=MsPortalFx.extend(d,{displayName:"ActivityBasedTimeoutPolicy",isOrganizationDefault:!0}));const m=fe.startTrace({source:"SettingsFlyout",action:o});try{const e=await(0,R.ajax)({uri:l,setAuthorizationHeader:{resourceName:"microsoft.graph"},type:c,data:u?null:JSON.stringify(d),contentType:"application/json"});"DELETE"===c?this._policyId=null:"POST"===c&&(this._policyId=e?.id),fe.endTrace(m,"completed",{duration:this.tenantPortalPolicyCheckbox.value()?s:null}),this._diContainer.get(w.NotificationManager).addClientNotification({title:Se.TenantIdleTimeout.notificationTitle,description:n,status:be.NotificationStatus.Success,timestamp:new Date}),this.tenantPortalPolicyCheckbox.value()?this.savedTenantTimeout({enableTenantTimeout:this.tenantPortalPolicyCheckbox.value(),hours:this.tenantHoursTextBox.value(),minutes:this.tenantMinutesTextBox.value()}):(this.savedTenantTimeout({enableTenantTimeout:this.tenantPortalPolicyCheckbox.value(),hours:0,minutes:0}),this.tenantHoursTextBox.value(0),this.tenantMinutesTextBox.value(0))}catch(e){const t=JSON.stringify(((e.jqXHR||{}).responseJSON||{}).error,null,4);fe.endTrace(m,"failed",{error:MsPortalFx.getLogFriendlyMessage(t)}),yt(this._diContainer,t,Se.TenantIdleTimeout.notificationDescriptionError)}}}revertChanges(){const{dropdownOption:e,timeoutInMinutes:t}=(0,c.evaluate)(this._ltm,this.savedIdleTimeout);Ct(t)?(this.customIdleTimeoutHoursField?.value(null),this.customIdleTimeoutMinutesDropDown?.value(0)):(this.customIdleTimeoutHoursField?.value(Math.floor(t/60)),this.customIdleTimeoutMinutesDropDown?.value(t%60)),this.idleTimeoutDropDown?.value(e),this.enableToastsCheckbox.value((0,c.evaluate)(this._ltm,this.savedEnableToasts)),this.enableTeachingBubbleCheckbox.value((0,c.evaluate)(this._ltm,this.savedEnableTeachingBubble)),this.savedTenantTimeout&&(this.tenantPortalPolicyCheckbox?.value(this.savedTenantTimeout.value.enableTenantTimeout),this.tenantHoursTextBox?.value(this.savedTenantTimeout.value.hours),this.tenantMinutesTextBox?.value(this.savedTenantTimeout.value.minutes)),this.savedOverrideValues&&(this.overrideCheckBox?.value(this.savedOverrideValues.value.checked),this.overrideTextBox?.value(this.savedOverrideValues.value.minutes)),ot("SignoutAndNotificationSettingsReverted")}}t.SignoutAndNotificationSettingsViewModel=_t;class Lt{constructor(e){this.diContainer=e,this.title=ke.moreAzureResourcesTitle;const t=ko.observable(),s=e.get(g.SubscriptionsUserContext).getGlobalSelectedSubscriptions().then((e=>e())).then((e=>{t(e)}));this.showDiagnosticsPopup=async()=>{const[t,a,n,o,r]=await Promise.all([i.require("MsPortalImpl/Base/Base.DiagnosticsPopup"),i.require("MsPortalImpl/Base/Base.ClientRawFileDownload"),s,e.get(z.TenantsService).getTenants(),e.getAsync(W.SecurityTokensManager)]),l=await t.getDiagnosticsData(e,ko.observableArray(o.tenants),r);a.downloadFile({provideText:()=>Promise.resolve(JSON.stringify(l,null,2))},"PortalDiagnostics.json","charset=utf-8;application/json")}}}t.MoreAzureResourcesViewModel=Lt,t.createFlyout=function(e,t,i){const s={getForm:()=>t.find(".fxs-settings-dialogtarget")[0],hideForm:()=>{},showForm:()=>{}};i.initializeElement(e,t,s)}})),
define("_generated/Less/MsPortalImpl/Weave/Components/SettingsFlyout.css",["module"],(function(e){"use strict";return{css:".fxs-settings-flyout-container{font-size:13px;line-height:18px;min-width:320px;height:100%;list-style:none}.fxs-settings-content-wrapper{display:flex;flex-direction:column;height:100%}.fxs-settings-fullheightsection .fxc-section-wrapper{height:100%;min-height:0}.fxs-settings-content{display:flex;flex-direction:column;height:100%;padding-top:15px;overflow:hidden}.fxs-settings-content .fxc-accordion-section{margin-bottom:12px;border-radius:2px;border:1px solid #edebe9}.fxs-settings-content .fxc-accordion-section .fxc-accordion-heading{background:#faf9f8}.fxs-mode-dark .fxs-settings-content .fxc-accordion-heading{background:transparent}.fxs-settings-header{display:flex;box-sizing:border-box;padding:0 24px;margin-bottom:0;min-height:44px;position:relative}.fxs-settings-title{font-size:24px;line-height:28px}.fxs-settings-title-sm{font-size:16px;line-height:20px;margin-right:10px}.fxs-settings-stretch{flex-grow:1}.fxs-settings-section-title{display:flex;font-size:14px;line-height:20px;font-weight:600;cursor:default}.fxs-settings-section-changelink{cursor:pointer}.fxs-settings-close-button{cursor:pointer;padding:0;border:0;background-color:transparent;margin:0;transition:background-color .2s ease-out;height:32px;width:32px}.fxs-settings-close-button svg{height:12px;width:12px}.fxs-settings-close-button:hover{background-color:#ba141a;fill:#fff!important}.fxs-settings-body{display:flex;flex:1 1 auto;overflow:hidden}.fxs-settings-menu-wrapper{flex:0 0 265px;display:flex;flex-direction:column;height:100%;overflow:hidden}.fxs-settings-list{padding:0;margin:0;list-style-type:none}.fxs-settings-menu{flex-grow:1;overflow-y:auto}.fxs-settings-menu-footer{padding:10px 0 50px}.fxs-settings-menu-item{flex:0 0 auto;font-size:13px;line-height:20px;padding:10px 23px;cursor:pointer}.fxs-settings-main{display:flex;flex-direction:column;width:100%;padding:0 24px;overflow-y:auto}.fxs-settings-menu-search{padding:0 23px 8px}.fxs-settings-menu-search .fxc-search-icon{display:none}.fxs-settings-column{max-width:640px}.fxs-settings-overview{display:flex;flex-direction:column;overflow:auto}.fxs-settings-flyout-group{margin-bottom:24px}.fxs-settings-label{width:252px}.msportalfx-settings-personalization-textbox{display:inline-block;width:90%}.fxs-settings-stack{display:flex;flex-direction:column;width:100%;height:100%;flex-grow:1;padding-top:0;overflow-y:auto}.fxs-settings-helplinks{display:flex;flex-direction:column;align-items:flex-start;line-height:180%}.fxs-settings-helplink-freelancer .fxs-settings-helplink-header,.fxs-settings-helplink-expert .fxs-settings-helplink-header{font-size:16px;padding:0}.fxs-settings-helplink-intro,.fxs-settings-helplink-body{flex:1 1 auto;overflow:auto;padding-top:0}.fxs--settings-helplink-spacer-small{margin-bottom:10px}.fxs-settings-helplink-spacer-large{margin-bottom:40px}.fxs-settings-tab{display:flex;flex-direction:column;overflow:auto;height:100%;min-height:250px}.fxs-settings-tab-title{font-weight:600}.fxs-settings-tabdescription{font-size:13px;line-height:19px;width:100%;margin-bottom:15px}.fxs-settings-scroll{overflow:auto}.fxs-settings-preview{padding-top:2px;padding-left:2px}.fxs-settings-thumbnail-frame{margin:0 12px 12px 0;padding:8px;border:1px solid transparent;text-align:left;fill:none;cursor:pointer}.fxs-settings-thumbnail-frame .fxs-settings-thumbnail{width:58px;height:49px}.fxs-settings-thumbnail-frame:not(.fxs-settings-thumbnail-selected):hover{border-color:transparent;box-shadow:0 0 0 1px #323130;border-radius:4px}.fxs-mode-dark .fxs-settings-thumbnail-frame:not(.fxs-settings-thumbnail-selected):hover{border-color:transparent;box-shadow:0 0 0 1px #a19f9d}.fxs-settings-thumbnail-selected{font-weight:600;border-color:transparent;box-shadow:0 0 0 2px #0078d4;border-radius:4px}.fxs-settings-footer{padding-bottom:8px;margin-top:8px}.fxs-settings-flex{display:flex}.fxs-settings-applybutton{margin-right:10px}.fxs-settings-dropdownrow{max-width:530px}.fxs-settings-searchmain{max-width:180px;display:none}.fxs-settings-svg{height:16px;width:16px;display:block}.fxs-settings-pointer{cursor:pointer}.fxs-settings-overview-grid{width:100%}.fxs-settings-overview-row{display:grid;grid-template-columns:5fr 1fr;align-items:center;height:32px;border-top-width:1px;border-top-style:solid}.fxs-settings-overview-row:last-of-type{border-bottom-width:1px;border-bottom-style:solid}.fxs-settings-overview-cell{display:flex;line-height:32px}.fxs-settings-overview-cell:nth-of-type(1){grid-column-start:1;grid-column-end:2;text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.fxs-settings-overview-cell:nth-of-type(2){grid-column-start:2;grid-column-end:3;display:flex;justify-content:right}.fxs-settings-previewsummary{display:flex}.fxs-settings-previewlabel{margin-left:8px}.fxs-settings-previewicon{width:28px;height:18px}.fxs-settings-dialogcontainer{position:relative;z-index:203;width:100%;overflow:visible}.fxs-settings-dialogtarget{position:absolute;width:100%;left:0;overflow:visible}.fxs-settings-dialogdescription{line-height:16px;margin-bottom:12px}.fxs-settings-activatecell{display:inline-flex;width:100%;justify-content:center}.fxs-settings-activatecell .fxs-settings-svg{margin-right:8px;margin-top:auto;margin-bottom:auto}.fxs-settings-overviewgrid{margin-bottom:7px}.fxs-settings-overviewgrid .fxc-gc-thead{display:none}.fxs-settings-idletimecontainer{display:flex;justify-content:flex-end;margin-top:-8px}.fxs-settings-tenantidletimecontainer{display:flex;margin-top:-8px}.fxs-settings-idletimemargin{margin-left:15px}.fxs-settings-idletimeout-defaulttimeout{margin-bottom:15px}.fxs-settings-useridletimeout-hours{min-width:200px}.fxs-settings-useridletimeout-minutes{min-width:55px}.fxs-settings-tenantidletimeout-hours{margin-right:15px}.fxs-settings-cappedwidth{max-width:700px}.fxs-settings-cappedwidth-sm{max-width:400px}.fxs-settings-filtersaccordion .fxc-accordion-header-text{overflow:hidden}.fxs-settings-accordionheader{display:flex}.fxs-settings-accordionheader .fxs-settings-accordiontitle{flex-grow:1;overflow:hidden}.fxs-settings-accordionheader .fxs-settings-accordionright{display:flex;margin-top:auto;margin-bottom:auto}.fxs-settings-addfilter{display:flex;font-size:13px;line-height:15px}.fxs-settings-addfilter .fxs-settings-addfilterlabel{margin-left:9px}.fxs-settings-filtergrid{margin-bottom:20px}.fxs-settings-createfilterwrapper{border:1px solid #edebe9;border-radius:2px;padding:16px 16px 20px}.fxs-settings-filtertitle{font-weight:600;font-size:14px;line-height:20px}.fxs-settings-createfiltertitle{font-size:16px;line-height:22.08px;margin-bottom:19px}.fxs-settings-accordionicon{margin-left:10px;margin-top:auto;margin-bottom:auto}.fxs-settings-noitemsmessage{text-align:center;margin-bottom:12px}.fxs-settings-overviewsection{margin-bottom:36px}.fxs-settings-overviewsection .fxc-gc-row-content{padding-left:0}.fxs-settings-overviewsection .fxc-gc-row-content .fxc-gc-columncell_0_0{margin-left:0}.fxs-settings-overviewseeall{cursor:pointer;margin-top:7px}.fxs-settings-toolbar{border-bottom:inset 1px rgba(204,204,204,.8);margin-bottom:15px}.fxs-settings-toolbar-slim{margin-bottom:0}.fxs-settings-summary{font-size:14px;line-height:20px;flex-wrap:wrap;display:none}.fxs-settings-summary .fxs-settings-summaryitem{display:flex;width:100%;margin-bottom:15px;padding-right:30px;white-space:nowrap}.fxs-settings-summary .fxs-settings-summaryitem-sm{margin-left:8px;display:inline-block;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.fxs-settings-textspace{margin:0 4px}.fxs-settings-space-small{margin-bottom:10px}.fxs-settings-space{margin-bottom:15px}.fxs-settings-directoriestab{height:calc(100% - 163px);min-height:0}.fxs-settings-directoriestab .fxc-tabs-container{margin-bottom:0}.fxs-settings-directoriessection{display:flex;flex-direction:column;height:100%;min-height:0}.fxs-settings-directoriesgrid{height:100%;min-height:300px}.fxs-settings-fullheight{height:100%}.fxs-settings-contactinfo-checkbox{display:inline-block;margin-top:15px;vertical-align:top}.fxs-settings-contactinfo-privacy{display:inline-block;margin-top:11px;max-width:calc(100% - 30px);margin-left:8px}.fxs-settings-contactinfo-privacy-optedin{display:inline-block;max-width:calc(100% - 30px)}.fxs-settings-contactinfo-country-dropdown{margin-top:10px}.fxs-settings-topalign{margin-top:0;padding-top:0}.fxs-settings-editfiltername{margin-top:8px}.fxs-settings-quicksubfilter{display:flex;flex-wrap:wrap;margin-bottom:12px}.fxs-settings-quicksubfilter>.fxc-section-wrapper{width:initial}.fxs-settings-quicksubfilter .fxs-settings-filterdropdown{width:100%;max-width:400px;min-width:260px}.fxs-settings-subscriptionfilterdropdown .fxc-resourcefilter-summary-filters{flex-wrap:wrap}.fxs-settings-subscriptionfilterdropdown .fxc-resourcefilter-summary-filters .fxc-resourcefilter-visible{margin-bottom:0;margin-right:0}.fxs-settings-subscriptionfilterdropdown .fxc-resourcefilter-summary-filters .fxc-resourcefilter-directories{margin-bottom:8px}.fxs-settings-subscriptionfilterdropdown .fxc-resourcefilter-summary-filters .fxc-resourcefilter-directories .azc-form-label{font-weight:600}.fxs-settings-subscriptionfilterdropdown .fxc-resourcefilter-summary-filters .fxc-dropdown-filter:not(.fxc-left-label)>.azc-form-labelcontainer{margin-bottom:4px}.fxs-settings-subscriptionfilterdropdown .fxc-resourcefilter-summary-filters .msportalfx-nested-control:not(.fxc-left-label){padding-left:20px;padding-bottom:15px}.fxs-settings-subscriptionfilterdropdown .fxc-resourcefilter-summary-filters .msportalfx-nested-control:not(.fxc-left-label)::before{height:calc(50% - 15px);left:0;top:-5px;width:14px}.fxs-settings-sectionlabel{font-weight:600;font-size:14px;line-height:20px;display:inline-block}.fxs-settings-sectionlabel .fxs-settings-sectionlabel-infoballoon{margin-left:4px}.fxs-settings-section{margin-bottom:24px}@media(min-width:1240px){.fxs-settings-overview{flex-direction:row}.fxs-settings-column{flex:1 0 auto;margin-right:33px}}@media(min-width:780px){.fxs-settings-stack{overflow-y:initial}.fxs-settings-header{margin-bottom:25px}.fxs-settings-menu-footer{padding-left:25px;padding-right:25px}.fxs-settings-sm-footer{display:none}}@media(min-height:300px){.fxs-settings-footer{margin-top:15px;padding-bottom:20px}.fxs-settings-menu-footer{padding-bottom:60px}.fxs-settings-thumbnail-frame .fxs-settings-thumbnail{width:116px;height:98px}.fxs-settings-tabdescription{display:block}.fxs-settings-summary{display:flex}.fxs-settings-summaryitem-sm{display:none}.fxs-settings-directoriestab .fxc-tabs-container{margin-bottom:12px}.fxs-settings-searchmain{display:block}.fxs-settings-quicksubfilter{margin-bottom:24px}.fxs-settings-pimsection{margin-bottom:20px}}",moduleId:e.id}})),
define("MsPortalImpl/Weave/Components/SettingsFlyout.Component",["require","exports","Weave/DirectMode","Weave","Fx/Composition","FxInternal/Weave","FxInternal/Weave/Util","FxInternal/Weave/Components/FormattedFragment","MsPortalImpl/Weave/Components/SettingsFlyout","FxInternal/Weave/Components/LoadingIndicator","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Resources/HelpMenuResources","MsPortalImpl/Controls/Forms/DropDown","MsPortalImpl.Controls/Fields/CheckBoxField","Fx/Controls/DropDown","Fx/Controls/EditableGrid","MsPortalImpl/Controls/Controls.InfoBox","Fx/Controls/InfoBalloon","Fx/Controls/TextBox","Fx/Controls/Validations","MsPortalImpl.Controls/Fields/TextField","FxInternal/Weave/Components/Button","FxInternal/Weave/Components/Tab","FxInternal/Weave/Components/Section","MsPortalImpl.Controls/Controls/SearchBox","FxInternal/Weave/Components/PcControl","FxInternal/Weave/Components/Accordion","MsPortalImpl/Widgets/Widgets.CommandBar","MsPortalImpl.Controls/Controls/Lists/Grid2/Grid2.EditableGrid.ctl","MsPortalImpl.Controls/Controls/Lists/Grid2/Grid2.DataGrid.ctl","MsPortalImpl.Controls/Controls/ResourceFilter","Fx/Controls/ManagementGroupDropDown","MsPortalImpl/Weave/Components/SettingsFlyoutHelpers","MsPortalImpl/Base/Languages","MsPortalImpl/UI/UI.ContextPane","MsPortalImpl/UI/Commands/Base.PortalFunctions","MsPortalImpl/Interactions/Interactions.KeyboardShortcutHandler","Fx","MsPortalImpl.Controls/Controls/Lists/Menu","Fx/Experimentation","MsPortalImpl/Base/Themes","_generated/Less/MsPortalImpl/Weave/Components/SettingsFlyout.css"],(function(e,t,i,s,a,n,o,r,l,c,u,d,m,p,g,h,f,v,x,b,y,w,C,I,S,M,F,T,k,D,A,P,N,_,L,B,V,O,H,E,R,z){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoreAzureResourcesSettings=t.SignoutAndNotificationSettings=t.LanguageAndRegionSettings=t.MyInformationSettings=t.AppearanceSettings=t.FilterSettings=t.DirectorySettings=t.OverviewSettings=t.SettingsFlyout=t.getFlyoutComponent=void 0;var W=MsPortalFx.Base.Images;const U=window.fx.environment.links,G=u.UiSettings.Flyout,q=u.AvatarMenu,j=u.Blade,K=j.titleFormat,Z=u.UiSettings.settingsBladeTitle;let Q;const J=i("div",{className:"fxs-settings-section-loading"},i(c.LoadingIndicator,{size:1})),X={subscriptionId:G.subscriptionId,subscriptionName:G.subscriptionName,subscriptionState:G.subscriptionState,managementGroupName:G.managementGroup},Y={subscriptionId:G.subscriptionIdMultiFormat,subscriptionName:G.subscriptionNameMultiFormat,subscriptionState:G.subscriptionStateMultiFormat,managementGroupName:G.managementGroupMultiFormat},ee=["==","!=","contains","!contains","startswith","!startswith","endswith","!endswith"],te=W.StatusBadge.Success({palette:4}),ie=W.TrashOutline({palette:3}),se=W.TrashOutline({palette:5}),ae=W.Add({palette:3}),ne=W.Edit({palette:3}),oe=W.Edit({palette:5});function re(e){const t=MsPortalFx.newGuid(),a=`azc-form-guid-${t}-for`;return i("div",{className:"fxc-weave-pccontrol fxc-base msportalfx-form-formelement fxc-has-label azc-fabric fxs-settings-space"},i("div",{className:"azc-form-labelcontainer azc-text-label azc-text-sublabel-neighbor fxc-section-control"},i("label",{id:`azc-form-guid-${t}`,className:"azc-form-label",for:a},e.label)),i("div",{className:"azc-formElementSubLabelContainer"},i("div",{className:"azc-formElementContainer",role:"region","aria-label":(0,s.makeConstantComputation)(e.label),id:a},e.node)))}function le(e){const t=e.value,a=(0,s.isComputation)(e.items)?e.items:(0,s.makeConstantComputation)(e.items);return i(re,{label:e.label,node:i("div",{role:"listbox",className:"fxs-settings-preview","aria-label":e.label},i(s.ForEach,{collection:a,fn:({item:e})=>i("button",{className:["fxs-settings-thumbnail-frame",{"fxs-settings-thumbnail-selected":t.compose((t=>t===e.item.value))}],fxclick:()=>(e.onClick(),!1),title:e.item.title,role:"option"},i("div",{className:"fxs-settings-thumbnail",image:e.item.svg}),i("div",{className:"fxs-portal-text"},e.item.title))}))})}function ce(e,t){return i("h3",{className:"fxs-settings-section-title"},i("a",{className:"fxs-settings-section-changelink",title:e,tabindex:"0",fxclick:()=>(t(),!1)},e))}function ue(e){return e.map((e=>{const t=e.operator.value,i=e.value.value;return{type:e.type.value,operator:t,value:["==","!="].includes(t)?i:i[0]}}))}function de(e,t,i){return new a.ClickableLink(e,t,"",(()=>(0,l.telemetryTrace)(i)))}function me(e,t){const{filter:i,isInEditMode:a,getAvailableDropdownValues:o}=t,r=(0,s.isComputation)(i.name)?i.name:(0,s.makeConstantComputation)(i.name),l=ko.observableArray([...i.facets.value]);(0,s.subscribe)(e,[i.facets],(e=>{l([...e])}));let c=-1;const d=(0,n.toObservable)(e,a),m=(0,h.create)(e,{ariaLabel:(0,n.toObservable)(e,r.compose((e=>G.facetsAriaLabelFormat.format(e)))),items:l,editing:{canEditRow:()=>d()},addition:{canAddRow:()=>d(),createItem:()=>({type:(0,s.makeWritableComputation)(),operator:(0,s.makeWritableComputation)("=="),value:(0,s.makeArrayComputation)([])})},deletion:{canDeleteRows:(e,t)=>d()&&e.length<t.rows().length},contextMenu:{supplyButtonCommands:(e,t,i)=>[i.deletion.createDeleteRowsCommand(e,t,{telemetryName:"RemoveFilterFacet"})],visible:d},columns:[{header:G.filterType,defineCell:(e,t)=>(0,n.toObservable)(e,t.type.compose((e=>e?X[e]:""))),createCellEditor:(e,t)=>{const i=ko.observableArray(MsPortalFx.stableSort([{value:"subscriptionId",text:X.subscriptionId},{value:"subscriptionName",text:X.subscriptionName},{value:"subscriptionState",text:X.subscriptionState}],((e,t)=>MsPortalFx.localeCompareIgnoreCase(e.text,t.text)))),a=X.managementGroupName;if(c<0){c++;const e=i();for(;c<e.length&&MsPortalFx.localeCompareIgnoreCase(e[c].text,a)<0;)c++}(0,s.subscribeAndRun)(e,[t.type,(0,n.toComputation)(l)],((e,t)=>{const s="managementGroupName"===e||!t.map((e=>e.type.value)).includes("managementGroupName"),n="managementGroupName"===i()[c].value;s&&!n?i.splice(c,0,{value:"managementGroupName",text:a}):!s&&n&&i.splice(c,1)}));const o=ko.observable(t.type.value);return o.subscribe(e,(e=>{t.type(e),t.value.clear()})),(0,g.create)(e,{ariaLabel:G.filterType,items:i,value:o,filter:!0,filterPlaceholder:G.search})}},{header:G.operator,defineCell:(e,t)=>(0,n.toObservable)(e,t.operator),createCellEditor:(e,t)=>{const i=ee.map((e=>({value:e,text:e}))),a=["==","!="].map((e=>({value:e,text:e}))),n=ko.observableArray();(0,s.subscribeAndRun)(e,[t.type],(e=>{n("managementGroupName"!==e?[...i]:[...a])}));const o=ko.observable(t.operator.value);return o.subscribe(e,(e=>t.operator(e))),(0,g.create)(e,{ariaLabel:G.operator,filter:!0,filterPlaceholder:G.search,items:n,value:o})}},{header:G.value,defineCell:(e,t)=>(0,n.toObservable)(e,(0,s.composeComputation)([t.value,t.type],((e,t)=>t&&e.length?1===e.length?e[0]:Y[t].format(e.length):""))),createCellEditor:(e,t)=>{const i=ko.observable(),a=ko.observableArray([]);let r=!1,l=e.createChildLifetime();return(0,s.subscribeAndRun)(e,[t.operator,t.type],((c,d)=>{const m=t.value.value;if(["==","!="].includes(c)){const c=ko.observableArray([...m]);a(m.map((e=>({text:e,value:e}))));let p=!1;if((0,s.subscribe)(e,[t.value],(e=>{p=!0,c([...e])})),c.subscribe(e,(e=>{p?p=!1:t.value.setAll(e)})),"managementGroupName"===d){r||(l?.dispose(),l=e.createChildLifetime(),r=!0);const t=(0,P.create)(l,{multiSelect:!0,ariaLabel:G.conditionValue,validations:[new b.Required(G.requiredManagementGroupMessage)]});return t.value.subscribe(l,(e=>{c(e.map((e=>e.id)))})),m.length&&t.fetchedValues.fxOnce(l,(e=>{const i=e.reduce(((e,t)=>(e[t.id.toLowerCase()]=t,e)),Object.create(null)),s=m.reduce(((e,t)=>{const s=i[t.toLowerCase()];return s&&e.push(s),e}),[]);s.length&&t.value(s)})),i(t)}r&&(l?.dispose(),l=e.createChildLifetime(),r=!1);const h=(0,g.create)(l,{ariaLabel:G.conditionValue,disabled:!d,items:a,filter:!0,filterPlaceholder:G.search,multiselect:!0,multiItemDisplayText:ko.pureComputed((()=>Y[d]||u.dropDownXSelected)),selectAll:!0,value:c,validations:[new b.Required]}),f=e=>{const t=[];let i,s=!1;if(e.length&&e[0].children){const t=new Set;e.forEach((e=>{(e.children||[]).forEach((e=>{t.add(e.value)}))})),i=Array.from(t.entries()).map((([e])=>e))}else i=e.map((e=>e.value));c().forEach((e=>{i.includes(e)?t.push(e):s=!0})),s&&c(t)};return(0,s.subscribe)(l,[(0,n.toComputation)(h.isPopUpOpen)],(async e=>{if(!e)return;const t=await o();let i;switch(d){case"subscriptionId":i=t.subscriptionIds;break;case"subscriptionName":i=t.subscriptionDisplayNames;break;case"subscriptionState":i=t.subscriptionStates}i?(a([...i]),f([...i])):a([])})),i(h)}const p=m.length?m[0]:"",h=ko.observable(p);return h.subscribe(e,(e=>t.value.setAll([e]))),i((0,x.create)(e,{ariaLabel:G.conditionValue,value:h,validations:[new b.Required]}))})),i}}]});return m}function pe(e){const t=e.isActive.compose((t=>!t&&!!e.filterId)),a=e.canModify.compose((t=>t&&!!e.filterId));return i("div",{className:"fxs-settings-accordionheader"},i("div",{className:"fxs-settings-accordiontitle"},i("div",{className:"fxs-settings-filtertitle msportalfx-text-ellipsis",title:e.title},e.title),e.subtitle?i("div",null,e.subtitle):null),i("div",{className:"fxs-settings-accordionright"},i(s.If,{condition:e.isActive.compose(o.negation),trueFn:()=>i(w.Button,{text:G.activate,style:1,loading:e.isLoading,loadingText:G.countsLoading,disabled:e.canActivate.compose(o.negation),onClick:()=>(e.onClickActivate(),!1)}),falseFn:()=>i("div",{className:"fxs-settings-activatecell"},i("div",{className:"fxs-settings-svg",image:te}),i("div",null,G.active))}),i("a",{tabindex:"0",className:"fxs-settings-accordionicon fxs-settings-deletefilter",title:G.deleteFilter,fxclick:t.compose((t=>t?()=>(e.onClickDelete(),!1):()=>!1)),"aria-disabled":t.compose(o.negation)},i("div",{className:"fxs-settings-svg",image:t.compose((e=>e?ie:se))})),i("a",{tabindex:"0",className:"fxs-settings-accordionicon fxs-settings-modifyfilter",title:G.modifyFilter,fxclick:()=>(e.onClickModify(),!1),"aria-disabled":a.compose(o.negation)},i("div",{className:"fxs-settings-svg",image:a.compose((e=>e?ne:oe))}))))}function ge(e){return 1===e?G.singleSubscriptionCount:G.multiSubscriptionsCountFormat.format(e)}function he(e){const{vm:t}=e,a=t.isLoading,c=i("span",{className:"msportalfx-font-semibold"},Z),u={title:Z,node:c},d=t.currentView.compose((e=>{if(!e)return u;const s=e=>({title:K.format(Z,e),node:i(r.FormattedFragment,{formatString:K,replacements:[c,e]})});switch(e){case"DirectoriesAndSubscriptions":return s(t.directorySettingsVm.title);case"Filters":return s(t.filterSettingsVm.title);case"AppearanceAndStartup":return s(t.appearanceSettingsVm.title);case"LanguageAndRegion":return s(t.languageAndRegionSettingsVm.title);case"MyInformation":return s(t.myInformationSettingsVm.title);case"SignoutAndNotifications":return s(t.signoutAndNotificationSettingsVm.title);case"MoreAzureResources":return s(t.moreAzureResourcesVm.title);default:return u}})),p=(0,l.initializeUsefulLinks)(_.currentLocaleContext);if(t.diContainer.get(FxImpl.Features).isEnabled("hidepartneridlink")){const e=MsPortalFx.findIndex(p,(e=>"PartnerNetworkLinkClicked"===e.telemetryAction));e>-1&&p.splice(e,1)}const h=(0,s.makeWritableComputation)(1<<20),f=h.compose((e=>e<=780)),v=i(s.Fragment,null,i("div",{className:"msportalfx-font-semibold"},G.usefulLinks),i("ul",{className:"fxs-settings-list"},p.filter((e=>e.url)).map((e=>{const t=[e.className,e.url.startsWith("#")?null:"msportalfx-ext-link"].filter(MsPortalFx.identity);return i("li",null,i("a",{fxclick:de(e.url,e.target,e.telemetryAction),className:t},e.text))})),t.showMoreAzureResourcesLink?i("li",null,i("a",{fxclick:()=>{t.navigateToSettingsTab("MoreAzureResources","Useful Links")}},G.moreAzureResourcesTitle)):null,t.showFeedbackLink?i("li",null,i("a",{className:"fxs-settings-feedback-link",fxclick:()=>{t.openFeedbackPane()}},G.feedbackLink)):null)),x=a.compose(o.negation);return i(s.Fragment,null,i(s.Css,{css:z}),i("div",{className:["fxs-settings-flyout-container fxs-portal-text",{"fxs-blade-layout-lg":f.compose(o.negation)}],onResize:({width:e})=>{h(e)}},i(s.Once,{"data-odebug":"4",condition:x,falseFn:()=>J,trueFn:()=>i("div",{className:"fxs-settings-content-wrapper"},i("div",{className:"fxs-settings-content"},i("div",{className:"fxs-settings-header"},i(s.If,{condition:f,falseFn:()=>i("div",{className:"fxs-settings-title",title:d.compose((e=>e.title))},d.compose((e=>e.node))),trueFn:()=>i(s.LifetimeManagerScoped,{fn:e=>{const a=(0,n.toObservable)(e,t.currentView),o=[{text:t.appearanceSettingsVm.title,value:"AppearanceAndStartup"},{text:t.languageAndRegionSettingsVm.title,value:"LanguageAndRegion"},{text:t.signoutAndNotificationSettingsVm.title,value:"SignoutAndNotifications"}];t.showOverview&&o.splice(0,0,{text:t.overviewVm.title,value:"Overview"}),t.filterSettingsVm&&o.splice(1,0,{text:t.filterSettingsVm.title,value:"Filters"}),t.showDirectoriesAndSubscriptionsView&&o.splice(1,0,{text:t.directorySettingsVm.title,value:"DirectoriesAndSubscriptions"}),t.showMyInformation&&o.splice(o.length-1,0,{text:t.myInformationSettingsVm.title,value:"MyInformation"});const r=(0,g.create)(e,{ariaLabel:G.currentView,items:o,value:a,filter:!0});return a.subscribe(e,(e=>{t.navigateToSettingsTab(e,"NavDropDown")})),i(s.Fragment,null,i("div",{className:"fxs-settings-title-sm msportalfx-font-semibold"},G.title),i(m.DropDown,{className:"fxs-settings-navdropdown",vm:r}))}})}),i("div",{className:"fxs-settings-stretch"}),i("button",{type:"button",className:"fxs-settings-close-button msportalfx-hideonactivated",title:j.close,"aria-label":j.close,image:W.Close(),fxclick:()=>(t.onClose(),!1)})),i("div",{className:"fxs-settings-body"},i(s.If,{condition:f.compose(o.negation),trueFn:()=>i("div",{className:"fxs-settings-menu-wrapper"},i(S.SearchBox,{className:"fxs-settings-menu-search",vm:t.menuSearch}),i("div",{className:"fxs-settings-menu"},i("ul",{className:"fxs-settings-menu-list fxs-settings-list"},t.settingsNavItems.map((e=>{const s=e.item;return i("li",{className:["fxs-settings-menu-item fxs-portal-text fxs-portal-hover",{"fxs-portal-selected":t.currentView.compose((e=>e===s.value))}],tabindex:"0",fxclick:()=>(e.onClick(),!1)},i("div",{className:["fxs-settings-category-button","DirectoriesAndSubscriptions"===e.item.value?"fxs-menu-directories-subscriptions":""]},s.text))})))),i("div",{className:"fxs-settings-footer fxs-settings-menu-footer"},v))}),i("div",{className:l.mainContentClass},i("div",{className:"fxs-settings-dialogcontainer"},i("div",{className:"fxs-settings-dialogtarget"})),i(s.If,{condition:t.currentView.compose((e=>"Overview"===e&&t.showOverview)),trueFn:()=>i(fe,{vm:t})}),i(s.If,{condition:t.currentView.compose((e=>"DirectoriesAndSubscriptions"===e)),trueFn:()=>i(ve,{vm:t})}),i(s.If,{condition:t.currentView.compose((e=>"Filters"===e)),trueFn:()=>i(s.LifetimeManagerScoped,{fn:e=>i(xe,{vm:t,lifetime:e})})}),i(s.If,{condition:t.currentView.compose((e=>"AppearanceAndStartup"===e)),trueFn:()=>i(be,{vm:t})}),i(s.If,{condition:t.currentView.compose((e=>"LanguageAndRegion"===e)),trueFn:()=>i(we,{vm:t})}),i(s.If,{condition:t.currentView.compose((e=>"MyInformation"===e)),trueFn:()=>i(ye,{vm:t})}),i(s.If,{condition:t.currentView.compose((e=>"SignoutAndNotifications"===e)),trueFn:()=>i(Ce,{vm:t})}),i(s.If,{condition:t.currentView.compose((e=>"MoreAzureResources"===e)),trueFn:()=>i(Ie,{vm:t})}),i("div",{className:"fxs-settings-sm-footer fxs-settings-menu-footer"},v)))))})))}function fe(e){const{vm:t}=e,a=t.isLoading,{overviewVm:n,appearanceSettingsVm:o,languageAndRegionSettingsVm:r,myInformationSettingsVm:l,signoutAndNotificationSettingsVm:c,showDirectoriesAndSubscriptionsView:u,showMyInformation:d,filterSettingsVm:m}=t,p=!!m||u;return i("div",{className:"fxs-settings-tab"},i(s.If,{condition:a,trueFn:()=>J,falseFn:()=>i(s.Fragment,null,i(T.CommandBar,{className:"fxs-settings-toolbar fxs-settings-toolbar-slim",vm:n.commandBar}),i("div",{className:"fxs-settings-overview"},p?i("div",{className:"fxs-settings-column"},u?i(I.Section,{className:"fxs-settings-overviewsection",name:ce(t.directorySettingsVm.title,(()=>{t.navigateToSettingsTab("DirectoriesAndSubscriptions","Overview")}))},i(D.DataGrid,{className:"fxs-settings-overviewgrid",vm:n.recentDirectoriesGrid}),i("a",{tabindex:"0",className:"fxs-settings-pointer",fxclick:()=>(t.navigateToSettingsTab("DirectoriesAndSubscriptions","Overview"),!1)},G.seeAll)):null,i(s.If,{condition:n.filtersGrid,trueFn:()=>i(I.Section,{className:"fxs-settings-overviewsection",name:ce(m.title,(()=>{t.navigateToSettingsTab("Filters","Overview")}))},i(s.LifetimeManagerScoped,{fn:e=>i(D.DataGrid,{className:"fxs-settings-overviewgrid",vm:(0,s.evaluate)(e,n.filtersGrid)})}),i("a",{tabindex:"0",className:"fxs-settings-pointer",fxclick:()=>(t.navigateToSettingsTab("Filters","Overview"),!1)},G.seeAll))})):null,i("div",{className:"fxs-settings-column"},i(I.Section,{className:"fxs-settings-overviewsection",name:ce(o.title,(()=>{t.navigateToSettingsTab("AppearanceAndStartup","Overview")})),children:[i(M.PcControl,{vm:o.summary,container:null})]}),i(I.Section,{className:"fxs-settings-overviewsection",name:ce(r.title,(()=>{t.navigateToSettingsTab("LanguageAndRegion","Overview")})),children:[i(M.PcControl,{vm:r.summary,container:null})]}),d?i(I.Section,{className:"fxs-settings-overviewsection",name:ce(l.title,(()=>{t.navigateToSettingsTab("MyInformation","Overview")})),children:[i(M.PcControl,{vm:l.summary,container:null})]}):null,i(I.Section,{className:"fxs-settings-overviewsection",name:ce(c.title,(()=>{t.navigateToSettingsTab("SignoutAndNotifications","Overview")})),children:[i(M.PcControl,{vm:c.summary,container:null})]}))))}))}function ve(e){const{vm:t}=e,a=t.directorySettingsVm,l={header:a.favoritesTab.title,content:()=>i(I.Section,{children:[i("div",{className:"fxs-settings-directoriessection"},i("div",{className:"fxs-settings-searchmain"},i(S.SearchBox,{vm:a.favoritesTab.searchVm})),i(M.PcControl,{className:"fxs-settings-directoriesgrid",vm:a.favoritesTab.gridVm,container:null}))]}),telemetryName:"favoriteDirectoriesTab"},c={header:a.allDirectoriesTab.title,content:()=>i(I.Section,{children:[i("div",{className:"fxs-settings-directoriessection"},i("div",{className:"fxs-settings-searchmain"},i(S.SearchBox,{vm:a.allDirectoriesTab.searchVm})),i(M.PcControl,{className:"fxs-settings-directoriesgrid",vm:a.allDirectoriesTab.gridVm,container:null}))]}),telemetryName:"allDirectoriesTab"},d=(0,v.create)(t.flyoutLifetime,{content:G.currentDirectoryDescription}),p=(0,s.composeComputation)([a.currentDirectoryName,a.passthroughUser],((e,t)=>i("span",{className:"msportalfx-text-ellipsis"},i(r.FormattedFragment,{formatString:G.labelValueFormat,replacements:[i("div",{className:"fxs-settings-sectionlabel"},i("span",{className:"msportalfx-font-semibold"},G.currentDirectory),i(M.PcControl,{className:"fxs-settings-sectionlabel-infoballoon",vm:d,container:null})),i("span",{className:"msportalfx-text-ellipsis fxs-settings-currentdirectoryname"},t?`${q.passthrough} (${e})`:e)]})))),g=(0,n.toObservable)(t.flyoutLifetime,a.startupDirectoryName),h=(0,v.create)(t.flyoutLifetime,{content:ko.pureComputed((()=>G.startupDirectoryDescriptionFormat.format(g())))}),f=(0,s.composeComputation)([a.startupDirectoryName,a.allTenants],((e,s)=>{const a=i("span",{className:"msportalfx-text-ellipsis"},e);return i("span",{className:"msportalfx-text-ellipsis"},i(r.FormattedFragment,{formatString:G.labelValueFormat,replacements:[i("div",{className:"fxs-settings-sectionlabel"},i("span",{className:"msportalfx-font-semibold"},G.startupDirectory),i(M.PcControl,{className:"fxs-settings-sectionlabel-infoballoon",vm:h,container:null})),s.length>1?i(r.FormattedFragment,{formatString:G.changeFormat,replacements:[a,i("a",{title:G.change,tabindex:"0",className:"fxs-settings-pointer",onClick:()=>(t.navigateToSettingsTab("AppearanceAndStartup","DirectoriesAndSubscriptions"),!1)},G.change)]}):a]}))})),x=(0,v.create)(t.flyoutLifetime,{content:u.Directory.subscriptionLabel}),b=(0,v.create)(t.flyoutLifetime,{content:G.directorySectionDescription});return i("div",{className:"fxs-settings-tab"},i(s.Once,{"data-odebug":"5",condition:a.finishedLoading,falseFn:()=>J,trueFn:()=>i("div",{className:"fxs-settings-stack fxs-settings-fullheightsection"},i(s.Fragment,null,i("div",{className:"fxs-settings-tabdescription"},a.showBasicSubscriptionFilter?G.subsFilterDescription:G.advancedSubsFilterDescription),i(s.If,{condition:a.passthroughUser,falseFn:()=>i("div",{className:"fxs-settings-quicksubfilter"},a.showBasicSubscriptionFilter?i(I.Section,{name:i("div",{className:"fxs-settings-sectionlabel"},i("span",{className:"msportalfx-font-semibold"},u.Directory.globalSubscriptionFilterLabel),i(M.PcControl,{className:"fxs-settings-sectionlabel-infoballoon",vm:x,container:null})),children:[i("div",{className:"fxs-settings-filterdropdown"},i("div",{className:{"fxs-display-none":a.subscriptionText.compose(o.negation)}},a.subscriptionText),i(A.ResourceFilter,{className:["fxs-settings-subscriptionfilterdropdown",{"fxs-display-none":a.subscriptionText}],vm:a.resourceFilter}))]}):i("div",{className:"fxs-settings-filterdropdown"},i(m.DropDown,{className:"fxs-settings-dropdownrow fxs-settings-subscriptionfilterdropdown",vm:a.globalFilterDropDown})),i("div",{className:["fxs-settings-stretch","fxs-settings-cappedwidth"]}),a.advancedFiltersToggle?i(I.Section,{leftLabelPosition:!0,children:[i(M.PcControl,{vm:a.advancedFiltersToggle,container:null})]}):null),trueFn:()=>i("div",{className:"fxs-settings-quicksubfilter"},G.passthroughNoSubAccess)}),i(s.If,{condition:a.pimEnabled,trueFn:()=>i("div",{className:"fxs-settings-pimsection"},i(I.Section,{name:i("div",{className:"fxs-settings-sectionlabel"},u.PriviledgeIdentityManagement.cannotFindSubscriptionTitle),children:[i("div",null,i("div",{className:"fxs-settings-tabdescription"},i(r.FormattedFragment,{formatString:u.PriviledgeIdentityManagement.cannotFindSubscriptionDescription,replacements:[i("a",{href:"https://learn.microsoft.com/azure/active-directory/privileged-identity-management/pim-configure",target:"_blank"},u.PriviledgeIdentityManagement.learnMore)]})),i("div",null,i("a",{title:u.PriviledgeIdentityManagement.eligibleAssignments,tabindex:"0",className:"fxs-settings-pointer",fxclick:de("#blade/Microsoft_Azure_PIMCommon/ActivationMenuBlade/azurerbac","_self","GoToEligibleAssignmentsClicked")},u.PriviledgeIdentityManagement.eligibleAssignments)))]}))}),i(I.Section,{name:i("div",{className:"fxs-settings-sectionlabel"},G.directories,i(M.PcControl,{className:"fxs-settings-sectionlabel-infoballoon",vm:b,container:null})),className:"fxs-settings-fullheight"},a.showSwitchDirectoryOption?i("div",{className:"fxs-settings-tabdescription"},i(r.FormattedFragment,{formatString:G.directoriesDescriptionFormat,replacements:[i("a",{className:"fxs-settings-directorieslearnmore msportalfx-ext-link",href:window.fx.environment.links.learnDirectory,target:"_blank"},G.directoryLearnMore)]})):null,i("div",{className:"fxs-settings-summary"},i("div",{className:"fxs-settings-summaryitem fxs-settings-cappedwidth-sm fxs-settings-currentdirectory"},p),i("div",{className:"fxs-settings-summaryitem fxs-settings-cappedwidth-sm fxs-settings-startupdirectory"},f)),a.showSwitchDirectoryOption?i(C.Tab,{className:["fxs-settings-stretch","fxs-settings-directoriestab"],tabPages:[l,c],activeIndex:a.activeTabIndex,onActiveIndexChange:e=>a.onActivateTab(e)}):null)))}))}function xe(e){const{vm:t,lifetime:a}=e,{isLoading:l,filterSettingsVm:c}=t,u=l.compose(o.negation),d=(e,t)=>[new b.Required,new b.Custom(G.duplicateFilterName,(i=>{const a=c.globalResourceFilters.value.reduce(((i,a)=>(t&&t===a.id||((0,s.isComputation)(a.name)&&i.push((0,s.evaluate)(e,a.name)),i.push(a.name)),i)),[]);return Promise.resolve({valid:!a.includes(i),message:G.duplicateFilterNameMessageFmt.format(i)})})),new b.LengthRange(1,50),new b.RegExMatch("^[a-zA-Z0-9- ]+$",G.filterNameCharsError)],m=(0,s.makeWritableComputation)(!1),p=(0,s.makeWritableComputation)(G.noFilter),g=(0,s.makeWritableComputation)(),h=(0,s.makeWritableComputation)(!1);p(i(s.If,{condition:h,trueFn:()=>g.compose((e=>G.noFilterCountFormat.format(ge(e)))),falseFn:()=>J})),Q||(Q=(0,N.getResourceCountsForFilter)({id:"",name:"",facets:[]},"SettingsFlyout")),Q.then((e=>{g(e.subscriptions),h(!0)}),(()=>{p(G.noFilter),h(!0)}));const C={title:i(pe,{filterId:"",title:(0,s.makeConstantComputation)(G.default),subtitle:p,isActive:c.selectedFilterId.compose((e=>""===e)),isLoading:(0,s.makeConstantComputation)(!1),canActivate:(0,s.makeConstantComputation)(!0),onClickActivate:()=>c.onClickActivateFilter(""),onClickDelete:MsPortalFx.noop,canModify:(0,s.makeConstantComputation)(!1),onClickModify:MsPortalFx.noop}),content:(0,s.makeConstantComputation)(G.defaultFilterDescription),expanded:m,onExpandChange:({expand:e})=>m(e)},S=c.globalResourceFilters.cMap((e=>{const t=e.id,i=(0,s.makeWritableComputation)(!1),o=me(a,{getAvailableDropdownValues:()=>c.getSubscriptionFilterFacetValues(),filter:e,isInEditMode:i}),r=(0,s.makeWritableComputation)(!1),l=(0,x.create)(a,{label:G.filterName,validations:d(a,e.id),value:(0,n.toObservable)(null,(0,s.ensureComputation)(e.name))});return{id:t,isInEditMode:i,grid:o,isOpen:r,filter:e,isDirty:(0,s.composeComputation)([(0,n.toComputation)(o.dirty),(0,n.toComputation)(l.dirty),i],((e,t,i)=>(e||t)&&i)),nameField:l}}));(0,s.subscribe)(a,[S.cFilter((e=>e.isDirty))],(e=>{c.modifyingFiltersAreDirty(!!e.length)}));const T=(0,s.composeComputation)([c.selectedFilterId,c.globalResourceFilters],((e,t)=>{if(!e)return G.default;return MsPortalFx.find(t,(t=>t.id===e)).name})),D=T.compose((e=>G.labelValueFormat.format(G.activeFilter,e))),A=T.compose((e=>i(r.FormattedFragment,{formatString:G.labelValueFormat,replacements:[i("span",{className:"msportalfx-font-semibold"},G.activeFilter),i("span",{className:"msportalfx-text-ellipsis fxs-settings-textspace"},e)]}))),P=S.cMap((e=>{const{filter:t,isOpen:r,isInEditMode:l,grid:u,nameField:d}=e,m=t.id,p=(0,s.makeWritableComputation)(!1);(0,s.subscribe)(a,[l,(0,n.toComputation)(u.validation.valid),(0,n.toComputation)(u.items),(0,n.toComputation)(d.valid),(0,n.toComputation)(u.dirty),(0,n.toComputation)(d.dirty)],((e,t,i,s,a,n)=>{p((a||n)&&e&&t&&i.length&&s)}));const g=(0,s.makeWritableComputation)(),h=(0,s.makeWritableComputation)(!t.resourceCountsPromise),f=(0,s.makeWritableComputation)(!!t.resourceCountsPromise);return t.resourceCountsPromise?(0,s.subscribeAndRun)(a,[t.resourceCountsPromise],(e=>{f(!0);const t=(0,s.makeWritableComputation)();g(i(s.If,{condition:f.compose(o.negation),trueFn:()=>t.compose((e=>{const t=ge(e);if(e)return t;const n=(0,v.create)(a,{content:G.noSubscriptionsMessage});return i(s.Fragment,null,t,i(M.PcControl,{vm:n,container:null}))})),falseFn:()=>G.countsLoading})),e&&e.then((e=>{const{subscriptions:i}=e;t(i),h(i>0),f(!1)}),(()=>{g(null),h(!0),f(!1)}))})):f(!1),{expanded:r,onExpandChange:({expand:e})=>r(e),title:i(pe,{filterId:m,title:t.name,canActivate:h,isActive:c.selectedFilterId.compose((e=>e===m)),isLoading:f,onClickActivate:()=>c.onClickActivateFilter(m),onClickDelete:()=>c.onClickDeleteFilter(m,t.name),canModify:l.compose(o.negation),onClickModify:()=>(e=>{e.isOpen(!0),e.isInEditMode(!0)})(e),subtitle:g}),content:i(I.Section,{className:"msportalfx-form",smartAlignLabel:!0},i(s.If,{condition:l,trueFn:()=>i(y.TextField,{className:"fxs-settings-editfiltername",vm:e.nameField})}),i(k.EditableGrid,{className:"fxs-settings-filtergrid",vm:u}),i(s.If,{condition:(0,s.composeComputation)([(0,n.toComputation)(u.rows),l],((e,t)=>!t&&!e.length)),trueFn:()=>i("div",{className:"fxs-settings-noitemsmessage"},G.noItemsMessage)}),i(s.If,{condition:l,trueFn:()=>i("div",null,i(w.Button,{className:"fxs-settings-applybutton",text:G.apply,style:0,onClick:()=>((async e=>{const{grid:t,isInEditMode:i,filter:a,nameField:n}=e,[o,r]=await Promise.all([t.validation.triggerValidation(),n.triggerValidation()]);if(!o||!r)return;const l=ue(t.items()),u=n.value();await c.updateFilter({id:a.id,name:u,facets:l}),(0,s.isComputation)(a.name)&&a.name(u),t.dirty(!1),n.dirty(!1),i(!1)})(e),!1),disabled:p.compose(o.negation)}),i(w.Button,{text:G.discard,style:1,onClick:()=>((async e=>{const{filter:t,grid:i,isInEditMode:n,nameField:o}=e;await c.revertFacets(t),o.value((0,s.isComputation)(t.name)?(0,s.evaluate)(a,t.name):t.name),i.dirty(!1),o.dirty(!1),n(!1)})(e),!1)}))}))}})),_=P.compose((e=>[C,...e]));return i("div",{className:"fxs-settings-tab"},i(s.Once,{"data-odebug":"6",condition:u,falseFn:()=>J,trueFn:()=>i("div",{className:["fxs-settings-stack","fxs-settings-cappedwidth"]},i(s.If,{condition:c.importFailedInfoBox,trueFn:()=>i(f.InfoBox,{vm:c.importFailedInfoBox.value,className:"fxs-settings-topalign"})}),i(f.InfoBox,{vm:c.welcomeInfoBox,className:"fxs-settings-topalign"}),i("div",{className:"fxs-settings-tabdescription"},i(r.FormattedFragment,{formatString:G.filtersDescriptionFormat,replacements:[i("a",{tabindex:"0",className:"fxs-settings-pointer",href:"#menu/directory"},G.switchCurrentDirectory)]})),i("div",{className:"fxs-settings-summary",title:D},i("span",{className:"fxs-settings-summaryitem"},A)),i(F.Accordion,{className:"fxs-settings-filtersaccordion",sections:_,ariaLabel:G.filtersTitle}),i(s.If,{condition:c.showAddFilterLink,trueFn:()=>i("a",{tabindex:"0",className:"fxs-settings-pointer fxs-settings-addfilter",fxclick:()=>(c.onClickAddFilter(),!1)},i("span",{className:"fxs-settings-svg",image:ae}),i("span",{className:"fxs-settings-addfilterlabel"},G.createFilter))}),i(s.If,{condition:c.showingCreateForm,concealmentBehavior:"remove",trueFn:()=>i(s.LifetimeManagerScoped,{fn:e=>{const t=(0,s.makeArrayComputation)([]),a=ko.observable(""),r=me(e,{getAvailableDropdownValues:()=>c.getSubscriptionFilterFacetValues(),filter:{name:(0,n.toComputation)(a),facets:t,resourceCountsPromise:null},isInEditMode:(0,s.makeWritableComputation)(!0)});e.registerForDispose((()=>{c.createFormIsDirty(!1)}));const l=(0,x.create)(e,{label:G.filterName,validations:d(e),value:a}),u=(0,s.makeWritableComputation)(!1);(0,s.subscribe)(e,[(0,n.toComputation)(l.dirty),(0,n.toComputation)(l.valid),(0,n.toComputation)(r.dirty),(0,n.toComputation)(r.validation.valid)],((e,t,i,s)=>u(e&&i&&t&&s)));(0,s.subscribe)(e,[(0,n.toComputation)(l.dirty),(0,n.toComputation)(r.dirty)],((e,t)=>{c.createFormIsDirty(e||t)}));const m=u.compose(o.negation);return i("div",{className:"fxs-settings-createfilterwrapper"},i("div",{className:"fxs-settings-createfiltertitle"},G.createFilter),i(I.Section,{className:"msportalfx-form",smartAlignLabel:!0},i(y.TextField,{vm:l}),i(k.EditableGrid,{className:"fxs-settings-filtergrid",vm:r}),i("div",null,i(w.Button,{className:"fxs-settings-applybutton",text:G.create,style:0,onClick:()=>((async()=>{const[e,t]=await Promise.all([l.triggerValidation(),r.validation.triggerValidation()]);if(!e||!t)return;const i=l.value(),s=ue(r.items());await c.createFilter(i,s)})(),!1),disabled:m}),i(w.Button,{text:G.cancel,style:1,onClick:()=>(c.onClickCancelCreateNew(),!1)}))))}})}),i(s.If,{condition:c.showMaxFiltersMessage,trueFn:()=>i("div",null,G.maxFilters)}))}))}function be(e){const{vm:t}=e,a=t.isLoading,n=t.appearanceSettingsVm,r=[i(s.PromiseFragment,{promise:(0,H.isFavoritesEnabled)(t.diContainer).then((e=>{if(e)return le({value:n.selectedDefaultMenuCollapseState,items:n.defaultMenuCollapseStatusOptions,label:u.UiSettings.DefaultMenuCollapseState.label})}))}),le({value:n.selectedTheme,items:n.themes,label:G.theme})];t.diContainer.get(E.Experimentation).shellAssignments.getBooleanValue(R.noHCThemesFlag)||r.push(le({value:n.selectedHighContrastMode,items:n.highContrastModes,label:G.highContrastTheme})),n.showLayoutOptions&&r.unshift(le({value:n.selectedSidebarLayoutMode,items:n.sidebarLayoutModes,label:G.menuBehavior}));const l=n.dirty.compose(o.negation),c=a.compose(o.negation);return i("div",{className:"fxs-settings-tab"},i(s.Once,{"data-odebug":"7",condition:c,falseFn:()=>J,trueFn:()=>i("div",{className:"fxs-settings-stack"},i(I.Section,{className:"msportalfx-form fxs-settings-stretch fxs-settings-scroll",smartAlignLabel:!0},i(I.Section,{name:i("div",{className:"fxs-settings-sectionlabel"},G.appearance),className:"fxs-settings-section",smartAlignLabel:!0,children:[i("div",{className:"fxs-settings-tabdescription"},G.appearanceDescription),...r]}),i(s.If,{condition:n.showStartupOptions,trueFn:()=>i(I.Section,{name:i("div",{className:"fxs-settings-sectionlabel"},G.startupTitle),className:"fxs-settings-section",smartAlignLabel:!0,children:[i("div",{className:"fxs-settings-tabdescription"},n.showLayoutOptions?G.startupDescriptionWithView:G.startupDescription),i(s.If,{condition:(0,s.makeConstantComputation)(n.showLayoutOptions),trueFn:()=>le({value:n.selectedLandingPage,items:n.landingPages,label:G.startupPage})}),i(s.If,{condition:n.showDefaultDirectorySelector,trueFn:()=>i(M.PcControl,{container:null,vm:n.startupDirectoryRadioButtons})})]})})),i("div",{className:"fxs-settings-footer"},i(w.Button,{className:"fxs-settings-applybutton",text:G.apply,style:0,onClick:()=>(n.applyChanges(),!1),disabled:l}),i(w.Button,{text:G.discard,style:1,onClick:()=>(n.revertChanges(),!1),disabled:l})))}))}function ye(e){const{vm:t}=e,a=t.isLoading,n=t.myInformationSettingsVm,l=n.enableApplyButton.compose(o.negation),c=n.dirty.compose(o.negation),u=a.compose(o.negation),d=n.isLoading.compose(o.negation);return i("div",{className:"fxs-settings-tab"},i(s.Once,{"data-odebug":"8",condition:u&&d,falseFn:()=>J,trueFn:()=>i(s.Fragment,null,t.showOverview?null:i(T.CommandBar,{className:"fxs-settings-toolbar",vm:n.commandBar}),i("div",{className:["fxs-settings-stack","fxs-settings-cappedwidth"]},i(s.If,{condition:n.errorInfoBox,trueFn:()=>i(M.PcControl,{vm:n.errorInfoBox.value,container:null})}),i(s.If,{condition:n.enableEmailUpdate,trueFn:()=>{const e=n.enableUserIntentSurvey.value;return i("div",{className:e?"fxs-settings-flyout-group":["fxs-settings-stretch","fxs-settings-flyout-group"]},i("div",{className:"fxs-settings-tab-title"},G.emailSetting),i("div",{className:"fxs-settings-tabdescription"},G.myInformationDescription),i(I.Section,{className:["msportalfx-form","fxs-settings-dropdownrow"],smartAlignLabel:!0,children:[i(M.PcControl,{vm:n.emailTextBox,container:null})]}),i(s.If,{condition:n.showCheckbox,trueFn:()=>i(p.CheckBoxField,{className:["fxc-section-control","fxs-settings-contactinfo-checkbox"],vm:n.emailOptInCheckBox})}),i(s.If,{condition:n.showCheckbox,falseFn:()=>i("div",{className:"fxs-settings-contactinfo-privacy-optedin"},i(r.FormattedFragment,{formatString:G.privacyDescriptionOptedIn,replacements:[i("a",{href:U.promotionalCommunicationsManager,target:"_blank",className:"msportalfx-ext-link"},i("span",null,G.promotionalCommunicationsManager)),i("a",{href:U.privacyStatement,target:"_blank",className:"msportalfx-ext-link"},i("span",null,G.privacyStatement))]})),trueFn:()=>i("div",{className:"fxs-settings-contactinfo-privacy"},i(r.FormattedFragment,{formatString:G.privacyDescription,replacements:[i("a",{href:U.promotionalCommunicationsManager,target:"_blank",className:"msportalfx-ext-link"},i("span",null,G.promotionalCommunicationsManager)),i("a",{href:U.privacyStatement,target:"_blank",className:"msportalfx-ext-link"},i("span",null,G.privacyStatement))]}))}),i(s.If,{condition:n.showCountryDropDown,trueFn:()=>i(I.Section,{className:["msportalfx-form","fxs-settings-dropdownrow","fxs-settings-contactinfo-country-dropdown"],smartAlignLabel:!0,children:[i(M.PcControl,{vm:n.countryDropdown,container:null})]})}))}}),i(s.If,{condition:n.enableUserIntentSurvey,trueFn:()=>i("div",{className:["fxs-settings-stretch","fxs-settings-flyout-group"]},i("div",{className:"fxs-settings-tab-title"},G.portalPersonalization),i("div",{className:"fxs-settings-tabdescription"},G.portalPersonalizationDescription),i(I.Section,{className:"msportalfx-form fxs-settings-stretch fxs-settings-dropdownrow fxs-settings-scroll",smartAlignLabel:!0,children:[i(m.DropDown,{className:"fxc-section-control",vm:n.userIntentDropdown})]}))}),i("div",{className:"fxs-settings-footer"},i(w.Button,{className:"fxs-settings-applybutton",text:G.apply,style:0,onClick:()=>(n.applyChanges(),!1),disabled:l}),i(w.Button,{text:G.discard,style:1,onClick:()=>(n.revertChanges(),!1),disabled:c}))))}))}function we(e){const{vm:t}=e,a=t.isLoading,n=t.languageAndRegionSettingsVm,r=n.dirty.compose(o.negation),l=a.compose(o.negation);return i("div",{className:"fxs-settings-tab"},i(s.Once,{"data-odebug":"9",condition:l,falseFn:()=>J,trueFn:()=>i("div",{className:"fxs-settings-stack"},i("div",{className:"fxs-settings-tabdescription"},G.languageAndRegionDescription),i(I.Section,{className:"msportalfx-form fxs-settings-stretch fxs-settings-dropdownrow fxs-settings-scroll",smartAlignLabel:!0,children:[i(m.DropDown,{className:"fxc-section-control",vm:n.languagesDropDown}),i(m.DropDown,{className:"fxc-section-control",vm:n.regionalFormatDropDown})]}),i("div",{className:"fxs-settings-footer"},i(w.Button,{className:"fxs-settings-applybutton",text:G.apply,style:0,onClick:()=>(n.applyChanges(),!1),disabled:r}),i(w.Button,{text:G.discard,style:1,onClick:()=>(n.revertChanges(),!1),disabled:r})))}))}function Ce(e){const{vm:t}=e,a=t.isLoading,r=t.signoutAndNotificationSettingsVm,l=a.compose(o.negation),c=t.signoutAndNotificationSettingsVm.isLoadingTenantTimeout.compose(o.negation),d=r.enableApplyButton.compose(o.negation),g=r.dirty.compose(o.negation);return i("div",{className:"fxs-settings-tab"},i(s.Once,{"data-odebug":"10",condition:l&&c,falseFn:()=>J,trueFn:()=>i("div",{className:"fxs-settings-stack"},i(I.Section,{className:"msportalfx-form fxs-settings-dropdownrow fxs-settings-space",smartAlignLabel:!0,name:G.signingOut,children:[i(s.Fragment,null,i(s.If,{condition:(0,s.ensureComputation)(r.isTenantAdmin),trueFn:()=>i(s.Fragment,null,i(s.If,{condition:r.tenantDefaultTimeout,trueFn:()=>i("div",{className:"fxs-settings-idletimeout-defaulttimeout"},r.tenantDefaultTimeout)}),i(p.CheckBoxField,{className:"fxc-section-control",vm:r.tenantPortalPolicyCheckbox}),i(s.If,{condition:(0,n.toComputation)(r.tenantPortalPolicyCheckbox.value).compose((e=>!0===e)),trueFn:()=>i(re,{label:"",node:i("div",{className:"fxs-settings-tenantidletimecontainer"},i(M.PcControl,{className:"fxs-settings-tenantidletimeout-hours",vm:r.tenantHoursTextBox,container:null}),i(M.PcControl,{vm:r.tenantMinutesTextBox,container:null}))})}))}),i("div",{className:"fxs-settings-space-small"},r.tenantLevelIdleTimeoutDescription),i(s.If,{condition:r.displayRegularTimeoutFields,trueFn:()=>i(s.Fragment,null,i(m.DropDown,{className:"fxc-section-control",vm:r.idleTimeoutDropDown}),i(s.If,{condition:(0,n.toComputation)(r.idleTimeoutDropDown.value).compose((e=>-1===e)),trueFn:()=>i("div",{className:"msportalfx-nested-control"},i(re,{label:u.UiSettings.idleTimeoutCustom,node:i("div",{className:"fxs-settings-idletimecontainer"},i(M.PcControl,{className:"fxs-settings-useridletimeout-hours",vm:r.customIdleTimeoutHoursField,container:null}),i(m.DropDown,{className:"fxs-settings-idletimemargin fxs-settings-useridletimeout-minutes",vm:r.customIdleTimeoutMinutesDropDown}))}))}))}),i(s.If,{condition:r.displayOverrideTimeoutFields,trueFn:()=>i(s.Fragment,null,i(M.PcControl,{vm:r.overrideCheckBox,container:null}),i(s.If,{condition:(0,n.toComputation)(r.overrideCheckBox.value).compose((e=>!0===e)),trueFn:()=>i(M.PcControl,{vm:r.overrideTextBox,container:null})}))}))]}),i(I.Section,{className:"msportalfx-form fxs-settings-stretch",smartAlignLabel:!0,name:G.notifications,children:[i(M.PcControl,{className:"fxc-section-control",vm:r.enableToastsCheckbox,container:null}),i(M.PcControl,{className:"fxc-section-control",vm:r.enableTeachingBubbleCheckbox,container:null})]}),i("div",{className:"fxs-settings-footer"},i(w.Button,{className:"fxs-settings-applybutton",text:G.apply,style:0,onClick:()=>(r.applyChanges(),!1),disabled:d}),i(w.Button,{text:G.discard,style:1,onClick:()=>(r.revertChanges(),!1),disabled:g})))}))}function Ie(e){const{vm:t}=e,a=t.isLoading,n=t.moreAzureResourcesVm,r=window.fx.environment.links,c=n.diContainer,u=c.get(L.RightContextPane),m=c.get(FxImpl.Features),p=a.compose(o.negation);return i("div",{className:"fxs-settings-tab"},i(s.Once,{"data-odebug":"11",condition:p,falseFn:()=>J,trueFn:()=>i("div",{className:"fxs-settings-stack"},i("div",{className:"fxs-settings-helplinks fxs-settings-helplink-spacer-large"},m.isEnabled("helpcontentwhatsnewenabled")?i("a",{className:"fxs-settings-link",title:d.HelpMenu.whatsNew,fxclick:de("#blade/HubsExtension/WhatsNewBlade","_self","WhatsNewBladeOpen")},d.HelpMenu.whatsNew):null,r.roadmap?i("a",{className:"fxs-settings-link msportalfx-ext-link",title:d.HelpMenu.roadmapLabel,fxclick:de(r.roadmap,"_blank","AzureRoadmapClicked")},i("span",null,d.HelpMenu.roadmapLabel)):null,m.isEnabled("guidedtour")?i("a",{href:"#",className:"fxs-settings-link",title:d.HelpMenu.welcomesequencePaneLabel,onClick:({event:e})=>{e.preventDefault(),(0,l.telemetryTrace)("LaunchGuidedTourClicked"),c.get(B.ShowWelcomeSequence).invoke({skipWelcomePrompt:!1,shouldDisplaySettingBubble:!1})}},d.HelpMenu.welcomesequencePaneLabel):null,window.fx.environment.chrome.hideShortcuts?null:i(s.LifetimeManagerScoped,{fn:e=>{const t=(0,O.memoizePromise)((e=>(e.event.preventDefault(),MsPortalFx.require("MsPortalImpl/Widgets/Widgets.KeyboardShortcutsPane").then((e=>e.create(c,u,c.get(V.KeyboardShortcutHandler)))).then((e=>{(0,l.telemetryTrace)("OpenKeyboardShortcuts"),e.toggle()})))));return e.registerForDispose(t),i("a",{href:"#",className:"fxs-settings-link",title:d.HelpMenu.keyboardshortcutsPaneLabel,onClick:t},d.HelpMenu.keyboardshortcutsPaneLabel)}}),i("a",{href:"#",className:"fxs-settings-link msportalfx-ext-link",title:d.HelpMenu.showDiagnosticsLabel,onClick:({event:e})=>{e.preventDefault(),(0,l.telemetryTrace)("ShowDiagnosticsClicked"),n.showDiagnosticsPopup()}},i("span",null,d.HelpMenu.showDiagnosticsLabel)),m.isEnabled("tryapp")?i("a",{href:FxImpl.internalEnv.portalApplicationUri+"/App/Download",className:"fxs-settings-link msportalfx-ext-link",title:d.HelpMenu.tryApp,target:"_blank"},i("span",null,d.HelpMenu.tryApp)):null,m.isEnabled("createsupportrequestlink")?i("a",{className:"fxs-settings-link msportalfx-ext-link",title:d.HelpMenu.newSupportRequestLabel,fxclick:de(r.createSupportRequest,"_blank","CreateSupportRequestClicked")},i("span",null,d.HelpMenu.newSupportRequestLabel)):null),m.isEnabled("mspexpert")?i("div",{className:"fxs-settings-helplink-expert"},i("h3",{className:"fxs-settings-helplink-header"},d.HelpMenu.Expert.header),i("div",{className:"fxs-settings-helplink-intro fxs--settings-helplink-spacer-small"},d.HelpMenu.Expert.intro),i("a",{className:"fxs-settings-link",title:d.HelpMenu.Expert.findCommand,fxclick:de("#blade/Microsoft_Azure_Marketplace/MarketplaceOffersBlade/selectedMenuItemId/solutionProviders","_self","FindAnExpertClicked")},d.HelpMenu.Expert.findCommand)):null,m.isEnabled("freelancer")?i("div",{className:"fxs-settings-helplink-freelancer"},i("h3",{className:"fxs-settings-helplink-header"},d.HelpMenu.FreeLancer.header),i("div",{className:"fxs-settings-helplink-intro fxs--settings-helplink-spacer-small"},d.HelpMenu.FreeLancer.intro),i("a",{className:"fxs-settings-link",title:d.HelpMenu.FreeLancer.findCommand,fxclick:de("https://www.upwork.com/ppc/microsoft/azure/","_blank","FindAFreeLancerClicked")},d.HelpMenu.FreeLancer.findCommand)):null,m.isEnabled("mspexpert")&&m.isEnabled("freelancer")?i("div",{className:"fxs-settings-helplinks"},i("a",{className:"fxs-settings-link",title:d.HelpMenu.optionsLearnMore,fxclick:de("https://learn.microsoft.com/microsoft-365/freelance-toolkit/azure-experts","_blank","LearnMoreClicked")},d.HelpMenu.optionsLearnMore)):null)}))}t.getFlyoutComponent=function(e){return i(s.LifetimeManagerScoped,{fn:t=>i(s.GetContext,{fn:s=>{const a=new l.ViewModel({diContainer:s.diContainer,settingsView:e,lifetime:t}),n=t.createChildLifetime();return i("div",{className:"fxs-settings-flyout fxs-portal-background",role:"presentation",afterMount:e=>{(0,l.createFlyout)(n,$(e),a)}},i(he,{vm:a}))}})})},t.SettingsFlyout=he,t.OverviewSettings=fe,t.DirectorySettings=ve,t.FilterSettings=xe,t.AppearanceSettings=be,t.MyInformationSettings=ye,t.LanguageAndRegionSettings=we,t.SignoutAndNotificationSettings=Ce,t.MoreAzureResourcesSettings=Ie}));